!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var s=t();for(var i in s)("object"==typeof exports?exports:e)[i]=s[i]}}(this,(()=>(()=>{var e={923:function(e){var t;t=()=>(()=>{"use strict";var e={147:e=>{e.exports=JSON.parse('{"name":"indigitall-web-core","description":"indigitall web core","version":"4.3.1","main":"index.js","author":"Smart2me S.L.","homepage":"https://indigitall.com","devDependencies":{"@babel/preset-env":"^7.18.10","babel-loader":"^8.2.5","filemanager-webpack-plugin":"^7.0.0","idempotent-babel-polyfill":"^7.4.4","script-loader":"^0.7.2","webpack":"^5.74.0","webpack-bundle-analyzer":"^4.6.1","webpack-cli":"^4.10.0"},"scripts":{"test":"echo \'There are not tests\'","public":"ws --directory ./public --port 80 --log.format dev","build":"webpack --config webpack.config.js --mode=production","build-dev":"webpack --config webpack.config.js --watch --mode=development","delete-node-modules":"rm -rf node_modules/ && rm -f package-lock.json","install-core":"npm install && npm run build"}}')}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,s),n.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{s.r(i),s.d(i,{default:()=>V});var e={};s.r(e),s.d(e,{BaseClient:()=>S,BaseRequest:()=>O});var t={};s.r(t),s.d(t,{Channel:()=>P,Device:()=>m,DeviceStatus:()=>N,ErrorDictionary:()=>A,ErrorModel:()=>p,EventType:()=>y,TopicSubscribeType:()=>w});var r={};s.r(r),s.d(r,{CommonUtils:()=>C,CorePermissions:()=>D,CryptoUtils:()=>v,ErrorUtils:()=>T,JsonUtils:()=>B,Log:()=>_,LogLevel:()=>u,TopicUtils:()=>M,Validations:()=>U});var n={platform:"webpush",version:"0.0.1"};const o=s(147);n.version=o.version;const a=n=Object.assign(n,{client:{URL_BASE:"https://device-api.indigitall.com/v1",URL_DEVICE_V2:"https://device-api.indigitall.com/v2",INAPP_URL_BASE:"https://inapp-api.indigitall.com/v1",INBOX_URL_BASE:"https://inbox-api.indigitall.com/v1",CUSTOMER_URL_BASE:"https://device-api.indigitall.com/v2"}}),c=new class{constructor(){this.storage=this.isLocalStorageAvailable()?window.localStorage:null}isLocalStorageAvailable(){try{const e=window.localStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==c.length}return!1}setItem(e,t){return null!=this.storage&&(this.storage.setItem(e,t),!0)}getItem(e){return null!=this.storage?this.storage.getItem(e):null}deleteItem(e){return!!this.storage&&(this.storage.setItem(e,value),!0)}clear(){this.storage&&this.storage.clear()}},l=c,E=new class{constructor(){this.TAG="[IND]IndexedDB: ",this.DB_NAME="indigitall.indexedDB",this.DB_VERSION=1,this.DB_STORE_NAME="indigitallStore",this.DB_STORE_MODE="readwrite",this.DB_KEY_PATH="id",this.DB_STORE_INDEX="storeIndex",this.IDB=indexedDB||mozzIndexedDB||webkitIndexedDB||msIndexedDB}async getDB(){return new Promise(((e,t)=>{const s=this.IDB;if(s){const i=s.open("indigitall.indexedDB",1);i.onupgradeneeded=function(){i.result.createObjectStore("indigitallStore").createIndex("storeIndex","store.key")},i.onsuccess=function(){const t=i.result,s=t.transaction("indigitallStore","readwrite"),r=s.objectStore("indigitallStore"),n=r.index("storeIndex");e({db:t,tx:s,store:r,index:n})},i.onerror=function(e){t(e)}}else t(!1)}))}async get(e,t){return new Promise(((s,i)=>{e||i(!1),e.index.get(t).onsuccess=t=>{t.target.result&&(this.close(e),s(t.target.result.store.value)),i(!1)}}))}async put(e,t,s){return new Promise(((i,r)=>{e||r(!1),e.store.put({store:{key:t,value:s}},t).onsuccess=t=>{this.close(e),i(s)}}))}close(e){if(e.tx)try{e.tx.oncomplete=()=>{e.db.close()}}catch(e){console.error(this.TAG,e)}}async setItem(e,t){try{const s=await this.getDB();return this.put(s,e,t)}catch(e){return e}}async getItem(e){try{const t=await this.getDB();return this.get(t,e)}catch(e){return e}}},h=new class{constructor(){this.SESSION="indigitall.session.storage",this.session=this.isSessionStorageAvailable()?window.sessionStorage:null}isSessionStorageAvailable(){try{const e=window.sessionStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==h.length}return!1}getItem(e){return null!=this.session?this.session.getItem(e):null}setItem(e,t){return null!=this.session&&(this.session.setItem(e,t),!0)}clearMessages(){this.session&&this.session.removeItem("messages")}},I=h,d=class{constructor(){this.storage=l,this.db=E,this.BASE_TIME=60,this.REPOSITORY="indigitall.repository",this.APP_KEY=this.REPOSITORY+".APP_KEY",this.VAPID_PUBLIC=this.REPOSITORY+".VAPID_PUBLIC",this.ENABLED=this.REPOSITORY+".ENABLED",this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID",this.SERVICE_SYNC_TIME=this.REPOSITORY+".SERVICE_SYNC_TIME",this.LOCATION_ENABLED=this.REPOSITORY+".LOCATION_ENABLED",this.LOCATION_UPDATE_MINUTES=this.REPOSITORY+".LOCATION_UPDATE_MINUTES",this.REQUEST_LOCATION=this.REPOSITORY+".REQUEST_LOCATION",this.BROWSER_PUBLIC_KEY=this.REPOSITORY+".BROWSER_PUBLIC_KEY",this.BROWSER_PRIVATE_KEY=this.REPOSITORY+".BROWSER_PRIVATE_KEY",this.PLATFORM=this.REPOSITORY+".PLATFORM",this.BROWSER_NAME=this.REPOSITORY+".BROWSER_NAME",this.BROWSER_VERSION=this.REPOSITORY+".BROWSER_VERSION",this.OS_NAME=this.REPOSITORY+".OS_NAME",this.OS_VERSION=this.REPOSITORY+".OS_VERSION",this.DEVICE_TYPE=this.REPOSITORY+".DEVICE_TYPE",this.SUPPORTED=this.REPOSITORY+".SUPPORTED",this.SERVICE_TIMESTAMP=this.REPOSITORY+".SERVICE_TIMESTAMP",this.LOCATION_TIMESTAMP=this.REPOSITORY+".LOCATION_TIMESTAMP",this.PERMISSION_LOCATION=this.REPOSITORY+".PERMISSION_LOCATION",this.SET_LOG_DEBUG=this.REPOSITORY+".SET_LOG_DEBUG",this.NEW_USER_TIMESTAMP=this.REPOSITORY+".NEW_USER_TIMESTAMP",this.EXTERNAL_ID=this.REPOSITORY+".EXTERNAL_ID",this.REGISTERED_BY_COOKIE=this.REPOSITORY+".REGISTERED_BY_COOKIE",this.LOG_LEVEL=this.REPOSITORY+".LOG_LEVEL",this.LATITUDE=this.REPOSITORY+".LATITUDE",this.LONGITUDE=this.REPOSITORY+".LONGITUDE",this.TOPIC_LIST=this.REPOSITORY+".TOPIC_LIST",this.INAPP_ENABLED=this.REPOSITORY+".INAPP_ENABLED",this.URL_INAPP_API=this.REPOSITORY+".URL_INAPP_API",this.INAPP_TOPICS=this.REPOSITORY+".INAPP_TOPICS"}setItemSessionStorage(e,t){I.setItem(e,t)}getItemSessionStorage(e){return I.getItem(e)}clearSessionStorage(){I.clearMessages()}setStorage(e,t){l.setItem(e,t)}getStorage(e){return l.getItem(e)}clearStorage(){l.clear()}setBrowserPublicKey(e){l.setItem(this.BROWSER_PUBLIC_KEY,e)}getBrowserPublicKey(){return l.getItem(this.BROWSER_PUBLIC_KEY)}setBrowserPrivateKey(e){l.setItem(this.BROWSER_PRIVATE_KEY,e)}getBrowserPrivateKey(){return l.getItem(this.BROWSER_PRIVATE_KEY)}async setAppKey(e){l.setItem(this.APP_KEY,e),E&&E.IDB&&await E.setItem(this.APP_KEY,e)}getAppKey(){return l.getItem(this.APP_KEY)}async getAppKeySync(){if(E&&E.IDB)return await E.getItem(this.APP_KEY)}setVAPID(e){l.setItem(this.VAPID_PUBLIC,e)}getVAPID(){return l.getItem(this.VAPID_PUBLIC)}setEnabled(e){l.setItem(this.ENABLED,e)}getEnabled(){return l.getItem(this.ENABLED)}setServiceSyncTime(e){l.setItem(this.SERVICE_SYNC_TIME,e*this.BASE_TIME)}getServiceSyncTime(){return l.getItem(this.SERVICE_SYNC_TIME)||1*this.BASE_TIME}setLocationEnabled(e){l.setItem(this.LOCATION_ENABLED,e)}getLocationEnabled(){return l.getItem(this.LOCATION_ENABLED)}setLocationUpdateMinutes(e){l.setItem(this.LOCATION_UPDATE_MINUTES,e)}getLocationUpdateMinutes(){return l.getItem(this.LOCATION_UPDATE_MINUTES)||30}async setRequestLocation(e){l.setItem(this.REQUEST_LOCATION,e)}getRequestLocation(){return!!l&&l.getItem(this.REQUEST_LOCATION)}async setPlatform(e){l.setItem(this.PLATFORM,e)}getPlatform(){return l&&l.getItem(this.PLATFORM)||a.platform}getVersion(){return a.version}async setBrowserName(e){l.setItem(this.BROWSER_NAME,e)}getBrowserName(){return l.getItem(this.BROWSER_NAME)}setBrowserVersion(e){l.setItem(this.BROWSER_VERSION,e)}getBrowserVersion(){return l.getItem(this.BROWSER_VERSION)}async setOsName(e){l.setItem(this.OS_NAME,e)}getOsName(){return l.getItem(this.OS_NAME)}setOsVersion(e){l.setItem(this.OS_VERSION,e)}getOsVersion(){return l.getItem(this.OS_VERSION)}setDeviceType(e){l.setItem(this.DEVICE_TYPE,e)}getDeviceType(){return l.getItem(this.DEVICE_TYPE)}setSupported(e){l.setItem(this.SUPPORTED,e)}getSupported(){return l.getItem(this.SUPPORTED)}setServiceTimestamp(e){l.setItem(this.SERVICE_TIMESTAMP,e)}getServiceTimestamp(){return l.getItem(this.SERVICE_TIMESTAMP)}setLocationTimestamp(e){l.setItem(this.LOCATION_TIMESTAMP,e)}getLocationTimestamp(){return l.getItem(this.LOCATION_TIMESTAMP)}setPermissionLocation(e){l.setItem(this.PERMISSION_LOCATION,e)}getPermissionLocation(){return l.getItem(this.PERMISSION_LOCATION)}setDebugLog(e){l.setItem(this.SET_LOG_DEBUG,e)}getDebugLog(){return"false"!==l.getItem(this.SET_LOG_DEBUG)}setLogLevel(e){l.setItem(this.LOG_LEVEL,e)}getLogLevel(){return l.getItem(this.LOG_LEVEL)}setNewUserTimestamp(e){l.setItem(this.NEW_USER_TIMESTAMP,e)}getNewUserTimestamp(){return l.getItem(this.NEW_USER_TIMESTAMP)}async setExternalIdRequest(e){l&&l.isLocalStorageAvailable()&&l.setItem(this.EXTERNAL_ID,e),E&&E.IDB&&await E.setItem(this.EXTERNAL_ID,e)}async getExternalIdRequest(){let e;try{l&&l.isLocalStorageAvailable()?e=l.getItem(this.EXTERNAL_ID):E&&E.IDB&&(e=await E.getItem(this.EXTERNAL_ID))}catch(e){}return e}setExternalId(e){l.setItem(this.EXTERNAL_ID,e)}getExternalId(){return l.getItem(this.EXTERNAL_ID)}async getRegisteredByCookie(){return l.getItem(this.REGISTERED_BY_COOKIE)}async setRegisteredByCookie(e){l.setItem(this.REGISTERED_BY_COOKIE,e)}setLatitude(e){l.setItem(this.LATITUDE,e)}getLatitude(){return l.getItem(this.LATITUDE)}setLongitude(e){l.setItem(this.LONGITUDE,e)}getLongitude(){return l.getItem(this.LONGITUDE)}async setInAppTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.INAPP_TOPICS,e)}async getInAppTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.INAPP_TOPICS))}catch(e){}return e}async setTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.TOPIC_LIST,e)}async getTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.TOPIC_LIST))}catch(e){}return e}getUrlInappApi(){return this.getStorage(this.URL_INAPP_API)}setUrlInappApi(e){this.setStorage(this.URL_INAPP_API,e)}setInAppEnabled(e){this.setStorage(this.INAPP_ENABLED,e)}isInAppEnabled(){return this.getStorage(this.INAPP_ENABLED)}},u=Object.freeze({DEBUG:1,INFO:2,WARNING:3,ERROR:4}),g=u;class R{constructor(e){this.tag="[IND]",e&&(this.tag=e),this.level=g.INFO,this.setLogLevel((new d).getLogLevel()),this.log=[]}setLogLevel(e){e&&e>=g.DEBUG&&e<=g.ERROR&&(this.level=e)}static addedAsString(e){return"string"==typeof e?e:JSON.stringify(e,null,2)}d(){if(this.level<=g.DEBUG)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}i(){if(this.level<=g.INFO)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}w(){if(this.level<=g.WARNING)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}e(){if(this.level<=g.ERROR)if(1==arguments.length&&arguments.errorCode)this.log+=`${error.errorCode}: ${error.errorMessage}`;else for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}writeLog(){this.log.length>0&&this.tag&&this.log&&console.log(this.tag,this.log),this.log=[]}}const _=R,p=class{constructor(e,t,s){this.errorCode=e,this.errorMessage=t,null!=s&&(this.exceptionMessage=s)}},T=new class{constructor(){}showError(e,t,s){if(null!=e){const i=Object.values(e.ErrorCode).indexOf(t);return i>=0?new p(Object.keys(e.ErrorCode)[i],Object.keys(e.ErrorMessage)[i],s):new p(GENERAL_ERROR,"general error",s)}}},A={ErrorCode:{GENERAL_ERROR:600,API_SERVER_ERROR:500,API_PARAMETER_MISSING:400,API_APPKEY_NOT_VALID:401,API_FORBIDDEN_REQUEST:403,API_DEVICE_NOT_FOUND:404,API_TOPICS_ARE_INSERTED:409,BAD_REQUEST_SERVER_ERROR:410},ErrorMessage:{GENERAL_ERROR:"General Error",API_SERVER_ERROR:"Error server response",API_PARAMETER_MISSING:"Api parameter missing",API_APPKEY_NOT_VALID:"appKey is not valid",API_FORBIDDEN_REQUEST:"forbidden request",API_DEVICE_NOT_FOUND:"device not found",API_TOPICS_ARE_INSERTED:"topics are inserted",BAD_REQUEST_SERVER_ERROR:"bad request"}},S=class{constructor(){this.URL_BASE="",this.GET="GET",this.POST="POST",this.PUT="PUT",this.DELETE="DELETE"}async getURL(){return this.URL_BASE}async call(e,t,s,i){const r=new _("[IND]BaseClient: ");s.isServiceWorkerRequest()&&r.setLogLevel(g.DEBUG);let n=await this.getURL()+s.getPath(t)+s.getParams();s.isJourneyRequest()&&(n=n.replace("v1","v2"));const o={method:e,headers:s.addHeaders()};e!==this.GET&&(o.body=JSON.stringify(s.getBody())),i&&(o.credentials=i);try{const t=await fetch(n,o),i=await t.json();return t.ok?(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\nResponse Body:",JSON.stringify(i.data,null,"\t")).writeLog(),i):(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\n").writeLog(),new p(i.statusCode,i.message))}catch(t){return r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Error: "+t).writeLog(),T.showError(A,A.ErrorCode.GENERAL_ERROR,t)}}async get(e,t){return await this.call(this.GET,e,t)}async post(e,t,s){return await this.call(this.POST,e,t,s)}async put(e,t,s){return await this.call(this.PUT,e,t,s)}async delete(e,t){return await this.call(this.DELETE,e,t)}},O=class{constructor(){this.PARAM_APP_KEY="appKey",this.PARAM_DEVICE_ID="deviceId",this.PARAM_PUSH_TOKEN="pushToken",this.PARAM_ENABLED="enabled",this.PARAM_PLATFORM="platform",this.PARAM_VERSION="version",this.PARAM_TOPICS="topics",this.PARAM_EVENT_TYPE="eventType",this.PARAM_PUSH_ID="pushId",this.PARAM_CLICKED_BUTTON="clickedButton",this.PARAM_PERMISSION_TYPE="permissionType",this.PARAM_LATITUDE="latitude",this.PARAM_LONGITUDE="longitude",this.PARAM_INAPP_ID="inAppId",this.PARAM_INAPP_EVENT_TYPE="eventType",this.PARAM_INAPP_CLICKED_BUTTON="clickedButton",this.PARAM_INAPP_LAST_VERSION_ID="lastVersionId",this.PARAM_INBOX_EXTERNALID="externalId",this.PARAM_INBOX_PAGE="page",this.PARAM_INBOX_PAGE_SIZE="pageSize",this.PARAM_INBOX_DATE_FROM="dateFrom",this.PARAM_INBOX_DATE_TO="dateTo",this.PARAM_INBOX_STATUS="status",this.PARAM_INBOX_SENDER_IDS="sendingIds",this.PARAM_CUSTOMER_ID="customerId",this.PARAM_CUSTOMER_FIELD_NAMES="fieldNames",this.PARAM_CUSTOMER_FIELDS="fields",this.PARAM_CUSTOMER_LINK="link",this.PARAM_CUSTOMER_CHANNEL="channel",this.appKey=(new d).getAppKey(),this.params=null,this.pathParams={},this.headers={}}getParams(){return"?"+this.PARAM_APP_KEY+"="+this.appKey+(this.params?"&"+this.params:"")}getBody(){return this.body?this.body:""}getPath(e){let t=e;return Object.keys(this.pathParams).forEach((e=>{t=t.replace(e,this.pathParams[e])})),t}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}isServiceWorkerRequest(){return this.serviceWorkerRequest}setServiceWorkerRequest(e){this.serviceWorkerRequest=e}isJourneyRequest(){return this.journeyRequest}setJourneyRequest(e){this.journeyRequest=e}},P=Object.freeze({PUSH:"push",INAPP:"inapp",CHAT:"chat"}),m=class{constructor(e=null,t){null==e?(this.browserPublicKey=(new d).getBrowserPublicKey(),this.browserPrivateKey=(new d).getBrowserPrivateKey(),this.platform=(new d).getPlatform(),this.version=(new d).getVersion(),this.browserName=(new d).getBrowserName(),this.browserVersion=(new d).getBrowserVersion(),this.osName=(new d).getOsName(),this.osVersion=(new d).getOsVersion(),this.deviceType=(new d).getDeviceType(),(new d).getEnabled()&&(this.enabled="true"===(new d).getEnabled()),(new d).getExternalId()&&(this.externalCode=(new d).getExternalId())):t?(e.enabled&&(this.enabled=e.enabled,(new d).setEnabled(this.enabled)),e.registeredByCookie&&(this.registeredByCookie=e.registeredByCookie,(new d).setRegisteredByCookie(this.registeredByCookie))):(e.browserPublicKey&&(this.browserPublicKey=e.browserPublicKey),e.browserPrivateKey&&(this.browserPrivateKey=e.browserPrivateKey),e.platform&&(this.platform=e.platform),e.version&&(this.version=e.version),e.osVersion&&(this.osVersion=e.osVersion),e.browserName&&(this.browserName=e.browserName),e.browserVersion&&(this.browserVersion=e.browserVersion),e.osName&&(this.osName=e.osName),e.deviceType&&(this.deviceType=e.deviceType),e.enabled&&(this.enabled=e.enabled),e.externalCode&&(this.externalCode=e.externalCode)),this.platform&&(this.productName=this.platform),this.version&&(this.productVersion=this.version),navigator&&"language"in navigator&&(this.locale=navigator.language),Intl&&"DateTimeFormat"in Intl&&(this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone),this.timeOffset=-(new Date).getTimezoneOffset()}getDeviceId(){return this.deviceId}setDeviceId(e){this.deviceId=e}setExternalCode(e){this.externalCode=e}toJSON(){const e={};return this.platform&&(e.platform=this.platform),this.version&&(e.version=this.version),this.productName&&(e.productName=this.productName),this.productVersion&&(e.productVersion=this.productVersion),this.browserName&&(e.browserName=this.browserName),this.browserVersion&&(e.browserVersion=this.browserVersion),this.osName&&(e.osName=this.osName),this.osVersion&&(e.osVersion=this.osVersion),this.deviceType&&(e.deviceType=this.deviceType),this.locale&&(e.locale=this.locale),this.timeZone&&(e.timeZome=this.timeZone),this.timeOffset&&(e.timeOffset=this.timeOffset),this.enabled&&(e.enabled=this.enabled),this.browserPublicKey&&(e.browserPublicKey=this.browserPublicKey),this.browserPrivateKey&&(e.browserPrivateKey=this.browserPrivateKey),this.externalCode&&(e.externalCode=this.externalCode),e}},N=Object.freeze({DEFAULT:-1,ENABLE:1,DISABLE:0}),y=Object.freeze({EVENT_TYPE_CLICK:"click",EVENT_TYPE_RECEIVE:"receive",EVENT_TYPE_UPDATE:"update",EVENT_TYPE_ACCEPT:"accept",EVENT_TYPE_REJECT:"reject",EVENT_TYPE_ASK:"ask"}),w=Object.freeze({SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe"}),C=class{static isServiceTimestampExceed(){return!(new d).getServiceTimestamp()||(new d).getServiceSyncTime()<=(Date.now()-(new d).getServiceTimestamp())/6e4}static isFunction(e){return!(!e||"function"!=typeof e)}},D=class{static async getPermissions(){const e=await this.getPermission("geolocation"),t={};return e&&(t.location=e.state),t}static async getPermission(e){try{if(navigator&&navigator.permissions&&navigator.permissions.query&&e)return await navigator.permissions.query({name:e,userVisibleOnly:!0})}catch(e){return null}return null}static async setPermissionsCallback(){await this.setCallback("geolocation",navigator.indigitallRequestLocationPermission)}static async setCallback(e,t){const s=await this.getPermission(e);if(s){let i=s.state;"onchange"in s&&(s.onchange=()=>{new _("[IND]CorePermissions: ").d(e+" permission state has changed from "+i+" to "+s.state).writeLog(),i=s.state,t&&t({name:e,state:s.state})})}}},b=new _("[IND]Crypto"),f=new TextEncoder("utf-8"),L="HMAC",v=class{static async createHmac(e,t){try{const s=window?.crypto?.subtle;if(!s)return;const i=await s.importKey("raw",f.encode(e),{name:L,hash:{name:"SHA-256"}},!1,["sign","verify"]),r=await s.sign(L,i,f.encode(t)),n=new Uint8Array(r),o=Array.prototype.map.call(n,(e=>("00"+e.toString(16)).slice(-2))).join("");return b.d("hmac: ",o).writeLog(),o}catch(e){return void b.e("error:",e).writeLog()}}},B=class{static compareJSON(e,t){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const i of s)if(e[i]!==t[i]){if("object"!=typeof e[i]||"object"!=typeof t[i])return!1;if(!isEqual(e[i],t[i]))return!1}return!0}},U=class{static isValidFormat(e){return null!=e&&""!=e&&"null"!=e&&e.length>8}},M=class{static setTopicChannel(e,t){const s=[];for(let i=0;i<e.length;i++){const r=e[i];r.channel=t,s.push(r)}return s}},V={Repository:d,Config:a,Api:e,Models:t,Utils:r}})(),i})(),e.exports=t()},109:(e,t,s)=>{"use strict";s.d(t,{Core:()=>Y});var i={};s.r(i),s.d(i,{BaseClient:()=>P,BaseRequest:()=>m});var r={};s.r(r),s.d(r,{Channel:()=>N,Device:()=>y,DeviceStatus:()=>w,ErrorDictionary:()=>O,ErrorModel:()=>T,EventType:()=>C,TopicSubscribeType:()=>D});var n={};s.r(n),s.d(n,{CommonUtils:()=>b,CorePermissions:()=>f,CryptoUtils:()=>U,ErrorUtils:()=>A,JsonUtils:()=>M,Log:()=>p,LogLevel:()=>g,TopicUtils:()=>x,Validations:()=>V});s(923);var o={platform:"webpush",version:"0.0.1"};const a=s(391);o.version=a.version;const c=o=Object.assign(o,{client:{URL_BASE:"https://device-api.indigitall.com/v1",URL_DEVICE_V2:"https://device-api.indigitall.com/v2",INAPP_URL_BASE:"https://inapp-api.indigitall.com/v1",INBOX_URL_BASE:"https://inbox-api.indigitall.com/v1",CUSTOMER_URL_BASE:"https://device-api.indigitall.com/v2"}});const l=new class{constructor(){this.storage=this.isLocalStorageAvailable()?window.localStorage:null}isLocalStorageAvailable(){try{const e=window.localStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==l.length}return!1}setItem(e,t){return null!=this.storage&&(this.storage.setItem(e,t),!0)}getItem(e){return null!=this.storage?this.storage.getItem(e):null}deleteItem(e){return!!this.storage&&(this.storage.setItem(e,value),!0)}clear(){this.storage&&this.storage.clear()}},E=l;const h=new class{constructor(){this.TAG="[IND]IndexedDB: ",this.DB_NAME="indigitall.indexedDB",this.DB_VERSION=1,this.DB_STORE_NAME="indigitallStore",this.DB_STORE_MODE="readwrite",this.DB_KEY_PATH="id",this.DB_STORE_INDEX="storeIndex",this.IDB=indexedDB||mozzIndexedDB||webkitIndexedDB||msIndexedDB}async getDB(){return new Promise(((e,t)=>{const s=this.IDB;if(s){const i=s.open("indigitall.indexedDB",1);i.onupgradeneeded=function(){i.result.createObjectStore("indigitallStore").createIndex("storeIndex","store.key")},i.onsuccess=function(){const t=i.result,s=t.transaction("indigitallStore","readwrite"),r=s.objectStore("indigitallStore"),n=r.index("storeIndex");e({db:t,tx:s,store:r,index:n})},i.onerror=function(e){t(e)}}else t(!1)}))}async get(e,t){return new Promise(((s,i)=>{e||i(!1),e.index.get(t).onsuccess=t=>{t.target.result&&(this.close(e),s(t.target.result.store.value)),i(!1)}}))}async put(e,t,s){return new Promise(((i,r)=>{e||r(!1),e.store.put({store:{key:t,value:s}},t).onsuccess=t=>{this.close(e),i(s)}}))}close(e){if(e.tx)try{e.tx.oncomplete=()=>{e.db.close()}}catch(e){console.error(this.TAG,e)}}async setItem(e,t){try{const s=await this.getDB();return this.put(s,e,t)}catch(e){return e}}async getItem(e){try{const t=await this.getDB();return this.get(t,e)}catch(e){return e}}};const I=new class{constructor(){this.SESSION="indigitall.session.storage",this.session=this.isSessionStorageAvailable()?window.sessionStorage:null}isSessionStorageAvailable(){try{const e=window.sessionStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==I.length}return!1}getItem(e){return null!=this.session?this.session.getItem(e):null}setItem(e,t){return null!=this.session&&(this.session.setItem(e,t),!0)}clearMessages(){this.session&&this.session.removeItem("messages")}},d=I;const u=class{constructor(){this.storage=E,this.db=h,this.BASE_TIME=60,this.REPOSITORY="indigitall.repository",this.APP_KEY=this.REPOSITORY+".APP_KEY",this.VAPID_PUBLIC=this.REPOSITORY+".VAPID_PUBLIC",this.ENABLED=this.REPOSITORY+".ENABLED",this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID",this.SERVICE_SYNC_TIME=this.REPOSITORY+".SERVICE_SYNC_TIME",this.LOCATION_ENABLED=this.REPOSITORY+".LOCATION_ENABLED",this.LOCATION_UPDATE_MINUTES=this.REPOSITORY+".LOCATION_UPDATE_MINUTES",this.REQUEST_LOCATION=this.REPOSITORY+".REQUEST_LOCATION",this.BROWSER_PUBLIC_KEY=this.REPOSITORY+".BROWSER_PUBLIC_KEY",this.BROWSER_PRIVATE_KEY=this.REPOSITORY+".BROWSER_PRIVATE_KEY",this.PLATFORM=this.REPOSITORY+".PLATFORM",this.BROWSER_NAME=this.REPOSITORY+".BROWSER_NAME",this.BROWSER_VERSION=this.REPOSITORY+".BROWSER_VERSION",this.OS_NAME=this.REPOSITORY+".OS_NAME",this.OS_VERSION=this.REPOSITORY+".OS_VERSION",this.DEVICE_TYPE=this.REPOSITORY+".DEVICE_TYPE",this.SUPPORTED=this.REPOSITORY+".SUPPORTED",this.SERVICE_TIMESTAMP=this.REPOSITORY+".SERVICE_TIMESTAMP",this.LOCATION_TIMESTAMP=this.REPOSITORY+".LOCATION_TIMESTAMP",this.PERMISSION_LOCATION=this.REPOSITORY+".PERMISSION_LOCATION",this.SET_LOG_DEBUG=this.REPOSITORY+".SET_LOG_DEBUG",this.NEW_USER_TIMESTAMP=this.REPOSITORY+".NEW_USER_TIMESTAMP",this.EXTERNAL_ID=this.REPOSITORY+".EXTERNAL_ID",this.REGISTERED_BY_COOKIE=this.REPOSITORY+".REGISTERED_BY_COOKIE",this.LOG_LEVEL=this.REPOSITORY+".LOG_LEVEL",this.LATITUDE=this.REPOSITORY+".LATITUDE",this.LONGITUDE=this.REPOSITORY+".LONGITUDE",this.TOPIC_LIST=this.REPOSITORY+".TOPIC_LIST",this.INAPP_ENABLED=this.REPOSITORY+".INAPP_ENABLED",this.URL_INAPP_API=this.REPOSITORY+".URL_INAPP_API",this.INAPP_TOPICS=this.REPOSITORY+".INAPP_TOPICS"}setItemSessionStorage(e,t){d.setItem(e,t)}getItemSessionStorage(e){return d.getItem(e)}clearSessionStorage(){d.clearMessages()}setStorage(e,t){E.setItem(e,t)}getStorage(e){return E.getItem(e)}clearStorage(){E.clear()}setBrowserPublicKey(e){E.setItem(this.BROWSER_PUBLIC_KEY,e)}getBrowserPublicKey(){return E.getItem(this.BROWSER_PUBLIC_KEY)}setBrowserPrivateKey(e){E.setItem(this.BROWSER_PRIVATE_KEY,e)}getBrowserPrivateKey(){return E.getItem(this.BROWSER_PRIVATE_KEY)}async setAppKey(e){E.setItem(this.APP_KEY,e),h&&h.IDB&&await h.setItem(this.APP_KEY,e)}getAppKey(){return E.getItem(this.APP_KEY)}async getAppKeySync(){if(h&&h.IDB)return await h.getItem(this.APP_KEY)}setVAPID(e){E.setItem(this.VAPID_PUBLIC,e)}getVAPID(){return E.getItem(this.VAPID_PUBLIC)}setEnabled(e){E.setItem(this.ENABLED,e)}getEnabled(){return E.getItem(this.ENABLED)}setServiceSyncTime(e){E.setItem(this.SERVICE_SYNC_TIME,e*this.BASE_TIME)}getServiceSyncTime(){const e=E.getItem(this.SERVICE_SYNC_TIME);return e||1*this.BASE_TIME}setLocationEnabled(e){E.setItem(this.LOCATION_ENABLED,e)}getLocationEnabled(){return E.getItem(this.LOCATION_ENABLED)}setLocationUpdateMinutes(e){E.setItem(this.LOCATION_UPDATE_MINUTES,e)}getLocationUpdateMinutes(){const e=E.getItem(this.LOCATION_UPDATE_MINUTES);return e||30}async setRequestLocation(e){E.setItem(this.REQUEST_LOCATION,e)}getRequestLocation(){return!!E&&E.getItem(this.REQUEST_LOCATION)}async setPlatform(e){E.setItem(this.PLATFORM,e)}getPlatform(){return E&&E.getItem(this.PLATFORM)||c.platform}getVersion(){return c.version}async setBrowserName(e){E.setItem(this.BROWSER_NAME,e)}getBrowserName(){return E.getItem(this.BROWSER_NAME)}setBrowserVersion(e){E.setItem(this.BROWSER_VERSION,e)}getBrowserVersion(){return E.getItem(this.BROWSER_VERSION)}async setOsName(e){E.setItem(this.OS_NAME,e)}getOsName(){return E.getItem(this.OS_NAME)}setOsVersion(e){E.setItem(this.OS_VERSION,e)}getOsVersion(){return E.getItem(this.OS_VERSION)}setDeviceType(e){E.setItem(this.DEVICE_TYPE,e)}getDeviceType(){return E.getItem(this.DEVICE_TYPE)}setSupported(e){E.setItem(this.SUPPORTED,e)}getSupported(){return E.getItem(this.SUPPORTED)}setServiceTimestamp(e){E.setItem(this.SERVICE_TIMESTAMP,e)}getServiceTimestamp(){return E.getItem(this.SERVICE_TIMESTAMP)}setLocationTimestamp(e){E.setItem(this.LOCATION_TIMESTAMP,e)}getLocationTimestamp(){return E.getItem(this.LOCATION_TIMESTAMP)}setPermissionLocation(e){E.setItem(this.PERMISSION_LOCATION,e)}getPermissionLocation(){return E.getItem(this.PERMISSION_LOCATION)}setDebugLog(e){E.setItem(this.SET_LOG_DEBUG,e)}getDebugLog(){return"false"!==E.getItem(this.SET_LOG_DEBUG)}setLogLevel(e){E.setItem(this.LOG_LEVEL,e)}getLogLevel(){return E.getItem(this.LOG_LEVEL)}setNewUserTimestamp(e){E.setItem(this.NEW_USER_TIMESTAMP,e)}getNewUserTimestamp(){return E.getItem(this.NEW_USER_TIMESTAMP)}async setExternalIdRequest(e){E&&E.isLocalStorageAvailable()&&E.setItem(this.EXTERNAL_ID,e),h&&h.IDB&&await h.setItem(this.EXTERNAL_ID,e)}async getExternalIdRequest(){let e;try{E&&E.isLocalStorageAvailable()?e=E.getItem(this.EXTERNAL_ID):h&&h.IDB&&(e=await h.getItem(this.EXTERNAL_ID))}catch(e){}return e}setExternalId(e){E.setItem(this.EXTERNAL_ID,e)}getExternalId(){return E.getItem(this.EXTERNAL_ID)}async getRegisteredByCookie(){return E.getItem(this.REGISTERED_BY_COOKIE)}async setRegisteredByCookie(e){E.setItem(this.REGISTERED_BY_COOKIE,e)}setLatitude(e){E.setItem(this.LATITUDE,e)}getLatitude(){return E.getItem(this.LATITUDE)}setLongitude(e){E.setItem(this.LONGITUDE,e)}getLongitude(){return E.getItem(this.LONGITUDE)}async setInAppTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.INAPP_TOPICS,e)}async getInAppTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.INAPP_TOPICS))}catch(e){}return e}async setTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.TOPIC_LIST,e)}async getTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.TOPIC_LIST))}catch(e){}return e}getUrlInappApi(){return this.getStorage(this.URL_INAPP_API)}setUrlInappApi(e){this.setStorage(this.URL_INAPP_API,e)}setInAppEnabled(e){this.setStorage(this.INAPP_ENABLED,e)}isInAppEnabled(){return this.getStorage(this.INAPP_ENABLED)}},g=Object.freeze({DEBUG:1,INFO:2,WARNING:3,ERROR:4}),R=g;class _{constructor(e){this.tag="[IND]",e&&(this.tag=e),this.level=R.INFO,this.setLogLevel((new u).getLogLevel()),this.log=[]}setLogLevel(e){e&&e>=R.DEBUG&&e<=R.ERROR&&(this.level=e)}static addedAsString(e){return"string"==typeof e?e:JSON.stringify(e,null,2)}d(){if(this.level<=R.DEBUG)for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}i(){if(this.level<=R.INFO)for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}w(){if(this.level<=R.WARNING)for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}e(){if(this.level<=R.ERROR)if(1==arguments.length&&arguments.errorCode)this.log+=`${error.errorCode}: ${error.errorMessage}`;else for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}writeLog(){this.log.length>0&&this.tag&&this.log&&console.log(this.tag,this.log),this.log=[]}}const p=_;const T=class{constructor(e,t,s){this.errorCode=e,this.errorMessage=t,null!=s&&(this.exceptionMessage=s)}};const A=new class{constructor(){}showError(e,t,s){if(null!=e){const i=Object.values(e.ErrorCode).indexOf(t);return i>=0?new T(Object.keys(e.ErrorCode)[i],Object.keys(e.ErrorMessage)[i],s):new T(GENERAL_ERROR,"general error",s)}}},S={GENERAL_ERROR:600,API_SERVER_ERROR:500,API_PARAMETER_MISSING:400,API_APPKEY_NOT_VALID:401,API_FORBIDDEN_REQUEST:403,API_DEVICE_NOT_FOUND:404,API_TOPICS_ARE_INSERTED:409,BAD_REQUEST_SERVER_ERROR:410};const O={ErrorCode:S,ErrorMessage:{GENERAL_ERROR:"General Error",API_SERVER_ERROR:"Error server response",API_PARAMETER_MISSING:"Api parameter missing",API_APPKEY_NOT_VALID:"appKey is not valid",API_FORBIDDEN_REQUEST:"forbidden request",API_DEVICE_NOT_FOUND:"device not found",API_TOPICS_ARE_INSERTED:"topics are inserted",BAD_REQUEST_SERVER_ERROR:"bad request"}};const P=class{constructor(){this.URL_BASE="",this.GET="GET",this.POST="POST",this.PUT="PUT",this.DELETE="DELETE"}async getURL(){return this.URL_BASE}async call(e,t,s,i){const r=new p("[IND]BaseClient: ");s.isServiceWorkerRequest()&&r.setLogLevel(R.DEBUG);let n=await this.getURL()+s.getPath(t)+s.getParams();s.isJourneyRequest()&&(n=n.replace("v1","v2"));const o={method:e,headers:s.addHeaders()};e!==this.GET&&(o.body=JSON.stringify(s.getBody())),i&&(o.credentials=i);try{const t=await fetch(n,o),i=await t.json();return t.ok?(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\nResponse Body:",JSON.stringify(i.data,null,"\t")).writeLog(),i):(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\n").writeLog(),new T(i.statusCode,i.message))}catch(t){return r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Error: "+t).writeLog(),A.showError(O,O.ErrorCode.GENERAL_ERROR,t)}}async get(e,t){return await this.call(this.GET,e,t)}async post(e,t,s){return await this.call(this.POST,e,t,s)}async put(e,t,s){return await this.call(this.PUT,e,t,s)}async delete(e,t){return await this.call(this.DELETE,e,t)}};const m=class{constructor(){this.PARAM_APP_KEY="appKey",this.PARAM_DEVICE_ID="deviceId",this.PARAM_PUSH_TOKEN="pushToken",this.PARAM_ENABLED="enabled",this.PARAM_PLATFORM="platform",this.PARAM_VERSION="version",this.PARAM_TOPICS="topics",this.PARAM_EVENT_TYPE="eventType",this.PARAM_PUSH_ID="pushId",this.PARAM_CLICKED_BUTTON="clickedButton",this.PARAM_PERMISSION_TYPE="permissionType",this.PARAM_LATITUDE="latitude",this.PARAM_LONGITUDE="longitude",this.PARAM_INAPP_ID="inAppId",this.PARAM_INAPP_EVENT_TYPE="eventType",this.PARAM_INAPP_CLICKED_BUTTON="clickedButton",this.PARAM_INAPP_LAST_VERSION_ID="lastVersionId",this.PARAM_INBOX_EXTERNALID="externalId",this.PARAM_INBOX_PAGE="page",this.PARAM_INBOX_PAGE_SIZE="pageSize",this.PARAM_INBOX_DATE_FROM="dateFrom",this.PARAM_INBOX_DATE_TO="dateTo",this.PARAM_INBOX_STATUS="status",this.PARAM_INBOX_SENDER_IDS="sendingIds",this.PARAM_CUSTOMER_ID="customerId",this.PARAM_CUSTOMER_FIELD_NAMES="fieldNames",this.PARAM_CUSTOMER_FIELDS="fields",this.PARAM_CUSTOMER_LINK="link",this.PARAM_CUSTOMER_CHANNEL="channel",this.appKey=(new u).getAppKey(),this.params=null,this.pathParams={},this.headers={}}getParams(){return"?"+this.PARAM_APP_KEY+"="+this.appKey+(this.params?"&"+this.params:"")}getBody(){return this.body?this.body:""}getPath(e){let t=e;return Object.keys(this.pathParams).forEach((e=>{t=t.replace(e,this.pathParams[e])})),t}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}isServiceWorkerRequest(){return this.serviceWorkerRequest}setServiceWorkerRequest(e){this.serviceWorkerRequest=e}isJourneyRequest(){return this.journeyRequest}setJourneyRequest(e){this.journeyRequest=e}},N=Object.freeze({PUSH:"push",INAPP:"inapp",CHAT:"chat"});const y=class{constructor(e=null,t){null==e?(this.browserPublicKey=(new u).getBrowserPublicKey(),this.browserPrivateKey=(new u).getBrowserPrivateKey(),this.platform=(new u).getPlatform(),this.version=(new u).getVersion(),this.browserName=(new u).getBrowserName(),this.browserVersion=(new u).getBrowserVersion(),this.osName=(new u).getOsName(),this.osVersion=(new u).getOsVersion(),this.deviceType=(new u).getDeviceType(),(new u).getEnabled()&&(this.enabled="true"===(new u).getEnabled()),(new u).getExternalId()&&(this.externalCode=(new u).getExternalId())):t?(e.enabled&&(this.enabled=e.enabled,(new u).setEnabled(this.enabled)),e.registeredByCookie&&(this.registeredByCookie=e.registeredByCookie,(new u).setRegisteredByCookie(this.registeredByCookie))):(e.browserPublicKey&&(this.browserPublicKey=e.browserPublicKey),e.browserPrivateKey&&(this.browserPrivateKey=e.browserPrivateKey),e.platform&&(this.platform=e.platform),e.version&&(this.version=e.version),e.osVersion&&(this.osVersion=e.osVersion),e.browserName&&(this.browserName=e.browserName),e.browserVersion&&(this.browserVersion=e.browserVersion),e.osName&&(this.osName=e.osName),e.deviceType&&(this.deviceType=e.deviceType),e.enabled&&(this.enabled=e.enabled),e.externalCode&&(this.externalCode=e.externalCode)),this.platform&&(this.productName=this.platform),this.version&&(this.productVersion=this.version),navigator&&"language"in navigator&&(this.locale=navigator.language),Intl&&"DateTimeFormat"in Intl&&(this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone),this.timeOffset=-(new Date).getTimezoneOffset()}getDeviceId(){return this.deviceId}setDeviceId(e){this.deviceId=e}setExternalCode(e){this.externalCode=e}toJSON(){const e={};return this.platform&&(e.platform=this.platform),this.version&&(e.version=this.version),this.productName&&(e.productName=this.productName),this.productVersion&&(e.productVersion=this.productVersion),this.browserName&&(e.browserName=this.browserName),this.browserVersion&&(e.browserVersion=this.browserVersion),this.osName&&(e.osName=this.osName),this.osVersion&&(e.osVersion=this.osVersion),this.deviceType&&(e.deviceType=this.deviceType),this.locale&&(e.locale=this.locale),this.timeZone&&(e.timeZome=this.timeZone),this.timeOffset&&(e.timeOffset=this.timeOffset),this.enabled&&(e.enabled=this.enabled),this.browserPublicKey&&(e.browserPublicKey=this.browserPublicKey),this.browserPrivateKey&&(e.browserPrivateKey=this.browserPrivateKey),this.externalCode&&(e.externalCode=this.externalCode),e}},w=Object.freeze({DEFAULT:-1,ENABLE:1,DISABLE:0}),C=Object.freeze({EVENT_TYPE_CLICK:"click",EVENT_TYPE_RECEIVE:"receive",EVENT_TYPE_UPDATE:"update",EVENT_TYPE_ACCEPT:"accept",EVENT_TYPE_REJECT:"reject",EVENT_TYPE_ASK:"ask"}),D=Object.freeze({SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe"});const b=class{static isServiceTimestampExceed(){return!(new u).getServiceTimestamp()||(new u).getServiceSyncTime()<=(Date.now()-(new u).getServiceTimestamp())/6e4}static isFunction(e){return!(!e||"function"!=typeof e)}};const f=class{static async getPermissions(){const e=await this.getPermission("geolocation"),t={};return e&&(t.location=e.state),t}static async getPermission(e){try{if(navigator&&navigator.permissions&&navigator.permissions.query&&e)return await navigator.permissions.query({name:e,userVisibleOnly:!0})}catch(e){return null}return null}static async setPermissionsCallback(){await this.setCallback("geolocation",navigator.indigitallRequestLocationPermission)}static async setCallback(e,t){const s=await this.getPermission(e);if(s){let i=s.state;"onchange"in s&&(s.onchange=()=>{new p("[IND]CorePermissions: ").d(e+" permission state has changed from "+i+" to "+s.state).writeLog(),i=s.state,t&&t({name:e,state:s.state})})}}},L=new p("[IND]Crypto"),v=new TextEncoder("utf-8"),B="HMAC";const U=class{static async createHmac(e,t){try{const s=window?.crypto?.subtle;if(!s)return;const i=await s.importKey("raw",v.encode(e),{name:B,hash:{name:"SHA-256"}},!1,["sign","verify"]),r=await s.sign(B,i,v.encode(t)),n=new Uint8Array(r),o=Array.prototype.map.call(n,(e=>("00"+e.toString(16)).slice(-2))).join("");return L.d("hmac: ",o).writeLog(),o}catch(e){return void L.e("error:",e).writeLog()}}};const M=class{static compareJSON(e,t){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const i of s)if(e[i]!==t[i]){if("object"!=typeof e[i]||"object"!=typeof t[i])return!1;if(!isEqual(e[i],t[i]))return!1}return!0}};const V=class{static isValidFormat(e){return null!=e&&""!=e&&"null"!=e&&e.length>8}};const x=class{static setTopicChannel(e,t){const s=[];for(let i=0;i<e.length;i++){const r=e[i];r.channel=t,s.push(r)}return s}},Y={Repository:u,Config:c,Api:i,Models:r,Utils:n}},691:function(e){var t;t=()=>(()=>{var e={923:function(e){var t;t=()=>(()=>{"use strict";var e={147:e=>{e.exports=JSON.parse('{"name":"indigitall-web-core","description":"indigitall web core","version":"4.3.1","main":"index.js","author":"Smart2me S.L.","homepage":"https://indigitall.com","devDependencies":{"@babel/preset-env":"^7.18.10","babel-loader":"^8.2.5","filemanager-webpack-plugin":"^7.0.0","idempotent-babel-polyfill":"^7.4.4","script-loader":"^0.7.2","webpack":"^5.74.0","webpack-bundle-analyzer":"^4.6.1","webpack-cli":"^4.10.0"},"scripts":{"test":"echo \'There are not tests\'","public":"ws --directory ./public --port 80 --log.format dev","build":"webpack --config webpack.config.js --mode=production","build-dev":"webpack --config webpack.config.js --watch --mode=development","delete-node-modules":"rm -rf node_modules/ && rm -f package-lock.json","install-core":"npm install && npm run build"}}')}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,s),n.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{s.r(i),s.d(i,{default:()=>V});var e={};s.r(e),s.d(e,{BaseClient:()=>S,BaseRequest:()=>O});var t={};s.r(t),s.d(t,{Channel:()=>P,Device:()=>m,DeviceStatus:()=>N,ErrorDictionary:()=>A,ErrorModel:()=>p,EventType:()=>y,TopicSubscribeType:()=>w});var r={};s.r(r),s.d(r,{CommonUtils:()=>C,CorePermissions:()=>D,CryptoUtils:()=>v,ErrorUtils:()=>T,JsonUtils:()=>B,Log:()=>_,LogLevel:()=>u,TopicUtils:()=>M,Validations:()=>U});var n={platform:"webpush",version:"0.0.1"};const o=s(147);n.version=o.version;const a=n=Object.assign(n,{client:{URL_BASE:"https://device-api.indigitall.com/v1",URL_DEVICE_V2:"https://device-api.indigitall.com/v2",INAPP_URL_BASE:"https://inapp-api.indigitall.com/v1",INBOX_URL_BASE:"https://inbox-api.indigitall.com/v1",CUSTOMER_URL_BASE:"https://device-api.indigitall.com/v2"}}),c=new class{constructor(){this.storage=this.isLocalStorageAvailable()?window.localStorage:null}isLocalStorageAvailable(){try{const e=window.localStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==c.length}return!1}setItem(e,t){return null!=this.storage&&(this.storage.setItem(e,t),!0)}getItem(e){return null!=this.storage?this.storage.getItem(e):null}deleteItem(e){return!!this.storage&&(this.storage.setItem(e,value),!0)}clear(){this.storage&&this.storage.clear()}},l=c,E=new class{constructor(){this.TAG="[IND]IndexedDB: ",this.DB_NAME="indigitall.indexedDB",this.DB_VERSION=1,this.DB_STORE_NAME="indigitallStore",this.DB_STORE_MODE="readwrite",this.DB_KEY_PATH="id",this.DB_STORE_INDEX="storeIndex",this.IDB=indexedDB||mozzIndexedDB||webkitIndexedDB||msIndexedDB}async getDB(){return new Promise(((e,t)=>{const s=this.IDB;if(s){const i=s.open("indigitall.indexedDB",1);i.onupgradeneeded=function(){i.result.createObjectStore("indigitallStore").createIndex("storeIndex","store.key")},i.onsuccess=function(){const t=i.result,s=t.transaction("indigitallStore","readwrite"),r=s.objectStore("indigitallStore"),n=r.index("storeIndex");e({db:t,tx:s,store:r,index:n})},i.onerror=function(e){t(e)}}else t(!1)}))}async get(e,t){return new Promise(((s,i)=>{e||i(!1),e.index.get(t).onsuccess=t=>{t.target.result&&(this.close(e),s(t.target.result.store.value)),i(!1)}}))}async put(e,t,s){return new Promise(((i,r)=>{e||r(!1),e.store.put({store:{key:t,value:s}},t).onsuccess=t=>{this.close(e),i(s)}}))}close(e){if(e.tx)try{e.tx.oncomplete=()=>{e.db.close()}}catch(e){console.error(this.TAG,e)}}async setItem(e,t){try{const s=await this.getDB();return this.put(s,e,t)}catch(e){return e}}async getItem(e){try{const t=await this.getDB();return this.get(t,e)}catch(e){return e}}},h=new class{constructor(){this.SESSION="indigitall.session.storage",this.session=this.isSessionStorageAvailable()?window.sessionStorage:null}isSessionStorageAvailable(){try{const e=window.sessionStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==h.length}return!1}getItem(e){return null!=this.session?this.session.getItem(e):null}setItem(e,t){return null!=this.session&&(this.session.setItem(e,t),!0)}clearMessages(){this.session&&this.session.removeItem("messages")}},I=h,d=class{constructor(){this.storage=l,this.db=E,this.BASE_TIME=60,this.REPOSITORY="indigitall.repository",this.APP_KEY=this.REPOSITORY+".APP_KEY",this.VAPID_PUBLIC=this.REPOSITORY+".VAPID_PUBLIC",this.ENABLED=this.REPOSITORY+".ENABLED",this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID",this.SERVICE_SYNC_TIME=this.REPOSITORY+".SERVICE_SYNC_TIME",this.LOCATION_ENABLED=this.REPOSITORY+".LOCATION_ENABLED",this.LOCATION_UPDATE_MINUTES=this.REPOSITORY+".LOCATION_UPDATE_MINUTES",this.REQUEST_LOCATION=this.REPOSITORY+".REQUEST_LOCATION",this.BROWSER_PUBLIC_KEY=this.REPOSITORY+".BROWSER_PUBLIC_KEY",this.BROWSER_PRIVATE_KEY=this.REPOSITORY+".BROWSER_PRIVATE_KEY",this.PLATFORM=this.REPOSITORY+".PLATFORM",this.BROWSER_NAME=this.REPOSITORY+".BROWSER_NAME",this.BROWSER_VERSION=this.REPOSITORY+".BROWSER_VERSION",this.OS_NAME=this.REPOSITORY+".OS_NAME",this.OS_VERSION=this.REPOSITORY+".OS_VERSION",this.DEVICE_TYPE=this.REPOSITORY+".DEVICE_TYPE",this.SUPPORTED=this.REPOSITORY+".SUPPORTED",this.SERVICE_TIMESTAMP=this.REPOSITORY+".SERVICE_TIMESTAMP",this.LOCATION_TIMESTAMP=this.REPOSITORY+".LOCATION_TIMESTAMP",this.PERMISSION_LOCATION=this.REPOSITORY+".PERMISSION_LOCATION",this.SET_LOG_DEBUG=this.REPOSITORY+".SET_LOG_DEBUG",this.NEW_USER_TIMESTAMP=this.REPOSITORY+".NEW_USER_TIMESTAMP",this.EXTERNAL_ID=this.REPOSITORY+".EXTERNAL_ID",this.REGISTERED_BY_COOKIE=this.REPOSITORY+".REGISTERED_BY_COOKIE",this.LOG_LEVEL=this.REPOSITORY+".LOG_LEVEL",this.LATITUDE=this.REPOSITORY+".LATITUDE",this.LONGITUDE=this.REPOSITORY+".LONGITUDE",this.TOPIC_LIST=this.REPOSITORY+".TOPIC_LIST",this.INAPP_ENABLED=this.REPOSITORY+".INAPP_ENABLED",this.URL_INAPP_API=this.REPOSITORY+".URL_INAPP_API",this.INAPP_TOPICS=this.REPOSITORY+".INAPP_TOPICS"}setItemSessionStorage(e,t){I.setItem(e,t)}getItemSessionStorage(e){return I.getItem(e)}clearSessionStorage(){I.clearMessages()}setStorage(e,t){l.setItem(e,t)}getStorage(e){return l.getItem(e)}clearStorage(){l.clear()}setBrowserPublicKey(e){l.setItem(this.BROWSER_PUBLIC_KEY,e)}getBrowserPublicKey(){return l.getItem(this.BROWSER_PUBLIC_KEY)}setBrowserPrivateKey(e){l.setItem(this.BROWSER_PRIVATE_KEY,e)}getBrowserPrivateKey(){return l.getItem(this.BROWSER_PRIVATE_KEY)}async setAppKey(e){l.setItem(this.APP_KEY,e),E&&E.IDB&&await E.setItem(this.APP_KEY,e)}getAppKey(){return l.getItem(this.APP_KEY)}async getAppKeySync(){if(E&&E.IDB)return await E.getItem(this.APP_KEY)}setVAPID(e){l.setItem(this.VAPID_PUBLIC,e)}getVAPID(){return l.getItem(this.VAPID_PUBLIC)}setEnabled(e){l.setItem(this.ENABLED,e)}getEnabled(){return l.getItem(this.ENABLED)}setServiceSyncTime(e){l.setItem(this.SERVICE_SYNC_TIME,e*this.BASE_TIME)}getServiceSyncTime(){return l.getItem(this.SERVICE_SYNC_TIME)||1*this.BASE_TIME}setLocationEnabled(e){l.setItem(this.LOCATION_ENABLED,e)}getLocationEnabled(){return l.getItem(this.LOCATION_ENABLED)}setLocationUpdateMinutes(e){l.setItem(this.LOCATION_UPDATE_MINUTES,e)}getLocationUpdateMinutes(){return l.getItem(this.LOCATION_UPDATE_MINUTES)||30}async setRequestLocation(e){l.setItem(this.REQUEST_LOCATION,e)}getRequestLocation(){return!!l&&l.getItem(this.REQUEST_LOCATION)}async setPlatform(e){l.setItem(this.PLATFORM,e)}getPlatform(){return l&&l.getItem(this.PLATFORM)||a.platform}getVersion(){return a.version}async setBrowserName(e){l.setItem(this.BROWSER_NAME,e)}getBrowserName(){return l.getItem(this.BROWSER_NAME)}setBrowserVersion(e){l.setItem(this.BROWSER_VERSION,e)}getBrowserVersion(){return l.getItem(this.BROWSER_VERSION)}async setOsName(e){l.setItem(this.OS_NAME,e)}getOsName(){return l.getItem(this.OS_NAME)}setOsVersion(e){l.setItem(this.OS_VERSION,e)}getOsVersion(){return l.getItem(this.OS_VERSION)}setDeviceType(e){l.setItem(this.DEVICE_TYPE,e)}getDeviceType(){return l.getItem(this.DEVICE_TYPE)}setSupported(e){l.setItem(this.SUPPORTED,e)}getSupported(){return l.getItem(this.SUPPORTED)}setServiceTimestamp(e){l.setItem(this.SERVICE_TIMESTAMP,e)}getServiceTimestamp(){return l.getItem(this.SERVICE_TIMESTAMP)}setLocationTimestamp(e){l.setItem(this.LOCATION_TIMESTAMP,e)}getLocationTimestamp(){return l.getItem(this.LOCATION_TIMESTAMP)}setPermissionLocation(e){l.setItem(this.PERMISSION_LOCATION,e)}getPermissionLocation(){return l.getItem(this.PERMISSION_LOCATION)}setDebugLog(e){l.setItem(this.SET_LOG_DEBUG,e)}getDebugLog(){return"false"!==l.getItem(this.SET_LOG_DEBUG)}setLogLevel(e){l.setItem(this.LOG_LEVEL,e)}getLogLevel(){return l.getItem(this.LOG_LEVEL)}setNewUserTimestamp(e){l.setItem(this.NEW_USER_TIMESTAMP,e)}getNewUserTimestamp(){return l.getItem(this.NEW_USER_TIMESTAMP)}async setExternalIdRequest(e){l&&l.isLocalStorageAvailable()&&l.setItem(this.EXTERNAL_ID,e),E&&E.IDB&&await E.setItem(this.EXTERNAL_ID,e)}async getExternalIdRequest(){let e;try{l&&l.isLocalStorageAvailable()?e=l.getItem(this.EXTERNAL_ID):E&&E.IDB&&(e=await E.getItem(this.EXTERNAL_ID))}catch(e){}return e}setExternalId(e){l.setItem(this.EXTERNAL_ID,e)}getExternalId(){return l.getItem(this.EXTERNAL_ID)}async getRegisteredByCookie(){return l.getItem(this.REGISTERED_BY_COOKIE)}async setRegisteredByCookie(e){l.setItem(this.REGISTERED_BY_COOKIE,e)}setLatitude(e){l.setItem(this.LATITUDE,e)}getLatitude(){return l.getItem(this.LATITUDE)}setLongitude(e){l.setItem(this.LONGITUDE,e)}getLongitude(){return l.getItem(this.LONGITUDE)}async setInAppTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.INAPP_TOPICS,e)}async getInAppTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.INAPP_TOPICS))}catch(e){}return e}async setTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.TOPIC_LIST,e)}async getTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.TOPIC_LIST))}catch(e){}return e}getUrlInappApi(){return this.getStorage(this.URL_INAPP_API)}setUrlInappApi(e){this.setStorage(this.URL_INAPP_API,e)}setInAppEnabled(e){this.setStorage(this.INAPP_ENABLED,e)}isInAppEnabled(){return this.getStorage(this.INAPP_ENABLED)}},u=Object.freeze({DEBUG:1,INFO:2,WARNING:3,ERROR:4}),g=u;class R{constructor(e){this.tag="[IND]",e&&(this.tag=e),this.level=g.INFO,this.setLogLevel((new d).getLogLevel()),this.log=[]}setLogLevel(e){e&&e>=g.DEBUG&&e<=g.ERROR&&(this.level=e)}static addedAsString(e){return"string"==typeof e?e:JSON.stringify(e,null,2)}d(){if(this.level<=g.DEBUG)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}i(){if(this.level<=g.INFO)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}w(){if(this.level<=g.WARNING)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}e(){if(this.level<=g.ERROR)if(1==arguments.length&&arguments.errorCode)this.log+=`${error.errorCode}: ${error.errorMessage}`;else for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}writeLog(){this.log.length>0&&this.tag&&this.log&&console.log(this.tag,this.log),this.log=[]}}const _=R,p=class{constructor(e,t,s){this.errorCode=e,this.errorMessage=t,null!=s&&(this.exceptionMessage=s)}},T=new class{constructor(){}showError(e,t,s){if(null!=e){const i=Object.values(e.ErrorCode).indexOf(t);return i>=0?new p(Object.keys(e.ErrorCode)[i],Object.keys(e.ErrorMessage)[i],s):new p(GENERAL_ERROR,"general error",s)}}},A={ErrorCode:{GENERAL_ERROR:600,API_SERVER_ERROR:500,API_PARAMETER_MISSING:400,API_APPKEY_NOT_VALID:401,API_FORBIDDEN_REQUEST:403,API_DEVICE_NOT_FOUND:404,API_TOPICS_ARE_INSERTED:409,BAD_REQUEST_SERVER_ERROR:410},ErrorMessage:{GENERAL_ERROR:"General Error",API_SERVER_ERROR:"Error server response",API_PARAMETER_MISSING:"Api parameter missing",API_APPKEY_NOT_VALID:"appKey is not valid",API_FORBIDDEN_REQUEST:"forbidden request",API_DEVICE_NOT_FOUND:"device not found",API_TOPICS_ARE_INSERTED:"topics are inserted",BAD_REQUEST_SERVER_ERROR:"bad request"}},S=class{constructor(){this.URL_BASE="",this.GET="GET",this.POST="POST",this.PUT="PUT",this.DELETE="DELETE"}async getURL(){return this.URL_BASE}async call(e,t,s,i){const r=new _("[IND]BaseClient: ");s.isServiceWorkerRequest()&&r.setLogLevel(g.DEBUG);let n=await this.getURL()+s.getPath(t)+s.getParams();s.isJourneyRequest()&&(n=n.replace("v1","v2"));const o={method:e,headers:s.addHeaders()};e!==this.GET&&(o.body=JSON.stringify(s.getBody())),i&&(o.credentials=i);try{const t=await fetch(n,o),i=await t.json();return t.ok?(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\nResponse Body:",JSON.stringify(i.data,null,"\t")).writeLog(),i):(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\n").writeLog(),new p(i.statusCode,i.message))}catch(t){return r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Error: "+t).writeLog(),T.showError(A,A.ErrorCode.GENERAL_ERROR,t)}}async get(e,t){return await this.call(this.GET,e,t)}async post(e,t,s){return await this.call(this.POST,e,t,s)}async put(e,t,s){return await this.call(this.PUT,e,t,s)}async delete(e,t){return await this.call(this.DELETE,e,t)}},O=class{constructor(){this.PARAM_APP_KEY="appKey",this.PARAM_DEVICE_ID="deviceId",this.PARAM_PUSH_TOKEN="pushToken",this.PARAM_ENABLED="enabled",this.PARAM_PLATFORM="platform",this.PARAM_VERSION="version",this.PARAM_TOPICS="topics",this.PARAM_EVENT_TYPE="eventType",this.PARAM_PUSH_ID="pushId",this.PARAM_CLICKED_BUTTON="clickedButton",this.PARAM_PERMISSION_TYPE="permissionType",this.PARAM_LATITUDE="latitude",this.PARAM_LONGITUDE="longitude",this.PARAM_INAPP_ID="inAppId",this.PARAM_INAPP_EVENT_TYPE="eventType",this.PARAM_INAPP_CLICKED_BUTTON="clickedButton",this.PARAM_INAPP_LAST_VERSION_ID="lastVersionId",this.PARAM_INBOX_EXTERNALID="externalId",this.PARAM_INBOX_PAGE="page",this.PARAM_INBOX_PAGE_SIZE="pageSize",this.PARAM_INBOX_DATE_FROM="dateFrom",this.PARAM_INBOX_DATE_TO="dateTo",this.PARAM_INBOX_STATUS="status",this.PARAM_INBOX_SENDER_IDS="sendingIds",this.PARAM_CUSTOMER_ID="customerId",this.PARAM_CUSTOMER_FIELD_NAMES="fieldNames",this.PARAM_CUSTOMER_FIELDS="fields",this.PARAM_CUSTOMER_LINK="link",this.PARAM_CUSTOMER_CHANNEL="channel",this.appKey=(new d).getAppKey(),this.params=null,this.pathParams={},this.headers={}}getParams(){return"?"+this.PARAM_APP_KEY+"="+this.appKey+(this.params?"&"+this.params:"")}getBody(){return this.body?this.body:""}getPath(e){let t=e;return Object.keys(this.pathParams).forEach((e=>{t=t.replace(e,this.pathParams[e])})),t}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}isServiceWorkerRequest(){return this.serviceWorkerRequest}setServiceWorkerRequest(e){this.serviceWorkerRequest=e}isJourneyRequest(){return this.journeyRequest}setJourneyRequest(e){this.journeyRequest=e}},P=Object.freeze({PUSH:"push",INAPP:"inapp",CHAT:"chat"}),m=class{constructor(e=null,t){null==e?(this.browserPublicKey=(new d).getBrowserPublicKey(),this.browserPrivateKey=(new d).getBrowserPrivateKey(),this.platform=(new d).getPlatform(),this.version=(new d).getVersion(),this.browserName=(new d).getBrowserName(),this.browserVersion=(new d).getBrowserVersion(),this.osName=(new d).getOsName(),this.osVersion=(new d).getOsVersion(),this.deviceType=(new d).getDeviceType(),(new d).getEnabled()&&(this.enabled="true"===(new d).getEnabled()),(new d).getExternalId()&&(this.externalCode=(new d).getExternalId())):t?(e.enabled&&(this.enabled=e.enabled,(new d).setEnabled(this.enabled)),e.registeredByCookie&&(this.registeredByCookie=e.registeredByCookie,(new d).setRegisteredByCookie(this.registeredByCookie))):(e.browserPublicKey&&(this.browserPublicKey=e.browserPublicKey),e.browserPrivateKey&&(this.browserPrivateKey=e.browserPrivateKey),e.platform&&(this.platform=e.platform),e.version&&(this.version=e.version),e.osVersion&&(this.osVersion=e.osVersion),e.browserName&&(this.browserName=e.browserName),e.browserVersion&&(this.browserVersion=e.browserVersion),e.osName&&(this.osName=e.osName),e.deviceType&&(this.deviceType=e.deviceType),e.enabled&&(this.enabled=e.enabled),e.externalCode&&(this.externalCode=e.externalCode)),this.platform&&(this.productName=this.platform),this.version&&(this.productVersion=this.version),navigator&&"language"in navigator&&(this.locale=navigator.language),Intl&&"DateTimeFormat"in Intl&&(this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone),this.timeOffset=-(new Date).getTimezoneOffset()}getDeviceId(){return this.deviceId}setDeviceId(e){this.deviceId=e}setExternalCode(e){this.externalCode=e}toJSON(){const e={};return this.platform&&(e.platform=this.platform),this.version&&(e.version=this.version),this.productName&&(e.productName=this.productName),this.productVersion&&(e.productVersion=this.productVersion),this.browserName&&(e.browserName=this.browserName),this.browserVersion&&(e.browserVersion=this.browserVersion),this.osName&&(e.osName=this.osName),this.osVersion&&(e.osVersion=this.osVersion),this.deviceType&&(e.deviceType=this.deviceType),this.locale&&(e.locale=this.locale),this.timeZone&&(e.timeZome=this.timeZone),this.timeOffset&&(e.timeOffset=this.timeOffset),this.enabled&&(e.enabled=this.enabled),this.browserPublicKey&&(e.browserPublicKey=this.browserPublicKey),this.browserPrivateKey&&(e.browserPrivateKey=this.browserPrivateKey),this.externalCode&&(e.externalCode=this.externalCode),e}},N=Object.freeze({DEFAULT:-1,ENABLE:1,DISABLE:0}),y=Object.freeze({EVENT_TYPE_CLICK:"click",EVENT_TYPE_RECEIVE:"receive",EVENT_TYPE_UPDATE:"update",EVENT_TYPE_ACCEPT:"accept",EVENT_TYPE_REJECT:"reject",EVENT_TYPE_ASK:"ask"}),w=Object.freeze({SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe"}),C=class{static isServiceTimestampExceed(){return!(new d).getServiceTimestamp()||(new d).getServiceSyncTime()<=(Date.now()-(new d).getServiceTimestamp())/6e4}static isFunction(e){return!(!e||"function"!=typeof e)}},D=class{static async getPermissions(){const e=await this.getPermission("geolocation"),t={};return e&&(t.location=e.state),t}static async getPermission(e){try{if(navigator&&navigator.permissions&&navigator.permissions.query&&e)return await navigator.permissions.query({name:e,userVisibleOnly:!0})}catch(e){return null}return null}static async setPermissionsCallback(){await this.setCallback("geolocation",navigator.indigitallRequestLocationPermission)}static async setCallback(e,t){const s=await this.getPermission(e);if(s){let i=s.state;"onchange"in s&&(s.onchange=()=>{new _("[IND]CorePermissions: ").d(e+" permission state has changed from "+i+" to "+s.state).writeLog(),i=s.state,t&&t({name:e,state:s.state})})}}},b=new _("[IND]Crypto"),f=new TextEncoder("utf-8"),L="HMAC",v=class{static async createHmac(e,t){try{const s=window?.crypto?.subtle;if(!s)return;const i=await s.importKey("raw",f.encode(e),{name:L,hash:{name:"SHA-256"}},!1,["sign","verify"]),r=await s.sign(L,i,f.encode(t)),n=new Uint8Array(r),o=Array.prototype.map.call(n,(e=>("00"+e.toString(16)).slice(-2))).join("");return b.d("hmac: ",o).writeLog(),o}catch(e){return void b.e("error:",e).writeLog()}}},B=class{static compareJSON(e,t){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const i of s)if(e[i]!==t[i]){if("object"!=typeof e[i]||"object"!=typeof t[i])return!1;if(!isEqual(e[i],t[i]))return!1}return!0}},U=class{static isValidFormat(e){return null!=e&&""!=e&&"null"!=e&&e.length>8}},M=class{static setTopicChannel(e,t){const s=[];for(let i=0;i<e.length;i++){const r=e[i];r.channel=t,s.push(r)}return s}},V={Repository:d,Config:a,Api:e,Models:t,Utils:r}})(),i})(),e.exports=t()},436:(e,t,s)=>{"use strict";s.d(t,{Core:()=>x});var i={};s.r(i),s.d(i,{BaseClient:()=>O,BaseRequest:()=>P});var r={};s.r(r),s.d(r,{Channel:()=>m,Device:()=>N,DeviceStatus:()=>y,ErrorDictionary:()=>S,ErrorModel:()=>T,EventType:()=>w,TopicSubscribeType:()=>C});var n={};s.r(n),s.d(n,{CommonUtils:()=>D,CorePermissions:()=>b,CryptoUtils:()=>B,ErrorUtils:()=>A,JsonUtils:()=>U,Log:()=>p,LogLevel:()=>g,TopicUtils:()=>V,Validations:()=>M}),s(923);var o={platform:"webpush",version:"0.0.1"};const a=s(391);o.version=a.version;const c=o=Object.assign(o,{client:{URL_BASE:"https://device-api.indigitall.com/v1",URL_DEVICE_V2:"https://device-api.indigitall.com/v2",INAPP_URL_BASE:"https://inapp-api.indigitall.com/v1",INBOX_URL_BASE:"https://inbox-api.indigitall.com/v1",CUSTOMER_URL_BASE:"https://device-api.indigitall.com/v2"}}),l=new class{constructor(){this.storage=this.isLocalStorageAvailable()?window.localStorage:null}isLocalStorageAvailable(){try{const e=window.localStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==l.length}return!1}setItem(e,t){return null!=this.storage&&(this.storage.setItem(e,t),!0)}getItem(e){return null!=this.storage?this.storage.getItem(e):null}deleteItem(e){return!!this.storage&&(this.storage.setItem(e,value),!0)}clear(){this.storage&&this.storage.clear()}},E=l,h=new class{constructor(){this.TAG="[IND]IndexedDB: ",this.DB_NAME="indigitall.indexedDB",this.DB_VERSION=1,this.DB_STORE_NAME="indigitallStore",this.DB_STORE_MODE="readwrite",this.DB_KEY_PATH="id",this.DB_STORE_INDEX="storeIndex",this.IDB=indexedDB||mozzIndexedDB||webkitIndexedDB||msIndexedDB}async getDB(){return new Promise(((e,t)=>{const s=this.IDB;if(s){const i=s.open("indigitall.indexedDB",1);i.onupgradeneeded=function(){i.result.createObjectStore("indigitallStore").createIndex("storeIndex","store.key")},i.onsuccess=function(){const t=i.result,s=t.transaction("indigitallStore","readwrite"),r=s.objectStore("indigitallStore"),n=r.index("storeIndex");e({db:t,tx:s,store:r,index:n})},i.onerror=function(e){t(e)}}else t(!1)}))}async get(e,t){return new Promise(((s,i)=>{e||i(!1),e.index.get(t).onsuccess=t=>{t.target.result&&(this.close(e),s(t.target.result.store.value)),i(!1)}}))}async put(e,t,s){return new Promise(((i,r)=>{e||r(!1),e.store.put({store:{key:t,value:s}},t).onsuccess=t=>{this.close(e),i(s)}}))}close(e){if(e.tx)try{e.tx.oncomplete=()=>{e.db.close()}}catch(e){console.error(this.TAG,e)}}async setItem(e,t){try{const s=await this.getDB();return this.put(s,e,t)}catch(e){return e}}async getItem(e){try{const t=await this.getDB();return this.get(t,e)}catch(e){return e}}},I=new class{constructor(){this.SESSION="indigitall.session.storage",this.session=this.isSessionStorageAvailable()?window.sessionStorage:null}isSessionStorageAvailable(){try{const e=window.sessionStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==I.length}return!1}getItem(e){return null!=this.session?this.session.getItem(e):null}setItem(e,t){return null!=this.session&&(this.session.setItem(e,t),!0)}clearMessages(){this.session&&this.session.removeItem("messages")}},d=I,u=class{constructor(){this.storage=E,this.db=h,this.BASE_TIME=60,this.REPOSITORY="indigitall.repository",this.APP_KEY=this.REPOSITORY+".APP_KEY",this.VAPID_PUBLIC=this.REPOSITORY+".VAPID_PUBLIC",this.ENABLED=this.REPOSITORY+".ENABLED",this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID",this.SERVICE_SYNC_TIME=this.REPOSITORY+".SERVICE_SYNC_TIME",this.LOCATION_ENABLED=this.REPOSITORY+".LOCATION_ENABLED",this.LOCATION_UPDATE_MINUTES=this.REPOSITORY+".LOCATION_UPDATE_MINUTES",this.REQUEST_LOCATION=this.REPOSITORY+".REQUEST_LOCATION",this.BROWSER_PUBLIC_KEY=this.REPOSITORY+".BROWSER_PUBLIC_KEY",this.BROWSER_PRIVATE_KEY=this.REPOSITORY+".BROWSER_PRIVATE_KEY",this.PLATFORM=this.REPOSITORY+".PLATFORM",this.BROWSER_NAME=this.REPOSITORY+".BROWSER_NAME",this.BROWSER_VERSION=this.REPOSITORY+".BROWSER_VERSION",this.OS_NAME=this.REPOSITORY+".OS_NAME",this.OS_VERSION=this.REPOSITORY+".OS_VERSION",this.DEVICE_TYPE=this.REPOSITORY+".DEVICE_TYPE",this.SUPPORTED=this.REPOSITORY+".SUPPORTED",this.SERVICE_TIMESTAMP=this.REPOSITORY+".SERVICE_TIMESTAMP",this.LOCATION_TIMESTAMP=this.REPOSITORY+".LOCATION_TIMESTAMP",this.PERMISSION_LOCATION=this.REPOSITORY+".PERMISSION_LOCATION",this.SET_LOG_DEBUG=this.REPOSITORY+".SET_LOG_DEBUG",this.NEW_USER_TIMESTAMP=this.REPOSITORY+".NEW_USER_TIMESTAMP",this.EXTERNAL_ID=this.REPOSITORY+".EXTERNAL_ID",this.REGISTERED_BY_COOKIE=this.REPOSITORY+".REGISTERED_BY_COOKIE",this.LOG_LEVEL=this.REPOSITORY+".LOG_LEVEL",this.LATITUDE=this.REPOSITORY+".LATITUDE",this.LONGITUDE=this.REPOSITORY+".LONGITUDE",this.TOPIC_LIST=this.REPOSITORY+".TOPIC_LIST",this.INAPP_ENABLED=this.REPOSITORY+".INAPP_ENABLED",this.URL_INAPP_API=this.REPOSITORY+".URL_INAPP_API",this.INAPP_TOPICS=this.REPOSITORY+".INAPP_TOPICS"}setItemSessionStorage(e,t){d.setItem(e,t)}getItemSessionStorage(e){return d.getItem(e)}clearSessionStorage(){d.clearMessages()}setStorage(e,t){E.setItem(e,t)}getStorage(e){return E.getItem(e)}clearStorage(){E.clear()}setBrowserPublicKey(e){E.setItem(this.BROWSER_PUBLIC_KEY,e)}getBrowserPublicKey(){return E.getItem(this.BROWSER_PUBLIC_KEY)}setBrowserPrivateKey(e){E.setItem(this.BROWSER_PRIVATE_KEY,e)}getBrowserPrivateKey(){return E.getItem(this.BROWSER_PRIVATE_KEY)}async setAppKey(e){E.setItem(this.APP_KEY,e),h&&h.IDB&&await h.setItem(this.APP_KEY,e)}getAppKey(){return E.getItem(this.APP_KEY)}async getAppKeySync(){if(h&&h.IDB)return await h.getItem(this.APP_KEY)}setVAPID(e){E.setItem(this.VAPID_PUBLIC,e)}getVAPID(){return E.getItem(this.VAPID_PUBLIC)}setEnabled(e){E.setItem(this.ENABLED,e)}getEnabled(){return E.getItem(this.ENABLED)}setServiceSyncTime(e){E.setItem(this.SERVICE_SYNC_TIME,e*this.BASE_TIME)}getServiceSyncTime(){return E.getItem(this.SERVICE_SYNC_TIME)||1*this.BASE_TIME}setLocationEnabled(e){E.setItem(this.LOCATION_ENABLED,e)}getLocationEnabled(){return E.getItem(this.LOCATION_ENABLED)}setLocationUpdateMinutes(e){E.setItem(this.LOCATION_UPDATE_MINUTES,e)}getLocationUpdateMinutes(){return E.getItem(this.LOCATION_UPDATE_MINUTES)||30}async setRequestLocation(e){E.setItem(this.REQUEST_LOCATION,e)}getRequestLocation(){return!!E&&E.getItem(this.REQUEST_LOCATION)}async setPlatform(e){E.setItem(this.PLATFORM,e)}getPlatform(){return E&&E.getItem(this.PLATFORM)||c.platform}getVersion(){return c.version}async setBrowserName(e){E.setItem(this.BROWSER_NAME,e)}getBrowserName(){return E.getItem(this.BROWSER_NAME)}setBrowserVersion(e){E.setItem(this.BROWSER_VERSION,e)}getBrowserVersion(){return E.getItem(this.BROWSER_VERSION)}async setOsName(e){E.setItem(this.OS_NAME,e)}getOsName(){return E.getItem(this.OS_NAME)}setOsVersion(e){E.setItem(this.OS_VERSION,e)}getOsVersion(){return E.getItem(this.OS_VERSION)}setDeviceType(e){E.setItem(this.DEVICE_TYPE,e)}getDeviceType(){return E.getItem(this.DEVICE_TYPE)}setSupported(e){E.setItem(this.SUPPORTED,e)}getSupported(){return E.getItem(this.SUPPORTED)}setServiceTimestamp(e){E.setItem(this.SERVICE_TIMESTAMP,e)}getServiceTimestamp(){return E.getItem(this.SERVICE_TIMESTAMP)}setLocationTimestamp(e){E.setItem(this.LOCATION_TIMESTAMP,e)}getLocationTimestamp(){return E.getItem(this.LOCATION_TIMESTAMP)}setPermissionLocation(e){E.setItem(this.PERMISSION_LOCATION,e)}getPermissionLocation(){return E.getItem(this.PERMISSION_LOCATION)}setDebugLog(e){E.setItem(this.SET_LOG_DEBUG,e)}getDebugLog(){return"false"!==E.getItem(this.SET_LOG_DEBUG)}setLogLevel(e){E.setItem(this.LOG_LEVEL,e)}getLogLevel(){return E.getItem(this.LOG_LEVEL)}setNewUserTimestamp(e){E.setItem(this.NEW_USER_TIMESTAMP,e)}getNewUserTimestamp(){return E.getItem(this.NEW_USER_TIMESTAMP)}async setExternalIdRequest(e){E&&E.isLocalStorageAvailable()&&E.setItem(this.EXTERNAL_ID,e),h&&h.IDB&&await h.setItem(this.EXTERNAL_ID,e)}async getExternalIdRequest(){let e;try{E&&E.isLocalStorageAvailable()?e=E.getItem(this.EXTERNAL_ID):h&&h.IDB&&(e=await h.getItem(this.EXTERNAL_ID))}catch(e){}return e}setExternalId(e){E.setItem(this.EXTERNAL_ID,e)}getExternalId(){return E.getItem(this.EXTERNAL_ID)}async getRegisteredByCookie(){return E.getItem(this.REGISTERED_BY_COOKIE)}async setRegisteredByCookie(e){E.setItem(this.REGISTERED_BY_COOKIE,e)}setLatitude(e){E.setItem(this.LATITUDE,e)}getLatitude(){return E.getItem(this.LATITUDE)}setLongitude(e){E.setItem(this.LONGITUDE,e)}getLongitude(){return E.getItem(this.LONGITUDE)}async setInAppTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.INAPP_TOPICS,e)}async getInAppTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.INAPP_TOPICS))}catch(e){}return e}async setTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.TOPIC_LIST,e)}async getTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.TOPIC_LIST))}catch(e){}return e}getUrlInappApi(){return this.getStorage(this.URL_INAPP_API)}setUrlInappApi(e){this.setStorage(this.URL_INAPP_API,e)}setInAppEnabled(e){this.setStorage(this.INAPP_ENABLED,e)}isInAppEnabled(){return this.getStorage(this.INAPP_ENABLED)}},g=Object.freeze({DEBUG:1,INFO:2,WARNING:3,ERROR:4}),R=g;class _{constructor(e){this.tag="[IND]",e&&(this.tag=e),this.level=R.INFO,this.setLogLevel((new u).getLogLevel()),this.log=[]}setLogLevel(e){e&&e>=R.DEBUG&&e<=R.ERROR&&(this.level=e)}static addedAsString(e){return"string"==typeof e?e:JSON.stringify(e,null,2)}d(){if(this.level<=R.DEBUG)for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}i(){if(this.level<=R.INFO)for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}w(){if(this.level<=R.WARNING)for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}e(){if(this.level<=R.ERROR)if(1==arguments.length&&arguments.errorCode)this.log+=`${error.errorCode}: ${error.errorMessage}`;else for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}writeLog(){this.log.length>0&&this.tag&&this.log&&console.log(this.tag,this.log),this.log=[]}}const p=_,T=class{constructor(e,t,s){this.errorCode=e,this.errorMessage=t,null!=s&&(this.exceptionMessage=s)}},A=new class{constructor(){}showError(e,t,s){if(null!=e){const i=Object.values(e.ErrorCode).indexOf(t);return i>=0?new T(Object.keys(e.ErrorCode)[i],Object.keys(e.ErrorMessage)[i],s):new T(GENERAL_ERROR,"general error",s)}}},S={ErrorCode:{GENERAL_ERROR:600,API_SERVER_ERROR:500,API_PARAMETER_MISSING:400,API_APPKEY_NOT_VALID:401,API_FORBIDDEN_REQUEST:403,API_DEVICE_NOT_FOUND:404,API_TOPICS_ARE_INSERTED:409,BAD_REQUEST_SERVER_ERROR:410},ErrorMessage:{GENERAL_ERROR:"General Error",API_SERVER_ERROR:"Error server response",API_PARAMETER_MISSING:"Api parameter missing",API_APPKEY_NOT_VALID:"appKey is not valid",API_FORBIDDEN_REQUEST:"forbidden request",API_DEVICE_NOT_FOUND:"device not found",API_TOPICS_ARE_INSERTED:"topics are inserted",BAD_REQUEST_SERVER_ERROR:"bad request"}},O=class{constructor(){this.URL_BASE="",this.GET="GET",this.POST="POST",this.PUT="PUT",this.DELETE="DELETE"}async getURL(){return this.URL_BASE}async call(e,t,s,i){const r=new p("[IND]BaseClient: ");s.isServiceWorkerRequest()&&r.setLogLevel(R.DEBUG);let n=await this.getURL()+s.getPath(t)+s.getParams();s.isJourneyRequest()&&(n=n.replace("v1","v2"));const o={method:e,headers:s.addHeaders()};e!==this.GET&&(o.body=JSON.stringify(s.getBody())),i&&(o.credentials=i);try{const t=await fetch(n,o),i=await t.json();return t.ok?(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\nResponse Body:",JSON.stringify(i.data,null,"\t")).writeLog(),i):(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\n").writeLog(),new T(i.statusCode,i.message))}catch(t){return r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Error: "+t).writeLog(),A.showError(S,S.ErrorCode.GENERAL_ERROR,t)}}async get(e,t){return await this.call(this.GET,e,t)}async post(e,t,s){return await this.call(this.POST,e,t,s)}async put(e,t,s){return await this.call(this.PUT,e,t,s)}async delete(e,t){return await this.call(this.DELETE,e,t)}},P=class{constructor(){this.PARAM_APP_KEY="appKey",this.PARAM_DEVICE_ID="deviceId",this.PARAM_PUSH_TOKEN="pushToken",this.PARAM_ENABLED="enabled",this.PARAM_PLATFORM="platform",this.PARAM_VERSION="version",this.PARAM_TOPICS="topics",this.PARAM_EVENT_TYPE="eventType",this.PARAM_PUSH_ID="pushId",this.PARAM_CLICKED_BUTTON="clickedButton",this.PARAM_PERMISSION_TYPE="permissionType",this.PARAM_LATITUDE="latitude",this.PARAM_LONGITUDE="longitude",this.PARAM_INAPP_ID="inAppId",this.PARAM_INAPP_EVENT_TYPE="eventType",this.PARAM_INAPP_CLICKED_BUTTON="clickedButton",this.PARAM_INAPP_LAST_VERSION_ID="lastVersionId",this.PARAM_INBOX_EXTERNALID="externalId",this.PARAM_INBOX_PAGE="page",this.PARAM_INBOX_PAGE_SIZE="pageSize",this.PARAM_INBOX_DATE_FROM="dateFrom",this.PARAM_INBOX_DATE_TO="dateTo",this.PARAM_INBOX_STATUS="status",this.PARAM_INBOX_SENDER_IDS="sendingIds",this.PARAM_CUSTOMER_ID="customerId",this.PARAM_CUSTOMER_FIELD_NAMES="fieldNames",this.PARAM_CUSTOMER_FIELDS="fields",this.PARAM_CUSTOMER_LINK="link",this.PARAM_CUSTOMER_CHANNEL="channel",this.appKey=(new u).getAppKey(),this.params=null,this.pathParams={},this.headers={}}getParams(){return"?"+this.PARAM_APP_KEY+"="+this.appKey+(this.params?"&"+this.params:"")}getBody(){return this.body?this.body:""}getPath(e){let t=e;return Object.keys(this.pathParams).forEach((e=>{t=t.replace(e,this.pathParams[e])})),t}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}isServiceWorkerRequest(){return this.serviceWorkerRequest}setServiceWorkerRequest(e){this.serviceWorkerRequest=e}isJourneyRequest(){return this.journeyRequest}setJourneyRequest(e){this.journeyRequest=e}},m=Object.freeze({PUSH:"push",INAPP:"inapp",CHAT:"chat"}),N=class{constructor(e=null,t){null==e?(this.browserPublicKey=(new u).getBrowserPublicKey(),this.browserPrivateKey=(new u).getBrowserPrivateKey(),this.platform=(new u).getPlatform(),this.version=(new u).getVersion(),this.browserName=(new u).getBrowserName(),this.browserVersion=(new u).getBrowserVersion(),this.osName=(new u).getOsName(),this.osVersion=(new u).getOsVersion(),this.deviceType=(new u).getDeviceType(),(new u).getEnabled()&&(this.enabled="true"===(new u).getEnabled()),(new u).getExternalId()&&(this.externalCode=(new u).getExternalId())):t?(e.enabled&&(this.enabled=e.enabled,(new u).setEnabled(this.enabled)),e.registeredByCookie&&(this.registeredByCookie=e.registeredByCookie,(new u).setRegisteredByCookie(this.registeredByCookie))):(e.browserPublicKey&&(this.browserPublicKey=e.browserPublicKey),e.browserPrivateKey&&(this.browserPrivateKey=e.browserPrivateKey),e.platform&&(this.platform=e.platform),e.version&&(this.version=e.version),e.osVersion&&(this.osVersion=e.osVersion),e.browserName&&(this.browserName=e.browserName),e.browserVersion&&(this.browserVersion=e.browserVersion),e.osName&&(this.osName=e.osName),e.deviceType&&(this.deviceType=e.deviceType),e.enabled&&(this.enabled=e.enabled),e.externalCode&&(this.externalCode=e.externalCode)),this.platform&&(this.productName=this.platform),this.version&&(this.productVersion=this.version),navigator&&"language"in navigator&&(this.locale=navigator.language),Intl&&"DateTimeFormat"in Intl&&(this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone),this.timeOffset=-(new Date).getTimezoneOffset()}getDeviceId(){return this.deviceId}setDeviceId(e){this.deviceId=e}setExternalCode(e){this.externalCode=e}toJSON(){const e={};return this.platform&&(e.platform=this.platform),this.version&&(e.version=this.version),this.productName&&(e.productName=this.productName),this.productVersion&&(e.productVersion=this.productVersion),this.browserName&&(e.browserName=this.browserName),this.browserVersion&&(e.browserVersion=this.browserVersion),this.osName&&(e.osName=this.osName),this.osVersion&&(e.osVersion=this.osVersion),this.deviceType&&(e.deviceType=this.deviceType),this.locale&&(e.locale=this.locale),this.timeZone&&(e.timeZome=this.timeZone),this.timeOffset&&(e.timeOffset=this.timeOffset),this.enabled&&(e.enabled=this.enabled),this.browserPublicKey&&(e.browserPublicKey=this.browserPublicKey),this.browserPrivateKey&&(e.browserPrivateKey=this.browserPrivateKey),this.externalCode&&(e.externalCode=this.externalCode),e}},y=Object.freeze({DEFAULT:-1,ENABLE:1,DISABLE:0}),w=Object.freeze({EVENT_TYPE_CLICK:"click",EVENT_TYPE_RECEIVE:"receive",EVENT_TYPE_UPDATE:"update",EVENT_TYPE_ACCEPT:"accept",EVENT_TYPE_REJECT:"reject",EVENT_TYPE_ASK:"ask"}),C=Object.freeze({SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe"}),D=class{static isServiceTimestampExceed(){return!(new u).getServiceTimestamp()||(new u).getServiceSyncTime()<=(Date.now()-(new u).getServiceTimestamp())/6e4}static isFunction(e){return!(!e||"function"!=typeof e)}},b=class{static async getPermissions(){const e=await this.getPermission("geolocation"),t={};return e&&(t.location=e.state),t}static async getPermission(e){try{if(navigator&&navigator.permissions&&navigator.permissions.query&&e)return await navigator.permissions.query({name:e,userVisibleOnly:!0})}catch(e){return null}return null}static async setPermissionsCallback(){await this.setCallback("geolocation",navigator.indigitallRequestLocationPermission)}static async setCallback(e,t){const s=await this.getPermission(e);if(s){let i=s.state;"onchange"in s&&(s.onchange=()=>{new p("[IND]CorePermissions: ").d(e+" permission state has changed from "+i+" to "+s.state).writeLog(),i=s.state,t&&t({name:e,state:s.state})})}}},f=new p("[IND]Crypto"),L=new TextEncoder("utf-8"),v="HMAC",B=class{static async createHmac(e,t){try{const s=window?.crypto?.subtle;if(!s)return;const i=await s.importKey("raw",L.encode(e),{name:v,hash:{name:"SHA-256"}},!1,["sign","verify"]),r=await s.sign(v,i,L.encode(t)),n=new Uint8Array(r),o=Array.prototype.map.call(n,(e=>("00"+e.toString(16)).slice(-2))).join("");return f.d("hmac: ",o).writeLog(),o}catch(e){return void f.e("error:",e).writeLog()}}},U=class{static compareJSON(e,t){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const i of s)if(e[i]!==t[i]){if("object"!=typeof e[i]||"object"!=typeof t[i])return!1;if(!isEqual(e[i],t[i]))return!1}return!0}},M=class{static isValidFormat(e){return null!=e&&""!=e&&"null"!=e&&e.length>8}},V=class{static setTopicChannel(e,t){const s=[];for(let i=0;i<e.length;i++){const r=e[i];r.channel=t,s.push(r)}return s}},x={Repository:u,Config:c,Api:i,Models:r,Utils:n}},391:e=>{"use strict";e.exports=JSON.parse('{"name":"indigitall-web-core","description":"indigitall web core","version":"4.3.1","main":"index.js","author":"Smart2me S.L.","homepage":"https://indigitall.com","devDependencies":{"@babel/preset-env":"^7.18.10","babel-loader":"^8.2.5","filemanager-webpack-plugin":"^7.0.0","idempotent-babel-polyfill":"^7.4.4","script-loader":"^0.7.2","webpack":"^5.74.0","webpack-bundle-analyzer":"^4.6.1","webpack-cli":"^4.10.0"},"scripts":{"test":"echo \'There are not tests\'","public":"ws --directory ./public --port 80 --log.format dev","build":"webpack --config webpack.config.js --mode=production","build-dev":"webpack --config webpack.config.js --watch --mode=development","delete-node-modules":"rm -rf node_modules/ && rm -f package-lock.json","install-core":"npm install && npm run build"}}')}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,s),n.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{"use strict";s.r(i),s.d(i,{default:()=>m});const{Repository:e}=s(436).Core,t=new class extends e{constructor(){super(),this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID"}async setDeviceId(e){this.setStorage(this.DEVICE_ID,e)}getDeviceId(){return this.getStorage(this.DEVICE_ID)}},{Validations:r,Log:n}=s(436).Core.Utils,o=class extends r{static isAppKeyFormat(){const e=t.getAppKey();return null!=e&&""!=e&&"null"!=e&&e.length>3}static isValidFormatRequest(){const e=new n("[IND]CustomerValidations: "),s=t.getDeviceId();let i=!0;return this.isAppKeyFormat()||(i=!1,e.w("appKey is null or empty").writeLog()),this.isValidFormat(s)||(i=!1,e.w("deviceId is null or empty").writeLog()),i}},a=class{constructor(e){e.id&&(this.id=e.id),e.customerId&&(this.customerId=e.customerId),e.applicationId&&(this.applicationId=e.applicationId),e.createdAt&&(this.createdAt=e.createdAt),e.updatedAt&&(this.updatedAt=e.updatedAt)}getCustomerId(){return this.customerId}getApplicationId(){return this.applicationId}getId(){return this.id}getCreatedAt(){return this.createdAt}getUpdatedAt(){return this.updatedAt}toJSON(){return{id:this.id,customerId:this.customerId,applicationId:this.applicationId,createdAt:this.createdAt,updatedAt:this.updatedAt}}},c=class{constructor(e,t){this.customerFieldKey=e,this.customerFieldValue=t}getCustomerFieldKey(){return this.customerFieldKey}getCustomerFieldValue(){return this.customerFieldValue}toJSON(){return JSON.parse(`"${this.customerFieldKey}":"${this.customerFieldValue}"`)}},{ErrorDictionary:l}=s(436).Core.Models,E=l.ErrorCode;Object.assign(E,{CUSTOMER_GET_ERROR:4001,CUSTOMER_PARAMS_ERROR:4011,CUSTOMER_GENERAL_ERROR:4600,CUSTOMER_NO_EXTERNAL_CODE:4601});const h=l.ErrorMessage;Object.assign(h,{CUSTOMER_GET_ERROR:"customer get error",CUSTOMER_PARAMS_ERROR:"Params are not correct",CUSTOMER_GENERAL_ERROR:"general error",CUSTOMER_NO_EXTERNAL_CODE:"no external code registered"});const I={ErrorCode:E,ErrorMessage:h},{Config:d}=s(436).Core,{BaseClient:u}=s(436).Core.Api,{ErrorModel:g}=s(436).Core.Models,{CommonUtils:R,ErrorUtils:_}=s(436).Core.Utils,p=new class extends u{constructor(){super(),this.URL_BASE=d.client.CUSTOMER_URL_BASE,this.ENDPOINT_CUSTOMER="/customer",this.ENDPOINT_CUSTOMER_FIELD=this.ENDPOINT_CUSTOMER+"/field",this.ENDPOINT_CUSTOMER_LINK=this.ENDPOINT_CUSTOMER+"/link",this.ENDPOINT_EVENT="/event",this.ENDPOINT_EVENT_JOURNEY=this.ENDPOINT_EVENT+"/custom",this.ENDPOINT_EVENT_JOURNEY_BEACON=this.ENDPOINT_EVENT_JOURNEY+"/beacon"}async getCustomer(e,s,i){if(o.isAppKeyFormat()&&o.isValidFormat(t.getExternalId)){const t=await this.get(this.ENDPOINT_CUSTOMER,e.getCustomerRequest());t&&!(t instanceof g)&&t.statusCode>=200&&t.statusCode<300?R.isFunction(s)&&s(new a(t.data)):t?R.isFunction(i)&&i(t):R.isFunction(i)&&i()}else R.isFunction(i)&&i(_.showError(I,I.ErrorCode.BAD_REQUEST_SERVER_ERROR))}async getCustomerField(e,s,i){if(o.isAppKeyFormat()&&o.isValidFormat(t.getExternalId)){const t=await this.get(this.ENDPOINT_CUSTOMER_FIELD,e.getCustomerFieldRequest()),r=[];for(const e in t.data)t.data.hasOwnProperty(e)&&r.push(new c(e,t.data[e]));t&&r.length>0&&!(t instanceof g)&&t.statusCode>=200&&t.statusCode<300?R.isFunction(s)&&s(r):t?R.isFunction(i)&&i(t):R.isFunction(i)&&i()}else R.isFunction(i)&&i(_.showError(I,I.ErrorCode.BAD_REQUEST_SERVER_ERROR))}async putCustomerField(e,s,i){if(o.isAppKeyFormat()&&o.isValidFormat(t.getExternalId)){const t=await this.put(this.ENDPOINT_CUSTOMER_FIELD,e.putCustomerFieldRequest());this.getCustomerResponse(t,s,i)}else R.isFunction(i)&&i(_.showError(I,I.ErrorCode.BAD_REQUEST_SERVER_ERROR))}async deleteCustomerField(e,s,i){if(o.isAppKeyFormat()&&o.isValidFormat(t.getExternalId)){const t=await this.delete(this.ENDPOINT_CUSTOMER_FIELD,e.deleteCustomerFieldRequest());this.getCustomerResponse(t,s,i)}else R.isFunction(i)&&i(_.showError(I,I.ErrorCode.BAD_REQUEST_SERVER_ERROR))}async postCustomerLink(e,s,i){if(o.isValidFormatRequest()&&o.isValidFormat(t.getExternalId)){const t=await this.post(this.ENDPOINT_CUSTOMER_LINK,e.postAndDeleteCustomerLinkRequest());this.getCustomerResponse(t,s,i)}else R.isFunction(i)&&i(_.showError(I,I.ErrorCode.BAD_REQUEST_SERVER_ERROR))}async deleteCustomerLink(e,s,i){if(o.isValidFormatRequest()&&o.isValidFormat(t.getExternalId)){const t=await this.delete(this.ENDPOINT_CUSTOMER_LINK,e.postAndDeleteCustomerLinkRequest());this.getCustomerResponse(t,s,i)}else R.isFunction(i)&&i(_.showError(I,I.ErrorCode.BAD_REQUEST_SERVER_ERROR))}async getCustomerResponse(e,t,s){e&&!(e instanceof g)&&e.statusCode>=200&&e.statusCode<300?R.isFunction(t)&&(""!=e.data?t(e.data):t()):e?R.isFunction(s)&&s(e):R.isFunction(s)&&s()}},{BaseRequest:T}=s(436).Core.Api,{Device:A}=s(436).Core.Models,S=class extends T{constructor(){super(),this.device=new A,null!=t.getExternalId()&&(this.customerId=t.getExternalId()),this.fieldNames,this.link,this.fields}getCustomerRequest(){return this.params=this.createQueryStringCustomerId(),this}getCustomerFieldRequest(){return this.params=this.createQueryString(),this}putCustomerFieldRequest(){return this.params=this.createQueryStringCustomerId(),this.body=this.createBodyJson(),this}deleteCustomerFieldRequest(){return this.params=this.createQueryStringCustomerId(),this.body=this.createDeleteBodyJson(),this}postAndDeleteCustomerLinkRequest(){return this.params="",this.body=this.createBodyJson(),this}createQueryString(){let e="";return e+=this.createQueryStringCustomerId(),this.fieldNames&&(e+=`&${this.PARAM_CUSTOMER_FIELD_NAMES}=${this.fieldNames}`),this.fields&&(e+=`&${this.PARAM_CUSTOMER_FIELDS}=${this.fields}`),this.link&&(e+=`&${this.PARAM_CUSTOMER_LINK}=${this.link}`),e}createQueryStringCustomerId(){return this.PARAM_CUSTOMER_ID+"="+this.customerId}createBodyJson(){let e={};try{this.channel&&(e.channel=this.channel,this.device&&(e.deviceId=this.device.deviceId),this.customerId&&(e.customerId=this.customerId)),this.link&&(e.link=this.link),this.fields&&(e=this.fields)}catch(e){console.log("Error fieldNames request :"+e)}return e}createDeleteBodyJson(){const e={},t=[];try{if(this.fieldNames){for(let e=0;e<this.fieldNames.length;e++)t.push(this.fieldNames[e]);e.fields=t}}catch(e){console.log("Error fieldNames request :"+e)}return e}setFields(e){this.fields=e}setFieldNames(e){this.fieldNames=e}setLink(e){this.link=e}setChannel(e){this.channel=e}},{CommonUtils:O,ErrorUtils:P}=s(436).Core.Utils,m=class{static async getCustomer(e,t){const s=new S;await p.getCustomer(s,e,t)}static async getCustomerInformation(e,t,s){const i=new S;null!=e&&(Array.isArray(e)?i.setFieldNames(e):O.isFunction(s)&&s(P.customerError(4011,P.CUSTOMER_ERROR_PARAMS))),await p.getCustomerField(i,t,s)}static async assignOrUpdateValueToCustomerFields(e,t,s){let i;try{"string"==typeof e?i=JSON.parse(i):"object"==typeof e&&(i=e)}catch(e){O.isFunction(s)&&s(P.customerError(4011,P.CUSTOMER_ERROR_PARAMS))}if(i){const e=new S;e.setFields(i),await p.putCustomerField(e,t,s)}else O.isFunction(s)&&s(P.customerError(4900,P.CUSTOMER_ERROR_PARAMS))}static async deleteValuesFromCustomerFields(e,t,s){if(Array.isArray(e)){const i=new S;i.setFieldNames(e),await p.deleteCustomerField(i,t,s)}else O.isFunction(s)&&s(P.customerError(4011,P.CUSTOMER_ERROR_PARAMS))}static async link(e,t,s){const i=new S;i.setChannel(e),await p.postCustomerLink(i,t,s)}static async unlink(e,t,s){const i=new S;i.setChannel(e),await p.deleteCustomerLink(i,t,s)}}})(),i})(),e.exports=t()},253:function(e){var t;t=()=>(()=>{var e={923:function(e){var t;t=()=>(()=>{"use strict";var e={147:e=>{e.exports=JSON.parse('{"name":"indigitall-web-core","description":"indigitall web core","version":"4.3.1","main":"index.js","author":"Smart2me S.L.","homepage":"https://indigitall.com","devDependencies":{"@babel/preset-env":"^7.18.10","babel-loader":"^8.2.5","filemanager-webpack-plugin":"^7.0.0","idempotent-babel-polyfill":"^7.4.4","script-loader":"^0.7.2","webpack":"^5.74.0","webpack-bundle-analyzer":"^4.6.1","webpack-cli":"^4.10.0"},"scripts":{"test":"echo \'There are not tests\'","public":"ws --directory ./public --port 80 --log.format dev","build":"webpack --config webpack.config.js --mode=production","build-dev":"webpack --config webpack.config.js --watch --mode=development","delete-node-modules":"rm -rf node_modules/ && rm -f package-lock.json","install-core":"npm install && npm run build"}}')}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,s),n.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{s.r(i),s.d(i,{default:()=>V});var e={};s.r(e),s.d(e,{BaseClient:()=>S,BaseRequest:()=>O});var t={};s.r(t),s.d(t,{Channel:()=>P,Device:()=>m,DeviceStatus:()=>N,ErrorDictionary:()=>A,ErrorModel:()=>p,EventType:()=>y,TopicSubscribeType:()=>w});var r={};s.r(r),s.d(r,{CommonUtils:()=>C,CorePermissions:()=>D,CryptoUtils:()=>v,ErrorUtils:()=>T,JsonUtils:()=>B,Log:()=>_,LogLevel:()=>u,TopicUtils:()=>M,Validations:()=>U});var n={platform:"webpush",version:"0.0.1"};const o=s(147);n.version=o.version;const a=n=Object.assign(n,{client:{URL_BASE:"https://device-api.indigitall.com/v1",URL_DEVICE_V2:"https://device-api.indigitall.com/v2",INAPP_URL_BASE:"https://inapp-api.indigitall.com/v1",INBOX_URL_BASE:"https://inbox-api.indigitall.com/v1",CUSTOMER_URL_BASE:"https://device-api.indigitall.com/v2"}}),c=new class{constructor(){this.storage=this.isLocalStorageAvailable()?window.localStorage:null}isLocalStorageAvailable(){try{const e=window.localStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==c.length}return!1}setItem(e,t){return null!=this.storage&&(this.storage.setItem(e,t),!0)}getItem(e){return null!=this.storage?this.storage.getItem(e):null}deleteItem(e){return!!this.storage&&(this.storage.setItem(e,value),!0)}clear(){this.storage&&this.storage.clear()}},l=c,E=new class{constructor(){this.TAG="[IND]IndexedDB: ",this.DB_NAME="indigitall.indexedDB",this.DB_VERSION=1,this.DB_STORE_NAME="indigitallStore",this.DB_STORE_MODE="readwrite",this.DB_KEY_PATH="id",this.DB_STORE_INDEX="storeIndex",this.IDB=indexedDB||mozzIndexedDB||webkitIndexedDB||msIndexedDB}async getDB(){return new Promise(((e,t)=>{const s=this.IDB;if(s){const i=s.open("indigitall.indexedDB",1);i.onupgradeneeded=function(){i.result.createObjectStore("indigitallStore").createIndex("storeIndex","store.key")},i.onsuccess=function(){const t=i.result,s=t.transaction("indigitallStore","readwrite"),r=s.objectStore("indigitallStore"),n=r.index("storeIndex");e({db:t,tx:s,store:r,index:n})},i.onerror=function(e){t(e)}}else t(!1)}))}async get(e,t){return new Promise(((s,i)=>{e||i(!1),e.index.get(t).onsuccess=t=>{t.target.result&&(this.close(e),s(t.target.result.store.value)),i(!1)}}))}async put(e,t,s){return new Promise(((i,r)=>{e||r(!1),e.store.put({store:{key:t,value:s}},t).onsuccess=t=>{this.close(e),i(s)}}))}close(e){if(e.tx)try{e.tx.oncomplete=()=>{e.db.close()}}catch(e){console.error(this.TAG,e)}}async setItem(e,t){try{const s=await this.getDB();return this.put(s,e,t)}catch(e){return e}}async getItem(e){try{const t=await this.getDB();return this.get(t,e)}catch(e){return e}}},h=new class{constructor(){this.SESSION="indigitall.session.storage",this.session=this.isSessionStorageAvailable()?window.sessionStorage:null}isSessionStorageAvailable(){try{const e=window.sessionStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==h.length}return!1}getItem(e){return null!=this.session?this.session.getItem(e):null}setItem(e,t){return null!=this.session&&(this.session.setItem(e,t),!0)}clearMessages(){this.session&&this.session.removeItem("messages")}},I=h,d=class{constructor(){this.storage=l,this.db=E,this.BASE_TIME=60,this.REPOSITORY="indigitall.repository",this.APP_KEY=this.REPOSITORY+".APP_KEY",this.VAPID_PUBLIC=this.REPOSITORY+".VAPID_PUBLIC",this.ENABLED=this.REPOSITORY+".ENABLED",this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID",this.SERVICE_SYNC_TIME=this.REPOSITORY+".SERVICE_SYNC_TIME",this.LOCATION_ENABLED=this.REPOSITORY+".LOCATION_ENABLED",this.LOCATION_UPDATE_MINUTES=this.REPOSITORY+".LOCATION_UPDATE_MINUTES",this.REQUEST_LOCATION=this.REPOSITORY+".REQUEST_LOCATION",this.BROWSER_PUBLIC_KEY=this.REPOSITORY+".BROWSER_PUBLIC_KEY",this.BROWSER_PRIVATE_KEY=this.REPOSITORY+".BROWSER_PRIVATE_KEY",this.PLATFORM=this.REPOSITORY+".PLATFORM",this.BROWSER_NAME=this.REPOSITORY+".BROWSER_NAME",this.BROWSER_VERSION=this.REPOSITORY+".BROWSER_VERSION",this.OS_NAME=this.REPOSITORY+".OS_NAME",this.OS_VERSION=this.REPOSITORY+".OS_VERSION",this.DEVICE_TYPE=this.REPOSITORY+".DEVICE_TYPE",this.SUPPORTED=this.REPOSITORY+".SUPPORTED",this.SERVICE_TIMESTAMP=this.REPOSITORY+".SERVICE_TIMESTAMP",this.LOCATION_TIMESTAMP=this.REPOSITORY+".LOCATION_TIMESTAMP",this.PERMISSION_LOCATION=this.REPOSITORY+".PERMISSION_LOCATION",this.SET_LOG_DEBUG=this.REPOSITORY+".SET_LOG_DEBUG",this.NEW_USER_TIMESTAMP=this.REPOSITORY+".NEW_USER_TIMESTAMP",this.EXTERNAL_ID=this.REPOSITORY+".EXTERNAL_ID",this.REGISTERED_BY_COOKIE=this.REPOSITORY+".REGISTERED_BY_COOKIE",this.LOG_LEVEL=this.REPOSITORY+".LOG_LEVEL",this.LATITUDE=this.REPOSITORY+".LATITUDE",this.LONGITUDE=this.REPOSITORY+".LONGITUDE",this.TOPIC_LIST=this.REPOSITORY+".TOPIC_LIST",this.INAPP_ENABLED=this.REPOSITORY+".INAPP_ENABLED",this.URL_INAPP_API=this.REPOSITORY+".URL_INAPP_API",this.INAPP_TOPICS=this.REPOSITORY+".INAPP_TOPICS"}setItemSessionStorage(e,t){I.setItem(e,t)}getItemSessionStorage(e){return I.getItem(e)}clearSessionStorage(){I.clearMessages()}setStorage(e,t){l.setItem(e,t)}getStorage(e){return l.getItem(e)}clearStorage(){l.clear()}setBrowserPublicKey(e){l.setItem(this.BROWSER_PUBLIC_KEY,e)}getBrowserPublicKey(){return l.getItem(this.BROWSER_PUBLIC_KEY)}setBrowserPrivateKey(e){l.setItem(this.BROWSER_PRIVATE_KEY,e)}getBrowserPrivateKey(){return l.getItem(this.BROWSER_PRIVATE_KEY)}async setAppKey(e){l.setItem(this.APP_KEY,e),E&&E.IDB&&await E.setItem(this.APP_KEY,e)}getAppKey(){return l.getItem(this.APP_KEY)}async getAppKeySync(){if(E&&E.IDB)return await E.getItem(this.APP_KEY)}setVAPID(e){l.setItem(this.VAPID_PUBLIC,e)}getVAPID(){return l.getItem(this.VAPID_PUBLIC)}setEnabled(e){l.setItem(this.ENABLED,e)}getEnabled(){return l.getItem(this.ENABLED)}setServiceSyncTime(e){l.setItem(this.SERVICE_SYNC_TIME,e*this.BASE_TIME)}getServiceSyncTime(){return l.getItem(this.SERVICE_SYNC_TIME)||1*this.BASE_TIME}setLocationEnabled(e){l.setItem(this.LOCATION_ENABLED,e)}getLocationEnabled(){return l.getItem(this.LOCATION_ENABLED)}setLocationUpdateMinutes(e){l.setItem(this.LOCATION_UPDATE_MINUTES,e)}getLocationUpdateMinutes(){return l.getItem(this.LOCATION_UPDATE_MINUTES)||30}async setRequestLocation(e){l.setItem(this.REQUEST_LOCATION,e)}getRequestLocation(){return!!l&&l.getItem(this.REQUEST_LOCATION)}async setPlatform(e){l.setItem(this.PLATFORM,e)}getPlatform(){return l&&l.getItem(this.PLATFORM)||a.platform}getVersion(){return a.version}async setBrowserName(e){l.setItem(this.BROWSER_NAME,e)}getBrowserName(){return l.getItem(this.BROWSER_NAME)}setBrowserVersion(e){l.setItem(this.BROWSER_VERSION,e)}getBrowserVersion(){return l.getItem(this.BROWSER_VERSION)}async setOsName(e){l.setItem(this.OS_NAME,e)}getOsName(){return l.getItem(this.OS_NAME)}setOsVersion(e){l.setItem(this.OS_VERSION,e)}getOsVersion(){return l.getItem(this.OS_VERSION)}setDeviceType(e){l.setItem(this.DEVICE_TYPE,e)}getDeviceType(){return l.getItem(this.DEVICE_TYPE)}setSupported(e){l.setItem(this.SUPPORTED,e)}getSupported(){return l.getItem(this.SUPPORTED)}setServiceTimestamp(e){l.setItem(this.SERVICE_TIMESTAMP,e)}getServiceTimestamp(){return l.getItem(this.SERVICE_TIMESTAMP)}setLocationTimestamp(e){l.setItem(this.LOCATION_TIMESTAMP,e)}getLocationTimestamp(){return l.getItem(this.LOCATION_TIMESTAMP)}setPermissionLocation(e){l.setItem(this.PERMISSION_LOCATION,e)}getPermissionLocation(){return l.getItem(this.PERMISSION_LOCATION)}setDebugLog(e){l.setItem(this.SET_LOG_DEBUG,e)}getDebugLog(){return"false"!==l.getItem(this.SET_LOG_DEBUG)}setLogLevel(e){l.setItem(this.LOG_LEVEL,e)}getLogLevel(){return l.getItem(this.LOG_LEVEL)}setNewUserTimestamp(e){l.setItem(this.NEW_USER_TIMESTAMP,e)}getNewUserTimestamp(){return l.getItem(this.NEW_USER_TIMESTAMP)}async setExternalIdRequest(e){l&&l.isLocalStorageAvailable()&&l.setItem(this.EXTERNAL_ID,e),E&&E.IDB&&await E.setItem(this.EXTERNAL_ID,e)}async getExternalIdRequest(){let e;try{l&&l.isLocalStorageAvailable()?e=l.getItem(this.EXTERNAL_ID):E&&E.IDB&&(e=await E.getItem(this.EXTERNAL_ID))}catch(e){}return e}setExternalId(e){l.setItem(this.EXTERNAL_ID,e)}getExternalId(){return l.getItem(this.EXTERNAL_ID)}async getRegisteredByCookie(){return l.getItem(this.REGISTERED_BY_COOKIE)}async setRegisteredByCookie(e){l.setItem(this.REGISTERED_BY_COOKIE,e)}setLatitude(e){l.setItem(this.LATITUDE,e)}getLatitude(){return l.getItem(this.LATITUDE)}setLongitude(e){l.setItem(this.LONGITUDE,e)}getLongitude(){return l.getItem(this.LONGITUDE)}async setInAppTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.INAPP_TOPICS,e)}async getInAppTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.INAPP_TOPICS))}catch(e){}return e}async setTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.TOPIC_LIST,e)}async getTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.TOPIC_LIST))}catch(e){}return e}getUrlInappApi(){return this.getStorage(this.URL_INAPP_API)}setUrlInappApi(e){this.setStorage(this.URL_INAPP_API,e)}setInAppEnabled(e){this.setStorage(this.INAPP_ENABLED,e)}isInAppEnabled(){return this.getStorage(this.INAPP_ENABLED)}},u=Object.freeze({DEBUG:1,INFO:2,WARNING:3,ERROR:4}),g=u;class R{constructor(e){this.tag="[IND]",e&&(this.tag=e),this.level=g.INFO,this.setLogLevel((new d).getLogLevel()),this.log=[]}setLogLevel(e){e&&e>=g.DEBUG&&e<=g.ERROR&&(this.level=e)}static addedAsString(e){return"string"==typeof e?e:JSON.stringify(e,null,2)}d(){if(this.level<=g.DEBUG)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}i(){if(this.level<=g.INFO)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}w(){if(this.level<=g.WARNING)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}e(){if(this.level<=g.ERROR)if(1==arguments.length&&arguments.errorCode)this.log+=`${error.errorCode}: ${error.errorMessage}`;else for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}writeLog(){this.log.length>0&&this.tag&&this.log&&console.log(this.tag,this.log),this.log=[]}}const _=R,p=class{constructor(e,t,s){this.errorCode=e,this.errorMessage=t,null!=s&&(this.exceptionMessage=s)}},T=new class{constructor(){}showError(e,t,s){if(null!=e){const i=Object.values(e.ErrorCode).indexOf(t);return i>=0?new p(Object.keys(e.ErrorCode)[i],Object.keys(e.ErrorMessage)[i],s):new p(GENERAL_ERROR,"general error",s)}}},A={ErrorCode:{GENERAL_ERROR:600,API_SERVER_ERROR:500,API_PARAMETER_MISSING:400,API_APPKEY_NOT_VALID:401,API_FORBIDDEN_REQUEST:403,API_DEVICE_NOT_FOUND:404,API_TOPICS_ARE_INSERTED:409,BAD_REQUEST_SERVER_ERROR:410},ErrorMessage:{GENERAL_ERROR:"General Error",API_SERVER_ERROR:"Error server response",API_PARAMETER_MISSING:"Api parameter missing",API_APPKEY_NOT_VALID:"appKey is not valid",API_FORBIDDEN_REQUEST:"forbidden request",API_DEVICE_NOT_FOUND:"device not found",API_TOPICS_ARE_INSERTED:"topics are inserted",BAD_REQUEST_SERVER_ERROR:"bad request"}},S=class{constructor(){this.URL_BASE="",this.GET="GET",this.POST="POST",this.PUT="PUT",this.DELETE="DELETE"}async getURL(){return this.URL_BASE}async call(e,t,s,i){const r=new _("[IND]BaseClient: ");s.isServiceWorkerRequest()&&r.setLogLevel(g.DEBUG);let n=await this.getURL()+s.getPath(t)+s.getParams();s.isJourneyRequest()&&(n=n.replace("v1","v2"));const o={method:e,headers:s.addHeaders()};e!==this.GET&&(o.body=JSON.stringify(s.getBody())),i&&(o.credentials=i);try{const t=await fetch(n,o),i=await t.json();return t.ok?(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\nResponse Body:",JSON.stringify(i.data,null,"\t")).writeLog(),i):(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\n").writeLog(),new p(i.statusCode,i.message))}catch(t){return r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Error: "+t).writeLog(),T.showError(A,A.ErrorCode.GENERAL_ERROR,t)}}async get(e,t){return await this.call(this.GET,e,t)}async post(e,t,s){return await this.call(this.POST,e,t,s)}async put(e,t,s){return await this.call(this.PUT,e,t,s)}async delete(e,t){return await this.call(this.DELETE,e,t)}},O=class{constructor(){this.PARAM_APP_KEY="appKey",this.PARAM_DEVICE_ID="deviceId",this.PARAM_PUSH_TOKEN="pushToken",this.PARAM_ENABLED="enabled",this.PARAM_PLATFORM="platform",this.PARAM_VERSION="version",this.PARAM_TOPICS="topics",this.PARAM_EVENT_TYPE="eventType",this.PARAM_PUSH_ID="pushId",this.PARAM_CLICKED_BUTTON="clickedButton",this.PARAM_PERMISSION_TYPE="permissionType",this.PARAM_LATITUDE="latitude",this.PARAM_LONGITUDE="longitude",this.PARAM_INAPP_ID="inAppId",this.PARAM_INAPP_EVENT_TYPE="eventType",this.PARAM_INAPP_CLICKED_BUTTON="clickedButton",this.PARAM_INAPP_LAST_VERSION_ID="lastVersionId",this.PARAM_INBOX_EXTERNALID="externalId",this.PARAM_INBOX_PAGE="page",this.PARAM_INBOX_PAGE_SIZE="pageSize",this.PARAM_INBOX_DATE_FROM="dateFrom",this.PARAM_INBOX_DATE_TO="dateTo",this.PARAM_INBOX_STATUS="status",this.PARAM_INBOX_SENDER_IDS="sendingIds",this.PARAM_CUSTOMER_ID="customerId",this.PARAM_CUSTOMER_FIELD_NAMES="fieldNames",this.PARAM_CUSTOMER_FIELDS="fields",this.PARAM_CUSTOMER_LINK="link",this.PARAM_CUSTOMER_CHANNEL="channel",this.appKey=(new d).getAppKey(),this.params=null,this.pathParams={},this.headers={}}getParams(){return"?"+this.PARAM_APP_KEY+"="+this.appKey+(this.params?"&"+this.params:"")}getBody(){return this.body?this.body:""}getPath(e){let t=e;return Object.keys(this.pathParams).forEach((e=>{t=t.replace(e,this.pathParams[e])})),t}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}isServiceWorkerRequest(){return this.serviceWorkerRequest}setServiceWorkerRequest(e){this.serviceWorkerRequest=e}isJourneyRequest(){return this.journeyRequest}setJourneyRequest(e){this.journeyRequest=e}},P=Object.freeze({PUSH:"push",INAPP:"inapp",CHAT:"chat"}),m=class{constructor(e=null,t){null==e?(this.browserPublicKey=(new d).getBrowserPublicKey(),this.browserPrivateKey=(new d).getBrowserPrivateKey(),this.platform=(new d).getPlatform(),this.version=(new d).getVersion(),this.browserName=(new d).getBrowserName(),this.browserVersion=(new d).getBrowserVersion(),this.osName=(new d).getOsName(),this.osVersion=(new d).getOsVersion(),this.deviceType=(new d).getDeviceType(),(new d).getEnabled()&&(this.enabled="true"===(new d).getEnabled()),(new d).getExternalId()&&(this.externalCode=(new d).getExternalId())):t?(e.enabled&&(this.enabled=e.enabled,(new d).setEnabled(this.enabled)),e.registeredByCookie&&(this.registeredByCookie=e.registeredByCookie,(new d).setRegisteredByCookie(this.registeredByCookie))):(e.browserPublicKey&&(this.browserPublicKey=e.browserPublicKey),e.browserPrivateKey&&(this.browserPrivateKey=e.browserPrivateKey),e.platform&&(this.platform=e.platform),e.version&&(this.version=e.version),e.osVersion&&(this.osVersion=e.osVersion),e.browserName&&(this.browserName=e.browserName),e.browserVersion&&(this.browserVersion=e.browserVersion),e.osName&&(this.osName=e.osName),e.deviceType&&(this.deviceType=e.deviceType),e.enabled&&(this.enabled=e.enabled),e.externalCode&&(this.externalCode=e.externalCode)),this.platform&&(this.productName=this.platform),this.version&&(this.productVersion=this.version),navigator&&"language"in navigator&&(this.locale=navigator.language),Intl&&"DateTimeFormat"in Intl&&(this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone),this.timeOffset=-(new Date).getTimezoneOffset()}getDeviceId(){return this.deviceId}setDeviceId(e){this.deviceId=e}setExternalCode(e){this.externalCode=e}toJSON(){const e={};return this.platform&&(e.platform=this.platform),this.version&&(e.version=this.version),this.productName&&(e.productName=this.productName),this.productVersion&&(e.productVersion=this.productVersion),this.browserName&&(e.browserName=this.browserName),this.browserVersion&&(e.browserVersion=this.browserVersion),this.osName&&(e.osName=this.osName),this.osVersion&&(e.osVersion=this.osVersion),this.deviceType&&(e.deviceType=this.deviceType),this.locale&&(e.locale=this.locale),this.timeZone&&(e.timeZome=this.timeZone),this.timeOffset&&(e.timeOffset=this.timeOffset),this.enabled&&(e.enabled=this.enabled),this.browserPublicKey&&(e.browserPublicKey=this.browserPublicKey),this.browserPrivateKey&&(e.browserPrivateKey=this.browserPrivateKey),this.externalCode&&(e.externalCode=this.externalCode),e}},N=Object.freeze({DEFAULT:-1,ENABLE:1,DISABLE:0}),y=Object.freeze({EVENT_TYPE_CLICK:"click",EVENT_TYPE_RECEIVE:"receive",EVENT_TYPE_UPDATE:"update",EVENT_TYPE_ACCEPT:"accept",EVENT_TYPE_REJECT:"reject",EVENT_TYPE_ASK:"ask"}),w=Object.freeze({SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe"}),C=class{static isServiceTimestampExceed(){return!(new d).getServiceTimestamp()||(new d).getServiceSyncTime()<=(Date.now()-(new d).getServiceTimestamp())/6e4}static isFunction(e){return!(!e||"function"!=typeof e)}},D=class{static async getPermissions(){const e=await this.getPermission("geolocation"),t={};return e&&(t.location=e.state),t}static async getPermission(e){try{if(navigator&&navigator.permissions&&navigator.permissions.query&&e)return await navigator.permissions.query({name:e,userVisibleOnly:!0})}catch(e){return null}return null}static async setPermissionsCallback(){await this.setCallback("geolocation",navigator.indigitallRequestLocationPermission)}static async setCallback(e,t){const s=await this.getPermission(e);if(s){let i=s.state;"onchange"in s&&(s.onchange=()=>{new _("[IND]CorePermissions: ").d(e+" permission state has changed from "+i+" to "+s.state).writeLog(),i=s.state,t&&t({name:e,state:s.state})})}}},b=new _("[IND]Crypto"),f=new TextEncoder("utf-8"),L="HMAC",v=class{static async createHmac(e,t){try{const s=window?.crypto?.subtle;if(!s)return;const i=await s.importKey("raw",f.encode(e),{name:L,hash:{name:"SHA-256"}},!1,["sign","verify"]),r=await s.sign(L,i,f.encode(t)),n=new Uint8Array(r),o=Array.prototype.map.call(n,(e=>("00"+e.toString(16)).slice(-2))).join("");return b.d("hmac: ",o).writeLog(),o}catch(e){return void b.e("error:",e).writeLog()}}},B=class{static compareJSON(e,t){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const i of s)if(e[i]!==t[i]){if("object"!=typeof e[i]||"object"!=typeof t[i])return!1;if(!isEqual(e[i],t[i]))return!1}return!0}},U=class{static isValidFormat(e){return null!=e&&""!=e&&"null"!=e&&e.length>8}},M=class{static setTopicChannel(e,t){const s=[];for(let i=0;i<e.length;i++){const r=e[i];r.channel=t,s.push(r)}return s}},V={Repository:d,Config:a,Api:e,Models:t,Utils:r}})(),i})(),e.exports=t()},590:(e,t,s)=>{"use strict";s.d(t,{Core:()=>x});var i={};s.r(i),s.d(i,{BaseClient:()=>O,BaseRequest:()=>P});var r={};s.r(r),s.d(r,{Channel:()=>m,Device:()=>N,DeviceStatus:()=>y,ErrorDictionary:()=>S,ErrorModel:()=>T,EventType:()=>w,TopicSubscribeType:()=>C});var n={};s.r(n),s.d(n,{CommonUtils:()=>D,CorePermissions:()=>b,CryptoUtils:()=>B,ErrorUtils:()=>A,JsonUtils:()=>U,Log:()=>p,LogLevel:()=>g,TopicUtils:()=>V,Validations:()=>M}),s(923);var o={platform:"webpush",version:"0.0.1"};const a=s(391);o.version=a.version;const c=o=Object.assign(o,{client:{URL_BASE:"https://device-api.indigitall.com/v1",URL_DEVICE_V2:"https://device-api.indigitall.com/v2",INAPP_URL_BASE:"https://inapp-api.indigitall.com/v1",INBOX_URL_BASE:"https://inbox-api.indigitall.com/v1",CUSTOMER_URL_BASE:"https://device-api.indigitall.com/v2"}}),l=new class{constructor(){this.storage=this.isLocalStorageAvailable()?window.localStorage:null}isLocalStorageAvailable(){try{const e=window.localStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==l.length}return!1}setItem(e,t){return null!=this.storage&&(this.storage.setItem(e,t),!0)}getItem(e){return null!=this.storage?this.storage.getItem(e):null}deleteItem(e){return!!this.storage&&(this.storage.setItem(e,value),!0)}clear(){this.storage&&this.storage.clear()}},E=l,h=new class{constructor(){this.TAG="[IND]IndexedDB: ",this.DB_NAME="indigitall.indexedDB",this.DB_VERSION=1,this.DB_STORE_NAME="indigitallStore",this.DB_STORE_MODE="readwrite",this.DB_KEY_PATH="id",this.DB_STORE_INDEX="storeIndex",this.IDB=indexedDB||mozzIndexedDB||webkitIndexedDB||msIndexedDB}async getDB(){return new Promise(((e,t)=>{const s=this.IDB;if(s){const i=s.open("indigitall.indexedDB",1);i.onupgradeneeded=function(){i.result.createObjectStore("indigitallStore").createIndex("storeIndex","store.key")},i.onsuccess=function(){const t=i.result,s=t.transaction("indigitallStore","readwrite"),r=s.objectStore("indigitallStore"),n=r.index("storeIndex");e({db:t,tx:s,store:r,index:n})},i.onerror=function(e){t(e)}}else t(!1)}))}async get(e,t){return new Promise(((s,i)=>{e||i(!1),e.index.get(t).onsuccess=t=>{t.target.result&&(this.close(e),s(t.target.result.store.value)),i(!1)}}))}async put(e,t,s){return new Promise(((i,r)=>{e||r(!1),e.store.put({store:{key:t,value:s}},t).onsuccess=t=>{this.close(e),i(s)}}))}close(e){if(e.tx)try{e.tx.oncomplete=()=>{e.db.close()}}catch(e){console.error(this.TAG,e)}}async setItem(e,t){try{const s=await this.getDB();return this.put(s,e,t)}catch(e){return e}}async getItem(e){try{const t=await this.getDB();return this.get(t,e)}catch(e){return e}}},I=new class{constructor(){this.SESSION="indigitall.session.storage",this.session=this.isSessionStorageAvailable()?window.sessionStorage:null}isSessionStorageAvailable(){try{const e=window.sessionStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==I.length}return!1}getItem(e){return null!=this.session?this.session.getItem(e):null}setItem(e,t){return null!=this.session&&(this.session.setItem(e,t),!0)}clearMessages(){this.session&&this.session.removeItem("messages")}},d=I,u=class{constructor(){this.storage=E,this.db=h,this.BASE_TIME=60,this.REPOSITORY="indigitall.repository",this.APP_KEY=this.REPOSITORY+".APP_KEY",this.VAPID_PUBLIC=this.REPOSITORY+".VAPID_PUBLIC",this.ENABLED=this.REPOSITORY+".ENABLED",this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID",this.SERVICE_SYNC_TIME=this.REPOSITORY+".SERVICE_SYNC_TIME",this.LOCATION_ENABLED=this.REPOSITORY+".LOCATION_ENABLED",this.LOCATION_UPDATE_MINUTES=this.REPOSITORY+".LOCATION_UPDATE_MINUTES",this.REQUEST_LOCATION=this.REPOSITORY+".REQUEST_LOCATION",this.BROWSER_PUBLIC_KEY=this.REPOSITORY+".BROWSER_PUBLIC_KEY",this.BROWSER_PRIVATE_KEY=this.REPOSITORY+".BROWSER_PRIVATE_KEY",this.PLATFORM=this.REPOSITORY+".PLATFORM",this.BROWSER_NAME=this.REPOSITORY+".BROWSER_NAME",this.BROWSER_VERSION=this.REPOSITORY+".BROWSER_VERSION",this.OS_NAME=this.REPOSITORY+".OS_NAME",this.OS_VERSION=this.REPOSITORY+".OS_VERSION",this.DEVICE_TYPE=this.REPOSITORY+".DEVICE_TYPE",this.SUPPORTED=this.REPOSITORY+".SUPPORTED",this.SERVICE_TIMESTAMP=this.REPOSITORY+".SERVICE_TIMESTAMP",this.LOCATION_TIMESTAMP=this.REPOSITORY+".LOCATION_TIMESTAMP",this.PERMISSION_LOCATION=this.REPOSITORY+".PERMISSION_LOCATION",this.SET_LOG_DEBUG=this.REPOSITORY+".SET_LOG_DEBUG",this.NEW_USER_TIMESTAMP=this.REPOSITORY+".NEW_USER_TIMESTAMP",this.EXTERNAL_ID=this.REPOSITORY+".EXTERNAL_ID",this.REGISTERED_BY_COOKIE=this.REPOSITORY+".REGISTERED_BY_COOKIE",this.LOG_LEVEL=this.REPOSITORY+".LOG_LEVEL",this.LATITUDE=this.REPOSITORY+".LATITUDE",this.LONGITUDE=this.REPOSITORY+".LONGITUDE",this.TOPIC_LIST=this.REPOSITORY+".TOPIC_LIST",this.INAPP_ENABLED=this.REPOSITORY+".INAPP_ENABLED",this.URL_INAPP_API=this.REPOSITORY+".URL_INAPP_API",this.INAPP_TOPICS=this.REPOSITORY+".INAPP_TOPICS"}setItemSessionStorage(e,t){d.setItem(e,t)}getItemSessionStorage(e){return d.getItem(e)}clearSessionStorage(){d.clearMessages()}setStorage(e,t){E.setItem(e,t)}getStorage(e){return E.getItem(e)}clearStorage(){E.clear()}setBrowserPublicKey(e){E.setItem(this.BROWSER_PUBLIC_KEY,e)}getBrowserPublicKey(){return E.getItem(this.BROWSER_PUBLIC_KEY)}setBrowserPrivateKey(e){E.setItem(this.BROWSER_PRIVATE_KEY,e)}getBrowserPrivateKey(){return E.getItem(this.BROWSER_PRIVATE_KEY)}async setAppKey(e){E.setItem(this.APP_KEY,e),h&&h.IDB&&await h.setItem(this.APP_KEY,e)}getAppKey(){return E.getItem(this.APP_KEY)}async getAppKeySync(){if(h&&h.IDB)return await h.getItem(this.APP_KEY)}setVAPID(e){E.setItem(this.VAPID_PUBLIC,e)}getVAPID(){return E.getItem(this.VAPID_PUBLIC)}setEnabled(e){E.setItem(this.ENABLED,e)}getEnabled(){return E.getItem(this.ENABLED)}setServiceSyncTime(e){E.setItem(this.SERVICE_SYNC_TIME,e*this.BASE_TIME)}getServiceSyncTime(){return E.getItem(this.SERVICE_SYNC_TIME)||1*this.BASE_TIME}setLocationEnabled(e){E.setItem(this.LOCATION_ENABLED,e)}getLocationEnabled(){return E.getItem(this.LOCATION_ENABLED)}setLocationUpdateMinutes(e){E.setItem(this.LOCATION_UPDATE_MINUTES,e)}getLocationUpdateMinutes(){return E.getItem(this.LOCATION_UPDATE_MINUTES)||30}async setRequestLocation(e){E.setItem(this.REQUEST_LOCATION,e)}getRequestLocation(){return!!E&&E.getItem(this.REQUEST_LOCATION)}async setPlatform(e){E.setItem(this.PLATFORM,e)}getPlatform(){return E&&E.getItem(this.PLATFORM)||c.platform}getVersion(){return c.version}async setBrowserName(e){E.setItem(this.BROWSER_NAME,e)}getBrowserName(){return E.getItem(this.BROWSER_NAME)}setBrowserVersion(e){E.setItem(this.BROWSER_VERSION,e)}getBrowserVersion(){return E.getItem(this.BROWSER_VERSION)}async setOsName(e){E.setItem(this.OS_NAME,e)}getOsName(){return E.getItem(this.OS_NAME)}setOsVersion(e){E.setItem(this.OS_VERSION,e)}getOsVersion(){return E.getItem(this.OS_VERSION)}setDeviceType(e){E.setItem(this.DEVICE_TYPE,e)}getDeviceType(){return E.getItem(this.DEVICE_TYPE)}setSupported(e){E.setItem(this.SUPPORTED,e)}getSupported(){return E.getItem(this.SUPPORTED)}setServiceTimestamp(e){E.setItem(this.SERVICE_TIMESTAMP,e)}getServiceTimestamp(){return E.getItem(this.SERVICE_TIMESTAMP)}setLocationTimestamp(e){E.setItem(this.LOCATION_TIMESTAMP,e)}getLocationTimestamp(){return E.getItem(this.LOCATION_TIMESTAMP)}setPermissionLocation(e){E.setItem(this.PERMISSION_LOCATION,e)}getPermissionLocation(){return E.getItem(this.PERMISSION_LOCATION)}setDebugLog(e){E.setItem(this.SET_LOG_DEBUG,e)}getDebugLog(){return"false"!==E.getItem(this.SET_LOG_DEBUG)}setLogLevel(e){E.setItem(this.LOG_LEVEL,e)}getLogLevel(){return E.getItem(this.LOG_LEVEL)}setNewUserTimestamp(e){E.setItem(this.NEW_USER_TIMESTAMP,e)}getNewUserTimestamp(){return E.getItem(this.NEW_USER_TIMESTAMP)}async setExternalIdRequest(e){E&&E.isLocalStorageAvailable()&&E.setItem(this.EXTERNAL_ID,e),h&&h.IDB&&await h.setItem(this.EXTERNAL_ID,e)}async getExternalIdRequest(){let e;try{E&&E.isLocalStorageAvailable()?e=E.getItem(this.EXTERNAL_ID):h&&h.IDB&&(e=await h.getItem(this.EXTERNAL_ID))}catch(e){}return e}setExternalId(e){E.setItem(this.EXTERNAL_ID,e)}getExternalId(){return E.getItem(this.EXTERNAL_ID)}async getRegisteredByCookie(){return E.getItem(this.REGISTERED_BY_COOKIE)}async setRegisteredByCookie(e){E.setItem(this.REGISTERED_BY_COOKIE,e)}setLatitude(e){E.setItem(this.LATITUDE,e)}getLatitude(){return E.getItem(this.LATITUDE)}setLongitude(e){E.setItem(this.LONGITUDE,e)}getLongitude(){return E.getItem(this.LONGITUDE)}async setInAppTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.INAPP_TOPICS,e)}async getInAppTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.INAPP_TOPICS))}catch(e){}return e}async setTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.TOPIC_LIST,e)}async getTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.TOPIC_LIST))}catch(e){}return e}getUrlInappApi(){return this.getStorage(this.URL_INAPP_API)}setUrlInappApi(e){this.setStorage(this.URL_INAPP_API,e)}setInAppEnabled(e){this.setStorage(this.INAPP_ENABLED,e)}isInAppEnabled(){return this.getStorage(this.INAPP_ENABLED)}},g=Object.freeze({DEBUG:1,INFO:2,WARNING:3,ERROR:4}),R=g;class _{constructor(e){this.tag="[IND]",e&&(this.tag=e),this.level=R.INFO,this.setLogLevel((new u).getLogLevel()),this.log=[]}setLogLevel(e){e&&e>=R.DEBUG&&e<=R.ERROR&&(this.level=e)}static addedAsString(e){return"string"==typeof e?e:JSON.stringify(e,null,2)}d(){if(this.level<=R.DEBUG)for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}i(){if(this.level<=R.INFO)for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}w(){if(this.level<=R.WARNING)for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}e(){if(this.level<=R.ERROR)if(1==arguments.length&&arguments.errorCode)this.log+=`${error.errorCode}: ${error.errorMessage}`;else for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}writeLog(){this.log.length>0&&this.tag&&this.log&&console.log(this.tag,this.log),this.log=[]}}const p=_,T=class{constructor(e,t,s){this.errorCode=e,this.errorMessage=t,null!=s&&(this.exceptionMessage=s)}},A=new class{constructor(){}showError(e,t,s){if(null!=e){const i=Object.values(e.ErrorCode).indexOf(t);return i>=0?new T(Object.keys(e.ErrorCode)[i],Object.keys(e.ErrorMessage)[i],s):new T(GENERAL_ERROR,"general error",s)}}},S={ErrorCode:{GENERAL_ERROR:600,API_SERVER_ERROR:500,API_PARAMETER_MISSING:400,API_APPKEY_NOT_VALID:401,API_FORBIDDEN_REQUEST:403,API_DEVICE_NOT_FOUND:404,API_TOPICS_ARE_INSERTED:409,BAD_REQUEST_SERVER_ERROR:410},ErrorMessage:{GENERAL_ERROR:"General Error",API_SERVER_ERROR:"Error server response",API_PARAMETER_MISSING:"Api parameter missing",API_APPKEY_NOT_VALID:"appKey is not valid",API_FORBIDDEN_REQUEST:"forbidden request",API_DEVICE_NOT_FOUND:"device not found",API_TOPICS_ARE_INSERTED:"topics are inserted",BAD_REQUEST_SERVER_ERROR:"bad request"}},O=class{constructor(){this.URL_BASE="",this.GET="GET",this.POST="POST",this.PUT="PUT",this.DELETE="DELETE"}async getURL(){return this.URL_BASE}async call(e,t,s,i){const r=new p("[IND]BaseClient: ");s.isServiceWorkerRequest()&&r.setLogLevel(R.DEBUG);let n=await this.getURL()+s.getPath(t)+s.getParams();s.isJourneyRequest()&&(n=n.replace("v1","v2"));const o={method:e,headers:s.addHeaders()};e!==this.GET&&(o.body=JSON.stringify(s.getBody())),i&&(o.credentials=i);try{const t=await fetch(n,o),i=await t.json();return t.ok?(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\nResponse Body:",JSON.stringify(i.data,null,"\t")).writeLog(),i):(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\n").writeLog(),new T(i.statusCode,i.message))}catch(t){return r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Error: "+t).writeLog(),A.showError(S,S.ErrorCode.GENERAL_ERROR,t)}}async get(e,t){return await this.call(this.GET,e,t)}async post(e,t,s){return await this.call(this.POST,e,t,s)}async put(e,t,s){return await this.call(this.PUT,e,t,s)}async delete(e,t){return await this.call(this.DELETE,e,t)}},P=class{constructor(){this.PARAM_APP_KEY="appKey",this.PARAM_DEVICE_ID="deviceId",this.PARAM_PUSH_TOKEN="pushToken",this.PARAM_ENABLED="enabled",this.PARAM_PLATFORM="platform",this.PARAM_VERSION="version",this.PARAM_TOPICS="topics",this.PARAM_EVENT_TYPE="eventType",this.PARAM_PUSH_ID="pushId",this.PARAM_CLICKED_BUTTON="clickedButton",this.PARAM_PERMISSION_TYPE="permissionType",this.PARAM_LATITUDE="latitude",this.PARAM_LONGITUDE="longitude",this.PARAM_INAPP_ID="inAppId",this.PARAM_INAPP_EVENT_TYPE="eventType",this.PARAM_INAPP_CLICKED_BUTTON="clickedButton",this.PARAM_INAPP_LAST_VERSION_ID="lastVersionId",this.PARAM_INBOX_EXTERNALID="externalId",this.PARAM_INBOX_PAGE="page",this.PARAM_INBOX_PAGE_SIZE="pageSize",this.PARAM_INBOX_DATE_FROM="dateFrom",this.PARAM_INBOX_DATE_TO="dateTo",this.PARAM_INBOX_STATUS="status",this.PARAM_INBOX_SENDER_IDS="sendingIds",this.PARAM_CUSTOMER_ID="customerId",this.PARAM_CUSTOMER_FIELD_NAMES="fieldNames",this.PARAM_CUSTOMER_FIELDS="fields",this.PARAM_CUSTOMER_LINK="link",this.PARAM_CUSTOMER_CHANNEL="channel",this.appKey=(new u).getAppKey(),this.params=null,this.pathParams={},this.headers={}}getParams(){return"?"+this.PARAM_APP_KEY+"="+this.appKey+(this.params?"&"+this.params:"")}getBody(){return this.body?this.body:""}getPath(e){let t=e;return Object.keys(this.pathParams).forEach((e=>{t=t.replace(e,this.pathParams[e])})),t}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}isServiceWorkerRequest(){return this.serviceWorkerRequest}setServiceWorkerRequest(e){this.serviceWorkerRequest=e}isJourneyRequest(){return this.journeyRequest}setJourneyRequest(e){this.journeyRequest=e}},m=Object.freeze({PUSH:"push",INAPP:"inapp",CHAT:"chat"}),N=class{constructor(e=null,t){null==e?(this.browserPublicKey=(new u).getBrowserPublicKey(),this.browserPrivateKey=(new u).getBrowserPrivateKey(),this.platform=(new u).getPlatform(),this.version=(new u).getVersion(),this.browserName=(new u).getBrowserName(),this.browserVersion=(new u).getBrowserVersion(),this.osName=(new u).getOsName(),this.osVersion=(new u).getOsVersion(),this.deviceType=(new u).getDeviceType(),(new u).getEnabled()&&(this.enabled="true"===(new u).getEnabled()),(new u).getExternalId()&&(this.externalCode=(new u).getExternalId())):t?(e.enabled&&(this.enabled=e.enabled,(new u).setEnabled(this.enabled)),e.registeredByCookie&&(this.registeredByCookie=e.registeredByCookie,(new u).setRegisteredByCookie(this.registeredByCookie))):(e.browserPublicKey&&(this.browserPublicKey=e.browserPublicKey),e.browserPrivateKey&&(this.browserPrivateKey=e.browserPrivateKey),e.platform&&(this.platform=e.platform),e.version&&(this.version=e.version),e.osVersion&&(this.osVersion=e.osVersion),e.browserName&&(this.browserName=e.browserName),e.browserVersion&&(this.browserVersion=e.browserVersion),e.osName&&(this.osName=e.osName),e.deviceType&&(this.deviceType=e.deviceType),e.enabled&&(this.enabled=e.enabled),e.externalCode&&(this.externalCode=e.externalCode)),this.platform&&(this.productName=this.platform),this.version&&(this.productVersion=this.version),navigator&&"language"in navigator&&(this.locale=navigator.language),Intl&&"DateTimeFormat"in Intl&&(this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone),this.timeOffset=-(new Date).getTimezoneOffset()}getDeviceId(){return this.deviceId}setDeviceId(e){this.deviceId=e}setExternalCode(e){this.externalCode=e}toJSON(){const e={};return this.platform&&(e.platform=this.platform),this.version&&(e.version=this.version),this.productName&&(e.productName=this.productName),this.productVersion&&(e.productVersion=this.productVersion),this.browserName&&(e.browserName=this.browserName),this.browserVersion&&(e.browserVersion=this.browserVersion),this.osName&&(e.osName=this.osName),this.osVersion&&(e.osVersion=this.osVersion),this.deviceType&&(e.deviceType=this.deviceType),this.locale&&(e.locale=this.locale),this.timeZone&&(e.timeZome=this.timeZone),this.timeOffset&&(e.timeOffset=this.timeOffset),this.enabled&&(e.enabled=this.enabled),this.browserPublicKey&&(e.browserPublicKey=this.browserPublicKey),this.browserPrivateKey&&(e.browserPrivateKey=this.browserPrivateKey),this.externalCode&&(e.externalCode=this.externalCode),e}},y=Object.freeze({DEFAULT:-1,ENABLE:1,DISABLE:0}),w=Object.freeze({EVENT_TYPE_CLICK:"click",EVENT_TYPE_RECEIVE:"receive",EVENT_TYPE_UPDATE:"update",EVENT_TYPE_ACCEPT:"accept",EVENT_TYPE_REJECT:"reject",EVENT_TYPE_ASK:"ask"}),C=Object.freeze({SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe"}),D=class{static isServiceTimestampExceed(){return!(new u).getServiceTimestamp()||(new u).getServiceSyncTime()<=(Date.now()-(new u).getServiceTimestamp())/6e4}static isFunction(e){return!(!e||"function"!=typeof e)}},b=class{static async getPermissions(){const e=await this.getPermission("geolocation"),t={};return e&&(t.location=e.state),t}static async getPermission(e){try{if(navigator&&navigator.permissions&&navigator.permissions.query&&e)return await navigator.permissions.query({name:e,userVisibleOnly:!0})}catch(e){return null}return null}static async setPermissionsCallback(){await this.setCallback("geolocation",navigator.indigitallRequestLocationPermission)}static async setCallback(e,t){const s=await this.getPermission(e);if(s){let i=s.state;"onchange"in s&&(s.onchange=()=>{new p("[IND]CorePermissions: ").d(e+" permission state has changed from "+i+" to "+s.state).writeLog(),i=s.state,t&&t({name:e,state:s.state})})}}},f=new p("[IND]Crypto"),L=new TextEncoder("utf-8"),v="HMAC",B=class{static async createHmac(e,t){try{const s=window?.crypto?.subtle;if(!s)return;const i=await s.importKey("raw",L.encode(e),{name:v,hash:{name:"SHA-256"}},!1,["sign","verify"]),r=await s.sign(v,i,L.encode(t)),n=new Uint8Array(r),o=Array.prototype.map.call(n,(e=>("00"+e.toString(16)).slice(-2))).join("");return f.d("hmac: ",o).writeLog(),o}catch(e){return void f.e("error:",e).writeLog()}}},U=class{static compareJSON(e,t){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const i of s)if(e[i]!==t[i]){if("object"!=typeof e[i]||"object"!=typeof t[i])return!1;if(!isEqual(e[i],t[i]))return!1}return!0}},M=class{static isValidFormat(e){return null!=e&&""!=e&&"null"!=e&&e.length>8}},V=class{static setTopicChannel(e,t){const s=[];for(let i=0;i<e.length;i++){const r=e[i];r.channel=t,s.push(r)}return s}},x={Repository:u,Config:c,Api:i,Models:r,Utils:n}},391:e=>{"use strict";e.exports=JSON.parse('{"name":"indigitall-web-core","description":"indigitall web core","version":"4.3.1","main":"index.js","author":"Smart2me S.L.","homepage":"https://indigitall.com","devDependencies":{"@babel/preset-env":"^7.18.10","babel-loader":"^8.2.5","filemanager-webpack-plugin":"^7.0.0","idempotent-babel-polyfill":"^7.4.4","script-loader":"^0.7.2","webpack":"^5.74.0","webpack-bundle-analyzer":"^4.6.1","webpack-cli":"^4.10.0"},"scripts":{"test":"echo \'There are not tests\'","public":"ws --directory ./public --port 80 --log.format dev","build":"webpack --config webpack.config.js --mode=production","build-dev":"webpack --config webpack.config.js --watch --mode=development","delete-node-modules":"rm -rf node_modules/ && rm -f package-lock.json","install-core":"npm install && npm run build"}}')}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,s),n.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{"use strict";s.r(i),s.d(i,{default:()=>ge});const{Repository:e}=s(590).Core,t=new class extends e{constructor(){super(),this.INAPP_SHOW_ONCE=this.REPOSITORY+".INAPP_SHOW_ONCE",this.INAPP_TIMES_CLICKED=this.REPOSITORY+".INAPP_TIMES_CLICKED",this.INAPP_DISMISS_FOREVER=this.REPOSITORY+".INAPP_DISMISS_FOREVER",this.URL_DEVICE_API=this.REPOSITORY+".URL_DEVICE_API",this.INAPP_TOPICS_SYNC=this.REPOSITORY+".INAPP_TOPICS_SYNC"}setItemStorage(e){this.setItemSessionStorage(this.REPOSITORY,e)}getItemStorage(){return this.getItemSessionStorage(this.REPOSITORY)}setDeviceId(e){this.setStorage(this.DEVICE_ID,e)}getDeviceId(){return this.getStorage(this.DEVICE_ID)}getInAppShowOnce(){return this.getStorage(this.INAPP_SHOW_ONCE)}setInAppShowOnce(e){this.setStorage(this.INAPP_SHOW_ONCE,e)}getInAppTimesClicked(){return this.getStorage(this.INAPP_TIMES_CLICKED)}setInAppTimesClicked(e){this.setStorage(this.INAPP_TIMES_CLICKED,e)}getInAppDismissForever(){return this.getStorage(this.INAPP_DISMISS_FOREVER)}setInAppDismissForever(e){this.setStorage(this.INAPP_DISMISS_FOREVER,e)}getInAppTopics(){return this.getStorage(this.INAPP_TOPICS)?this.getStorage(this.INAPP_TOPICS).split(","):null}setInAppTopics(e){this.setStorage(this.INAPP_TOPICS,e)}async getInAppTopicsSync(){let e=null;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.INAPP_TOPICS_SYNC))}catch(e){}return e}async setInAppTopicsSync(e){this.db&&this.db.IDB&&await this.db.setItem(this.INAPP_TOPICS_SYNC,e)}async getUrlDeviceApi(){let e;try{this.storage&&this.storage.isLocalStorageAvailable()?e=this.getStorage(this.URL_DEVICE_API):this.db&&this.db.IDB&&(e=await this.db.getItem(this.URL_DEVICE_API))}catch(e){}return e}},{Validations:r,Log:n}=s(590).Core.Utils,o=class extends r{static isAppKeyFormat(){const e=t.getAppKey();return null!=e&&""!=e&&"null"!=e&&e.length>3}static isValidFormatRequest(){const e=new n("[IND]InAppValidations: "),s=t.getDeviceId();let i=!0;return this.isAppKeyFormat()||(i=!1,e.w("appKey is null or empty").writeLog()),this.isValidFormat(s)||(i=!1,e.w("deviceId is null or empty").writeLog()),i}},{ErrorDictionary:a}=s(590).Core.Models,c=a.ErrorCode;Object.assign(c,{INAPP_ERROR:2e3,INAPP_SHOW_INAPP_ERROR:2100,INAPP_WAS_EXPIRED:2101,INAPP_WAS_SHOWN_MANY_TIMES:2102,INAPP_WAS_CLICKED_MANY_TIMES:2103,INAPP_FORM_TYPE_NOT_CORRECT:2120,INAPP_FORM_FIELD_IS_EMPTY:2121,INAPP_POPUP_ERROR:2300,INAPP_WAS_DISMISSED_FOREVER:2304,INAPP_ERROR_CONTENT_MESSAGE:2305,INAPP_INSTANCE_TOPICS_ERROR:2306,INAPP_GENERAL_ERROR:2600});const l=a.ErrorMessage;Object.assign(l,{INAPP_ERROR:"inApp error",INAPP_SHOW_INAPP_ERROR:"error on show inApp",INAPP_WAS_EXPIRED:"InApp was expired",INAPP_WAS_SHOWN_MANY_TIMES:"InApp was shown more than $x times",INAPP_WAS_CLICKED_MANY_TIMES:"InApp was clicked more than $x times",NAPP_FORM_TYPE_NOT_CORRECT:"Input type is not correct",INAPP_FORM_FIELD_IS_EMPTY:"Field is empty",INAPP_POPUP_ERROR:"error on popup",INAPP_WAS_DISMISSED_FOREVER:"InApp was dismissed forever",INAPP_ERROR_CONTENT_MESSAGE:"InApp error with content",INAPP_INSTANCE_TOPICS_ERROR:"topics instance is not correct, only string[] is valid types",INAPP_GENERAL_ERROR:"inApp general error"});const E={ErrorCode:c,ErrorMessage:l},h=class{constructor(e){this.URL="url",e.actionId&&(this.actionId=e.actionId),e.destroy&&(this.destroy=e.destroy),e.topics&&(this.topics=e.topics),e.type&&(this.type=e.type),e.url&&(this.url=e.url),e.no_action&&(this.no_action=e.no_action)}},I=class{constructor(e){e.borderRadius&&(this.borderRadius=e.borderRadius)}},d=class{constructor(e){e.contentUrl&&(this.contentUrl=e.contentUrl),e.showTime&&(this.showTime=e.showTime),e.numberOfShows&&(this.numberOfShows=e.numberOfShows),e.numberOfClicks&&(this.numberOfClicks=e.numberOfClicks),e.dismissForever&&(this.dismissForever=e.dismissForever),e.layout&&(this.layout=new I(e.layout)),e.action&&(this.action=new h(e.action))}setAction(e){this.action=e}},u=class{constructor(e){this.timesShowed=0,this.timesClicked=0,this.wasDismissed=!1,e&&(e.timesShowed&&(this.timesShowed=e.timesShowed),e.timesClicked&&(this.timesClicked=e.timesClicked),e.wasDismissed&&(this.wasDismissed=e.wasDismissed))}},g=class{static searchInApp(e){const t=this.getListInApp();return null==t?null:this.findInAppFromInAppList(t,e)}static searchInAppWithInAppId(e){const t=this.getListInApp();return null==t?null:this.findInAppFromInAppListWithInAppId(t,e)}static addInApp(e){let s=this.getListInApp();null!=s?s.push(e):s=[e],t.setItemStorage(JSON.stringify(s))}static getListInApp(){let e=null;try{t.getItemStorage()&&(e=JSON.parse(t.getItemStorage()))}catch(e){console.error(e.message)}return e}static addInAppNewClick(e){this.updateInAppField(e.inAppId,!0,null,null)}static addInAppNewShow(e){this.updateInAppField(e.inAppId,null,!0,null)}static addInAppDismissForever(e){this.updateInAppField(e.inAppId,null,null,!0)}static updateInAppField(e,s,i,r){const n=this.getListInApp(),o=[];if(null!=n)for(let t=0;t<n.length;t++)n[t].inAppId==e&&(null!=s&&(n[t].inAppShow.timesClicked+=1),null!=i&&(n[t].inAppShow.timesShowed+=1),null!=r&&(n[t].inAppShow.wasDismissed=!0)),o.push(n[t]);t.setItemStorage(JSON.stringify(o))}static updateInApp(e){const s=this.getListInApp(),i=[];let r=!1,n=null;if(null!=s)for(let t=0;t<s.length;t++)s[t].inAppId===e.inAppId&&(r=!0,s[t].filters&&(e.filters=s[t].filters),s[t].name&&(e.name=s[t].name),null!=s[t].properties&&(e.properties=new d(s[t].properties)),null!=s[t].inAppShow&&(e.inAppShow=new u(s[t].inAppShow)),i.push(e),n=e);if(r)return t.setItemStorage(JSON.stringify(i)),n}static deleteInApp(e){const s=this.getListInApp(),i=[];if(null!=s)for(let t=0;t<s.length;t++)s[t].inAppId!=e.inAppId&&i.push(s[t]);t.setItemStorage(JSON.stringify(i))}static findInAppFromInAppListWithInAppId(e,t){if(null!=e)for(let s=0;s<e.length;s++)if(e[s].inAppId&&e[s].inAppId==t)return e[s];return null}static findInAppFromInAppList(e,t){if(null!=e)for(let s=0;s<e.length;s++)if(e[s].schema&&e[s].schema.code&&e[s].schema.code==t)return e[s];return null}static findInAppFromInAppListWithInAppId(e,t){if(null!=e)for(let s=0;s<e.length;s++)if(e[s].inAppId&&e[s].inAppId==t)return e[s];return null}},R=class{constructor(e){e.code&&(this.code=e.code),e.width&&(this.width=e.width),e.height&&(this.height=e.height)}},_=class{constructor(e){if(e.cacheTtl&&(this.cacheTtl=e.cacheTtl),e.inAppId&&(this.inAppId=e.inAppId),e.showOnce&&(this.showOnce=e.showOnce),e.version&&(this.version=e.version),e.customData&&(this.customData=e.customData),e.creationDate?this.creationDate=e.creationDate:this.creationDate=U.getDate((new Date).getTime()),e.expiredDate)this.expiredDate=e.expiredDate;else{let e=36e5;this.cacheTtl&&(e=1e3*this.cacheTtl),this.expiredDate=U.getDate((new Date).getTime()+e)}e.schema&&(this.schema=new R(e.schema)),e.properties&&(this.properties=new d(e.properties)),this.inAppShow=new u(e.inAppShow),e.filters&&(this.filters=e.filters),e.name&&(this.name=e.name)}},{BaseRequest:p}=s(590).Core.Api,{Config:T}=s(590).Core,A=class extends p{constructor(){super(),t.getDeviceId()?this.deviceId=t.getDeviceId():this.deviceId=U.generateDeviceId()}setEventType(e){this.eventType=e}setInAppId(e){this.inAppId=e}setActionId(e){this.actionId=e}setClickedButton(e){this.clickedButton=e}setLastVersionId(e){this.lastVersionId=e}setVersion(e){this.version=e}setDeviceId(e){this.deviceId=e}setPlatform(e){this.platform=e}postEventPrintRequest(){const e=this.fillJsonEventRequest();return this.body=e,this}postEventClickRequest(){const e=this.fillJsonEventRequest();return e.actionId=this.actionId,this.body=e,this}fillJsonEventRequest(){const e={};return e.deviceId=this.deviceId,t.getExternalId()&&(e.externalId=t.getExternalId()),e.inAppId=this.inAppId,e.platform=T.platform,e.version=this.version,e}postEventInAppRequest(){const e={};return e.inAppId=this.inAppId,e.lastVersionId=this.lastVersionId,e.deviceId=this.deviceId,this.eventType&&(e.eventType=this.eventType),e.platform=this.platform,e.clickedButton=this.clickedButton,this.body=e,this}},{BaseRequest:S}=s(590).Core.Api,O=class extends S{constructor(){super(),null!=t.getExternalId()&&(this.customerId=t.getExternalId()),null!=t.getDeviceId()&&(this.deviceId=t.getDeviceId())}setFields(e){this.fields=e}putCustomerFieldRequest(){return this.params=this.createQueryStringCustomerId(),this.body=this.createBodyJson(),this}createQueryStringCustomerId(){return this.PARAM_CUSTOMER_ID+"="+this.customerId}createBodyJson(){let e={};try{e.channel="inapp",this.device&&(e.deviceId=this.device.deviceId),this.customerId&&(e.customerId=this.customerId),this.fields&&(e=this.fields)}catch(e){console.log("Error fieldNames request :"+e)}return e}},{BaseRequest:P}=s(590).Core.Api,{Config:m}=s(590).Core,N=class extends P{constructor(){super()}setInAppId(e){this.inAppId=e}setVersion(e){this.version=e}setJsonForm(e){this.jsonForm=e}postForm(){return this.body=this.createBody(),this}createBody(){const e={};return t.getDeviceId()&&(e.deviceId=t.getDeviceId()),t.getExternalId()&&(e.externalCode=t.getExternalId()),this.jsonForm&&(e.form=this.jsonForm),e.inAppId=this.inAppId,e.platform=m.platform,e.version=this.version,e}},y=class{static sendEventPrint(e){const t=new A;t.setInAppId(e.inAppId),t.setVersion(e.version),X.postEventPrint(t)}static sendEventClick(e){const t=new A;t.setActionId(e.properties.action.actionId),t.setInAppId(e.inAppId),t.setVersion(e.version),X.postEventClick(t)}static sendEventForm(e,t,s){const i=new N;i.setVersion(t),i.setInAppId(e),i.setJsonForm(s),X.postEventForm(i)}static sendEventFormToCustomer(e){const t=new O;t.setFields(e),X.putCustomerField(t)}},{DeviceStatus:w,Device:C}=s(590).Core.Models,{BaseRequest:D}=s(590).Core.Api,b=class extends D{constructor(){super(),this.device=new C}postDeviceRequest(){return this.body=this.createDeviceJson(),this.status!==w.DEFAULT&&(this.body.enabled=1===this.status),this}createDeviceJson(){let e={};try{e=this.device.toJSON()}catch(e){console.log(e)}return e}},{Log:f,CryptoUtils:L,CorePermissions:v}=s(590).Core.Utils,{EventType:B}=s(590).Core.Models,U=class{constructor(){this.MONTH=24192e5}static addNewInApp(e){g.addInApp(e)}static addNewInAppClick(e){e.properties.numberOfClicks&&e.properties.numberOfClicks>0&&g.addInAppNewClick(e),y.sendEventClick(e)}static addNewInApptoDismissForever(e){g.addInAppDismissForever(e)}static isInAppDismissForever(e){const t=g.searchInAppWithInAppId(e.inAppId);return!(null==t||!new _(t).inAppShow.wasDismissed)}static async registerLocation(){const e=new f("[IND]InAppUtils: ");try{navigator.geolocation&&"prompt"===(await v.getPermissions()).location&&navigator.geolocation.getCurrentPosition((e=>{t.setLatitude(e.coords.latitude),t.setLongitude(e.coords.longitude)}),(s=>{e.e("error "+s).writeLog(),t.getPermissionLocation()||t.getPermissionLocation()==B.EVENT_TYPE_REJECT||t.setPermissionLocation(B.EVENT_TYPE_REJECT)}))}catch(t){e.e(t).writeLog()}}static generateDeviceId(){X.postDevice(new b,(e=>e),(e=>(console.log(e),null)))}static async setExternalCode(e){let s=e;if(e){const i=t.getAppKey();s=await L.createHmac(i,e)}return t.setExternalId(s),s}static async convertToJSONArray(e){if(e&&""!=e)return await Promise.resolve(e).then((e=>JSON.parse(e)))}static getDate(e){const t=new Date(e);let s=""+(t.getMonth()+1),i=""+t.getDate();const r=t.getFullYear();let n=t.getHours(),o=t.getMinutes(),a=t.getSeconds();return s.length<2&&(s="0"+s),i.length<2&&(i="0"+i),n.length<2&&(n="0"+n),o.length<2&&(o="0"+o),a.length<2&&(a="0"+a),`${r}-${s}-${i} ${n}:${o}:${a}`}},{CommonUtils:M,ErrorUtils:V}=s(590).Core.Utils,{Channel:x}=s(590).Core.Models,Y=class{static async saveTopics(e,s,i){try{if(e instanceof Array){let i=[];const r=await t.getInAppTopics();if(null!=r&&""!=r&&(i=r),0!==i.length){const t=e.filter((e=>!i.includes(e)));0!==t.length&&i.push(t)}else for(let t=0;t<e.length;t++)i.push(e[t]);t.setInAppTopics(i),await t.setInAppTopicsSync(i);const n=[];for(let e=0;e<i.length;e++)n.push({code:i[e],name:i[e],visible:!0,subscribe:!0,parentCode:"",channel:x.INAPP});M.isFunction(s)&&s(n)}else M.isFunction(i)&&i(V.showError(E,E.ErrorCode.INAPP_INSTANCE_TOPICS_ERROR))}catch(e){M.isFunction(i)&&i(V.showError(E,E.ErrorCode.INAPP_ERROR,e.message))}}static async deleteTopics(e,s,i){if(e instanceof Array){let i=[],r=[];const n=await t.getInAppTopics();null!=n&&""!=n&&(i=n),0!==i.length&&(r=i.filter((t=>!e.includes(t))),t.setInAppTopics(r),await t.setInAppTopicsSync(r));const o=[];if(r.length>0)for(let e=0;e<r.length;e++)o.push({code:r[e],name:r[e],visible:!0,subscribe:!0,parentCode:"",channel:x.INAPP});M.isFunction(s)&&s(o)}else M.isFunction(i)&&i(V.showError(E,E.ErrorCode.INAPP_INSTANCE_TOPICS_ERROR))}static isSubscribe(e){let s=[],i=[];if(t.getInAppTopics()&&(i=t.getInAppTopics()),e&&e.length>0)if(i&&i.length>0)for(let t=0;t<e.length;t++){e[t].subscribed=!1;for(let s=0;s<i.length;s++)e[t].code===i[s]&&(e[t].subscribed=!0);s.push(e[t])}else{for(let t=0;t<e.length;t++)e[t].subscribe=!1;s=e}return s}},{BaseClient:F}=s(590).Core.Api,{Config:K}=s(590).Core,{Channel:k,ErrorModel:G}=s(590).Core.Models,{TopicUtils:q,CommonUtils:W,ErrorUtils:j}=s(590).Core.Utils,X=new class extends F{constructor(){super(),this.ENDPOINT_INAPP="/inapp",this.URL_BASE=K.client.URL_DEVICE_V2+this.ENDPOINT_INAPP,this.ENDPOINT_CAMPAIGN="/campaign",this.ENDPOINT_CAMPAIGN_TAG=this.ENDPOINT_CAMPAIGN+"/{tag}",this.ENDPOINT_DEVICE="/device",this.ENDPOINT_EVENT_INAPP="/event",this.ENDPOINT_EVENT_INAPP_PRINT=this.ENDPOINT_EVENT_INAPP+"/print",this.ENDPOINT_EVENT_INAPP_CLICK=this.ENDPOINT_EVENT_INAPP+"/click",this.ENDPOINT_EVENT_INAPP_FORM=this.ENDPOINT_EVENT_INAPP+"/form",this.ENDPOINT_DEVICE_TOPICS="/topic",this.ENDPOINT_CUSTOMER="/customer",this.ENDPOINT_CUSTOMER_FIELD=this.ENDPOINT_CUSTOMER+"/field",this.isCustomerRequest=!1,this.isDeviceRequest=!1}async getURL(){if(this.isCustomerRequest){this.isCustomerRequest=!1;const e=await t.getUrlInappApi();return e?e=e.replaceAll("v2","v1"):K.client.CUSTOMER_URL_BASE}if(this.isDeviceRequest){this.isDeviceRequest=!1;const e=await t.getUrlInappApi();return e?e=e.replaceAll("v2","v1"):K.client.URL_BASE}const e=await t.getUrlInappApi();return e?e+this.ENDPOINT_INAPP:this.URL_BASE}async getCampaignTag(e,t,s){const i=await this.get(this.ENDPOINT_CAMPAIGN_TAG,e.getCampaignTagRequest());if(i&&!(i instanceof G)&&i.data&&Object.keys(i.data).length>0){if(W.isFunction(t)){const s=new _(i.data);s.properties.numberOfShows>0&&(s.inAppShow.timesShowed=1),s.properties.dismissForever&&(s.inAppShow.wasDismissed=!0),e.isUpdateInApp()||U.addNewInApp(s),t(s)}}else i?W.isFunction(s)&&s(i):W.isFunction(s)&&s(j.showError(E,E.ErrorCode.INAPP_ERROR_CONTENT_MESSAGE));return null}async getInAppTopics(e,s,i){if(o.isAppKeyFormat()){const r=await this.get(this.ENDPOINT_DEVICE_TOPICS,e.getDeviceTopicsRequest());if(!r||r instanceof G)r?W.isFunction(i)&&i(r):W.isFunction(i)&&i();else{const e=q.setTopicChannel(r.data,k.INAPP),i=Y.isSubscribe(e);await t.setInAppTopicList(i),W.isFunction(s)&&s(i)}}else W.isFunction(i)&&i(j.showError(E,E.ErrorCode.INAPP_GENERAL_ERROR));return!0}postEventClick(e){o.isAppKeyFormat()&&this.post(this.ENDPOINT_EVENT_INAPP_CLICK,e.postEventClickRequest())}postEventPrint(e){o.isAppKeyFormat()&&this.post(this.ENDPOINT_EVENT_INAPP_PRINT,e.postEventClickRequest())}postEventForm(e){o.isAppKeyFormat()&&this.post(this.ENDPOINT_EVENT_INAPP_FORM,e.postForm())}putCustomerField(e){o.isAppKeyFormat()&&(this.isCustomerRequest=!0,this.put(this.ENDPOINT_CUSTOMER_FIELD,e.putCustomerFieldRequest()))}async postDevice(e,s,i){if(o.isAppKeyFormat()){this.isDeviceRequest=!0;const r=await this.post(this.ENDPOINT_DEVICE,e.postDeviceRequest(),"include");!r||r instanceof G?r?W.isFunction(i)&&i(r):W.isFunction(i)&&i():(r.data.deviceId&&t.setDeviceId(r.data.deviceId),W.isFunction(s)&&s(r.data.deviceId))}else W.isFunction(i)&&i(j.showError(E,E.ErrorCode.INAPP_ERROR));return!0}},{BaseRequest:H}=s(590).Core.Api,J=class extends H{constructor(){super(),this.update=!1,this.PARAM_DEVICE_TYPE="deviceType",this.PARAM_EXTERNAL_CODE="externalCode",this.PARAM_BROWSER_NAME="browserName"}setTag(e){this.tag=e}setUpdateInApp(e){this.update=e}isUpdateInApp(){return this.update}getCampaignTagRequest(){return this.params=this.createQueryString(),this.pathParams["{tag}"]=this.tag,this}createQueryString(){let e="";if(null!=t.getDeviceId()?e+=`${this.PARAM_DEVICE_ID}=${t.getDeviceId()}&`:U.generateDeviceId(),null!=t.getExternalId()&&(e+=`${this.PARAM_EXTERNAL_CODE}=${t.getExternalId()}&`),null!=t.getDeviceType()&&(e+=`${this.PARAM_DEVICE_TYPE}=${t.getDeviceType()}&`),null!=t.getBrowserName()&&(e+=`${this.PARAM_BROWSER_NAME}=${t.getBrowserName()}&`),null!=t.getLatitude()&&(e+=`${this.PARAM_LATITUDE}=${t.getLatitude()}&`),null!=t.getLongitude()&&(e+=`${this.PARAM_LONGITUDE}=${t.getLongitude()}&`),null!=t.getInAppTopics()&&0!==t.getInAppTopics().length){const s=t.getInAppTopics();let i="";for(let e=0;e<s.length;e++)i+=`${this.PARAM_TOPICS}=${encodeURIComponent(s[e])}&`;e+=i}return e+=`${this.PARAM_PLATFORM}=webpush`,e}},{BaseRequest:Q}=s(590).Core.Api,z=class extends Q{constructor(){super()}getDeviceTopicsRequest(){return this.params=this.PARAM_DEVICE_ID+"="+t.getDeviceId(),this}},$=class{constructor(e,t){this.script=` \n    var slideIndex_${t} = 1;\n    var delta_${t} = 6;\n    var startMove_${t} = null;\n    var startMoveY_${t} = null;    \n    var diffX_${t};\n    var diffY_${t};\n    var timeSlide_${t} = 10000;\n\n    var slider_${t} = document.getElementById("${e}").querySelector('.ind_slider-container-actions');\n    var sliderTotal_${t} = document.getElementById("${e}").getElementsByClassName("ind_slideshow-item").length;\n\n    showSlides_${t}(slideIndex_${t});\n\n    var interval_${t} = setInterval(() => {\n        newSlide_${t}();\n    }, timeSlide_${t});\n\n    if (slider_${t}){\n      slider_${t}.addEventListener('touchstart', handleStart_${t}, false);\n      slider_${t}.addEventListener('touchend', handleEnd_${t}, false);\n      slider_${t}.addEventListener('mousedown', mouseStart_${t});\n      slider_${t}.addEventListener('mouseup', mouseEnd_${t}); \n    }\n\n\n    function mouseStart_${t}(evt) {\n        evt.preventDefault();\n        startMove_${t} = evt.clientX;\n        startMoveY_${t} = evt.clientY;\n    }\n\n    function mouseEnd_${t}(evt) {\n        evt.preventDefault();\n        var endMove = evt.clientX;\n        var endMoveY = evt.clientY;\n        setEndMove_${t}(endMove, endMoveY);\n    }\n\n    function handleStart_${t}(evt) {\n        evt.preventDefault();\n        startMove_${t} = evt.touches[0].clientX;\n        startMoveY_${t} = evt.touches[0].clientY;\n    }\n    function handleEnd_${t}(evt) {\n        evt.preventDefault();\n        var endMove = evt.changedTouches[0].pageX;\n        var endMoveY = evt.changedTouches[0].pageY;\n        setEndMove_${t}(endMove, endMoveY);\n    }\n\n    function setEndMove_${t}(endMove, endMoveY) {\n        diffX_${t} = Math.abs(endMove - startMove_${t});\n        diffY_${t} = Math.abs(endMoveY - startMoveY_${t});\n        if (startMove_${t} != null) {\n            if (startMove_${t} > endMove) {\n                slideIndex_${t}++;\n                if (slideIndex_${t} > sliderTotal_${t}) {\n                    slideIndex_${t} = 1;\n                }\n            } else {\n                if (slideIndex_${t} == 0) {\n                    slideIndex_${t} = sliderTotal_${t};\n                } else {\n                    slideIndex_${t}--;\n                }\n            }\n            showSlides_${t}(slideIndex_${t});\n            setNewInterval_${t}();\n        }\n    }\n\n    function plusSlides_${t}(n) {\n      showSlides_${t}(slideIndex_${t} += n);\n      setNewInterval_${t}();\n    }\n\n    function currentSlide_${t}(n) {\n      showSlides_${t}(slideIndex_${t} = n);\n    }\n\n    function setNewInterval_${t}() {\n      clearInterval(interval_${t});\n      interval_${t} = setInterval(() => {\n        newSlide_${t}();\n      }, timeSlide_${t});\n    }\n\n    function newSlide_${t}(){\n        slideIndex_${t}++;\n        if (slideIndex_${t} > sliderTotal_${t}) {\n            slideIndex_${t} = 1;\n        }\n        showSlides_${t}(slideIndex_${t});\n    }\n\n    function showSlides_${t}(n) {\n      let view = document.getElementById("${e}");\n      if (view) {\n        let slides = view.getElementsByClassName("ind_slideshow-item");\n        let i;\n        let dots = view.getElementsByClassName("ind_dot");\n        if (n > slides.length) {slideIndex_${t} = 1;}\n        if (n < 1) {slideIndex_${t} = slides.length;}\n        for (i = 0; i < slides.length; i++) {\n          slides[i].style.display = "none";\n        }\n        for (i = 0; i < dots.length; i++) {\n          dots[i].className = dots[i].className.replace(" active", "");\n        }\n        if (slides[slideIndex_${t}-1]) {\n          slides[slideIndex_${t}-1].style.display = "block";\n        }\n        if (dots[slideIndex_${t}-1]) dots[slideIndex_${t}-1].className += " active";\n      }\n    }\n\n\n    function inAppIndigitallOnClick_${t}(action) {\n      if (diffX_${t} && diffY_${t}) {\n        if (diffX_${t} < delta_${t} && diffY_${t} < delta_${t}) {\n          indigitall.InApp.inAppOnClick(action);\n        }\n      } else {\n        indigitall.InApp.inAppOnClick(action);\n      }\n    }\n\n    function inAppIndigitallSubmit(formOptions) {\n        const jsonForm = {}\n        const jsonCustomer = {}\n        const form = document.querySelector('[id="'+formOptions.formId+'"]');\n        if (form) {\n          formOptions.inputs.forEach((el) => {\n            if (el.id !== 'undefined') {\n              let value;\n              if (el.type === 'text' || el.type === 'number') {\n                  if (form && form.querySelector('input[id^="'+el.id+'"]') && form.querySelector('input[id^="'+el.id+'"]').value !== 'undefined') {\n                      value = form.querySelector('input[id^="'+el.id+'"]').value;\n                  }\n              }\n              if (el.type === 'checkbox') {\n                  if (form && form.querySelectorAll('input[id^="'+el.id +'"]')) {\n                      let values = form.querySelectorAll('input[id^="'+el.id +'"]');\n                      var valuesChecked = [];\n                      for (var i = 0; i < values.length; i++) {\n                          if (values[i].checked && values[i].value !== 'undefined') {\n                              valuesChecked.push(values[i].value);\n                          }\n                      }\n                      value = valuesChecked;\n                  }\n              }\n              if (el.type === 'radio') {\n                  if (form && form.querySelectorAll('input[id^="'+el.id +'"]')) {\n                      let values = form.querySelectorAll('input[id^="'+el.id +'"]');\n                      var valuesChecked;\n                      for (var i = 0; i < values.length; i++) {\n                          if (values[i].checked && values[i].value !== 'undefined') {\n                              valuesChecked = values[i].value;\n                          }\n                      }\n                      value = valuesChecked;\n                  }\n              }\n              if (el.type === 'select') {\n                  if (form && form.querySelector('select[id^="'+el.id+'"]') && form.querySelector('select[id^="'+el.id+'"]').value !== 'undefined') {\n                      value = form.querySelector('select[id^="'+el.id+'"]').value;\n                  }\n              }\n              if (value) jsonForm[el.id] = value;\n              if (el.sendToCustomer) jsonCustomer[el.id] = value;\n            }\n          });\n        }\n        indigitall.InApp.inAppSubmit(JSON.stringify(formOptions), JSON.stringify(jsonForm), JSON.stringify(jsonCustomer));\n    }\n    `,this.htmlTest="\n          <!DOCTYPE html>\n          <html lang=\"en\" dir=\"ltr\">\n            <head>\n              <meta charset=\"utf-8\" />\n              <meta name=\"viewport\" content=\"width=device-width\" />\n              <title>guille test</title>\n              <style>\n                html,\n                body {\n                  margin: 0;\n                  padding: 0;\n                  height: 100%;\n                  width: 100%;\n                }\n                body p:first-child {\n                  margin: 0;\n                }\n              </style>\n            </head>\n            <body>\n              \n      <!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n        <html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"en\" xml:lang=\"en\" xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\">\n          <head>\n            <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n            \x3c!--[if !mso]>\x3c!--\x3e\n            \x3c!--[if (gte mso 9)|(IE)]>\x3c!--\x3e\n            <link href=\"https://fonts.googleapis.com/css2?family=EB+Garamond&family=Merriweather&family=Montserrat&family=Open+Sans&family=Oswald&family=Playfair+Display&family=Raleway&family=Roboto&family=Roboto+Slab&family=Source+Sans+Pro&display=swap\" rel=\"stylesheet\">\n            \x3c!--<![endif]--\x3e\n            <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n            \x3c!--<![endif]--\x3e\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n            <link href=\"http://fonts.cdnfonts.com/css/arial\" rel=\"stylesheet\">\n            <link href=\"http://fonts.cdnfonts.com/css/courier-new\" rel=\"stylesheet\">\n            <link href=\"http://fonts.cdnfonts.com/css/georgia-2\" rel=\"stylesheet\">\n            <link href=\"http://fonts.cdnfonts.com/css/trebuchet-ms-2\" rel=\"stylesheet\">\n            <link href=\"http://fonts.cdnfonts.com/css/verdana-pro-cond\" rel=\"stylesheet\">\n                    \n            <link href=\"https://fonts.googleapis.com/css2?family=EB+Garamond&family=Merriweather&family=Montserrat&family=Open+Sans&family=Oswald&family=Playfair+Display&family=Raleway&family=Roboto&family=Roboto+Slab&family=Source+Sans+Pro&display=swap\" rel=\"stylesheet\">\n            <title>InApp Sample</title>\n            \n            <style type=\"text/css\">\n              html {\n              width: 100%;\n              height: 100%;\n              }\n              @font-face {\n                font-family: 'Merriweather';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/merriweather/v28/u-440qyriQwlOrhSvowK_l5OeA.woff) format('woff');\n              }\n              @font-face {\n                font-family: 'Montserrat';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/montserrat/v23/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCtr6Ew9.woff) format('woff');\n              }\n              @font-face {\n                font-family: 'Open Sans';\n                font-style: normal;\n                font-weight: 400;\n                font-stretch: normal;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/opensans/v28/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0C4k.woff) format('woff');\n              }\n              @font-face {\n                font-family: 'Oswald';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/oswald/v47/TK3_WkUHHAIjg75cFRf3bXL8LICs1_FvgUI.woff) format('woff');\n              }\n              @font-face {\n                font-family: 'Playfair Display';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/playfairdisplay/v28/nuFvD-vYSZviVYUb_rj3ij__anPXJzDwcbmjWBN2PKdFvUDT.woff) format('woff');\n              }\n              @font-face {\n                font-family: 'Raleway';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/raleway/v26/1Ptxg8zYS_SKggPN4iEgvnHyvveLxVvaooCM.woff) format('woff');\n              }\n              @font-face {\n                font-family: 'Roboto';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Me5g.woff) format('woff');\n              }\n              @font-face {\n                font-family: 'Roboto Slab';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/robotoslab/v22/BngbUXZYTXPIvIBgJJSb6s3BzlRRfKOFbvjojISWaw.woff) format('woff');\n              }\n              @font-face {\n                font-family: 'Source Sans Pro';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/sourcesanspro/v19/6xK3dSBYKcSV-LCoeQqfX1RYOo3aPA.woff) format('woff');\n              }\n              @font-face {\n                font-family: 'EB Garamond';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/ebgaramond/v24/SlGDmQSNjdsmc35JDF1K5E55YMjF_7DPuGi-6_RUAA.woff) format('woff');\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'Merriweather';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/merriweather/v28/u-440qyriQwlOrhSvowK_l5-ciZMZ-Y.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'Merriweather';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/merriweather/v28/u-440qyriQwlOrhSvowK_l5-fCZM.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'Montserrat';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/montserrat/v23/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCtr6Hw3aXpsog.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'Montserrat';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/montserrat/v23/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCtr6Hw5aXo.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'Open Sans';\n                font-style: normal;\n                font-weight: 400;\n                font-stretch: 100%;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/opensans/v28/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4uaVIGxA.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'Open Sans';\n                font-style: normal;\n                font-weight: 400;\n                font-stretch: 100%;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/opensans/v28/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4gaVI.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'Oswald';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/oswald/v47/TK3_WkUHHAIjg75cFRf3bXL8LICs1_FvsUhiZTaR.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'Oswald';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/oswald/v47/TK3_WkUHHAIjg75cFRf3bXL8LICs1_FvsUZiZQ.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'Playfair Display';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/playfairdisplay/v28/nuFvD-vYSZviVYUb_rj3ij__anPXJzDwcbmjWBN2PKdFvXDZbtPY_Q.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'Playfair Display';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/playfairdisplay/v28/nuFvD-vYSZviVYUb_rj3ij__anPXJzDwcbmjWBN2PKdFvXDXbtM.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'Raleway';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/raleway/v26/1Ptxg8zYS_SKggPN4iEgvnHyvveLxVvaorCGPrEHJA.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'Raleway';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/raleway/v26/1Ptxg8zYS_SKggPN4iEgvnHyvveLxVvaorCIPrE.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'Roboto';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7GxKOzY.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'Roboto';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4mxK.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'Roboto Slab';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/robotoslab/v22/BngbUXZYTXPIvIBgJJSb6s3BzlRRfKOFbvjojISmYWRjRdE.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'Roboto Slab';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/robotoslab/v22/BngbUXZYTXPIvIBgJJSb6s3BzlRRfKOFbvjojISmb2Rj.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'Source Sans Pro';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/sourcesanspro/v19/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNq7lqDY.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'Source Sans Pro';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/sourcesanspro/v19/6xK3dSBYKcSV-LCoeQqfX1RYOo3qOK7l.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'EB Garamond';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/ebgaramond/v24/SlGDmQSNjdsmc35JDF1K5E55YMjF_7DPuGi-6_RkCo9_S6w.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'EB Garamond';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/ebgaramond/v24/SlGDmQSNjdsmc35JDF1K5E55YMjF_7DPuGi-6_RkBI9_.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n      \n            </style>\n            <style>\n              .slideshow-item {\n                cursor: grabbing;\n                scroll-snap-align: start;\n                display: none; \n                scroll-snap-type: x mandatory;\n                scroll-behavior: smooth;\n                -webkit-overflow-scrolling: touch; /* For mobile */\n                -ms-overflow-style: none; /* For hide scrollbar */\n                scrollbar-width: none; /* For hide scrollbar */\n              }\n              .slideshow-item-preview {\n                cursor: grabbing;\n                scroll-snap-align: start;\n                display: block; \n                scroll-snap-type: x mandatory;\n                scroll-behavior: smooth;\n                -webkit-overflow-scrolling: touch; /* For mobile */\n                -ms-overflow-style: none; /* For hide scrollbar */\n                scrollbar-width: none; /* For hide scrollbar */\n              }\n              img {vertical-align: middle;}\n              \n              /* Slideshow container */\n              .slideshow-container {\n              /*   max-width: 1000px; */\n                position: relative;\n                margin: auto;\n                -webkit-overflow-scrolling: touch; /* For mobile */\n              }\n              \n              /* Next & previous buttons */\n              .prev, .next {\n                cursor: pointer;\n                position: absolute;\n                top: 50%;\n                width: auto;\n                padding: 16px;\n                margin-top: -22px;\n                color: white;\n                font-weight: bold;\n                font-size: 18px;\n                transition: 0.6s ease;\n                border-radius: 0 3px 3px 0;\n                user-select: none;\n              }\n              \n              /* Position the \"next button\" to the right */\n              .next {\n                right: 0;\n                border-radius: 3px 0 0 3px;\n              }\n              \n              /* On hover, add a black background color with a little bit see-through */\n              .prev:hover, .next:hover {\n                background-color: rgba(0,0,0,0.8);\n              }\n              \n              .points {\n                padding: 8px 12px;\n                position: absolute;\n                bottom: 8px;\n                text-align: center;\n                width:100%;\n              }\n              \n              /* The dots/bullets/indicators */\n              .dot {\n                cursor: pointer;\n                height: 15px;\n                width: 15px;\n                margin: 0 2px;\n                background-color: #bbb;\n                border-radius: 50%;\n                display: inline-block;\n                transition: background-color 0.6s ease;\n              }\n              \n              .active, .dot:hover {\n                background-color: #717171;\n              }\n              \n              /* On smaller screens, decrease text size */\n              @media only screen and (max-width: 300px) {\n                .prev, .next,.text {font-size: 11px}\n              }\n          </style>\n            \n          </head>\n          <body style=\"margin:0; height: 100%; width: 100%;\">\n            <div style=\"\n                background-color: rgba(244, 244, 244, 1);\n                width: 100%;\n                height: 100%;\n                margin: 0 auto;\n              \">\n              \n            <div style=\"\n          display: flex;\n          flexDirection: row;\n          box-sizing: border-box;\n          padding: 0px 0px 0px 0px ;\n          margin: 0px 0px 0px 0px ;\n          background-color: rgba(244, 244, 244, 0);\n          border: 0px solid rgba(244, 244, 244, 0);\n          width: 100%;\">\n              \n                <div style=\"\n          width: 100%;\n        \">\n                  \n                        <div style=\"\n                            margin: 0px 0px 0px 0px ;\n                            padding: 15px 15px 15px 15px ;\n                            background-color: rgba(244, 244, 244, 0);\n                            text-align: left;\n                            font-family: 'Roboto';\n                          \">\n                          \n          <form id=\"5kZSrg6xbKyX\" class=\"form-style-1\">\n            \n        <style type=\"text/css\">\n          .form-style-1 {\n          }\n          .form-style-1 li {\n            padding: 0;\n            display: block;\n            list-style: none;\n            margin: 10px 0 0 0;\n          }\n          .form-style-1 label{\n            margin:0 0 3px 0;\n            padding:0px;\n            display:block;\n            font-weight: bold;\n          }\n          .form-style-1 input[type=text], \n          .form-style-1 input[type=date],\n          .form-style-1 input[type=datetime],\n          .form-style-1 input[type=number],\n          .form-style-1 input[type=search],\n          .form-style-1 input[type=time],\n          .form-style-1 input[type=url],\n          .form-style-1 input[type=email],\n          textarea, \n          select{\n            box-sizing: border-box;\n            -webkit-box-sizing: border-box;\n            -moz-box-sizing: border-box;\n            border:1px solid #BEBEBE;\n            padding: 7px;\n            margin:0px;\n            -webkit-transition: all 0.30s ease-in-out;\n            -moz-transition: all 0.30s ease-in-out;\n            -ms-transition: all 0.30s ease-in-out;\n            -o-transition: all 0.30s ease-in-out;\n            outline: none;\n          }\n          .form-style-1 input[type=text]:focus, \n          .form-style-1 input[type=date]:focus,\n          .form-style-1 input[type=datetime]:focus,\n          .form-style-1 input[type=number]:focus,\n          .form-style-1 input[type=search]:focus,\n          .form-style-1 input[type=time]:focus,\n          .form-style-1 input[type=url]:focus,\n          .form-style-1 input[type=email]:focus,\n          .form-style-1 textarea:focus, \n          .form-style-1 select:focus{\n            -moz-box-shadow: 0 0 8px #88D5E9;\n            -webkit-box-shadow: 0 0 8px #88D5E9;\n            box-shadow: 0 0 8px #88D5E9;\n            border: 1px solid #88D5E9;\n          }\n          .form-style-1 .field-divided{\n            width: 49%;\n          }\n      \n          .form-style-1 .field-long{\n            width: 100%;\n          }\n          .form-style-1 .field-select{\n            width: 100%;\n          }\n          .form-style-1 .field-textarea{\n            height: 100px;\n          }\n          \n          .form-style-1 input[type=submit]:hover, .form-style-1 input[type=button]:hover{\n            background: #4691A4;\n            box-shadow:none;\n            -moz-box-shadow:none;\n            -webkit-box-shadow:none;\n          }\n          .form-style-1 input[type=radio]{\n            transform: scale(1.2);\n          }\n          .form-style-1 input[type=checkbox]{\n            transform: scale(1.2);\n          }\n          .form-style-1 .required{\n            color:red;\n          }\n          </style>\n        \n            \n          <div style=\"margin-top: 10px;\">\n            <label>\n              Escribe algo\n              <span class=\"required\">*</span>\n            </label>\n            <input type=\"text\" name=\"algo\" id=\"algo\" required=\"true\" sendToCustomer=\"true\" style=\"width: 100%;\n        padding: 12px 20px;\n        margin: 8px 0;\n        display: inline-block;\n        border: 1px solid #ccc;\n        border-radius: 4px;\n        box-sizing: border-box;\">\n          </div><div style=\"margin-top: 10px;\">\n          <label style=\"\n          margin:0 0 3px 0;\n          padding:0px;\n          display:block;\n        \">\n            Selecciona algo\n            \n          </label>\n          <select style=\"width: 100%;\n          padding: 12px 20px;\n          margin: 8px 0;\n          display: inline-block;\n          border: 1px solid #ccc;\n          border-radius: 4px;\n          box-sizing: border-box;\" id=\"selector\" required=\"undefined\" sendToCustomer=\"true\">\n            <option value=\"algo\">Algo</option><option value=\"masalgo\">Mas algo</option><option value=\"variosalgos\">Varios algos</option>\n          </select>\n        </div>\n          <div style=\"\n          margin-top: 10px;\n        \">\n            <label style=\"\n          margin-bottom: 10px;\n        \">\n              ¿Cuál de las dos opciones te gusta más?\n              \n            </label>\n            \n                <div style=\"margin-bottom: 5px; display: flex; flex-direction: row; align-items: baseline; gap:0px;\">\n                  <input style=\"margin-right: 10px;\" type=\"radio\" id=\"radio0\" name=\"radio\" value=\"opcion1\"><label style=\"font-weight: 100; margin-right: 10px;\" for=\"radio0\">Opcion 1</label>\n                </div>\n              \n                <div style=\"margin-bottom: 5px; display: flex; flex-direction: row; align-items: baseline; gap:0px;\">\n                  <input style=\"margin-right: 10px;\" type=\"radio\" id=\"radio1\" name=\"radio\" value=\"opcion2\"><label style=\"font-weight: 100; margin-right: 10px;\" for=\"radio1\">Opcion 2</label>\n                </div>\n              \n          </div>\n        \n        <div style=\"margin-top: 10px;\">\n          <label style=\"\n          margin-bottom: 10px;\n        \">\n            Marca las casillas que quieras\n            \n          </label>\n          \n              <div style=\"display: flex; flex-direction: row; margin-bottom: 5px; align-items: flex-start;\">\n                <input style=\"margin-right: 10px;\" type=\"checkbox\" id=\"casilla0\" name=\"casilla\" value=\"casilla1\"><label style=\"font-weight: 100; margin-right: 10px;\" for=\"casilla0\">Casilla 1</label>\n              </div>\n            \n              <div style=\"display: flex; flex-direction: row; margin-bottom: 5px; align-items: flex-start;\">\n                <input style=\"margin-right: 10px;\" type=\"checkbox\" id=\"casilla1\" name=\"casilla\" value=\"casilla2\"><label style=\"font-weight: 100; margin-right: 10px;\" for=\"casilla1\">Casilla 2</label>\n              </div>\n            \n        </div>\n            \n          <tr style=\"\n              display: block;\n              text-align: left; \">\n            <td style=\"\n                display: inline-block;\n                width: auto;\n                padding: 15px 15px 15px 15px ;\n                margin: 0px 0px 0px 0px ;\n                background-color: rgba(244, 244, 244, 0);\">\n              <div target=\"_blank\" rel=\"noreferrer\" onclick=\"InAppIndigitall.submit({'schemaId':217,'inAppId':22,'inputs':[{'type':'text','label':'Escribe algo','name':'algo','subtype':'text','required':true,'sendToCustomer':true,'id':'algo'},{'type':'select','label':'Selecciona algo','name':'selector','options':[{'name':'Algo','value':'algo'},{'name':'Mas algo','value':'masalgo'},{'name':'Varios algos','value':'variosalgos'}],'sendToCustomer':true,'id':'selector'},{'type':'radio','label':'¿Cuál de las dos opciones te gusta más?','name':'radio','options':[{'name':'Opcion 1','value':'opcion1'},{'name':'Opcion 2','value':'opcion2'}],'labelPosition':'right','id':'radio'},{'type':'checkbox','label':'Marca las casillas que quieras','options':[{'name':'Casilla 1','value':'casilla1'},{'name':'Casilla 2','value':'casilla2'}],'subtype':'right','name':'casilla','id':'casilla'}],'formId':'5kZSrg6xbKyX'})\" style=\"text-decoration: none; width: auto; cursor: pointer;\">\n                <div style=\"\n                    padding: 8px 16px 8px 16px;\n                    width: auto;\n                    display: inline-block;\n                    text-align: left;\n                    background-color: rgba(200, 200, 200, 1);\n                    border-radius: 3px 3px 3px 3px;\n                    border: 0px solid transparent;\n                    box-sizing: border-box;\n                    margin-top: 15px;\">\n                  <span style=\"text-align: center; \"><span style=\"font-size: 16px\"><span style=\"font-family: Roboto, sans-serif !important\"><span style=\"color: #555555\"><span style=\"background-color: transparent\"><span style=\"letter-spacing: 0px;\">Botón</span></span></span></span></span></span>\n                </div>\n              </div>\n            </td>\n          </tr>\n        \n            </form>\n            \n                        </div>\n                      \n                </div>\n            </div>\n            </div>\n          </body>\n        </html>\n              <script>\n                // Created event\n                var event = document.createEvent('Event');\n            \n                /* defined event 'click'.*/\n                event.initEvent('click', true, true);\n            \n                // to assign event click.\n                document.addEventListener('click', function (e) {\n                  window.parent.document.dispatchEvent(new CustomEvent('indigitall_on_click_inapp', {detail: {\n                    inAppId: 217,\n                    lastVersionId: 431,\n                    clickedButton: 'content',\n                    action: {\n                        type: 'url',\n                        url: 'https://indigitall.com'\n                    }\n                  }}));\n                }, false);\n              <\/script>\n            </body>\n          </html>\n           \n         "}},Z=Object.freeze({TEXT:"text",NUMBER:"number",RADIO:"radio",CHECKBOX:"checkbox",SELECT:"select"}),ee=class{constructor(e){if(e.id&&(this.id=e.id),e.name&&(this.name=e.name),e.type)switch(e.type){case"text":this.type=Z.TEXT;break;case"checkbox":this.type=Z.CHECKBOX;break;case"number":this.type=Z.NUMBER;break;case"radio":this.type=Z.RADIO;break;case"select":this.type=Z.SELECT}e.required&&(this.required=e.required),e.sendToCustomer&&(this.sendToCustomer=e.sendToCustomer)}},te=class{constructor(e){if(e.inAppId&&(this.inAppId=e.inAppId),e.formId&&(this.formId=e.formId),e.inappVersion&&(this.inappVersion=e.inappVersion),e.inputs&&Array.isArray(e.inputs)){this.inputs=[];for(let t=0;t<e.inputs.length;t++)this.inputs.push(new ee(e.inputs[t]))}}},{ErrorUtils:se}=s(590).Core.Utils,ie=class{static checkFieldsForm(e,t,s){const i=[];if(t&&e.inputs&&e.inputs.length>0)for(let s=0;s<e.inputs.length;s++){const r=this.checkInputType(e.inputs[s],t);null!=r&&i.push(r)}if(i.length>0)return i;t&&0!==Object.keys(t).length&&y.sendEventForm(e.inAppId,e.inappVersion,t),s&&0!==Object.keys(s).length&&y.sendEventFormToCustomer(s)}static checkInputType(e,t){if(null!=e.id)switch(e.type){case Z.TEXT:if(e.required){if(!t[e.id])return se.showError(E,2121,e.id);if(!t[e.id]instanceof String)return se.showError(E,2120,`The field ${e.id} is not text`)}break;case Z.NUMBER:if(e.required){if(!t[e.id])return se.showError(E,2121,e.id);if(!t[e.id]instanceof String){if(!parseInt(t[e.id]))return se.showError(E,2120,`The field ${e.id} is not number`)}else if(!t[e.id]instanceof int)return se.showError(E,2120,`The field ${e.id} is not number`)}break;default:if(e.required&&t[e.id]&&""==t[e.id])return se.showError(E,2121,e.id)}return null}static editingFormHtml(e,t){return e.replaceAll("InAppIndigitall.onClick",`inAppIndigitallOnClick_${t}`).replaceAll("InAppIndigitall.submit","inAppIndigitallSubmit").replaceAll("plusSlides",`plusSlides_${t}`).replaceAll("currentSlide",`currentSlide_${t}`).replaceAll("setNewInterval",`setNewInterval_${t}`).replaceAll("newSlide",`newSlide_${t}`).replaceAll("showSlides",`showSlides_${t}`)}},re=class{static onClick(e){if(e){const t=JSON.parse(e);let s;t.inAppId&&(s=t.inAppId),t.inappId&&(s=t.inappId);const i=g.searchInAppWithInAppId(s);if(i&&t.action){const e=new _(i),s=new h(t.action);if(e.properties.setAction(s),s.type==s.URL&&window.open(s.url),e){U.addNewInAppClick(e);const t=new CustomEvent("didClicked",{detail:{action:s},bubbles:!0,cancelable:!0,composed:!1});self.dispatchEvent(t)}}else console.log(`InApp ${t.schema} not found`)}else console.log("InApp action is empty")}static submit(e,t,s){if(e){const i=new te(JSON.parse(e));if(t){const e=ie.checkFieldsForm(i,JSON.parse(t),JSON.parse(s));if(e&&e.length>0){const t=new CustomEvent("didFormError",{detail:{errorList:e},bubbles:!0,cancelable:!0,composed:!1});self.dispatchEvent(t)}else{const e=new CustomEvent("didFormSubmit",{detail:{},bubbles:!0,cancelable:!0,composed:!1});self.dispatchEvent(e)}}}}},{Log:ne,ErrorUtils:oe,CommonUtils:ae}=s(590).Core.Utils,ce="[IND]ShowInAppUtils: ";class le{static async inAppWasShown(e,t,s,i,r){const n=new ne(ce);e.schema.code&&this.inAppWasGot(e.schema.code,null,t,(e=>{ae.isFunction(r)&&r(e)}),(()=>{ae.isFunction(r)&&r(e)}),((e,t)=>{n.d("inAppWasShown: "+e.inAppId+" with error: "+t.errorMessage).writeLog()}),s,i)}static inAppWasGot(e,t,s,i,r,n,o,a){const c=g.searchInApp(e),l=(new Date).getTime();if(null!=c){const e=new _(c);if(l<new Date(e.expiredDate).getTime()){const s=this.wasInAppPassedFilterProperties(e);null!=s?(s==E.ErrorCode.INAPP_WAS_DISMISSED_FOREVER&&ae.isFunction(n)&&n(e,oe.showError(E,E.ErrorCode.INAPP_WAS_DISMISSED_FOREVER)),s==E.ErrorCode.INAPP_WAS_SHOWN_MANY_TIMES&&ae.isFunction(o)&&o(e,oe.showError(E,E.ErrorCode.INAPP_WAS_SHOWN_MANY_TIMES)),s==E.ErrorCode.INAPP_WAS_CLICKED_MANY_TIMES&&ae.isFunction(a)&&a(e,oe.showError(E,E.ErrorCode.INAPP_WAS_CLICKED_MANY_TIMES))):ae.isFunction(i)&&i(e,t)}else ae.isFunction(s)&&s(e,oe.showError(E,E.ErrorCode.INAPP_WAS_EXPIRED)),le.updateInAppGet(e.schema.code,n,o,a,(e=>{ae.isFunction(i)&&i(e,t)}),(e=>{new ne(ce).e(e).writeLog()}))}else ae.isFunction(r)&&r(e,t)}static wasInAppPassedFilterProperties(e){if(e.properties.dismissForever&&e.inAppShow.wasDismissed)return E.ErrorCode.INAPP_WAS_DISMISSED_FOREVER;{e.properties.dismissForever&&U.addNewInApptoDismissForever(e);const t=e.properties.numberOfShows,s=e.inAppShow?e.inAppShow.timesShowed:null,i=e.properties.numberOfClicks,r=e.inAppShow?e.inAppShow.timesClicked:null;if(t>0){if(!(null!=s&&s<t))return E.ErrorCode.INAPP_WAS_SHOWN_MANY_TIMES;g.addInAppNewShow(e)}if(i>0&&null!=r&&r>=i)return E.ErrorCode.INAPP_WAS_CLICKED_MANY_TIMES}return null}static updateInAppGet(e,t,s,i,r,n){ge.getInAppWithUpdate(e,!0,(e=>{const n=g.updateInApp(e),o=this.wasInAppPassedFilterProperties(n);if(null!=o)return o==E.ErrorCode.INAPP_WAS_DISMISSED_FOREVER&&ae.isFunction(t)&&t(e,oe.showError(E,E.ErrorCode.INAPP_WAS_DISMISSED_FOREVER)),o==E.ErrorCode.INAPP_WAS_SHOWN_MANY_TIMES&&ae.isFunction(s)&&s(e,oe.showError(E,E.ErrorCode.INAPP_WAS_SHOWN_MANY_TIMES)),void(o==E.ErrorCode.INAPP_WAS_CLICKED_MANY_TIMES&&ae.isFunction(i)&&i(e,oe.showError(E,E.ErrorCode.INAPP_WAS_CLICKED_MANY_TIMES)));ae.isFunction(r)&&r(n)}),(e=>{ae.isFunction(n)&&n(e)}))}}const Ee=le,{ErrorUtils:he,CommonUtils:Ie,LogLevel:de}=s(590).Core.Utils;class ue{constructor(){this.LogLevel=de,this.inAppIndigitallInterface=re}static async init(e){null!=e.appKey&&await t.setAppKey(e.appKey),e.urlInAppApi&&t.setUrlInappApi(e.urlInAppApi),e.logLevel&&t.setLogLevel(e.logLevel),!0===e.requestLocation&&U.registerLocation()}static async showInApp(e,s,i,r){const n={appKey:t.getAppKey(),urlInAppApi:"https://device-api.indigitall.com/v2",requestLocation:!0,logLevel:de.DEBUG,inAppCode:e,viewId:s};this.showInAppWithConfig(n,null,null,null,null,null,null,i,r,null,null)}static async showInAppWithConfig(e,t,s,i,r,n,a,c,l,h,I){await this.init(e),o.isAppKeyFormat()?Ee.inAppWasGot(e.inAppCode,e.viewId,s,(async(e,s)=>{e&&e.properties&&this.createInApp(e,s,a,c,l,t,h,I)}),((e,s)=>{this.drawInApp(e,s,t,a,c,l,h,I)}),n,i,r):Ie.isFunction(l)&&l(he.showError(E,E.ErrorCode.BAD_REQUEST_SERVER_ERROR))}static showMultipleInApp(e,s,i,r){const n={appKey:t.getAppKey(),urlInAppApi:"https://device-api.indigitall.com/v2",requestLocation:!0,logLevel:de.DEBUG,inAppCodeList:e,divList:s};this.showMultipleInAppWithConfig(n,null,null,null,null,null,null,i,r,null,null)}static async showMultipleInAppWithConfig(e,t,s,i,r,n,a,c,l,h,I){if(await this.init(e),o.isAppKeyFormat()){if(e.inAppCodeList.length==e.divList.length&&e.inAppCodeList.length>0)for(var d=0;d<e.inAppCodeList.length;d++)Ee.inAppWasGot(e.inAppCodeList[d],e.divList[d],s,(async(e,s)=>{e&&e.properties&&this.createInApp(e,s,a,c,l,t,h,I)}),((e,s)=>{ue.drawInApp(e,s,t,a,c,l,h,I)}),n,i,r)}else Ie.isFunction(l)&&l(he.showError(E,E.ErrorCode.BAD_REQUEST_SERVER_ERROR))}static async drawInApp(e,t,s,i,r,n,o,a){this.getInApp(e,(async e=>{e&&e.properties&&this.createInApp(e,t,i,r,n,s,o,a)}),n)}static async createInApp(e,t,s,i,r,n,o,a){if(e&&e.properties&&e.properties.contentUrl)try{const r=document.getElementById(t);if(r){r.style.position="relative",r.style.overflow="hidden";const c=await fetch(e.properties.contentUrl);let l=await c.text();null!=e.customData&&Object.keys(e.customData).forEach((function(t){l=l.replaceAll(`{{${t}}}`,e.customData[t])})),e.version&&(l=l.replaceAll("'inappVersion':'{{version}}'","'inappVersion':"+e.version));const E=t.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,""),h=ie.editingFormHtml(l,E);if(r.innerHTML=h,"undefined"===document.getElementById(`script_${E}`)||null===document.getElementById(`script_${E}`)){const e=document.createElement("script");e.id=`script_${E}`,e.type="text/javascript",e.innerHTML=new $(t,E).script,r.appendChild(e)}if(self.addEventListener("didClicked",(function t(i){s&&s(e,i.detail.action),self.removeEventListener("didClicked",t)})),self.addEventListener("didFormError",(function t(s){o&&o(e,s.detail.errorList),self.removeEventListener("didFormError",t)})),self.addEventListener("didFormSubmit",(function t(s){a&&a(e),self.removeEventListener("didFormSubmit",t)})),e.properties.showTime){let t=0;const s=setInterval((function(){t++,t==parseInt(e.properties.showTime)&&(r.style.display="none",clearInterval(s),Ie.isFunction(n)&&n(e,r,1e3*e.properties.showTime))}),1e3)}if(e.properties.layout&&e.properties.layout.borderRadius){const t=`${parseInt(e.properties.layout.borderRadius)}px`;r.style.borderRadius=t}Ie.isFunction(i)&&i(e,r),y.sendEventPrint(e)}}catch(s){let i=null;e&&e.schema&&e.schema.code&&(i=e.schema.code),Ie.isFunction(r)&&r(s,t,i)}}static topicsList(e,t){return X.getInAppTopics(new z,e,t),!0}static topicsSubscribe(e,t,s){Y.saveTopics(e,t,s)}static topicsUnsubscribe(e,t,s){Y.deleteTopics(e,t,s)}static inAppGet(e,t,s){this.getInApp(e,t,s)}static getInApp(e,t,s){this.getInAppWithUpdate(e,!1,t,s)}static getInAppWithUpdate(e,t,s,i){if(o.isAppKeyFormat()){const r=new J;r.setTag(e),r.setUpdateInApp(t),X.getCampaignTag(r,s,i)}else Ie.isFunction(i)&&i(he.showError(E,E.ErrorCode.BAD_REQUEST_SERVER_ERROR))}static addNewInAppToDismissForever(e){U.addNewInApptoDismissForever(e)}static async isInAppDismissForever(e){U.isInAppDismissForever(e)}static async inAppOnClick(e){re.onClick(e)}static async inAppSubmit(e,t,s){re.submit(e,t,s)}static async inAppWasShown(e,t,s,i,r){Ee.inAppWasShown(e,t,s,i,r)}static async downloadHTML(e){const t=await fetch(e,{method:"GET"});console.log(t)}static async setExternalCode(e,t,s){try{const s=await U.setExternalCode(e);t&&t(s)}catch(e){s&&s(e)}}static async logIn(e,t,s){await this.setExternalCode(e,t,s)}static async logOut(e,t){await this.setExternalCode(null,e,t)}}const ge=ue;window.indigitall||(window.indigitall={}),window.indigitall.InApp=ue,window.indigitall.InApp.Utils=U,window.indigitall.LogLevel=de})(),i})(),e.exports=t()},557:function(e){var t;t=()=>(()=>{var e={923:function(e){var t;t=()=>(()=>{"use strict";var e={147:e=>{e.exports=JSON.parse('{"name":"indigitall-web-core","description":"indigitall web core","version":"4.3.1","main":"index.js","author":"Smart2me S.L.","homepage":"https://indigitall.com","devDependencies":{"@babel/preset-env":"^7.18.10","babel-loader":"^8.2.5","filemanager-webpack-plugin":"^7.0.0","idempotent-babel-polyfill":"^7.4.4","script-loader":"^0.7.2","webpack":"^5.74.0","webpack-bundle-analyzer":"^4.6.1","webpack-cli":"^4.10.0"},"scripts":{"test":"echo \'There are not tests\'","public":"ws --directory ./public --port 80 --log.format dev","build":"webpack --config webpack.config.js --mode=production","build-dev":"webpack --config webpack.config.js --watch --mode=development","delete-node-modules":"rm -rf node_modules/ && rm -f package-lock.json","install-core":"npm install && npm run build"}}')}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,s),n.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{s.r(i),s.d(i,{default:()=>V});var e={};s.r(e),s.d(e,{BaseClient:()=>S,BaseRequest:()=>O});var t={};s.r(t),s.d(t,{Channel:()=>P,Device:()=>m,DeviceStatus:()=>N,ErrorDictionary:()=>A,ErrorModel:()=>p,EventType:()=>y,TopicSubscribeType:()=>w});var r={};s.r(r),s.d(r,{CommonUtils:()=>C,CorePermissions:()=>D,CryptoUtils:()=>v,ErrorUtils:()=>T,JsonUtils:()=>B,Log:()=>_,LogLevel:()=>u,TopicUtils:()=>M,Validations:()=>U});var n={platform:"webpush",version:"0.0.1"};const o=s(147);n.version=o.version;const a=n=Object.assign(n,{client:{URL_BASE:"https://device-api.indigitall.com/v1",URL_DEVICE_V2:"https://device-api.indigitall.com/v2",INAPP_URL_BASE:"https://inapp-api.indigitall.com/v1",INBOX_URL_BASE:"https://inbox-api.indigitall.com/v1",CUSTOMER_URL_BASE:"https://device-api.indigitall.com/v2"}}),c=new class{constructor(){this.storage=this.isLocalStorageAvailable()?window.localStorage:null}isLocalStorageAvailable(){try{const e=window.localStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==c.length}return!1}setItem(e,t){return null!=this.storage&&(this.storage.setItem(e,t),!0)}getItem(e){return null!=this.storage?this.storage.getItem(e):null}deleteItem(e){return!!this.storage&&(this.storage.setItem(e,value),!0)}clear(){this.storage&&this.storage.clear()}},l=c,E=new class{constructor(){this.TAG="[IND]IndexedDB: ",this.DB_NAME="indigitall.indexedDB",this.DB_VERSION=1,this.DB_STORE_NAME="indigitallStore",this.DB_STORE_MODE="readwrite",this.DB_KEY_PATH="id",this.DB_STORE_INDEX="storeIndex",this.IDB=indexedDB||mozzIndexedDB||webkitIndexedDB||msIndexedDB}async getDB(){return new Promise(((e,t)=>{const s=this.IDB;if(s){const i=s.open("indigitall.indexedDB",1);i.onupgradeneeded=function(){i.result.createObjectStore("indigitallStore").createIndex("storeIndex","store.key")},i.onsuccess=function(){const t=i.result,s=t.transaction("indigitallStore","readwrite"),r=s.objectStore("indigitallStore"),n=r.index("storeIndex");e({db:t,tx:s,store:r,index:n})},i.onerror=function(e){t(e)}}else t(!1)}))}async get(e,t){return new Promise(((s,i)=>{e||i(!1),e.index.get(t).onsuccess=t=>{t.target.result&&(this.close(e),s(t.target.result.store.value)),i(!1)}}))}async put(e,t,s){return new Promise(((i,r)=>{e||r(!1),e.store.put({store:{key:t,value:s}},t).onsuccess=t=>{this.close(e),i(s)}}))}close(e){if(e.tx)try{e.tx.oncomplete=()=>{e.db.close()}}catch(e){console.error(this.TAG,e)}}async setItem(e,t){try{const s=await this.getDB();return this.put(s,e,t)}catch(e){return e}}async getItem(e){try{const t=await this.getDB();return this.get(t,e)}catch(e){return e}}},h=new class{constructor(){this.SESSION="indigitall.session.storage",this.session=this.isSessionStorageAvailable()?window.sessionStorage:null}isSessionStorageAvailable(){try{const e=window.sessionStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==h.length}return!1}getItem(e){return null!=this.session?this.session.getItem(e):null}setItem(e,t){return null!=this.session&&(this.session.setItem(e,t),!0)}clearMessages(){this.session&&this.session.removeItem("messages")}},I=h,d=class{constructor(){this.storage=l,this.db=E,this.BASE_TIME=60,this.REPOSITORY="indigitall.repository",this.APP_KEY=this.REPOSITORY+".APP_KEY",this.VAPID_PUBLIC=this.REPOSITORY+".VAPID_PUBLIC",this.ENABLED=this.REPOSITORY+".ENABLED",this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID",this.SERVICE_SYNC_TIME=this.REPOSITORY+".SERVICE_SYNC_TIME",this.LOCATION_ENABLED=this.REPOSITORY+".LOCATION_ENABLED",this.LOCATION_UPDATE_MINUTES=this.REPOSITORY+".LOCATION_UPDATE_MINUTES",this.REQUEST_LOCATION=this.REPOSITORY+".REQUEST_LOCATION",this.BROWSER_PUBLIC_KEY=this.REPOSITORY+".BROWSER_PUBLIC_KEY",this.BROWSER_PRIVATE_KEY=this.REPOSITORY+".BROWSER_PRIVATE_KEY",this.PLATFORM=this.REPOSITORY+".PLATFORM",this.BROWSER_NAME=this.REPOSITORY+".BROWSER_NAME",this.BROWSER_VERSION=this.REPOSITORY+".BROWSER_VERSION",this.OS_NAME=this.REPOSITORY+".OS_NAME",this.OS_VERSION=this.REPOSITORY+".OS_VERSION",this.DEVICE_TYPE=this.REPOSITORY+".DEVICE_TYPE",this.SUPPORTED=this.REPOSITORY+".SUPPORTED",this.SERVICE_TIMESTAMP=this.REPOSITORY+".SERVICE_TIMESTAMP",this.LOCATION_TIMESTAMP=this.REPOSITORY+".LOCATION_TIMESTAMP",this.PERMISSION_LOCATION=this.REPOSITORY+".PERMISSION_LOCATION",this.SET_LOG_DEBUG=this.REPOSITORY+".SET_LOG_DEBUG",this.NEW_USER_TIMESTAMP=this.REPOSITORY+".NEW_USER_TIMESTAMP",this.EXTERNAL_ID=this.REPOSITORY+".EXTERNAL_ID",this.REGISTERED_BY_COOKIE=this.REPOSITORY+".REGISTERED_BY_COOKIE",this.LOG_LEVEL=this.REPOSITORY+".LOG_LEVEL",this.LATITUDE=this.REPOSITORY+".LATITUDE",this.LONGITUDE=this.REPOSITORY+".LONGITUDE",this.TOPIC_LIST=this.REPOSITORY+".TOPIC_LIST",this.INAPP_ENABLED=this.REPOSITORY+".INAPP_ENABLED",this.URL_INAPP_API=this.REPOSITORY+".URL_INAPP_API",this.INAPP_TOPICS=this.REPOSITORY+".INAPP_TOPICS"}setItemSessionStorage(e,t){I.setItem(e,t)}getItemSessionStorage(e){return I.getItem(e)}clearSessionStorage(){I.clearMessages()}setStorage(e,t){l.setItem(e,t)}getStorage(e){return l.getItem(e)}clearStorage(){l.clear()}setBrowserPublicKey(e){l.setItem(this.BROWSER_PUBLIC_KEY,e)}getBrowserPublicKey(){return l.getItem(this.BROWSER_PUBLIC_KEY)}setBrowserPrivateKey(e){l.setItem(this.BROWSER_PRIVATE_KEY,e)}getBrowserPrivateKey(){return l.getItem(this.BROWSER_PRIVATE_KEY)}async setAppKey(e){l.setItem(this.APP_KEY,e),E&&E.IDB&&await E.setItem(this.APP_KEY,e)}getAppKey(){return l.getItem(this.APP_KEY)}async getAppKeySync(){if(E&&E.IDB)return await E.getItem(this.APP_KEY)}setVAPID(e){l.setItem(this.VAPID_PUBLIC,e)}getVAPID(){return l.getItem(this.VAPID_PUBLIC)}setEnabled(e){l.setItem(this.ENABLED,e)}getEnabled(){return l.getItem(this.ENABLED)}setServiceSyncTime(e){l.setItem(this.SERVICE_SYNC_TIME,e*this.BASE_TIME)}getServiceSyncTime(){return l.getItem(this.SERVICE_SYNC_TIME)||1*this.BASE_TIME}setLocationEnabled(e){l.setItem(this.LOCATION_ENABLED,e)}getLocationEnabled(){return l.getItem(this.LOCATION_ENABLED)}setLocationUpdateMinutes(e){l.setItem(this.LOCATION_UPDATE_MINUTES,e)}getLocationUpdateMinutes(){return l.getItem(this.LOCATION_UPDATE_MINUTES)||30}async setRequestLocation(e){l.setItem(this.REQUEST_LOCATION,e)}getRequestLocation(){return!!l&&l.getItem(this.REQUEST_LOCATION)}async setPlatform(e){l.setItem(this.PLATFORM,e)}getPlatform(){return l&&l.getItem(this.PLATFORM)||a.platform}getVersion(){return a.version}async setBrowserName(e){l.setItem(this.BROWSER_NAME,e)}getBrowserName(){return l.getItem(this.BROWSER_NAME)}setBrowserVersion(e){l.setItem(this.BROWSER_VERSION,e)}getBrowserVersion(){return l.getItem(this.BROWSER_VERSION)}async setOsName(e){l.setItem(this.OS_NAME,e)}getOsName(){return l.getItem(this.OS_NAME)}setOsVersion(e){l.setItem(this.OS_VERSION,e)}getOsVersion(){return l.getItem(this.OS_VERSION)}setDeviceType(e){l.setItem(this.DEVICE_TYPE,e)}getDeviceType(){return l.getItem(this.DEVICE_TYPE)}setSupported(e){l.setItem(this.SUPPORTED,e)}getSupported(){return l.getItem(this.SUPPORTED)}setServiceTimestamp(e){l.setItem(this.SERVICE_TIMESTAMP,e)}getServiceTimestamp(){return l.getItem(this.SERVICE_TIMESTAMP)}setLocationTimestamp(e){l.setItem(this.LOCATION_TIMESTAMP,e)}getLocationTimestamp(){return l.getItem(this.LOCATION_TIMESTAMP)}setPermissionLocation(e){l.setItem(this.PERMISSION_LOCATION,e)}getPermissionLocation(){return l.getItem(this.PERMISSION_LOCATION)}setDebugLog(e){l.setItem(this.SET_LOG_DEBUG,e)}getDebugLog(){return"false"!==l.getItem(this.SET_LOG_DEBUG)}setLogLevel(e){l.setItem(this.LOG_LEVEL,e)}getLogLevel(){return l.getItem(this.LOG_LEVEL)}setNewUserTimestamp(e){l.setItem(this.NEW_USER_TIMESTAMP,e)}getNewUserTimestamp(){return l.getItem(this.NEW_USER_TIMESTAMP)}async setExternalIdRequest(e){l&&l.isLocalStorageAvailable()&&l.setItem(this.EXTERNAL_ID,e),E&&E.IDB&&await E.setItem(this.EXTERNAL_ID,e)}async getExternalIdRequest(){let e;try{l&&l.isLocalStorageAvailable()?e=l.getItem(this.EXTERNAL_ID):E&&E.IDB&&(e=await E.getItem(this.EXTERNAL_ID))}catch(e){}return e}setExternalId(e){l.setItem(this.EXTERNAL_ID,e)}getExternalId(){return l.getItem(this.EXTERNAL_ID)}async getRegisteredByCookie(){return l.getItem(this.REGISTERED_BY_COOKIE)}async setRegisteredByCookie(e){l.setItem(this.REGISTERED_BY_COOKIE,e)}setLatitude(e){l.setItem(this.LATITUDE,e)}getLatitude(){return l.getItem(this.LATITUDE)}setLongitude(e){l.setItem(this.LONGITUDE,e)}getLongitude(){return l.getItem(this.LONGITUDE)}async setInAppTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.INAPP_TOPICS,e)}async getInAppTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.INAPP_TOPICS))}catch(e){}return e}async setTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.TOPIC_LIST,e)}async getTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.TOPIC_LIST))}catch(e){}return e}getUrlInappApi(){return this.getStorage(this.URL_INAPP_API)}setUrlInappApi(e){this.setStorage(this.URL_INAPP_API,e)}setInAppEnabled(e){this.setStorage(this.INAPP_ENABLED,e)}isInAppEnabled(){return this.getStorage(this.INAPP_ENABLED)}},u=Object.freeze({DEBUG:1,INFO:2,WARNING:3,ERROR:4}),g=u;class R{constructor(e){this.tag="[IND]",e&&(this.tag=e),this.level=g.INFO,this.setLogLevel((new d).getLogLevel()),this.log=[]}setLogLevel(e){e&&e>=g.DEBUG&&e<=g.ERROR&&(this.level=e)}static addedAsString(e){return"string"==typeof e?e:JSON.stringify(e,null,2)}d(){if(this.level<=g.DEBUG)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}i(){if(this.level<=g.INFO)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}w(){if(this.level<=g.WARNING)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}e(){if(this.level<=g.ERROR)if(1==arguments.length&&arguments.errorCode)this.log+=`${error.errorCode}: ${error.errorMessage}`;else for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}writeLog(){this.log.length>0&&this.tag&&this.log&&console.log(this.tag,this.log),this.log=[]}}const _=R,p=class{constructor(e,t,s){this.errorCode=e,this.errorMessage=t,null!=s&&(this.exceptionMessage=s)}},T=new class{constructor(){}showError(e,t,s){if(null!=e){const i=Object.values(e.ErrorCode).indexOf(t);return i>=0?new p(Object.keys(e.ErrorCode)[i],Object.keys(e.ErrorMessage)[i],s):new p(GENERAL_ERROR,"general error",s)}}},A={ErrorCode:{GENERAL_ERROR:600,API_SERVER_ERROR:500,API_PARAMETER_MISSING:400,API_APPKEY_NOT_VALID:401,API_FORBIDDEN_REQUEST:403,API_DEVICE_NOT_FOUND:404,API_TOPICS_ARE_INSERTED:409,BAD_REQUEST_SERVER_ERROR:410},ErrorMessage:{GENERAL_ERROR:"General Error",API_SERVER_ERROR:"Error server response",API_PARAMETER_MISSING:"Api parameter missing",API_APPKEY_NOT_VALID:"appKey is not valid",API_FORBIDDEN_REQUEST:"forbidden request",API_DEVICE_NOT_FOUND:"device not found",API_TOPICS_ARE_INSERTED:"topics are inserted",BAD_REQUEST_SERVER_ERROR:"bad request"}},S=class{constructor(){this.URL_BASE="",this.GET="GET",this.POST="POST",this.PUT="PUT",this.DELETE="DELETE"}async getURL(){return this.URL_BASE}async call(e,t,s,i){const r=new _("[IND]BaseClient: ");s.isServiceWorkerRequest()&&r.setLogLevel(g.DEBUG);let n=await this.getURL()+s.getPath(t)+s.getParams();s.isJourneyRequest()&&(n=n.replace("v1","v2"));const o={method:e,headers:s.addHeaders()};e!==this.GET&&(o.body=JSON.stringify(s.getBody())),i&&(o.credentials=i);try{const t=await fetch(n,o),i=await t.json();return t.ok?(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\nResponse Body:",JSON.stringify(i.data,null,"\t")).writeLog(),i):(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\n").writeLog(),new p(i.statusCode,i.message))}catch(t){return r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Error: "+t).writeLog(),T.showError(A,A.ErrorCode.GENERAL_ERROR,t)}}async get(e,t){return await this.call(this.GET,e,t)}async post(e,t,s){return await this.call(this.POST,e,t,s)}async put(e,t,s){return await this.call(this.PUT,e,t,s)}async delete(e,t){return await this.call(this.DELETE,e,t)}},O=class{constructor(){this.PARAM_APP_KEY="appKey",this.PARAM_DEVICE_ID="deviceId",this.PARAM_PUSH_TOKEN="pushToken",this.PARAM_ENABLED="enabled",this.PARAM_PLATFORM="platform",this.PARAM_VERSION="version",this.PARAM_TOPICS="topics",this.PARAM_EVENT_TYPE="eventType",this.PARAM_PUSH_ID="pushId",this.PARAM_CLICKED_BUTTON="clickedButton",this.PARAM_PERMISSION_TYPE="permissionType",this.PARAM_LATITUDE="latitude",this.PARAM_LONGITUDE="longitude",this.PARAM_INAPP_ID="inAppId",this.PARAM_INAPP_EVENT_TYPE="eventType",this.PARAM_INAPP_CLICKED_BUTTON="clickedButton",this.PARAM_INAPP_LAST_VERSION_ID="lastVersionId",this.PARAM_INBOX_EXTERNALID="externalId",this.PARAM_INBOX_PAGE="page",this.PARAM_INBOX_PAGE_SIZE="pageSize",this.PARAM_INBOX_DATE_FROM="dateFrom",this.PARAM_INBOX_DATE_TO="dateTo",this.PARAM_INBOX_STATUS="status",this.PARAM_INBOX_SENDER_IDS="sendingIds",this.PARAM_CUSTOMER_ID="customerId",this.PARAM_CUSTOMER_FIELD_NAMES="fieldNames",this.PARAM_CUSTOMER_FIELDS="fields",this.PARAM_CUSTOMER_LINK="link",this.PARAM_CUSTOMER_CHANNEL="channel",this.appKey=(new d).getAppKey(),this.params=null,this.pathParams={},this.headers={}}getParams(){return"?"+this.PARAM_APP_KEY+"="+this.appKey+(this.params?"&"+this.params:"")}getBody(){return this.body?this.body:""}getPath(e){let t=e;return Object.keys(this.pathParams).forEach((e=>{t=t.replace(e,this.pathParams[e])})),t}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}isServiceWorkerRequest(){return this.serviceWorkerRequest}setServiceWorkerRequest(e){this.serviceWorkerRequest=e}isJourneyRequest(){return this.journeyRequest}setJourneyRequest(e){this.journeyRequest=e}},P=Object.freeze({PUSH:"push",INAPP:"inapp",CHAT:"chat"}),m=class{constructor(e=null,t){null==e?(this.browserPublicKey=(new d).getBrowserPublicKey(),this.browserPrivateKey=(new d).getBrowserPrivateKey(),this.platform=(new d).getPlatform(),this.version=(new d).getVersion(),this.browserName=(new d).getBrowserName(),this.browserVersion=(new d).getBrowserVersion(),this.osName=(new d).getOsName(),this.osVersion=(new d).getOsVersion(),this.deviceType=(new d).getDeviceType(),(new d).getEnabled()&&(this.enabled="true"===(new d).getEnabled()),(new d).getExternalId()&&(this.externalCode=(new d).getExternalId())):t?(e.enabled&&(this.enabled=e.enabled,(new d).setEnabled(this.enabled)),e.registeredByCookie&&(this.registeredByCookie=e.registeredByCookie,(new d).setRegisteredByCookie(this.registeredByCookie))):(e.browserPublicKey&&(this.browserPublicKey=e.browserPublicKey),e.browserPrivateKey&&(this.browserPrivateKey=e.browserPrivateKey),e.platform&&(this.platform=e.platform),e.version&&(this.version=e.version),e.osVersion&&(this.osVersion=e.osVersion),e.browserName&&(this.browserName=e.browserName),e.browserVersion&&(this.browserVersion=e.browserVersion),e.osName&&(this.osName=e.osName),e.deviceType&&(this.deviceType=e.deviceType),e.enabled&&(this.enabled=e.enabled),e.externalCode&&(this.externalCode=e.externalCode)),this.platform&&(this.productName=this.platform),this.version&&(this.productVersion=this.version),navigator&&"language"in navigator&&(this.locale=navigator.language),Intl&&"DateTimeFormat"in Intl&&(this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone),this.timeOffset=-(new Date).getTimezoneOffset()}getDeviceId(){return this.deviceId}setDeviceId(e){this.deviceId=e}setExternalCode(e){this.externalCode=e}toJSON(){const e={};return this.platform&&(e.platform=this.platform),this.version&&(e.version=this.version),this.productName&&(e.productName=this.productName),this.productVersion&&(e.productVersion=this.productVersion),this.browserName&&(e.browserName=this.browserName),this.browserVersion&&(e.browserVersion=this.browserVersion),this.osName&&(e.osName=this.osName),this.osVersion&&(e.osVersion=this.osVersion),this.deviceType&&(e.deviceType=this.deviceType),this.locale&&(e.locale=this.locale),this.timeZone&&(e.timeZome=this.timeZone),this.timeOffset&&(e.timeOffset=this.timeOffset),this.enabled&&(e.enabled=this.enabled),this.browserPublicKey&&(e.browserPublicKey=this.browserPublicKey),this.browserPrivateKey&&(e.browserPrivateKey=this.browserPrivateKey),this.externalCode&&(e.externalCode=this.externalCode),e}},N=Object.freeze({DEFAULT:-1,ENABLE:1,DISABLE:0}),y=Object.freeze({EVENT_TYPE_CLICK:"click",EVENT_TYPE_RECEIVE:"receive",EVENT_TYPE_UPDATE:"update",EVENT_TYPE_ACCEPT:"accept",EVENT_TYPE_REJECT:"reject",EVENT_TYPE_ASK:"ask"}),w=Object.freeze({SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe"}),C=class{static isServiceTimestampExceed(){return!(new d).getServiceTimestamp()||(new d).getServiceSyncTime()<=(Date.now()-(new d).getServiceTimestamp())/6e4}static isFunction(e){return!(!e||"function"!=typeof e)}},D=class{static async getPermissions(){const e=await this.getPermission("geolocation"),t={};return e&&(t.location=e.state),t}static async getPermission(e){try{if(navigator&&navigator.permissions&&navigator.permissions.query&&e)return await navigator.permissions.query({name:e,userVisibleOnly:!0})}catch(e){return null}return null}static async setPermissionsCallback(){await this.setCallback("geolocation",navigator.indigitallRequestLocationPermission)}static async setCallback(e,t){const s=await this.getPermission(e);if(s){let i=s.state;"onchange"in s&&(s.onchange=()=>{new _("[IND]CorePermissions: ").d(e+" permission state has changed from "+i+" to "+s.state).writeLog(),i=s.state,t&&t({name:e,state:s.state})})}}},b=new _("[IND]Crypto"),f=new TextEncoder("utf-8"),L="HMAC",v=class{static async createHmac(e,t){try{const s=window?.crypto?.subtle;if(!s)return;const i=await s.importKey("raw",f.encode(e),{name:L,hash:{name:"SHA-256"}},!1,["sign","verify"]),r=await s.sign(L,i,f.encode(t)),n=new Uint8Array(r),o=Array.prototype.map.call(n,(e=>("00"+e.toString(16)).slice(-2))).join("");return b.d("hmac: ",o).writeLog(),o}catch(e){return void b.e("error:",e).writeLog()}}},B=class{static compareJSON(e,t){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const i of s)if(e[i]!==t[i]){if("object"!=typeof e[i]||"object"!=typeof t[i])return!1;if(!isEqual(e[i],t[i]))return!1}return!0}},U=class{static isValidFormat(e){return null!=e&&""!=e&&"null"!=e&&e.length>8}},M=class{static setTopicChannel(e,t){const s=[];for(let i=0;i<e.length;i++){const r=e[i];r.channel=t,s.push(r)}return s}},V={Repository:d,Config:a,Api:e,Models:t,Utils:r}})(),i})(),e.exports=t()},57:(e,t,s)=>{"use strict";s.d(t,{Core:()=>x});var i={};s.r(i),s.d(i,{BaseClient:()=>O,BaseRequest:()=>P});var r={};s.r(r),s.d(r,{Channel:()=>m,Device:()=>N,DeviceStatus:()=>y,ErrorDictionary:()=>S,ErrorModel:()=>T,EventType:()=>w,TopicSubscribeType:()=>C});var n={};s.r(n),s.d(n,{CommonUtils:()=>D,CorePermissions:()=>b,CryptoUtils:()=>B,ErrorUtils:()=>A,JsonUtils:()=>U,Log:()=>p,LogLevel:()=>g,TopicUtils:()=>V,Validations:()=>M}),s(923);var o={platform:"webpush",version:"0.0.1"};const a=s(391);o.version=a.version;const c=o=Object.assign(o,{client:{URL_BASE:"https://device-api.indigitall.com/v1",URL_DEVICE_V2:"https://device-api.indigitall.com/v2",INAPP_URL_BASE:"https://inapp-api.indigitall.com/v1",INBOX_URL_BASE:"https://inbox-api.indigitall.com/v1",CUSTOMER_URL_BASE:"https://device-api.indigitall.com/v2"}}),l=new class{constructor(){this.storage=this.isLocalStorageAvailable()?window.localStorage:null}isLocalStorageAvailable(){try{const e=window.localStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==l.length}return!1}setItem(e,t){return null!=this.storage&&(this.storage.setItem(e,t),!0)}getItem(e){return null!=this.storage?this.storage.getItem(e):null}deleteItem(e){return!!this.storage&&(this.storage.setItem(e,value),!0)}clear(){this.storage&&this.storage.clear()}},E=l,h=new class{constructor(){this.TAG="[IND]IndexedDB: ",this.DB_NAME="indigitall.indexedDB",this.DB_VERSION=1,this.DB_STORE_NAME="indigitallStore",this.DB_STORE_MODE="readwrite",this.DB_KEY_PATH="id",this.DB_STORE_INDEX="storeIndex",this.IDB=indexedDB||mozzIndexedDB||webkitIndexedDB||msIndexedDB}async getDB(){return new Promise(((e,t)=>{const s=this.IDB;if(s){const i=s.open("indigitall.indexedDB",1);i.onupgradeneeded=function(){i.result.createObjectStore("indigitallStore").createIndex("storeIndex","store.key")},i.onsuccess=function(){const t=i.result,s=t.transaction("indigitallStore","readwrite"),r=s.objectStore("indigitallStore"),n=r.index("storeIndex");e({db:t,tx:s,store:r,index:n})},i.onerror=function(e){t(e)}}else t(!1)}))}async get(e,t){return new Promise(((s,i)=>{e||i(!1),e.index.get(t).onsuccess=t=>{t.target.result&&(this.close(e),s(t.target.result.store.value)),i(!1)}}))}async put(e,t,s){return new Promise(((i,r)=>{e||r(!1),e.store.put({store:{key:t,value:s}},t).onsuccess=t=>{this.close(e),i(s)}}))}close(e){if(e.tx)try{e.tx.oncomplete=()=>{e.db.close()}}catch(e){console.error(this.TAG,e)}}async setItem(e,t){try{const s=await this.getDB();return this.put(s,e,t)}catch(e){return e}}async getItem(e){try{const t=await this.getDB();return this.get(t,e)}catch(e){return e}}},I=new class{constructor(){this.SESSION="indigitall.session.storage",this.session=this.isSessionStorageAvailable()?window.sessionStorage:null}isSessionStorageAvailable(){try{const e=window.sessionStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==I.length}return!1}getItem(e){return null!=this.session?this.session.getItem(e):null}setItem(e,t){return null!=this.session&&(this.session.setItem(e,t),!0)}clearMessages(){this.session&&this.session.removeItem("messages")}},d=I,u=class{constructor(){this.storage=E,this.db=h,this.BASE_TIME=60,this.REPOSITORY="indigitall.repository",this.APP_KEY=this.REPOSITORY+".APP_KEY",this.VAPID_PUBLIC=this.REPOSITORY+".VAPID_PUBLIC",this.ENABLED=this.REPOSITORY+".ENABLED",this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID",this.SERVICE_SYNC_TIME=this.REPOSITORY+".SERVICE_SYNC_TIME",this.LOCATION_ENABLED=this.REPOSITORY+".LOCATION_ENABLED",this.LOCATION_UPDATE_MINUTES=this.REPOSITORY+".LOCATION_UPDATE_MINUTES",this.REQUEST_LOCATION=this.REPOSITORY+".REQUEST_LOCATION",this.BROWSER_PUBLIC_KEY=this.REPOSITORY+".BROWSER_PUBLIC_KEY",this.BROWSER_PRIVATE_KEY=this.REPOSITORY+".BROWSER_PRIVATE_KEY",this.PLATFORM=this.REPOSITORY+".PLATFORM",this.BROWSER_NAME=this.REPOSITORY+".BROWSER_NAME",this.BROWSER_VERSION=this.REPOSITORY+".BROWSER_VERSION",this.OS_NAME=this.REPOSITORY+".OS_NAME",this.OS_VERSION=this.REPOSITORY+".OS_VERSION",this.DEVICE_TYPE=this.REPOSITORY+".DEVICE_TYPE",this.SUPPORTED=this.REPOSITORY+".SUPPORTED",this.SERVICE_TIMESTAMP=this.REPOSITORY+".SERVICE_TIMESTAMP",this.LOCATION_TIMESTAMP=this.REPOSITORY+".LOCATION_TIMESTAMP",this.PERMISSION_LOCATION=this.REPOSITORY+".PERMISSION_LOCATION",this.SET_LOG_DEBUG=this.REPOSITORY+".SET_LOG_DEBUG",this.NEW_USER_TIMESTAMP=this.REPOSITORY+".NEW_USER_TIMESTAMP",this.EXTERNAL_ID=this.REPOSITORY+".EXTERNAL_ID",this.REGISTERED_BY_COOKIE=this.REPOSITORY+".REGISTERED_BY_COOKIE",this.LOG_LEVEL=this.REPOSITORY+".LOG_LEVEL",this.LATITUDE=this.REPOSITORY+".LATITUDE",this.LONGITUDE=this.REPOSITORY+".LONGITUDE",this.TOPIC_LIST=this.REPOSITORY+".TOPIC_LIST",this.INAPP_ENABLED=this.REPOSITORY+".INAPP_ENABLED",this.URL_INAPP_API=this.REPOSITORY+".URL_INAPP_API",this.INAPP_TOPICS=this.REPOSITORY+".INAPP_TOPICS"}setItemSessionStorage(e,t){d.setItem(e,t)}getItemSessionStorage(e){return d.getItem(e)}clearSessionStorage(){d.clearMessages()}setStorage(e,t){E.setItem(e,t)}getStorage(e){return E.getItem(e)}clearStorage(){E.clear()}setBrowserPublicKey(e){E.setItem(this.BROWSER_PUBLIC_KEY,e)}getBrowserPublicKey(){return E.getItem(this.BROWSER_PUBLIC_KEY)}setBrowserPrivateKey(e){E.setItem(this.BROWSER_PRIVATE_KEY,e)}getBrowserPrivateKey(){return E.getItem(this.BROWSER_PRIVATE_KEY)}async setAppKey(e){E.setItem(this.APP_KEY,e),h&&h.IDB&&await h.setItem(this.APP_KEY,e)}getAppKey(){return E.getItem(this.APP_KEY)}async getAppKeySync(){if(h&&h.IDB)return await h.getItem(this.APP_KEY)}setVAPID(e){E.setItem(this.VAPID_PUBLIC,e)}getVAPID(){return E.getItem(this.VAPID_PUBLIC)}setEnabled(e){E.setItem(this.ENABLED,e)}getEnabled(){return E.getItem(this.ENABLED)}setServiceSyncTime(e){E.setItem(this.SERVICE_SYNC_TIME,e*this.BASE_TIME)}getServiceSyncTime(){return E.getItem(this.SERVICE_SYNC_TIME)||1*this.BASE_TIME}setLocationEnabled(e){E.setItem(this.LOCATION_ENABLED,e)}getLocationEnabled(){return E.getItem(this.LOCATION_ENABLED)}setLocationUpdateMinutes(e){E.setItem(this.LOCATION_UPDATE_MINUTES,e)}getLocationUpdateMinutes(){return E.getItem(this.LOCATION_UPDATE_MINUTES)||30}async setRequestLocation(e){E.setItem(this.REQUEST_LOCATION,e)}getRequestLocation(){return!!E&&E.getItem(this.REQUEST_LOCATION)}async setPlatform(e){E.setItem(this.PLATFORM,e)}getPlatform(){return E&&E.getItem(this.PLATFORM)||c.platform}getVersion(){return c.version}async setBrowserName(e){E.setItem(this.BROWSER_NAME,e)}getBrowserName(){return E.getItem(this.BROWSER_NAME)}setBrowserVersion(e){E.setItem(this.BROWSER_VERSION,e)}getBrowserVersion(){return E.getItem(this.BROWSER_VERSION)}async setOsName(e){E.setItem(this.OS_NAME,e)}getOsName(){return E.getItem(this.OS_NAME)}setOsVersion(e){E.setItem(this.OS_VERSION,e)}getOsVersion(){return E.getItem(this.OS_VERSION)}setDeviceType(e){E.setItem(this.DEVICE_TYPE,e)}getDeviceType(){return E.getItem(this.DEVICE_TYPE)}setSupported(e){E.setItem(this.SUPPORTED,e)}getSupported(){return E.getItem(this.SUPPORTED)}setServiceTimestamp(e){E.setItem(this.SERVICE_TIMESTAMP,e)}getServiceTimestamp(){return E.getItem(this.SERVICE_TIMESTAMP)}setLocationTimestamp(e){E.setItem(this.LOCATION_TIMESTAMP,e)}getLocationTimestamp(){return E.getItem(this.LOCATION_TIMESTAMP)}setPermissionLocation(e){E.setItem(this.PERMISSION_LOCATION,e)}getPermissionLocation(){return E.getItem(this.PERMISSION_LOCATION)}setDebugLog(e){E.setItem(this.SET_LOG_DEBUG,e)}getDebugLog(){return"false"!==E.getItem(this.SET_LOG_DEBUG)}setLogLevel(e){E.setItem(this.LOG_LEVEL,e)}getLogLevel(){return E.getItem(this.LOG_LEVEL)}setNewUserTimestamp(e){E.setItem(this.NEW_USER_TIMESTAMP,e)}getNewUserTimestamp(){return E.getItem(this.NEW_USER_TIMESTAMP)}async setExternalIdRequest(e){E&&E.isLocalStorageAvailable()&&E.setItem(this.EXTERNAL_ID,e),h&&h.IDB&&await h.setItem(this.EXTERNAL_ID,e)}async getExternalIdRequest(){let e;try{E&&E.isLocalStorageAvailable()?e=E.getItem(this.EXTERNAL_ID):h&&h.IDB&&(e=await h.getItem(this.EXTERNAL_ID))}catch(e){}return e}setExternalId(e){E.setItem(this.EXTERNAL_ID,e)}getExternalId(){return E.getItem(this.EXTERNAL_ID)}async getRegisteredByCookie(){return E.getItem(this.REGISTERED_BY_COOKIE)}async setRegisteredByCookie(e){E.setItem(this.REGISTERED_BY_COOKIE,e)}setLatitude(e){E.setItem(this.LATITUDE,e)}getLatitude(){return E.getItem(this.LATITUDE)}setLongitude(e){E.setItem(this.LONGITUDE,e)}getLongitude(){return E.getItem(this.LONGITUDE)}async setInAppTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.INAPP_TOPICS,e)}async getInAppTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.INAPP_TOPICS))}catch(e){}return e}async setTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.TOPIC_LIST,e)}async getTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.TOPIC_LIST))}catch(e){}return e}getUrlInappApi(){return this.getStorage(this.URL_INAPP_API)}setUrlInappApi(e){this.setStorage(this.URL_INAPP_API,e)}setInAppEnabled(e){this.setStorage(this.INAPP_ENABLED,e)}isInAppEnabled(){return this.getStorage(this.INAPP_ENABLED)}},g=Object.freeze({DEBUG:1,INFO:2,WARNING:3,ERROR:4}),R=g;class _{constructor(e){this.tag="[IND]",e&&(this.tag=e),this.level=R.INFO,this.setLogLevel((new u).getLogLevel()),this.log=[]}setLogLevel(e){e&&e>=R.DEBUG&&e<=R.ERROR&&(this.level=e)}static addedAsString(e){return"string"==typeof e?e:JSON.stringify(e,null,2)}d(){if(this.level<=R.DEBUG)for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}i(){if(this.level<=R.INFO)for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}w(){if(this.level<=R.WARNING)for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}e(){if(this.level<=R.ERROR)if(1==arguments.length&&arguments.errorCode)this.log+=`${error.errorCode}: ${error.errorMessage}`;else for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}writeLog(){this.log.length>0&&this.tag&&this.log&&console.log(this.tag,this.log),this.log=[]}}const p=_,T=class{constructor(e,t,s){this.errorCode=e,this.errorMessage=t,null!=s&&(this.exceptionMessage=s)}},A=new class{constructor(){}showError(e,t,s){if(null!=e){const i=Object.values(e.ErrorCode).indexOf(t);return i>=0?new T(Object.keys(e.ErrorCode)[i],Object.keys(e.ErrorMessage)[i],s):new T(GENERAL_ERROR,"general error",s)}}},S={ErrorCode:{GENERAL_ERROR:600,API_SERVER_ERROR:500,API_PARAMETER_MISSING:400,API_APPKEY_NOT_VALID:401,API_FORBIDDEN_REQUEST:403,API_DEVICE_NOT_FOUND:404,API_TOPICS_ARE_INSERTED:409,BAD_REQUEST_SERVER_ERROR:410},ErrorMessage:{GENERAL_ERROR:"General Error",API_SERVER_ERROR:"Error server response",API_PARAMETER_MISSING:"Api parameter missing",API_APPKEY_NOT_VALID:"appKey is not valid",API_FORBIDDEN_REQUEST:"forbidden request",API_DEVICE_NOT_FOUND:"device not found",API_TOPICS_ARE_INSERTED:"topics are inserted",BAD_REQUEST_SERVER_ERROR:"bad request"}},O=class{constructor(){this.URL_BASE="",this.GET="GET",this.POST="POST",this.PUT="PUT",this.DELETE="DELETE"}async getURL(){return this.URL_BASE}async call(e,t,s,i){const r=new p("[IND]BaseClient: ");s.isServiceWorkerRequest()&&r.setLogLevel(R.DEBUG);let n=await this.getURL()+s.getPath(t)+s.getParams();s.isJourneyRequest()&&(n=n.replace("v1","v2"));const o={method:e,headers:s.addHeaders()};e!==this.GET&&(o.body=JSON.stringify(s.getBody())),i&&(o.credentials=i);try{const t=await fetch(n,o),i=await t.json();return t.ok?(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\nResponse Body:",JSON.stringify(i.data,null,"\t")).writeLog(),i):(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\n").writeLog(),new T(i.statusCode,i.message))}catch(t){return r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Error: "+t).writeLog(),A.showError(S,S.ErrorCode.GENERAL_ERROR,t)}}async get(e,t){return await this.call(this.GET,e,t)}async post(e,t,s){return await this.call(this.POST,e,t,s)}async put(e,t,s){return await this.call(this.PUT,e,t,s)}async delete(e,t){return await this.call(this.DELETE,e,t)}},P=class{constructor(){this.PARAM_APP_KEY="appKey",this.PARAM_DEVICE_ID="deviceId",this.PARAM_PUSH_TOKEN="pushToken",this.PARAM_ENABLED="enabled",this.PARAM_PLATFORM="platform",this.PARAM_VERSION="version",this.PARAM_TOPICS="topics",this.PARAM_EVENT_TYPE="eventType",this.PARAM_PUSH_ID="pushId",this.PARAM_CLICKED_BUTTON="clickedButton",this.PARAM_PERMISSION_TYPE="permissionType",this.PARAM_LATITUDE="latitude",this.PARAM_LONGITUDE="longitude",this.PARAM_INAPP_ID="inAppId",this.PARAM_INAPP_EVENT_TYPE="eventType",this.PARAM_INAPP_CLICKED_BUTTON="clickedButton",this.PARAM_INAPP_LAST_VERSION_ID="lastVersionId",this.PARAM_INBOX_EXTERNALID="externalId",this.PARAM_INBOX_PAGE="page",this.PARAM_INBOX_PAGE_SIZE="pageSize",this.PARAM_INBOX_DATE_FROM="dateFrom",this.PARAM_INBOX_DATE_TO="dateTo",this.PARAM_INBOX_STATUS="status",this.PARAM_INBOX_SENDER_IDS="sendingIds",this.PARAM_CUSTOMER_ID="customerId",this.PARAM_CUSTOMER_FIELD_NAMES="fieldNames",this.PARAM_CUSTOMER_FIELDS="fields",this.PARAM_CUSTOMER_LINK="link",this.PARAM_CUSTOMER_CHANNEL="channel",this.appKey=(new u).getAppKey(),this.params=null,this.pathParams={},this.headers={}}getParams(){return"?"+this.PARAM_APP_KEY+"="+this.appKey+(this.params?"&"+this.params:"")}getBody(){return this.body?this.body:""}getPath(e){let t=e;return Object.keys(this.pathParams).forEach((e=>{t=t.replace(e,this.pathParams[e])})),t}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}isServiceWorkerRequest(){return this.serviceWorkerRequest}setServiceWorkerRequest(e){this.serviceWorkerRequest=e}isJourneyRequest(){return this.journeyRequest}setJourneyRequest(e){this.journeyRequest=e}},m=Object.freeze({PUSH:"push",INAPP:"inapp",CHAT:"chat"}),N=class{constructor(e=null,t){null==e?(this.browserPublicKey=(new u).getBrowserPublicKey(),this.browserPrivateKey=(new u).getBrowserPrivateKey(),this.platform=(new u).getPlatform(),this.version=(new u).getVersion(),this.browserName=(new u).getBrowserName(),this.browserVersion=(new u).getBrowserVersion(),this.osName=(new u).getOsName(),this.osVersion=(new u).getOsVersion(),this.deviceType=(new u).getDeviceType(),(new u).getEnabled()&&(this.enabled="true"===(new u).getEnabled()),(new u).getExternalId()&&(this.externalCode=(new u).getExternalId())):t?(e.enabled&&(this.enabled=e.enabled,(new u).setEnabled(this.enabled)),e.registeredByCookie&&(this.registeredByCookie=e.registeredByCookie,(new u).setRegisteredByCookie(this.registeredByCookie))):(e.browserPublicKey&&(this.browserPublicKey=e.browserPublicKey),e.browserPrivateKey&&(this.browserPrivateKey=e.browserPrivateKey),e.platform&&(this.platform=e.platform),e.version&&(this.version=e.version),e.osVersion&&(this.osVersion=e.osVersion),e.browserName&&(this.browserName=e.browserName),e.browserVersion&&(this.browserVersion=e.browserVersion),e.osName&&(this.osName=e.osName),e.deviceType&&(this.deviceType=e.deviceType),e.enabled&&(this.enabled=e.enabled),e.externalCode&&(this.externalCode=e.externalCode)),this.platform&&(this.productName=this.platform),this.version&&(this.productVersion=this.version),navigator&&"language"in navigator&&(this.locale=navigator.language),Intl&&"DateTimeFormat"in Intl&&(this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone),this.timeOffset=-(new Date).getTimezoneOffset()}getDeviceId(){return this.deviceId}setDeviceId(e){this.deviceId=e}setExternalCode(e){this.externalCode=e}toJSON(){const e={};return this.platform&&(e.platform=this.platform),this.version&&(e.version=this.version),this.productName&&(e.productName=this.productName),this.productVersion&&(e.productVersion=this.productVersion),this.browserName&&(e.browserName=this.browserName),this.browserVersion&&(e.browserVersion=this.browserVersion),this.osName&&(e.osName=this.osName),this.osVersion&&(e.osVersion=this.osVersion),this.deviceType&&(e.deviceType=this.deviceType),this.locale&&(e.locale=this.locale),this.timeZone&&(e.timeZome=this.timeZone),this.timeOffset&&(e.timeOffset=this.timeOffset),this.enabled&&(e.enabled=this.enabled),this.browserPublicKey&&(e.browserPublicKey=this.browserPublicKey),this.browserPrivateKey&&(e.browserPrivateKey=this.browserPrivateKey),this.externalCode&&(e.externalCode=this.externalCode),e}},y=Object.freeze({DEFAULT:-1,ENABLE:1,DISABLE:0}),w=Object.freeze({EVENT_TYPE_CLICK:"click",EVENT_TYPE_RECEIVE:"receive",EVENT_TYPE_UPDATE:"update",EVENT_TYPE_ACCEPT:"accept",EVENT_TYPE_REJECT:"reject",EVENT_TYPE_ASK:"ask"}),C=Object.freeze({SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe"}),D=class{static isServiceTimestampExceed(){return!(new u).getServiceTimestamp()||(new u).getServiceSyncTime()<=(Date.now()-(new u).getServiceTimestamp())/6e4}static isFunction(e){return!(!e||"function"!=typeof e)}},b=class{static async getPermissions(){const e=await this.getPermission("geolocation"),t={};return e&&(t.location=e.state),t}static async getPermission(e){try{if(navigator&&navigator.permissions&&navigator.permissions.query&&e)return await navigator.permissions.query({name:e,userVisibleOnly:!0})}catch(e){return null}return null}static async setPermissionsCallback(){await this.setCallback("geolocation",navigator.indigitallRequestLocationPermission)}static async setCallback(e,t){const s=await this.getPermission(e);if(s){let i=s.state;"onchange"in s&&(s.onchange=()=>{new p("[IND]CorePermissions: ").d(e+" permission state has changed from "+i+" to "+s.state).writeLog(),i=s.state,t&&t({name:e,state:s.state})})}}},f=new p("[IND]Crypto"),L=new TextEncoder("utf-8"),v="HMAC",B=class{static async createHmac(e,t){try{const s=window?.crypto?.subtle;if(!s)return;const i=await s.importKey("raw",L.encode(e),{name:v,hash:{name:"SHA-256"}},!1,["sign","verify"]),r=await s.sign(v,i,L.encode(t)),n=new Uint8Array(r),o=Array.prototype.map.call(n,(e=>("00"+e.toString(16)).slice(-2))).join("");return f.d("hmac: ",o).writeLog(),o}catch(e){return void f.e("error:",e).writeLog()}}},U=class{static compareJSON(e,t){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const i of s)if(e[i]!==t[i]){if("object"!=typeof e[i]||"object"!=typeof t[i])return!1;if(!isEqual(e[i],t[i]))return!1}return!0}},M=class{static isValidFormat(e){return null!=e&&""!=e&&"null"!=e&&e.length>8}},V=class{static setTopicChannel(e,t){const s=[];for(let i=0;i<e.length;i++){const r=e[i];r.channel=t,s.push(r)}return s}},x={Repository:u,Config:c,Api:i,Models:r,Utils:n}},391:e=>{"use strict";e.exports=JSON.parse('{"name":"indigitall-web-core","description":"indigitall web core","version":"4.3.1","main":"index.js","author":"Smart2me S.L.","homepage":"https://indigitall.com","devDependencies":{"@babel/preset-env":"^7.18.10","babel-loader":"^8.2.5","filemanager-webpack-plugin":"^7.0.0","idempotent-babel-polyfill":"^7.4.4","script-loader":"^0.7.2","webpack":"^5.74.0","webpack-bundle-analyzer":"^4.6.1","webpack-cli":"^4.10.0"},"scripts":{"test":"echo \'There are not tests\'","public":"ws --directory ./public --port 80 --log.format dev","build":"webpack --config webpack.config.js --mode=production","build-dev":"webpack --config webpack.config.js --watch --mode=development","delete-node-modules":"rm -rf node_modules/ && rm -f package-lock.json","install-core":"npm install && npm run build"}}')}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,s),n.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";s.r(r),s.d(r,{default:()=>L});const{Repository:e}=s(57).Core,t=new class extends e{constructor(){super(),this.AUTH_TOKEN=this.REPOSITORY+".AUTH_TOKEN",this.INBOX_AUTH_MODE=this.REPOSITORY+".INBOX_AUTH_MODE",this.URL_INBOX_API=this.REPOSITORY+".URL_INBOX_API"}async setDeviceId(e){this.setStorage(this.DEVICE_ID,e)}getDeviceId(){return this.getStorage(this.DEVICE_ID)}setAuthToken(e){this.setStorage(this.AUTH_TOKEN,e)}getAuthToken(){return this.getStorage(this.AUTH_TOKEN)}setInboxAuthMode(e){this.setStorage(this.INBOX_AUTH_MODE,e)}getInboxAuthMode(){return this.getStorage(this.INBOX_AUTH_MODE)}async getUrlInboxApi(){return this.getStorage(this.URL_INBOX_API)}async setUrlInboxApi(e){this.setStorage(this.URL_INBOX_API,e)}},{BaseClient:n}=s(57).Core.Api,{Config:o}=s(57).Core,{ErrorModel:a}=s(57).Core.Models,{CommonUtils:c}=s(57).Core.Utils,l=new class extends n{constructor(){super(),this.URL_BASE=o.client.INBOX_URL_BASE,this.ENDPOINT_INBOX_NOTIFICATIONS="/notification",this.ENDPOINT_INBOX_NOTIFICATIONS_WITH_SENDINGID=this.ENDPOINT_INBOX_NOTIFICATIONS+"/{sendingId}",this.ENDPOINT_INBOX_COUNTER="/counters",this.ENDPOINT_INBOX_AUTH="/auth/webhook"}async getURL(){return await t.getUrlInboxApi()||this.URL_BASE}async postInboxAuth(e,s,i){const r=await this.post(this.ENDPOINT_INBOX_AUTH,e.postInboxAuth());if(!r||r instanceof a||!r.data)r?c.isFunction(i)&&i(r):c.isFunction(i)&&i();else{const e=r.data.token;t.setAuthToken(e),c.isFunction(s)&&s(r)}return!0}async getInbox(e,t,s){const i=await this.get(this.ENDPOINT_INBOX_NOTIFICATIONS,e.getInboxPushRequest());return this.getInboxResponseStatus(i,t,s),!0}async putInboxPush(e,t,s){const i=await this.put(this.ENDPOINT_INBOX_NOTIFICATIONS,e.putInboxPushRequest());return this.getInboxResponseEdit(i,t,s),!0}async getInboxPushWithSendingId(e,t,s,i){const r=await this.get(this.ENDPOINT_INBOX_NOTIFICATIONS_WITH_SENDINGID,e.getInboxPushRequestWithSendingId());return this.getNotificationResponseStatus(r,t,s,i),!0}async putInboxPushWithSendingId(e,t,s,i){const r=await this.put(this.ENDPOINT_INBOX_NOTIFICATIONS_WITH_SENDINGID,e.putInboxWithSendingId());return this.getNotificationResponseStatus(r,t,s,i),!0}async getInboxCounter(e,t,s){const i=await this.get(this.ENDPOINT_INBOX_COUNTER,e.getCounter());this.getCounterStatus(i,t,s)}async getInboxResponseStatus(e,t,s){if(e&&!(e instanceof a)&&e.statusCode>=200&&e.statusCode<300){const s=new L(e.data);c.isFunction(t)&&t(s)}else e?c.isFunction(s)&&s(e):c.isFunction(s)&&s()}async getInboxResponseEdit(e,t,s){e&&!(e instanceof a)&&e.statusCode>=200&&e.statusCode<300?c.isFunction(t)&&t():e?c.isFunction(s)&&s(e):c.isFunction(s)&&s()}getNotifications(e,t){const s=[];for(let i=0;i<e.length;i++){null!=e[i].sentAt&&null!=t&&e[i].sentAt<t&&(read=!0);const r=new InboxNotification(e[i],t);s.push(r)}return s}async getNotificationResponseStatus(e,t,s,r){if(e&&!(e instanceof a)&&e.statusCode>=200&&e.statusCode<300){const e=new InboxNotification(notifications[i],t);c.isFunction(s)&&s(e)}else e?c.isFunction(r)&&r(e):c.isFunction(r)&&r()}async getCounterStatus(e,t,s){if(e&&!(e instanceof a)&&e.statusCode>=200&&e.statusCode<300){const s={click:e.data.click,sent:e.data.sent,deleted:e.data.deleted,unread:this.getUnreadCounters(e.data.unread)};c.isFunction(t)&&t(s)}else e?c.isFunction(s)&&s(e):c.isFunction(s)&&s()}getUnreadCounters(e){return{count:e.count,lastAccess:e.lastAccess}}},{BaseRequest:E}=s(57).Core.Api,h=class extends E{constructor(){super()}postInboxAuth(){return this.body=this.json,this}setJson(e){this.json=e}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}},I=Object.freeze({SENT:"sent",CLICK:"click",DELETED:"deleted"});window.inboxStatus=I;const d=I,u=Object.freeze({NONE:"none",DEFAULT:"default",WEBHOOK:"webhook"}),{BaseRequest:g}=s(57).Core.Api,R=class extends g{constructor(){super(),null!=t.getExternalId()&&(this.externalId=t.getExternalId()),null!=t.getAuthToken()&&t.getInboxAuthMode()==u.WEBHOOK&&(this.headers.Authorization="Bearer "+t.getAuthToken()),this.sendingId="",this.sendingIds=null,this.page=0,this.pageSize=0,this.dateFrom="",this.dateTo="",this.status=d.INBOXSTATUS_SENT,this.statusList=null}getInboxPushRequest(){return this.params=this.createQueryString(),this}putInboxPushRequest(){return this.params=this.createQueryStringExternalId(),this.body=this.createBodyJson(),this}getInboxPushRequestWithSendingId(){return this.pathParams["{sendingId}"]=this.sendingId,this.params=this.createQueryStringExternalId(),this}putInboxWithSendingId(){return this.pathParams["{sendingId}"]=this.sendingId,this.params=this.createQueryStringExternalId(),this.body=this.createBodyStatusJson(),this}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}createQueryString(){let e="";if(this.page&&(e+=this.PARAM_INBOX_PAGE+"="+this.page+"&"),this.pageSize&&(e+=this.PARAM_INBOX_PAGE_SIZE+"="+this.pageSize+"&"),this.dateFrom&&(e+=this.PARAM_INBOX_DATE_FROM+"="+this.dateFrom+"&"),this.dateTo&&(e+=this.PARAM_INBOX_DATE_TO+"="+this.dateTo+"&"),this.statusList){let t="";for(let e=0;e<this.statusList.length;e++)t+=this.statusList[e],e!=this.statusList.length-1&&(t+=",");e+=this.PARAM_INBOX_STATUS+"="+t+"&"}return e+this.createQueryStringExternalId()}createQueryStringExternalId(){return this.PARAM_INBOX_EXTERNALID+"="+this.externalId}createBodyJson(){let e={};const t=[];try{if(e=this.createBodyStatusJson(),this.sendingIds)for(let e=0;e<this.sendingIds.length;e++)t.push(this.sendingIds[e]);e.sendingIds=t}catch(e){console.log("Error Inbox request :"+e)}return e}createBodyStatusJson(){const e={};return this.status&&(e.status=this.status),e}setSendingId(e){this.sendingId=e}setSendingIds(e){this.sendingIds=e}setPage(e){this.page=e}setPageSize(e){this.pageSize=e}setDateFrom(e){this.dateFrom=e}setDateTo(e){this.dateTo=e}setStatus(e){this.status=e}setStatusList(e){this.statusList=e}},{BaseRequest:_}=s(57).Core.Api,p=class extends _{constructor(){super(),null!=t.getExternalId()&&(this.externalId=t.getExternalId()),null!=t.getAuthToken()&&t.getInboxAuthMode()==u.WEBHOOK&&(this.headers.Authorization="Bearer "+t.getAuthToken())}getCounter(){return this.params=this.createQueryStringExternalId(),this}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}createQueryStringExternalId(){return this.PARAM_INBOX_EXTERNALID+"="+this.externalId}};class T{constructor(e,t){e&&(e.id&&(this.id=e.id),e.externalId&&(this.externalId=e.externalId),e.sentAt&&(this.sentAt=e.sentAt),e.status&&(this.status=e.status),e.sendingId&&(this.sendingId=e.sendingId),e.message&&(this.message=e.message),e.campaignId&&(this.campaignId=e.campaignId),this.read=!1,this.sentAt&&t&&this.sentAt<t&&(this.read=!0))}}window.inboxNotification=T;const A=T,{ErrorDictionary:S}=s(57).Core.Models,O=S.ErrorCode;Object.assign(O,{INBOX_GET_ERROR:3001,INBOX_GET_PAGE_ERROR:3011,INBOX_EXTERNAL_ID_NO_REGISTERED:3012,INBOX_NO_MESSAGES:3013,INBOX_IS_REQUESTING_PAGE:3014,INBOX_EMPTY:3015,INBOX_GENERAL_ERROR:3600});const P=S.ErrorMessage;Object.assign(P,{INBOX_GET_ERROR:"inbox GET request error",INBOX_GET_PAGE_ERROR:"error inbox get page",INBOX_EXTERNAL_ID_NO_REGISTERED:"external Id is not registered",INBOX_NO_MESSAGES:"There are no more messages on Inbox",INBOX_IS_REQUESTING_PAGE:"Wait. Is Requesting new page",INBOX_EMPTY:"There are no messages on Inbox",INBOX_GENERAL_ERROR:"general error"});const m={ErrorCode:O,ErrorMessage:P},{Validations:N,Log:y}=s(57).Core.Utils,w=class extends N{static isAppKeyFormat(){const e=t.getAppKey();return null!=e&&""!=e&&"null"!=e&&e.length>3}static isValidFormatRequest(){const e=new y("[IND]InboxValidations: "),s=t.getDeviceId();let i=!0;return this.isAppKeyFormat()||(i=!1,e.w("appKey is null or empty").writeLog()),this.isValidFormat(s)||(i=!1,e.w("deviceId is null or empty").writeLog()),i}},{CommonUtils:C,ErrorUtils:D,Log:b}=s(57).Core.Utils;class f{constructor(e){if(e){if(e.lastAccess&&(this.lastAccess=e.lastAccess),e.numPage?this.page=e.numPage:this.page=0,e.pageSize&&(this.pageSize=e.pageSize),e.count&&(this.count=e.count),e.notifications){this.notifications=[];const t=e.notifications;for(let e=0;e<t.length;e++){const s=new A(t[e],this.lastAccess);this.notifications.push(s)}}this.totalPages=Math.trunc(this.count/this.pageSize)}this.dateFrom=null,this.dateTo=null,this.statusList=null,this.newNotifications=[A],this.isRequestingPage=!1}static generateAuthToken(e,t){let s={};navigator.indigitallGetAuthConfig&&C.isFunction(navigator.indigitallGetAuthConfig)&&(s=navigator.indigitallGetAuthConfig());const i=new h;i.setJson(s),l.postInboxAuth(i,e,t)}static getMessagesCountWithAuth(e,t,s){C.isFunction(e.getAuthConfig)&&(navigator.indigitallGetAuthConfig=getAuthConfig),f.getMessagesCount(t,s)}static setUrlInboxApi(e){t.setUrlInboxApi(e)}static setInboxAuthMode(e){t.setInboxAuthMode(e)}static getMessagesCount(e,s){if(w.isValidFormatRequest())if(w.isValidFormat(t.getExternalId())){const t=new p;l.getInboxCounter(t,e,(s=>{401===s.errorCode?this.generateAuthToken((()=>{l.getInboxCounter(t,e,s)}),s):C.isFunction(s)&&s(s)}))}else C.isFunction(s)&&s(D.showError(m,m.ErrorCode.INBOX_GET_ERROR));else C.isFunction(s)&&s(D.showError(m,m.ErrorCode.GENERAL_ERROR_BAD_REQUEST))}static getInboxWithAuth(e,t,s){C.isFunction(e.getAuthConfig)&&(navigator.indigitallGetAuthConfig=getAuthConfig),f.getInbox(t,s)}static getInbox(e,t){f.getInboxWithPage(null,null,null,null,null,e,t)}static getInboxWithPageAuth(e,t,s,i,r,n,o,a){C.isFunction(e.getAuthConfig)&&(navigator.indigitallGetAuthConfig=getAuthConfig),f.getInboxWithPage(t,s,i,r,n,o,a)}static getInboxWithPage(e,s,i,r,n,o,a){if(w.isValidFormatRequest())if(w.isValidFormat(t.getExternalId())){const t=new R;e&&t.setPage(e),s&&t.setPageSize(s),i&&(t.setDateFrom(i),this.dateFrom=i),r&&(t.setDateTo(r),this.dateTo=r),n&&(t.setStatusList(n),this.statusList=n),l.getInbox(t,(e=>{this.totalPages=e.totalPages,0!=e.count?C.isFunction(o)&&o(e):C.isFunction(a)&&a(D.showError(m,m.ErrorCode.INBOX_GET_PAGE_ERROR))}),(e=>{401==e.errorCode?this.generateAuthToken((()=>{l.getInbox(t,(e=>{this.totalPages=e.totalPages,C.isFunction(o)&&o(e)}),e)}),e):C.isFunction(e)&&e(e)}))}else C.isFunction(a)&&a(D.showError(m,m.ErrorCode.INBOX_EXTERNAL_ID_NO_REGISTERED));else C.isFunction(a)&&a(D.showError(m,m.ErrorCode.GENERAL_ERROR_BAD_REQUEST))}getNextPage(e,s){const i=new b("[IND]Inbox: ");if(this.isRequestingPage)i.w(m.ErrorMessage.INBOX_IS_REQUESTING_PAGE).writeLog();else if(this.isRequestingPage=!0,this.page+1<this.totalPages)if(w.isValidFormatRequest())if(w.isValidFormat(t.getExternalId())){const t=new R;(this.page||0==this.page)&&t.setPage(this.page+1),this.pageSize&&t.setPageSize(this.pageSize),this.dateFrom&&t.setDateFrom(this.dateFrom),this.dateTo&&t.setDateTo(this.dateTo),this.statusList&&t.setStatusList(this.statusList),l.getInbox(t,(t=>{this.notifications=this.notifications.concat(t.notifications),this.newNotifications=t.notifications,this.lastAccess=t.lastAccess,this.count=t.count,this.page=t.page,this.pageSize=t.pageSize,this.totalPages=t.totalPages,this.isRequestingPage=!1,C.isFunction(e)&&e(this,this.newNotifications)}),(s=>{401===s.errorCode?this.generateAuthToken((()=>{l.getInbox(t,(t=>{this.notifications=this.notifications.concat(t.notifications),this.newNotifications=t.notifications,this.lastAccess=t.lastAccess,this.count=t.count,this.page=t.page,this.pageSize=t.pageSize,this.totalPages=t.totalPages,this.isRequestingPage=!1,C.isFunction(e)&&e(this,this.newNotifications)}),s)}),s):(this.isRequestingPage=!1,C.isFunction(s)&&s())}))}else this.isRequestingPage=!1,C.isFunction(s)&&s(D.showError(m,m.ErrorCode.INBOX_EXTERNAL_ID_NO_REGISTERED));else C.isFunction(s)&&s(D.showError(m,m.ErrorCode.GENERAL_ERROR_BAD_REQUEST));else this.isRequestingPage=!1,C.isFunction(s)&&s(D.showError(m,m.ErrorCode.INBOX_NO_MESSAGES))}massiveEditNotifications(e,s,i,r){if(w.isValidFormatRequest())if(w.isValidFormat(t.getExternalId())){if(e&&s){const t=new R;t.setSendingIds(e),t.setStatus(s),l.putInboxPush(t,i,(e=>{401===e.errorCode?this.generateAuthToken((()=>{l.putInboxPush(t,i,e)}),e):C.isFunction(e)&&e(e)}))}}else C.isFunction(r)&&r(D.showError(m,m.ErrorCode.INBOX_EXTERNAL_ID_NO_REGISTERED));else C.isFunction(r)&&r(D.showError(m,m.ErrorCode.BAD_REQUEST_SERVER_ERROR))}getInfoFromNotification(e,s,i){if(w.isValidFormatRequest())if(w.isValidFormat(t.getExternalId())){if(e){const t=new R;t.setSendingId(e),l.getInboxPushWithSendingId(t,this.lastAccess,s,(e=>{401===e.errorCode?this.generateAuthToken((()=>{l.getInboxPushWithSendingId(t,this.lastAccess,s,e)}),e):C.isFunction(e)&&e(e)}))}}else C.isFunction(i)&&i(D.showError(m,m.ErrorCode.INBOX_EXTERNAL_ID_NO_REGISTERED));else C.isFunction(i)&&i(D.showError(m,m.ErrorCode.BAD_REQUEST_SERVER_ERROR))}modifyStatusFromNotification(e,s,i,r){if(w.isValidFormatRequest())if(w.isValidFormat(t.getExternalId())){if(e&&s){const t=new R;t.setSendingId(e),t.setStatus(s),l.putInboxPushWithSendingId(t,this.lastAccess,i,(e=>{401===e.errorCode?this.generateAuthToken((()=>{l.putInboxPushWithSendingId(t,this.lastAccess,i,e)}),e):C.isFunction(e)&&e(e)}))}}else C.isFunction(r)&&r(D.showError(m,m.ErrorCode.INBOX_EXTERNAL_ID_NO_REGISTERED));else C.isFunction(r)&&r(D.showError(m,m.ErrorCode.BAD_REQUEST_SERVER_ERROR))}}const L=f})(),r})(),e.exports=t()},867:function(e){var t;t=()=>(()=>{var e={923:function(e){var t;t=()=>(()=>{"use strict";var e={147:e=>{e.exports=JSON.parse('{"name":"indigitall-web-core","description":"indigitall web core","version":"4.3.1","main":"index.js","author":"Smart2me S.L.","homepage":"https://indigitall.com","devDependencies":{"@babel/preset-env":"^7.18.10","babel-loader":"^8.2.5","filemanager-webpack-plugin":"^7.0.0","idempotent-babel-polyfill":"^7.4.4","script-loader":"^0.7.2","webpack":"^5.74.0","webpack-bundle-analyzer":"^4.6.1","webpack-cli":"^4.10.0"},"scripts":{"test":"echo \'There are not tests\'","public":"ws --directory ./public --port 80 --log.format dev","build":"webpack --config webpack.config.js --mode=production","build-dev":"webpack --config webpack.config.js --watch --mode=development","delete-node-modules":"rm -rf node_modules/ && rm -f package-lock.json","install-core":"npm install && npm run build"}}')}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,s),n.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{s.r(i),s.d(i,{default:()=>V});var e={};s.r(e),s.d(e,{BaseClient:()=>S,BaseRequest:()=>O});var t={};s.r(t),s.d(t,{Channel:()=>P,Device:()=>m,DeviceStatus:()=>N,ErrorDictionary:()=>A,ErrorModel:()=>p,EventType:()=>y,TopicSubscribeType:()=>w});var r={};s.r(r),s.d(r,{CommonUtils:()=>C,CorePermissions:()=>D,CryptoUtils:()=>v,ErrorUtils:()=>T,JsonUtils:()=>B,Log:()=>_,LogLevel:()=>u,TopicUtils:()=>M,Validations:()=>U});var n={platform:"webpush",version:"0.0.1"};const o=s(147);n.version=o.version;const a=n=Object.assign(n,{client:{URL_BASE:"https://device-api.indigitall.com/v1",URL_DEVICE_V2:"https://device-api.indigitall.com/v2",INAPP_URL_BASE:"https://inapp-api.indigitall.com/v1",INBOX_URL_BASE:"https://inbox-api.indigitall.com/v1",CUSTOMER_URL_BASE:"https://device-api.indigitall.com/v2"}}),c=new class{constructor(){this.storage=this.isLocalStorageAvailable()?window.localStorage:null}isLocalStorageAvailable(){try{const e=window.localStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==c.length}return!1}setItem(e,t){return null!=this.storage&&(this.storage.setItem(e,t),!0)}getItem(e){return null!=this.storage?this.storage.getItem(e):null}deleteItem(e){return!!this.storage&&(this.storage.setItem(e,value),!0)}clear(){this.storage&&this.storage.clear()}},l=c,E=new class{constructor(){this.TAG="[IND]IndexedDB: ",this.DB_NAME="indigitall.indexedDB",this.DB_VERSION=1,this.DB_STORE_NAME="indigitallStore",this.DB_STORE_MODE="readwrite",this.DB_KEY_PATH="id",this.DB_STORE_INDEX="storeIndex",this.IDB=indexedDB||mozzIndexedDB||webkitIndexedDB||msIndexedDB}async getDB(){return new Promise(((e,t)=>{const s=this.IDB;if(s){const i=s.open("indigitall.indexedDB",1);i.onupgradeneeded=function(){i.result.createObjectStore("indigitallStore").createIndex("storeIndex","store.key")},i.onsuccess=function(){const t=i.result,s=t.transaction("indigitallStore","readwrite"),r=s.objectStore("indigitallStore"),n=r.index("storeIndex");e({db:t,tx:s,store:r,index:n})},i.onerror=function(e){t(e)}}else t(!1)}))}async get(e,t){return new Promise(((s,i)=>{e||i(!1),e.index.get(t).onsuccess=t=>{t.target.result&&(this.close(e),s(t.target.result.store.value)),i(!1)}}))}async put(e,t,s){return new Promise(((i,r)=>{e||r(!1),e.store.put({store:{key:t,value:s}},t).onsuccess=t=>{this.close(e),i(s)}}))}close(e){if(e.tx)try{e.tx.oncomplete=()=>{e.db.close()}}catch(e){console.error(this.TAG,e)}}async setItem(e,t){try{const s=await this.getDB();return this.put(s,e,t)}catch(e){return e}}async getItem(e){try{const t=await this.getDB();return this.get(t,e)}catch(e){return e}}},h=new class{constructor(){this.SESSION="indigitall.session.storage",this.session=this.isSessionStorageAvailable()?window.sessionStorage:null}isSessionStorageAvailable(){try{const e=window.sessionStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==h.length}return!1}getItem(e){return null!=this.session?this.session.getItem(e):null}setItem(e,t){return null!=this.session&&(this.session.setItem(e,t),!0)}clearMessages(){this.session&&this.session.removeItem("messages")}},I=h,d=class{constructor(){this.storage=l,this.db=E,this.BASE_TIME=60,this.REPOSITORY="indigitall.repository",this.APP_KEY=this.REPOSITORY+".APP_KEY",this.VAPID_PUBLIC=this.REPOSITORY+".VAPID_PUBLIC",this.ENABLED=this.REPOSITORY+".ENABLED",this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID",this.SERVICE_SYNC_TIME=this.REPOSITORY+".SERVICE_SYNC_TIME",this.LOCATION_ENABLED=this.REPOSITORY+".LOCATION_ENABLED",this.LOCATION_UPDATE_MINUTES=this.REPOSITORY+".LOCATION_UPDATE_MINUTES",this.REQUEST_LOCATION=this.REPOSITORY+".REQUEST_LOCATION",this.BROWSER_PUBLIC_KEY=this.REPOSITORY+".BROWSER_PUBLIC_KEY",this.BROWSER_PRIVATE_KEY=this.REPOSITORY+".BROWSER_PRIVATE_KEY",this.PLATFORM=this.REPOSITORY+".PLATFORM",this.BROWSER_NAME=this.REPOSITORY+".BROWSER_NAME",this.BROWSER_VERSION=this.REPOSITORY+".BROWSER_VERSION",this.OS_NAME=this.REPOSITORY+".OS_NAME",this.OS_VERSION=this.REPOSITORY+".OS_VERSION",this.DEVICE_TYPE=this.REPOSITORY+".DEVICE_TYPE",this.SUPPORTED=this.REPOSITORY+".SUPPORTED",this.SERVICE_TIMESTAMP=this.REPOSITORY+".SERVICE_TIMESTAMP",this.LOCATION_TIMESTAMP=this.REPOSITORY+".LOCATION_TIMESTAMP",this.PERMISSION_LOCATION=this.REPOSITORY+".PERMISSION_LOCATION",this.SET_LOG_DEBUG=this.REPOSITORY+".SET_LOG_DEBUG",this.NEW_USER_TIMESTAMP=this.REPOSITORY+".NEW_USER_TIMESTAMP",this.EXTERNAL_ID=this.REPOSITORY+".EXTERNAL_ID",this.REGISTERED_BY_COOKIE=this.REPOSITORY+".REGISTERED_BY_COOKIE",this.LOG_LEVEL=this.REPOSITORY+".LOG_LEVEL",this.LATITUDE=this.REPOSITORY+".LATITUDE",this.LONGITUDE=this.REPOSITORY+".LONGITUDE",this.TOPIC_LIST=this.REPOSITORY+".TOPIC_LIST",this.INAPP_ENABLED=this.REPOSITORY+".INAPP_ENABLED",this.URL_INAPP_API=this.REPOSITORY+".URL_INAPP_API",this.INAPP_TOPICS=this.REPOSITORY+".INAPP_TOPICS"}setItemSessionStorage(e,t){I.setItem(e,t)}getItemSessionStorage(e){return I.getItem(e)}clearSessionStorage(){I.clearMessages()}setStorage(e,t){l.setItem(e,t)}getStorage(e){return l.getItem(e)}clearStorage(){l.clear()}setBrowserPublicKey(e){l.setItem(this.BROWSER_PUBLIC_KEY,e)}getBrowserPublicKey(){return l.getItem(this.BROWSER_PUBLIC_KEY)}setBrowserPrivateKey(e){l.setItem(this.BROWSER_PRIVATE_KEY,e)}getBrowserPrivateKey(){return l.getItem(this.BROWSER_PRIVATE_KEY)}async setAppKey(e){l.setItem(this.APP_KEY,e),E&&E.IDB&&await E.setItem(this.APP_KEY,e)}getAppKey(){return l.getItem(this.APP_KEY)}async getAppKeySync(){if(E&&E.IDB)return await E.getItem(this.APP_KEY)}setVAPID(e){l.setItem(this.VAPID_PUBLIC,e)}getVAPID(){return l.getItem(this.VAPID_PUBLIC)}setEnabled(e){l.setItem(this.ENABLED,e)}getEnabled(){return l.getItem(this.ENABLED)}setServiceSyncTime(e){l.setItem(this.SERVICE_SYNC_TIME,e*this.BASE_TIME)}getServiceSyncTime(){return l.getItem(this.SERVICE_SYNC_TIME)||1*this.BASE_TIME}setLocationEnabled(e){l.setItem(this.LOCATION_ENABLED,e)}getLocationEnabled(){return l.getItem(this.LOCATION_ENABLED)}setLocationUpdateMinutes(e){l.setItem(this.LOCATION_UPDATE_MINUTES,e)}getLocationUpdateMinutes(){return l.getItem(this.LOCATION_UPDATE_MINUTES)||30}async setRequestLocation(e){l.setItem(this.REQUEST_LOCATION,e)}getRequestLocation(){return!!l&&l.getItem(this.REQUEST_LOCATION)}async setPlatform(e){l.setItem(this.PLATFORM,e)}getPlatform(){return l&&l.getItem(this.PLATFORM)||a.platform}getVersion(){return a.version}async setBrowserName(e){l.setItem(this.BROWSER_NAME,e)}getBrowserName(){return l.getItem(this.BROWSER_NAME)}setBrowserVersion(e){l.setItem(this.BROWSER_VERSION,e)}getBrowserVersion(){return l.getItem(this.BROWSER_VERSION)}async setOsName(e){l.setItem(this.OS_NAME,e)}getOsName(){return l.getItem(this.OS_NAME)}setOsVersion(e){l.setItem(this.OS_VERSION,e)}getOsVersion(){return l.getItem(this.OS_VERSION)}setDeviceType(e){l.setItem(this.DEVICE_TYPE,e)}getDeviceType(){return l.getItem(this.DEVICE_TYPE)}setSupported(e){l.setItem(this.SUPPORTED,e)}getSupported(){return l.getItem(this.SUPPORTED)}setServiceTimestamp(e){l.setItem(this.SERVICE_TIMESTAMP,e)}getServiceTimestamp(){return l.getItem(this.SERVICE_TIMESTAMP)}setLocationTimestamp(e){l.setItem(this.LOCATION_TIMESTAMP,e)}getLocationTimestamp(){return l.getItem(this.LOCATION_TIMESTAMP)}setPermissionLocation(e){l.setItem(this.PERMISSION_LOCATION,e)}getPermissionLocation(){return l.getItem(this.PERMISSION_LOCATION)}setDebugLog(e){l.setItem(this.SET_LOG_DEBUG,e)}getDebugLog(){return"false"!==l.getItem(this.SET_LOG_DEBUG)}setLogLevel(e){l.setItem(this.LOG_LEVEL,e)}getLogLevel(){return l.getItem(this.LOG_LEVEL)}setNewUserTimestamp(e){l.setItem(this.NEW_USER_TIMESTAMP,e)}getNewUserTimestamp(){return l.getItem(this.NEW_USER_TIMESTAMP)}async setExternalIdRequest(e){l&&l.isLocalStorageAvailable()&&l.setItem(this.EXTERNAL_ID,e),E&&E.IDB&&await E.setItem(this.EXTERNAL_ID,e)}async getExternalIdRequest(){let e;try{l&&l.isLocalStorageAvailable()?e=l.getItem(this.EXTERNAL_ID):E&&E.IDB&&(e=await E.getItem(this.EXTERNAL_ID))}catch(e){}return e}setExternalId(e){l.setItem(this.EXTERNAL_ID,e)}getExternalId(){return l.getItem(this.EXTERNAL_ID)}async getRegisteredByCookie(){return l.getItem(this.REGISTERED_BY_COOKIE)}async setRegisteredByCookie(e){l.setItem(this.REGISTERED_BY_COOKIE,e)}setLatitude(e){l.setItem(this.LATITUDE,e)}getLatitude(){return l.getItem(this.LATITUDE)}setLongitude(e){l.setItem(this.LONGITUDE,e)}getLongitude(){return l.getItem(this.LONGITUDE)}async setInAppTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.INAPP_TOPICS,e)}async getInAppTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.INAPP_TOPICS))}catch(e){}return e}async setTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.TOPIC_LIST,e)}async getTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.TOPIC_LIST))}catch(e){}return e}getUrlInappApi(){return this.getStorage(this.URL_INAPP_API)}setUrlInappApi(e){this.setStorage(this.URL_INAPP_API,e)}setInAppEnabled(e){this.setStorage(this.INAPP_ENABLED,e)}isInAppEnabled(){return this.getStorage(this.INAPP_ENABLED)}},u=Object.freeze({DEBUG:1,INFO:2,WARNING:3,ERROR:4}),g=u;class R{constructor(e){this.tag="[IND]",e&&(this.tag=e),this.level=g.INFO,this.setLogLevel((new d).getLogLevel()),this.log=[]}setLogLevel(e){e&&e>=g.DEBUG&&e<=g.ERROR&&(this.level=e)}static addedAsString(e){return"string"==typeof e?e:JSON.stringify(e,null,2)}d(){if(this.level<=g.DEBUG)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}i(){if(this.level<=g.INFO)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}w(){if(this.level<=g.WARNING)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}e(){if(this.level<=g.ERROR)if(1==arguments.length&&arguments.errorCode)this.log+=`${error.errorCode}: ${error.errorMessage}`;else for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}writeLog(){this.log.length>0&&this.tag&&this.log&&console.log(this.tag,this.log),this.log=[]}}const _=R,p=class{constructor(e,t,s){this.errorCode=e,this.errorMessage=t,null!=s&&(this.exceptionMessage=s)}},T=new class{constructor(){}showError(e,t,s){if(null!=e){const i=Object.values(e.ErrorCode).indexOf(t);return i>=0?new p(Object.keys(e.ErrorCode)[i],Object.keys(e.ErrorMessage)[i],s):new p(GENERAL_ERROR,"general error",s)}}},A={ErrorCode:{GENERAL_ERROR:600,API_SERVER_ERROR:500,API_PARAMETER_MISSING:400,API_APPKEY_NOT_VALID:401,API_FORBIDDEN_REQUEST:403,API_DEVICE_NOT_FOUND:404,API_TOPICS_ARE_INSERTED:409,BAD_REQUEST_SERVER_ERROR:410},ErrorMessage:{GENERAL_ERROR:"General Error",API_SERVER_ERROR:"Error server response",API_PARAMETER_MISSING:"Api parameter missing",API_APPKEY_NOT_VALID:"appKey is not valid",API_FORBIDDEN_REQUEST:"forbidden request",API_DEVICE_NOT_FOUND:"device not found",API_TOPICS_ARE_INSERTED:"topics are inserted",BAD_REQUEST_SERVER_ERROR:"bad request"}},S=class{constructor(){this.URL_BASE="",this.GET="GET",this.POST="POST",this.PUT="PUT",this.DELETE="DELETE"}async getURL(){return this.URL_BASE}async call(e,t,s,i){const r=new _("[IND]BaseClient: ");s.isServiceWorkerRequest()&&r.setLogLevel(g.DEBUG);let n=await this.getURL()+s.getPath(t)+s.getParams();s.isJourneyRequest()&&(n=n.replace("v1","v2"));const o={method:e,headers:s.addHeaders()};e!==this.GET&&(o.body=JSON.stringify(s.getBody())),i&&(o.credentials=i);try{const t=await fetch(n,o),i=await t.json();return t.ok?(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\nResponse Body:",JSON.stringify(i.data,null,"\t")).writeLog(),i):(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\n").writeLog(),new p(i.statusCode,i.message))}catch(t){return r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Error: "+t).writeLog(),T.showError(A,A.ErrorCode.GENERAL_ERROR,t)}}async get(e,t){return await this.call(this.GET,e,t)}async post(e,t,s){return await this.call(this.POST,e,t,s)}async put(e,t,s){return await this.call(this.PUT,e,t,s)}async delete(e,t){return await this.call(this.DELETE,e,t)}},O=class{constructor(){this.PARAM_APP_KEY="appKey",this.PARAM_DEVICE_ID="deviceId",this.PARAM_PUSH_TOKEN="pushToken",this.PARAM_ENABLED="enabled",this.PARAM_PLATFORM="platform",this.PARAM_VERSION="version",this.PARAM_TOPICS="topics",this.PARAM_EVENT_TYPE="eventType",this.PARAM_PUSH_ID="pushId",this.PARAM_CLICKED_BUTTON="clickedButton",this.PARAM_PERMISSION_TYPE="permissionType",this.PARAM_LATITUDE="latitude",this.PARAM_LONGITUDE="longitude",this.PARAM_INAPP_ID="inAppId",this.PARAM_INAPP_EVENT_TYPE="eventType",this.PARAM_INAPP_CLICKED_BUTTON="clickedButton",this.PARAM_INAPP_LAST_VERSION_ID="lastVersionId",this.PARAM_INBOX_EXTERNALID="externalId",this.PARAM_INBOX_PAGE="page",this.PARAM_INBOX_PAGE_SIZE="pageSize",this.PARAM_INBOX_DATE_FROM="dateFrom",this.PARAM_INBOX_DATE_TO="dateTo",this.PARAM_INBOX_STATUS="status",this.PARAM_INBOX_SENDER_IDS="sendingIds",this.PARAM_CUSTOMER_ID="customerId",this.PARAM_CUSTOMER_FIELD_NAMES="fieldNames",this.PARAM_CUSTOMER_FIELDS="fields",this.PARAM_CUSTOMER_LINK="link",this.PARAM_CUSTOMER_CHANNEL="channel",this.appKey=(new d).getAppKey(),this.params=null,this.pathParams={},this.headers={}}getParams(){return"?"+this.PARAM_APP_KEY+"="+this.appKey+(this.params?"&"+this.params:"")}getBody(){return this.body?this.body:""}getPath(e){let t=e;return Object.keys(this.pathParams).forEach((e=>{t=t.replace(e,this.pathParams[e])})),t}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}isServiceWorkerRequest(){return this.serviceWorkerRequest}setServiceWorkerRequest(e){this.serviceWorkerRequest=e}isJourneyRequest(){return this.journeyRequest}setJourneyRequest(e){this.journeyRequest=e}},P=Object.freeze({PUSH:"push",INAPP:"inapp",CHAT:"chat"}),m=class{constructor(e=null,t){null==e?(this.browserPublicKey=(new d).getBrowserPublicKey(),this.browserPrivateKey=(new d).getBrowserPrivateKey(),this.platform=(new d).getPlatform(),this.version=(new d).getVersion(),this.browserName=(new d).getBrowserName(),this.browserVersion=(new d).getBrowserVersion(),this.osName=(new d).getOsName(),this.osVersion=(new d).getOsVersion(),this.deviceType=(new d).getDeviceType(),(new d).getEnabled()&&(this.enabled="true"===(new d).getEnabled()),(new d).getExternalId()&&(this.externalCode=(new d).getExternalId())):t?(e.enabled&&(this.enabled=e.enabled,(new d).setEnabled(this.enabled)),e.registeredByCookie&&(this.registeredByCookie=e.registeredByCookie,(new d).setRegisteredByCookie(this.registeredByCookie))):(e.browserPublicKey&&(this.browserPublicKey=e.browserPublicKey),e.browserPrivateKey&&(this.browserPrivateKey=e.browserPrivateKey),e.platform&&(this.platform=e.platform),e.version&&(this.version=e.version),e.osVersion&&(this.osVersion=e.osVersion),e.browserName&&(this.browserName=e.browserName),e.browserVersion&&(this.browserVersion=e.browserVersion),e.osName&&(this.osName=e.osName),e.deviceType&&(this.deviceType=e.deviceType),e.enabled&&(this.enabled=e.enabled),e.externalCode&&(this.externalCode=e.externalCode)),this.platform&&(this.productName=this.platform),this.version&&(this.productVersion=this.version),navigator&&"language"in navigator&&(this.locale=navigator.language),Intl&&"DateTimeFormat"in Intl&&(this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone),this.timeOffset=-(new Date).getTimezoneOffset()}getDeviceId(){return this.deviceId}setDeviceId(e){this.deviceId=e}setExternalCode(e){this.externalCode=e}toJSON(){const e={};return this.platform&&(e.platform=this.platform),this.version&&(e.version=this.version),this.productName&&(e.productName=this.productName),this.productVersion&&(e.productVersion=this.productVersion),this.browserName&&(e.browserName=this.browserName),this.browserVersion&&(e.browserVersion=this.browserVersion),this.osName&&(e.osName=this.osName),this.osVersion&&(e.osVersion=this.osVersion),this.deviceType&&(e.deviceType=this.deviceType),this.locale&&(e.locale=this.locale),this.timeZone&&(e.timeZome=this.timeZone),this.timeOffset&&(e.timeOffset=this.timeOffset),this.enabled&&(e.enabled=this.enabled),this.browserPublicKey&&(e.browserPublicKey=this.browserPublicKey),this.browserPrivateKey&&(e.browserPrivateKey=this.browserPrivateKey),this.externalCode&&(e.externalCode=this.externalCode),e}},N=Object.freeze({DEFAULT:-1,ENABLE:1,DISABLE:0}),y=Object.freeze({EVENT_TYPE_CLICK:"click",EVENT_TYPE_RECEIVE:"receive",EVENT_TYPE_UPDATE:"update",EVENT_TYPE_ACCEPT:"accept",EVENT_TYPE_REJECT:"reject",EVENT_TYPE_ASK:"ask"}),w=Object.freeze({SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe"}),C=class{static isServiceTimestampExceed(){return!(new d).getServiceTimestamp()||(new d).getServiceSyncTime()<=(Date.now()-(new d).getServiceTimestamp())/6e4}static isFunction(e){return!(!e||"function"!=typeof e)}},D=class{static async getPermissions(){const e=await this.getPermission("geolocation"),t={};return e&&(t.location=e.state),t}static async getPermission(e){try{if(navigator&&navigator.permissions&&navigator.permissions.query&&e)return await navigator.permissions.query({name:e,userVisibleOnly:!0})}catch(e){return null}return null}static async setPermissionsCallback(){await this.setCallback("geolocation",navigator.indigitallRequestLocationPermission)}static async setCallback(e,t){const s=await this.getPermission(e);if(s){let i=s.state;"onchange"in s&&(s.onchange=()=>{new _("[IND]CorePermissions: ").d(e+" permission state has changed from "+i+" to "+s.state).writeLog(),i=s.state,t&&t({name:e,state:s.state})})}}},b=new _("[IND]Crypto"),f=new TextEncoder("utf-8"),L="HMAC",v=class{static async createHmac(e,t){try{const s=window?.crypto?.subtle;if(!s)return;const i=await s.importKey("raw",f.encode(e),{name:L,hash:{name:"SHA-256"}},!1,["sign","verify"]),r=await s.sign(L,i,f.encode(t)),n=new Uint8Array(r),o=Array.prototype.map.call(n,(e=>("00"+e.toString(16)).slice(-2))).join("");return b.d("hmac: ",o).writeLog(),o}catch(e){return void b.e("error:",e).writeLog()}}},B=class{static compareJSON(e,t){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const i of s)if(e[i]!==t[i]){if("object"!=typeof e[i]||"object"!=typeof t[i])return!1;if(!isEqual(e[i],t[i]))return!1}return!0}},U=class{static isValidFormat(e){return null!=e&&""!=e&&"null"!=e&&e.length>8}},M=class{static setTopicChannel(e,t){const s=[];for(let i=0;i<e.length;i++){const r=e[i];r.channel=t,s.push(r)}return s}},V={Repository:d,Config:a,Api:e,Models:t,Utils:r}})(),i})(),e.exports=t()},916:(e,t,s)=>{"use strict";s.d(t,{Core:()=>x});var i={};s.r(i),s.d(i,{BaseClient:()=>O,BaseRequest:()=>P});var r={};s.r(r),s.d(r,{Channel:()=>m,Device:()=>N,DeviceStatus:()=>y,ErrorDictionary:()=>S,ErrorModel:()=>T,EventType:()=>w,TopicSubscribeType:()=>C});var n={};s.r(n),s.d(n,{CommonUtils:()=>D,CorePermissions:()=>b,CryptoUtils:()=>B,ErrorUtils:()=>A,JsonUtils:()=>U,Log:()=>p,LogLevel:()=>g,TopicUtils:()=>V,Validations:()=>M}),s(923);var o={platform:"webpush",version:"0.0.1"};const a=s(391);o.version=a.version;const c=o=Object.assign(o,{client:{URL_BASE:"https://device-api.indigitall.com/v1",URL_DEVICE_V2:"https://device-api.indigitall.com/v2",INAPP_URL_BASE:"https://inapp-api.indigitall.com/v1",INBOX_URL_BASE:"https://inbox-api.indigitall.com/v1",CUSTOMER_URL_BASE:"https://device-api.indigitall.com/v2"}}),l=new class{constructor(){this.storage=this.isLocalStorageAvailable()?window.localStorage:null}isLocalStorageAvailable(){try{const e=window.localStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==l.length}return!1}setItem(e,t){return null!=this.storage&&(this.storage.setItem(e,t),!0)}getItem(e){return null!=this.storage?this.storage.getItem(e):null}deleteItem(e){return!!this.storage&&(this.storage.setItem(e,value),!0)}clear(){this.storage&&this.storage.clear()}},E=l,h=new class{constructor(){this.TAG="[IND]IndexedDB: ",this.DB_NAME="indigitall.indexedDB",this.DB_VERSION=1,this.DB_STORE_NAME="indigitallStore",this.DB_STORE_MODE="readwrite",this.DB_KEY_PATH="id",this.DB_STORE_INDEX="storeIndex",this.IDB=indexedDB||mozzIndexedDB||webkitIndexedDB||msIndexedDB}async getDB(){return new Promise(((e,t)=>{const s=this.IDB;if(s){const i=s.open("indigitall.indexedDB",1);i.onupgradeneeded=function(){i.result.createObjectStore("indigitallStore").createIndex("storeIndex","store.key")},i.onsuccess=function(){const t=i.result,s=t.transaction("indigitallStore","readwrite"),r=s.objectStore("indigitallStore"),n=r.index("storeIndex");e({db:t,tx:s,store:r,index:n})},i.onerror=function(e){t(e)}}else t(!1)}))}async get(e,t){return new Promise(((s,i)=>{e||i(!1),e.index.get(t).onsuccess=t=>{t.target.result&&(this.close(e),s(t.target.result.store.value)),i(!1)}}))}async put(e,t,s){return new Promise(((i,r)=>{e||r(!1),e.store.put({store:{key:t,value:s}},t).onsuccess=t=>{this.close(e),i(s)}}))}close(e){if(e.tx)try{e.tx.oncomplete=()=>{e.db.close()}}catch(e){console.error(this.TAG,e)}}async setItem(e,t){try{const s=await this.getDB();return this.put(s,e,t)}catch(e){return e}}async getItem(e){try{const t=await this.getDB();return this.get(t,e)}catch(e){return e}}},I=new class{constructor(){this.SESSION="indigitall.session.storage",this.session=this.isSessionStorageAvailable()?window.sessionStorage:null}isSessionStorageAvailable(){try{const e=window.sessionStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==I.length}return!1}getItem(e){return null!=this.session?this.session.getItem(e):null}setItem(e,t){return null!=this.session&&(this.session.setItem(e,t),!0)}clearMessages(){this.session&&this.session.removeItem("messages")}},d=I,u=class{constructor(){this.storage=E,this.db=h,this.BASE_TIME=60,this.REPOSITORY="indigitall.repository",this.APP_KEY=this.REPOSITORY+".APP_KEY",this.VAPID_PUBLIC=this.REPOSITORY+".VAPID_PUBLIC",this.ENABLED=this.REPOSITORY+".ENABLED",this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID",this.SERVICE_SYNC_TIME=this.REPOSITORY+".SERVICE_SYNC_TIME",this.LOCATION_ENABLED=this.REPOSITORY+".LOCATION_ENABLED",this.LOCATION_UPDATE_MINUTES=this.REPOSITORY+".LOCATION_UPDATE_MINUTES",this.REQUEST_LOCATION=this.REPOSITORY+".REQUEST_LOCATION",this.BROWSER_PUBLIC_KEY=this.REPOSITORY+".BROWSER_PUBLIC_KEY",this.BROWSER_PRIVATE_KEY=this.REPOSITORY+".BROWSER_PRIVATE_KEY",this.PLATFORM=this.REPOSITORY+".PLATFORM",this.BROWSER_NAME=this.REPOSITORY+".BROWSER_NAME",this.BROWSER_VERSION=this.REPOSITORY+".BROWSER_VERSION",this.OS_NAME=this.REPOSITORY+".OS_NAME",this.OS_VERSION=this.REPOSITORY+".OS_VERSION",this.DEVICE_TYPE=this.REPOSITORY+".DEVICE_TYPE",this.SUPPORTED=this.REPOSITORY+".SUPPORTED",this.SERVICE_TIMESTAMP=this.REPOSITORY+".SERVICE_TIMESTAMP",this.LOCATION_TIMESTAMP=this.REPOSITORY+".LOCATION_TIMESTAMP",this.PERMISSION_LOCATION=this.REPOSITORY+".PERMISSION_LOCATION",this.SET_LOG_DEBUG=this.REPOSITORY+".SET_LOG_DEBUG",this.NEW_USER_TIMESTAMP=this.REPOSITORY+".NEW_USER_TIMESTAMP",this.EXTERNAL_ID=this.REPOSITORY+".EXTERNAL_ID",this.REGISTERED_BY_COOKIE=this.REPOSITORY+".REGISTERED_BY_COOKIE",this.LOG_LEVEL=this.REPOSITORY+".LOG_LEVEL",this.LATITUDE=this.REPOSITORY+".LATITUDE",this.LONGITUDE=this.REPOSITORY+".LONGITUDE",this.TOPIC_LIST=this.REPOSITORY+".TOPIC_LIST",this.INAPP_ENABLED=this.REPOSITORY+".INAPP_ENABLED",this.URL_INAPP_API=this.REPOSITORY+".URL_INAPP_API",this.INAPP_TOPICS=this.REPOSITORY+".INAPP_TOPICS"}setItemSessionStorage(e,t){d.setItem(e,t)}getItemSessionStorage(e){return d.getItem(e)}clearSessionStorage(){d.clearMessages()}setStorage(e,t){E.setItem(e,t)}getStorage(e){return E.getItem(e)}clearStorage(){E.clear()}setBrowserPublicKey(e){E.setItem(this.BROWSER_PUBLIC_KEY,e)}getBrowserPublicKey(){return E.getItem(this.BROWSER_PUBLIC_KEY)}setBrowserPrivateKey(e){E.setItem(this.BROWSER_PRIVATE_KEY,e)}getBrowserPrivateKey(){return E.getItem(this.BROWSER_PRIVATE_KEY)}async setAppKey(e){E.setItem(this.APP_KEY,e),h&&h.IDB&&await h.setItem(this.APP_KEY,e)}getAppKey(){return E.getItem(this.APP_KEY)}async getAppKeySync(){if(h&&h.IDB)return await h.getItem(this.APP_KEY)}setVAPID(e){E.setItem(this.VAPID_PUBLIC,e)}getVAPID(){return E.getItem(this.VAPID_PUBLIC)}setEnabled(e){E.setItem(this.ENABLED,e)}getEnabled(){return E.getItem(this.ENABLED)}setServiceSyncTime(e){E.setItem(this.SERVICE_SYNC_TIME,e*this.BASE_TIME)}getServiceSyncTime(){return E.getItem(this.SERVICE_SYNC_TIME)||1*this.BASE_TIME}setLocationEnabled(e){E.setItem(this.LOCATION_ENABLED,e)}getLocationEnabled(){return E.getItem(this.LOCATION_ENABLED)}setLocationUpdateMinutes(e){E.setItem(this.LOCATION_UPDATE_MINUTES,e)}getLocationUpdateMinutes(){return E.getItem(this.LOCATION_UPDATE_MINUTES)||30}async setRequestLocation(e){E.setItem(this.REQUEST_LOCATION,e)}getRequestLocation(){return!!E&&E.getItem(this.REQUEST_LOCATION)}async setPlatform(e){E.setItem(this.PLATFORM,e)}getPlatform(){return E&&E.getItem(this.PLATFORM)||c.platform}getVersion(){return c.version}async setBrowserName(e){E.setItem(this.BROWSER_NAME,e)}getBrowserName(){return E.getItem(this.BROWSER_NAME)}setBrowserVersion(e){E.setItem(this.BROWSER_VERSION,e)}getBrowserVersion(){return E.getItem(this.BROWSER_VERSION)}async setOsName(e){E.setItem(this.OS_NAME,e)}getOsName(){return E.getItem(this.OS_NAME)}setOsVersion(e){E.setItem(this.OS_VERSION,e)}getOsVersion(){return E.getItem(this.OS_VERSION)}setDeviceType(e){E.setItem(this.DEVICE_TYPE,e)}getDeviceType(){return E.getItem(this.DEVICE_TYPE)}setSupported(e){E.setItem(this.SUPPORTED,e)}getSupported(){return E.getItem(this.SUPPORTED)}setServiceTimestamp(e){E.setItem(this.SERVICE_TIMESTAMP,e)}getServiceTimestamp(){return E.getItem(this.SERVICE_TIMESTAMP)}setLocationTimestamp(e){E.setItem(this.LOCATION_TIMESTAMP,e)}getLocationTimestamp(){return E.getItem(this.LOCATION_TIMESTAMP)}setPermissionLocation(e){E.setItem(this.PERMISSION_LOCATION,e)}getPermissionLocation(){return E.getItem(this.PERMISSION_LOCATION)}setDebugLog(e){E.setItem(this.SET_LOG_DEBUG,e)}getDebugLog(){return"false"!==E.getItem(this.SET_LOG_DEBUG)}setLogLevel(e){E.setItem(this.LOG_LEVEL,e)}getLogLevel(){return E.getItem(this.LOG_LEVEL)}setNewUserTimestamp(e){E.setItem(this.NEW_USER_TIMESTAMP,e)}getNewUserTimestamp(){return E.getItem(this.NEW_USER_TIMESTAMP)}async setExternalIdRequest(e){E&&E.isLocalStorageAvailable()&&E.setItem(this.EXTERNAL_ID,e),h&&h.IDB&&await h.setItem(this.EXTERNAL_ID,e)}async getExternalIdRequest(){let e;try{E&&E.isLocalStorageAvailable()?e=E.getItem(this.EXTERNAL_ID):h&&h.IDB&&(e=await h.getItem(this.EXTERNAL_ID))}catch(e){}return e}setExternalId(e){E.setItem(this.EXTERNAL_ID,e)}getExternalId(){return E.getItem(this.EXTERNAL_ID)}async getRegisteredByCookie(){return E.getItem(this.REGISTERED_BY_COOKIE)}async setRegisteredByCookie(e){E.setItem(this.REGISTERED_BY_COOKIE,e)}setLatitude(e){E.setItem(this.LATITUDE,e)}getLatitude(){return E.getItem(this.LATITUDE)}setLongitude(e){E.setItem(this.LONGITUDE,e)}getLongitude(){return E.getItem(this.LONGITUDE)}async setInAppTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.INAPP_TOPICS,e)}async getInAppTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.INAPP_TOPICS))}catch(e){}return e}async setTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.TOPIC_LIST,e)}async getTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.TOPIC_LIST))}catch(e){}return e}getUrlInappApi(){return this.getStorage(this.URL_INAPP_API)}setUrlInappApi(e){this.setStorage(this.URL_INAPP_API,e)}setInAppEnabled(e){this.setStorage(this.INAPP_ENABLED,e)}isInAppEnabled(){return this.getStorage(this.INAPP_ENABLED)}},g=Object.freeze({DEBUG:1,INFO:2,WARNING:3,ERROR:4}),R=g;class _{constructor(e){this.tag="[IND]",e&&(this.tag=e),this.level=R.INFO,this.setLogLevel((new u).getLogLevel()),this.log=[]}setLogLevel(e){e&&e>=R.DEBUG&&e<=R.ERROR&&(this.level=e)}static addedAsString(e){return"string"==typeof e?e:JSON.stringify(e,null,2)}d(){if(this.level<=R.DEBUG)for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}i(){if(this.level<=R.INFO)for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}w(){if(this.level<=R.WARNING)for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}e(){if(this.level<=R.ERROR)if(1==arguments.length&&arguments.errorCode)this.log+=`${error.errorCode}: ${error.errorMessage}`;else for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}writeLog(){this.log.length>0&&this.tag&&this.log&&console.log(this.tag,this.log),this.log=[]}}const p=_,T=class{constructor(e,t,s){this.errorCode=e,this.errorMessage=t,null!=s&&(this.exceptionMessage=s)}},A=new class{constructor(){}showError(e,t,s){if(null!=e){const i=Object.values(e.ErrorCode).indexOf(t);return i>=0?new T(Object.keys(e.ErrorCode)[i],Object.keys(e.ErrorMessage)[i],s):new T(GENERAL_ERROR,"general error",s)}}},S={ErrorCode:{GENERAL_ERROR:600,API_SERVER_ERROR:500,API_PARAMETER_MISSING:400,API_APPKEY_NOT_VALID:401,API_FORBIDDEN_REQUEST:403,API_DEVICE_NOT_FOUND:404,API_TOPICS_ARE_INSERTED:409,BAD_REQUEST_SERVER_ERROR:410},ErrorMessage:{GENERAL_ERROR:"General Error",API_SERVER_ERROR:"Error server response",API_PARAMETER_MISSING:"Api parameter missing",API_APPKEY_NOT_VALID:"appKey is not valid",API_FORBIDDEN_REQUEST:"forbidden request",API_DEVICE_NOT_FOUND:"device not found",API_TOPICS_ARE_INSERTED:"topics are inserted",BAD_REQUEST_SERVER_ERROR:"bad request"}},O=class{constructor(){this.URL_BASE="",this.GET="GET",this.POST="POST",this.PUT="PUT",this.DELETE="DELETE"}async getURL(){return this.URL_BASE}async call(e,t,s,i){const r=new p("[IND]BaseClient: ");s.isServiceWorkerRequest()&&r.setLogLevel(R.DEBUG);let n=await this.getURL()+s.getPath(t)+s.getParams();s.isJourneyRequest()&&(n=n.replace("v1","v2"));const o={method:e,headers:s.addHeaders()};e!==this.GET&&(o.body=JSON.stringify(s.getBody())),i&&(o.credentials=i);try{const t=await fetch(n,o),i=await t.json();return t.ok?(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\nResponse Body:",JSON.stringify(i.data,null,"\t")).writeLog(),i):(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\n").writeLog(),new T(i.statusCode,i.message))}catch(t){return r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Error: "+t).writeLog(),A.showError(S,S.ErrorCode.GENERAL_ERROR,t)}}async get(e,t){return await this.call(this.GET,e,t)}async post(e,t,s){return await this.call(this.POST,e,t,s)}async put(e,t,s){return await this.call(this.PUT,e,t,s)}async delete(e,t){return await this.call(this.DELETE,e,t)}},P=class{constructor(){this.PARAM_APP_KEY="appKey",this.PARAM_DEVICE_ID="deviceId",this.PARAM_PUSH_TOKEN="pushToken",this.PARAM_ENABLED="enabled",this.PARAM_PLATFORM="platform",this.PARAM_VERSION="version",this.PARAM_TOPICS="topics",this.PARAM_EVENT_TYPE="eventType",this.PARAM_PUSH_ID="pushId",this.PARAM_CLICKED_BUTTON="clickedButton",this.PARAM_PERMISSION_TYPE="permissionType",this.PARAM_LATITUDE="latitude",this.PARAM_LONGITUDE="longitude",this.PARAM_INAPP_ID="inAppId",this.PARAM_INAPP_EVENT_TYPE="eventType",this.PARAM_INAPP_CLICKED_BUTTON="clickedButton",this.PARAM_INAPP_LAST_VERSION_ID="lastVersionId",this.PARAM_INBOX_EXTERNALID="externalId",this.PARAM_INBOX_PAGE="page",this.PARAM_INBOX_PAGE_SIZE="pageSize",this.PARAM_INBOX_DATE_FROM="dateFrom",this.PARAM_INBOX_DATE_TO="dateTo",this.PARAM_INBOX_STATUS="status",this.PARAM_INBOX_SENDER_IDS="sendingIds",this.PARAM_CUSTOMER_ID="customerId",this.PARAM_CUSTOMER_FIELD_NAMES="fieldNames",this.PARAM_CUSTOMER_FIELDS="fields",this.PARAM_CUSTOMER_LINK="link",this.PARAM_CUSTOMER_CHANNEL="channel",this.appKey=(new u).getAppKey(),this.params=null,this.pathParams={},this.headers={}}getParams(){return"?"+this.PARAM_APP_KEY+"="+this.appKey+(this.params?"&"+this.params:"")}getBody(){return this.body?this.body:""}getPath(e){let t=e;return Object.keys(this.pathParams).forEach((e=>{t=t.replace(e,this.pathParams[e])})),t}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}isServiceWorkerRequest(){return this.serviceWorkerRequest}setServiceWorkerRequest(e){this.serviceWorkerRequest=e}isJourneyRequest(){return this.journeyRequest}setJourneyRequest(e){this.journeyRequest=e}},m=Object.freeze({PUSH:"push",INAPP:"inapp",CHAT:"chat"}),N=class{constructor(e=null,t){null==e?(this.browserPublicKey=(new u).getBrowserPublicKey(),this.browserPrivateKey=(new u).getBrowserPrivateKey(),this.platform=(new u).getPlatform(),this.version=(new u).getVersion(),this.browserName=(new u).getBrowserName(),this.browserVersion=(new u).getBrowserVersion(),this.osName=(new u).getOsName(),this.osVersion=(new u).getOsVersion(),this.deviceType=(new u).getDeviceType(),(new u).getEnabled()&&(this.enabled="true"===(new u).getEnabled()),(new u).getExternalId()&&(this.externalCode=(new u).getExternalId())):t?(e.enabled&&(this.enabled=e.enabled,(new u).setEnabled(this.enabled)),e.registeredByCookie&&(this.registeredByCookie=e.registeredByCookie,(new u).setRegisteredByCookie(this.registeredByCookie))):(e.browserPublicKey&&(this.browserPublicKey=e.browserPublicKey),e.browserPrivateKey&&(this.browserPrivateKey=e.browserPrivateKey),e.platform&&(this.platform=e.platform),e.version&&(this.version=e.version),e.osVersion&&(this.osVersion=e.osVersion),e.browserName&&(this.browserName=e.browserName),e.browserVersion&&(this.browserVersion=e.browserVersion),e.osName&&(this.osName=e.osName),e.deviceType&&(this.deviceType=e.deviceType),e.enabled&&(this.enabled=e.enabled),e.externalCode&&(this.externalCode=e.externalCode)),this.platform&&(this.productName=this.platform),this.version&&(this.productVersion=this.version),navigator&&"language"in navigator&&(this.locale=navigator.language),Intl&&"DateTimeFormat"in Intl&&(this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone),this.timeOffset=-(new Date).getTimezoneOffset()}getDeviceId(){return this.deviceId}setDeviceId(e){this.deviceId=e}setExternalCode(e){this.externalCode=e}toJSON(){const e={};return this.platform&&(e.platform=this.platform),this.version&&(e.version=this.version),this.productName&&(e.productName=this.productName),this.productVersion&&(e.productVersion=this.productVersion),this.browserName&&(e.browserName=this.browserName),this.browserVersion&&(e.browserVersion=this.browserVersion),this.osName&&(e.osName=this.osName),this.osVersion&&(e.osVersion=this.osVersion),this.deviceType&&(e.deviceType=this.deviceType),this.locale&&(e.locale=this.locale),this.timeZone&&(e.timeZome=this.timeZone),this.timeOffset&&(e.timeOffset=this.timeOffset),this.enabled&&(e.enabled=this.enabled),this.browserPublicKey&&(e.browserPublicKey=this.browserPublicKey),this.browserPrivateKey&&(e.browserPrivateKey=this.browserPrivateKey),this.externalCode&&(e.externalCode=this.externalCode),e}},y=Object.freeze({DEFAULT:-1,ENABLE:1,DISABLE:0}),w=Object.freeze({EVENT_TYPE_CLICK:"click",EVENT_TYPE_RECEIVE:"receive",EVENT_TYPE_UPDATE:"update",EVENT_TYPE_ACCEPT:"accept",EVENT_TYPE_REJECT:"reject",EVENT_TYPE_ASK:"ask"}),C=Object.freeze({SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe"}),D=class{static isServiceTimestampExceed(){return!(new u).getServiceTimestamp()||(new u).getServiceSyncTime()<=(Date.now()-(new u).getServiceTimestamp())/6e4}static isFunction(e){return!(!e||"function"!=typeof e)}},b=class{static async getPermissions(){const e=await this.getPermission("geolocation"),t={};return e&&(t.location=e.state),t}static async getPermission(e){try{if(navigator&&navigator.permissions&&navigator.permissions.query&&e)return await navigator.permissions.query({name:e,userVisibleOnly:!0})}catch(e){return null}return null}static async setPermissionsCallback(){await this.setCallback("geolocation",navigator.indigitallRequestLocationPermission)}static async setCallback(e,t){const s=await this.getPermission(e);if(s){let i=s.state;"onchange"in s&&(s.onchange=()=>{new p("[IND]CorePermissions: ").d(e+" permission state has changed from "+i+" to "+s.state).writeLog(),i=s.state,t&&t({name:e,state:s.state})})}}},f=new p("[IND]Crypto"),L=new TextEncoder("utf-8"),v="HMAC",B=class{static async createHmac(e,t){try{const s=window?.crypto?.subtle;if(!s)return;const i=await s.importKey("raw",L.encode(e),{name:v,hash:{name:"SHA-256"}},!1,["sign","verify"]),r=await s.sign(v,i,L.encode(t)),n=new Uint8Array(r),o=Array.prototype.map.call(n,(e=>("00"+e.toString(16)).slice(-2))).join("");return f.d("hmac: ",o).writeLog(),o}catch(e){return void f.e("error:",e).writeLog()}}},U=class{static compareJSON(e,t){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const i of s)if(e[i]!==t[i]){if("object"!=typeof e[i]||"object"!=typeof t[i])return!1;if(!isEqual(e[i],t[i]))return!1}return!0}},M=class{static isValidFormat(e){return null!=e&&""!=e&&"null"!=e&&e.length>8}},V=class{static setTopicChannel(e,t){const s=[];for(let i=0;i<e.length;i++){const r=e[i];r.channel=t,s.push(r)}return s}},x={Repository:u,Config:c,Api:i,Models:r,Utils:n}},557:function(e){var t;t=()=>(()=>{var e={923:function(e){var t;t=()=>(()=>{"use strict";var e={147:e=>{e.exports=JSON.parse('{"name":"indigitall-web-core","description":"indigitall web core","version":"4.3.1","main":"index.js","author":"Smart2me S.L.","homepage":"https://indigitall.com","devDependencies":{"@babel/preset-env":"^7.18.10","babel-loader":"^8.2.5","filemanager-webpack-plugin":"^7.0.0","idempotent-babel-polyfill":"^7.4.4","script-loader":"^0.7.2","webpack":"^5.74.0","webpack-bundle-analyzer":"^4.6.1","webpack-cli":"^4.10.0"},"scripts":{"test":"echo \'There are not tests\'","public":"ws --directory ./public --port 80 --log.format dev","build":"webpack --config webpack.config.js --mode=production","build-dev":"webpack --config webpack.config.js --watch --mode=development","delete-node-modules":"rm -rf node_modules/ && rm -f package-lock.json","install-core":"npm install && npm run build"}}')}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,s),n.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{s.r(i),s.d(i,{default:()=>V});var e={};s.r(e),s.d(e,{BaseClient:()=>S,BaseRequest:()=>O});var t={};s.r(t),s.d(t,{Channel:()=>P,Device:()=>m,DeviceStatus:()=>N,ErrorDictionary:()=>A,ErrorModel:()=>p,EventType:()=>y,TopicSubscribeType:()=>w});var r={};s.r(r),s.d(r,{CommonUtils:()=>C,CorePermissions:()=>D,CryptoUtils:()=>v,ErrorUtils:()=>T,JsonUtils:()=>B,Log:()=>_,LogLevel:()=>u,TopicUtils:()=>M,Validations:()=>U});var n={platform:"webpush",version:"0.0.1"};const o=s(147);n.version=o.version;const a=n=Object.assign(n,{client:{URL_BASE:"https://device-api.indigitall.com/v1",URL_DEVICE_V2:"https://device-api.indigitall.com/v2",INAPP_URL_BASE:"https://inapp-api.indigitall.com/v1",INBOX_URL_BASE:"https://inbox-api.indigitall.com/v1",CUSTOMER_URL_BASE:"https://device-api.indigitall.com/v2"}}),c=new class{constructor(){this.storage=this.isLocalStorageAvailable()?window.localStorage:null}isLocalStorageAvailable(){try{const e=window.localStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==c.length}return!1}setItem(e,t){return null!=this.storage&&(this.storage.setItem(e,t),!0)}getItem(e){return null!=this.storage?this.storage.getItem(e):null}deleteItem(e){return!!this.storage&&(this.storage.setItem(e,value),!0)}clear(){this.storage&&this.storage.clear()}},l=c,E=new class{constructor(){this.TAG="[IND]IndexedDB: ",this.DB_NAME="indigitall.indexedDB",this.DB_VERSION=1,this.DB_STORE_NAME="indigitallStore",this.DB_STORE_MODE="readwrite",this.DB_KEY_PATH="id",this.DB_STORE_INDEX="storeIndex",this.IDB=indexedDB||mozzIndexedDB||webkitIndexedDB||msIndexedDB}async getDB(){return new Promise(((e,t)=>{const s=this.IDB;if(s){const i=s.open("indigitall.indexedDB",1);i.onupgradeneeded=function(){i.result.createObjectStore("indigitallStore").createIndex("storeIndex","store.key")},i.onsuccess=function(){const t=i.result,s=t.transaction("indigitallStore","readwrite"),r=s.objectStore("indigitallStore"),n=r.index("storeIndex");e({db:t,tx:s,store:r,index:n})},i.onerror=function(e){t(e)}}else t(!1)}))}async get(e,t){return new Promise(((s,i)=>{e||i(!1),e.index.get(t).onsuccess=t=>{t.target.result&&(this.close(e),s(t.target.result.store.value)),i(!1)}}))}async put(e,t,s){return new Promise(((i,r)=>{e||r(!1),e.store.put({store:{key:t,value:s}},t).onsuccess=t=>{this.close(e),i(s)}}))}close(e){if(e.tx)try{e.tx.oncomplete=()=>{e.db.close()}}catch(e){console.error(this.TAG,e)}}async setItem(e,t){try{const s=await this.getDB();return this.put(s,e,t)}catch(e){return e}}async getItem(e){try{const t=await this.getDB();return this.get(t,e)}catch(e){return e}}},h=new class{constructor(){this.SESSION="indigitall.session.storage",this.session=this.isSessionStorageAvailable()?window.sessionStorage:null}isSessionStorageAvailable(){try{const e=window.sessionStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==h.length}return!1}getItem(e){return null!=this.session?this.session.getItem(e):null}setItem(e,t){return null!=this.session&&(this.session.setItem(e,t),!0)}clearMessages(){this.session&&this.session.removeItem("messages")}},I=h,d=class{constructor(){this.storage=l,this.db=E,this.BASE_TIME=60,this.REPOSITORY="indigitall.repository",this.APP_KEY=this.REPOSITORY+".APP_KEY",this.VAPID_PUBLIC=this.REPOSITORY+".VAPID_PUBLIC",this.ENABLED=this.REPOSITORY+".ENABLED",this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID",this.SERVICE_SYNC_TIME=this.REPOSITORY+".SERVICE_SYNC_TIME",this.LOCATION_ENABLED=this.REPOSITORY+".LOCATION_ENABLED",this.LOCATION_UPDATE_MINUTES=this.REPOSITORY+".LOCATION_UPDATE_MINUTES",this.REQUEST_LOCATION=this.REPOSITORY+".REQUEST_LOCATION",this.BROWSER_PUBLIC_KEY=this.REPOSITORY+".BROWSER_PUBLIC_KEY",this.BROWSER_PRIVATE_KEY=this.REPOSITORY+".BROWSER_PRIVATE_KEY",this.PLATFORM=this.REPOSITORY+".PLATFORM",this.BROWSER_NAME=this.REPOSITORY+".BROWSER_NAME",this.BROWSER_VERSION=this.REPOSITORY+".BROWSER_VERSION",this.OS_NAME=this.REPOSITORY+".OS_NAME",this.OS_VERSION=this.REPOSITORY+".OS_VERSION",this.DEVICE_TYPE=this.REPOSITORY+".DEVICE_TYPE",this.SUPPORTED=this.REPOSITORY+".SUPPORTED",this.SERVICE_TIMESTAMP=this.REPOSITORY+".SERVICE_TIMESTAMP",this.LOCATION_TIMESTAMP=this.REPOSITORY+".LOCATION_TIMESTAMP",this.PERMISSION_LOCATION=this.REPOSITORY+".PERMISSION_LOCATION",this.SET_LOG_DEBUG=this.REPOSITORY+".SET_LOG_DEBUG",this.NEW_USER_TIMESTAMP=this.REPOSITORY+".NEW_USER_TIMESTAMP",this.EXTERNAL_ID=this.REPOSITORY+".EXTERNAL_ID",this.REGISTERED_BY_COOKIE=this.REPOSITORY+".REGISTERED_BY_COOKIE",this.LOG_LEVEL=this.REPOSITORY+".LOG_LEVEL",this.LATITUDE=this.REPOSITORY+".LATITUDE",this.LONGITUDE=this.REPOSITORY+".LONGITUDE",this.TOPIC_LIST=this.REPOSITORY+".TOPIC_LIST",this.INAPP_ENABLED=this.REPOSITORY+".INAPP_ENABLED",this.URL_INAPP_API=this.REPOSITORY+".URL_INAPP_API",this.INAPP_TOPICS=this.REPOSITORY+".INAPP_TOPICS"}setItemSessionStorage(e,t){I.setItem(e,t)}getItemSessionStorage(e){return I.getItem(e)}clearSessionStorage(){I.clearMessages()}setStorage(e,t){l.setItem(e,t)}getStorage(e){return l.getItem(e)}clearStorage(){l.clear()}setBrowserPublicKey(e){l.setItem(this.BROWSER_PUBLIC_KEY,e)}getBrowserPublicKey(){return l.getItem(this.BROWSER_PUBLIC_KEY)}setBrowserPrivateKey(e){l.setItem(this.BROWSER_PRIVATE_KEY,e)}getBrowserPrivateKey(){return l.getItem(this.BROWSER_PRIVATE_KEY)}async setAppKey(e){l.setItem(this.APP_KEY,e),E&&E.IDB&&await E.setItem(this.APP_KEY,e)}getAppKey(){return l.getItem(this.APP_KEY)}async getAppKeySync(){if(E&&E.IDB)return await E.getItem(this.APP_KEY)}setVAPID(e){l.setItem(this.VAPID_PUBLIC,e)}getVAPID(){return l.getItem(this.VAPID_PUBLIC)}setEnabled(e){l.setItem(this.ENABLED,e)}getEnabled(){return l.getItem(this.ENABLED)}setServiceSyncTime(e){l.setItem(this.SERVICE_SYNC_TIME,e*this.BASE_TIME)}getServiceSyncTime(){return l.getItem(this.SERVICE_SYNC_TIME)||1*this.BASE_TIME}setLocationEnabled(e){l.setItem(this.LOCATION_ENABLED,e)}getLocationEnabled(){return l.getItem(this.LOCATION_ENABLED)}setLocationUpdateMinutes(e){l.setItem(this.LOCATION_UPDATE_MINUTES,e)}getLocationUpdateMinutes(){return l.getItem(this.LOCATION_UPDATE_MINUTES)||30}async setRequestLocation(e){l.setItem(this.REQUEST_LOCATION,e)}getRequestLocation(){return!!l&&l.getItem(this.REQUEST_LOCATION)}async setPlatform(e){l.setItem(this.PLATFORM,e)}getPlatform(){return l&&l.getItem(this.PLATFORM)||a.platform}getVersion(){return a.version}async setBrowserName(e){l.setItem(this.BROWSER_NAME,e)}getBrowserName(){return l.getItem(this.BROWSER_NAME)}setBrowserVersion(e){l.setItem(this.BROWSER_VERSION,e)}getBrowserVersion(){return l.getItem(this.BROWSER_VERSION)}async setOsName(e){l.setItem(this.OS_NAME,e)}getOsName(){return l.getItem(this.OS_NAME)}setOsVersion(e){l.setItem(this.OS_VERSION,e)}getOsVersion(){return l.getItem(this.OS_VERSION)}setDeviceType(e){l.setItem(this.DEVICE_TYPE,e)}getDeviceType(){return l.getItem(this.DEVICE_TYPE)}setSupported(e){l.setItem(this.SUPPORTED,e)}getSupported(){return l.getItem(this.SUPPORTED)}setServiceTimestamp(e){l.setItem(this.SERVICE_TIMESTAMP,e)}getServiceTimestamp(){return l.getItem(this.SERVICE_TIMESTAMP)}setLocationTimestamp(e){l.setItem(this.LOCATION_TIMESTAMP,e)}getLocationTimestamp(){return l.getItem(this.LOCATION_TIMESTAMP)}setPermissionLocation(e){l.setItem(this.PERMISSION_LOCATION,e)}getPermissionLocation(){return l.getItem(this.PERMISSION_LOCATION)}setDebugLog(e){l.setItem(this.SET_LOG_DEBUG,e)}getDebugLog(){return"false"!==l.getItem(this.SET_LOG_DEBUG)}setLogLevel(e){l.setItem(this.LOG_LEVEL,e)}getLogLevel(){return l.getItem(this.LOG_LEVEL)}setNewUserTimestamp(e){l.setItem(this.NEW_USER_TIMESTAMP,e)}getNewUserTimestamp(){return l.getItem(this.NEW_USER_TIMESTAMP)}async setExternalIdRequest(e){l&&l.isLocalStorageAvailable()&&l.setItem(this.EXTERNAL_ID,e),E&&E.IDB&&await E.setItem(this.EXTERNAL_ID,e)}async getExternalIdRequest(){let e;try{l&&l.isLocalStorageAvailable()?e=l.getItem(this.EXTERNAL_ID):E&&E.IDB&&(e=await E.getItem(this.EXTERNAL_ID))}catch(e){}return e}setExternalId(e){l.setItem(this.EXTERNAL_ID,e)}getExternalId(){return l.getItem(this.EXTERNAL_ID)}async getRegisteredByCookie(){return l.getItem(this.REGISTERED_BY_COOKIE)}async setRegisteredByCookie(e){l.setItem(this.REGISTERED_BY_COOKIE,e)}setLatitude(e){l.setItem(this.LATITUDE,e)}getLatitude(){return l.getItem(this.LATITUDE)}setLongitude(e){l.setItem(this.LONGITUDE,e)}getLongitude(){return l.getItem(this.LONGITUDE)}async setInAppTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.INAPP_TOPICS,e)}async getInAppTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.INAPP_TOPICS))}catch(e){}return e}async setTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.TOPIC_LIST,e)}async getTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.TOPIC_LIST))}catch(e){}return e}getUrlInappApi(){return this.getStorage(this.URL_INAPP_API)}setUrlInappApi(e){this.setStorage(this.URL_INAPP_API,e)}setInAppEnabled(e){this.setStorage(this.INAPP_ENABLED,e)}isInAppEnabled(){return this.getStorage(this.INAPP_ENABLED)}},u=Object.freeze({DEBUG:1,INFO:2,WARNING:3,ERROR:4}),g=u;class R{constructor(e){this.tag="[IND]",e&&(this.tag=e),this.level=g.INFO,this.setLogLevel((new d).getLogLevel()),this.log=[]}setLogLevel(e){e&&e>=g.DEBUG&&e<=g.ERROR&&(this.level=e)}static addedAsString(e){return"string"==typeof e?e:JSON.stringify(e,null,2)}d(){if(this.level<=g.DEBUG)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}i(){if(this.level<=g.INFO)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}w(){if(this.level<=g.WARNING)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}e(){if(this.level<=g.ERROR)if(1==arguments.length&&arguments.errorCode)this.log+=`${error.errorCode}: ${error.errorMessage}`;else for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}writeLog(){this.log.length>0&&this.tag&&this.log&&console.log(this.tag,this.log),this.log=[]}}const _=R,p=class{constructor(e,t,s){this.errorCode=e,this.errorMessage=t,null!=s&&(this.exceptionMessage=s)}},T=new class{constructor(){}showError(e,t,s){if(null!=e){const i=Object.values(e.ErrorCode).indexOf(t);return i>=0?new p(Object.keys(e.ErrorCode)[i],Object.keys(e.ErrorMessage)[i],s):new p(GENERAL_ERROR,"general error",s)}}},A={ErrorCode:{GENERAL_ERROR:600,API_SERVER_ERROR:500,API_PARAMETER_MISSING:400,API_APPKEY_NOT_VALID:401,API_FORBIDDEN_REQUEST:403,API_DEVICE_NOT_FOUND:404,API_TOPICS_ARE_INSERTED:409,BAD_REQUEST_SERVER_ERROR:410},ErrorMessage:{GENERAL_ERROR:"General Error",API_SERVER_ERROR:"Error server response",API_PARAMETER_MISSING:"Api parameter missing",API_APPKEY_NOT_VALID:"appKey is not valid",API_FORBIDDEN_REQUEST:"forbidden request",API_DEVICE_NOT_FOUND:"device not found",API_TOPICS_ARE_INSERTED:"topics are inserted",BAD_REQUEST_SERVER_ERROR:"bad request"}},S=class{constructor(){this.URL_BASE="",this.GET="GET",this.POST="POST",this.PUT="PUT",this.DELETE="DELETE"}async getURL(){return this.URL_BASE}async call(e,t,s,i){const r=new _("[IND]BaseClient: ");s.isServiceWorkerRequest()&&r.setLogLevel(g.DEBUG);let n=await this.getURL()+s.getPath(t)+s.getParams();s.isJourneyRequest()&&(n=n.replace("v1","v2"));const o={method:e,headers:s.addHeaders()};e!==this.GET&&(o.body=JSON.stringify(s.getBody())),i&&(o.credentials=i);try{const t=await fetch(n,o),i=await t.json();return t.ok?(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\nResponse Body:",JSON.stringify(i.data,null,"\t")).writeLog(),i):(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\n").writeLog(),new p(i.statusCode,i.message))}catch(t){return r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Error: "+t).writeLog(),T.showError(A,A.ErrorCode.GENERAL_ERROR,t)}}async get(e,t){return await this.call(this.GET,e,t)}async post(e,t,s){return await this.call(this.POST,e,t,s)}async put(e,t,s){return await this.call(this.PUT,e,t,s)}async delete(e,t){return await this.call(this.DELETE,e,t)}},O=class{constructor(){this.PARAM_APP_KEY="appKey",this.PARAM_DEVICE_ID="deviceId",this.PARAM_PUSH_TOKEN="pushToken",this.PARAM_ENABLED="enabled",this.PARAM_PLATFORM="platform",this.PARAM_VERSION="version",this.PARAM_TOPICS="topics",this.PARAM_EVENT_TYPE="eventType",this.PARAM_PUSH_ID="pushId",this.PARAM_CLICKED_BUTTON="clickedButton",this.PARAM_PERMISSION_TYPE="permissionType",this.PARAM_LATITUDE="latitude",this.PARAM_LONGITUDE="longitude",this.PARAM_INAPP_ID="inAppId",this.PARAM_INAPP_EVENT_TYPE="eventType",this.PARAM_INAPP_CLICKED_BUTTON="clickedButton",this.PARAM_INAPP_LAST_VERSION_ID="lastVersionId",this.PARAM_INBOX_EXTERNALID="externalId",this.PARAM_INBOX_PAGE="page",this.PARAM_INBOX_PAGE_SIZE="pageSize",this.PARAM_INBOX_DATE_FROM="dateFrom",this.PARAM_INBOX_DATE_TO="dateTo",this.PARAM_INBOX_STATUS="status",this.PARAM_INBOX_SENDER_IDS="sendingIds",this.PARAM_CUSTOMER_ID="customerId",this.PARAM_CUSTOMER_FIELD_NAMES="fieldNames",this.PARAM_CUSTOMER_FIELDS="fields",this.PARAM_CUSTOMER_LINK="link",this.PARAM_CUSTOMER_CHANNEL="channel",this.appKey=(new d).getAppKey(),this.params=null,this.pathParams={},this.headers={}}getParams(){return"?"+this.PARAM_APP_KEY+"="+this.appKey+(this.params?"&"+this.params:"")}getBody(){return this.body?this.body:""}getPath(e){let t=e;return Object.keys(this.pathParams).forEach((e=>{t=t.replace(e,this.pathParams[e])})),t}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}isServiceWorkerRequest(){return this.serviceWorkerRequest}setServiceWorkerRequest(e){this.serviceWorkerRequest=e}isJourneyRequest(){return this.journeyRequest}setJourneyRequest(e){this.journeyRequest=e}},P=Object.freeze({PUSH:"push",INAPP:"inapp",CHAT:"chat"}),m=class{constructor(e=null,t){null==e?(this.browserPublicKey=(new d).getBrowserPublicKey(),this.browserPrivateKey=(new d).getBrowserPrivateKey(),this.platform=(new d).getPlatform(),this.version=(new d).getVersion(),this.browserName=(new d).getBrowserName(),this.browserVersion=(new d).getBrowserVersion(),this.osName=(new d).getOsName(),this.osVersion=(new d).getOsVersion(),this.deviceType=(new d).getDeviceType(),(new d).getEnabled()&&(this.enabled="true"===(new d).getEnabled()),(new d).getExternalId()&&(this.externalCode=(new d).getExternalId())):t?(e.enabled&&(this.enabled=e.enabled,(new d).setEnabled(this.enabled)),e.registeredByCookie&&(this.registeredByCookie=e.registeredByCookie,(new d).setRegisteredByCookie(this.registeredByCookie))):(e.browserPublicKey&&(this.browserPublicKey=e.browserPublicKey),e.browserPrivateKey&&(this.browserPrivateKey=e.browserPrivateKey),e.platform&&(this.platform=e.platform),e.version&&(this.version=e.version),e.osVersion&&(this.osVersion=e.osVersion),e.browserName&&(this.browserName=e.browserName),e.browserVersion&&(this.browserVersion=e.browserVersion),e.osName&&(this.osName=e.osName),e.deviceType&&(this.deviceType=e.deviceType),e.enabled&&(this.enabled=e.enabled),e.externalCode&&(this.externalCode=e.externalCode)),this.platform&&(this.productName=this.platform),this.version&&(this.productVersion=this.version),navigator&&"language"in navigator&&(this.locale=navigator.language),Intl&&"DateTimeFormat"in Intl&&(this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone),this.timeOffset=-(new Date).getTimezoneOffset()}getDeviceId(){return this.deviceId}setDeviceId(e){this.deviceId=e}setExternalCode(e){this.externalCode=e}toJSON(){const e={};return this.platform&&(e.platform=this.platform),this.version&&(e.version=this.version),this.productName&&(e.productName=this.productName),this.productVersion&&(e.productVersion=this.productVersion),this.browserName&&(e.browserName=this.browserName),this.browserVersion&&(e.browserVersion=this.browserVersion),this.osName&&(e.osName=this.osName),this.osVersion&&(e.osVersion=this.osVersion),this.deviceType&&(e.deviceType=this.deviceType),this.locale&&(e.locale=this.locale),this.timeZone&&(e.timeZome=this.timeZone),this.timeOffset&&(e.timeOffset=this.timeOffset),this.enabled&&(e.enabled=this.enabled),this.browserPublicKey&&(e.browserPublicKey=this.browserPublicKey),this.browserPrivateKey&&(e.browserPrivateKey=this.browserPrivateKey),this.externalCode&&(e.externalCode=this.externalCode),e}},N=Object.freeze({DEFAULT:-1,ENABLE:1,DISABLE:0}),y=Object.freeze({EVENT_TYPE_CLICK:"click",EVENT_TYPE_RECEIVE:"receive",EVENT_TYPE_UPDATE:"update",EVENT_TYPE_ACCEPT:"accept",EVENT_TYPE_REJECT:"reject",EVENT_TYPE_ASK:"ask"}),w=Object.freeze({SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe"}),C=class{static isServiceTimestampExceed(){return!(new d).getServiceTimestamp()||(new d).getServiceSyncTime()<=(Date.now()-(new d).getServiceTimestamp())/6e4}static isFunction(e){return!(!e||"function"!=typeof e)}},D=class{static async getPermissions(){const e=await this.getPermission("geolocation"),t={};return e&&(t.location=e.state),t}static async getPermission(e){try{if(navigator&&navigator.permissions&&navigator.permissions.query&&e)return await navigator.permissions.query({name:e,userVisibleOnly:!0})}catch(e){return null}return null}static async setPermissionsCallback(){await this.setCallback("geolocation",navigator.indigitallRequestLocationPermission)}static async setCallback(e,t){const s=await this.getPermission(e);if(s){let i=s.state;"onchange"in s&&(s.onchange=()=>{new _("[IND]CorePermissions: ").d(e+" permission state has changed from "+i+" to "+s.state).writeLog(),i=s.state,t&&t({name:e,state:s.state})})}}},b=new _("[IND]Crypto"),f=new TextEncoder("utf-8"),L="HMAC",v=class{static async createHmac(e,t){try{const s=window?.crypto?.subtle;if(!s)return;const i=await s.importKey("raw",f.encode(e),{name:L,hash:{name:"SHA-256"}},!1,["sign","verify"]),r=await s.sign(L,i,f.encode(t)),n=new Uint8Array(r),o=Array.prototype.map.call(n,(e=>("00"+e.toString(16)).slice(-2))).join("");return b.d("hmac: ",o).writeLog(),o}catch(e){return void b.e("error:",e).writeLog()}}},B=class{static compareJSON(e,t){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const i of s)if(e[i]!==t[i]){if("object"!=typeof e[i]||"object"!=typeof t[i])return!1;if(!isEqual(e[i],t[i]))return!1}return!0}},U=class{static isValidFormat(e){return null!=e&&""!=e&&"null"!=e&&e.length>8}},M=class{static setTopicChannel(e,t){const s=[];for(let i=0;i<e.length;i++){const r=e[i];r.channel=t,s.push(r)}return s}},V={Repository:d,Config:a,Api:e,Models:t,Utils:r}})(),i})(),e.exports=t()},57:(e,t,s)=>{"use strict";s.d(t,{Core:()=>x});var i={};s.r(i),s.d(i,{BaseClient:()=>O,BaseRequest:()=>P});var r={};s.r(r),s.d(r,{Channel:()=>m,Device:()=>N,DeviceStatus:()=>y,ErrorDictionary:()=>S,ErrorModel:()=>T,EventType:()=>w,TopicSubscribeType:()=>C});var n={};s.r(n),s.d(n,{CommonUtils:()=>D,CorePermissions:()=>b,CryptoUtils:()=>B,ErrorUtils:()=>A,JsonUtils:()=>U,Log:()=>p,LogLevel:()=>g,TopicUtils:()=>V,Validations:()=>M}),s(923);var o={platform:"webpush",version:"0.0.1"};const a=s(391);o.version=a.version;const c=o=Object.assign(o,{client:{URL_BASE:"https://device-api.indigitall.com/v1",URL_DEVICE_V2:"https://device-api.indigitall.com/v2",INAPP_URL_BASE:"https://inapp-api.indigitall.com/v1",INBOX_URL_BASE:"https://inbox-api.indigitall.com/v1",CUSTOMER_URL_BASE:"https://device-api.indigitall.com/v2"}}),l=new class{constructor(){this.storage=this.isLocalStorageAvailable()?window.localStorage:null}isLocalStorageAvailable(){try{const e=window.localStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==l.length}return!1}setItem(e,t){return null!=this.storage&&(this.storage.setItem(e,t),!0)}getItem(e){return null!=this.storage?this.storage.getItem(e):null}deleteItem(e){return!!this.storage&&(this.storage.setItem(e,value),!0)}clear(){this.storage&&this.storage.clear()}},E=l,h=new class{constructor(){this.TAG="[IND]IndexedDB: ",this.DB_NAME="indigitall.indexedDB",this.DB_VERSION=1,this.DB_STORE_NAME="indigitallStore",this.DB_STORE_MODE="readwrite",this.DB_KEY_PATH="id",this.DB_STORE_INDEX="storeIndex",this.IDB=indexedDB||mozzIndexedDB||webkitIndexedDB||msIndexedDB}async getDB(){return new Promise(((e,t)=>{const s=this.IDB;if(s){const i=s.open("indigitall.indexedDB",1);i.onupgradeneeded=function(){i.result.createObjectStore("indigitallStore").createIndex("storeIndex","store.key")},i.onsuccess=function(){const t=i.result,s=t.transaction("indigitallStore","readwrite"),r=s.objectStore("indigitallStore"),n=r.index("storeIndex");e({db:t,tx:s,store:r,index:n})},i.onerror=function(e){t(e)}}else t(!1)}))}async get(e,t){return new Promise(((s,i)=>{e||i(!1),e.index.get(t).onsuccess=t=>{t.target.result&&(this.close(e),s(t.target.result.store.value)),i(!1)}}))}async put(e,t,s){return new Promise(((i,r)=>{e||r(!1),e.store.put({store:{key:t,value:s}},t).onsuccess=t=>{this.close(e),i(s)}}))}close(e){if(e.tx)try{e.tx.oncomplete=()=>{e.db.close()}}catch(e){console.error(this.TAG,e)}}async setItem(e,t){try{const s=await this.getDB();return this.put(s,e,t)}catch(e){return e}}async getItem(e){try{const t=await this.getDB();return this.get(t,e)}catch(e){return e}}},I=new class{constructor(){this.SESSION="indigitall.session.storage",this.session=this.isSessionStorageAvailable()?window.sessionStorage:null}isSessionStorageAvailable(){try{const e=window.sessionStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==I.length}return!1}getItem(e){return null!=this.session?this.session.getItem(e):null}setItem(e,t){return null!=this.session&&(this.session.setItem(e,t),!0)}clearMessages(){this.session&&this.session.removeItem("messages")}},d=I,u=class{constructor(){this.storage=E,this.db=h,this.BASE_TIME=60,this.REPOSITORY="indigitall.repository",this.APP_KEY=this.REPOSITORY+".APP_KEY",this.VAPID_PUBLIC=this.REPOSITORY+".VAPID_PUBLIC",this.ENABLED=this.REPOSITORY+".ENABLED",this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID",this.SERVICE_SYNC_TIME=this.REPOSITORY+".SERVICE_SYNC_TIME",this.LOCATION_ENABLED=this.REPOSITORY+".LOCATION_ENABLED",this.LOCATION_UPDATE_MINUTES=this.REPOSITORY+".LOCATION_UPDATE_MINUTES",this.REQUEST_LOCATION=this.REPOSITORY+".REQUEST_LOCATION",this.BROWSER_PUBLIC_KEY=this.REPOSITORY+".BROWSER_PUBLIC_KEY",this.BROWSER_PRIVATE_KEY=this.REPOSITORY+".BROWSER_PRIVATE_KEY",this.PLATFORM=this.REPOSITORY+".PLATFORM",this.BROWSER_NAME=this.REPOSITORY+".BROWSER_NAME",this.BROWSER_VERSION=this.REPOSITORY+".BROWSER_VERSION",this.OS_NAME=this.REPOSITORY+".OS_NAME",this.OS_VERSION=this.REPOSITORY+".OS_VERSION",this.DEVICE_TYPE=this.REPOSITORY+".DEVICE_TYPE",this.SUPPORTED=this.REPOSITORY+".SUPPORTED",this.SERVICE_TIMESTAMP=this.REPOSITORY+".SERVICE_TIMESTAMP",this.LOCATION_TIMESTAMP=this.REPOSITORY+".LOCATION_TIMESTAMP",this.PERMISSION_LOCATION=this.REPOSITORY+".PERMISSION_LOCATION",this.SET_LOG_DEBUG=this.REPOSITORY+".SET_LOG_DEBUG",this.NEW_USER_TIMESTAMP=this.REPOSITORY+".NEW_USER_TIMESTAMP",this.EXTERNAL_ID=this.REPOSITORY+".EXTERNAL_ID",this.REGISTERED_BY_COOKIE=this.REPOSITORY+".REGISTERED_BY_COOKIE",this.LOG_LEVEL=this.REPOSITORY+".LOG_LEVEL",this.LATITUDE=this.REPOSITORY+".LATITUDE",this.LONGITUDE=this.REPOSITORY+".LONGITUDE",this.TOPIC_LIST=this.REPOSITORY+".TOPIC_LIST",this.INAPP_ENABLED=this.REPOSITORY+".INAPP_ENABLED",this.URL_INAPP_API=this.REPOSITORY+".URL_INAPP_API",this.INAPP_TOPICS=this.REPOSITORY+".INAPP_TOPICS"}setItemSessionStorage(e,t){d.setItem(e,t)}getItemSessionStorage(e){return d.getItem(e)}clearSessionStorage(){d.clearMessages()}setStorage(e,t){E.setItem(e,t)}getStorage(e){return E.getItem(e)}clearStorage(){E.clear()}setBrowserPublicKey(e){E.setItem(this.BROWSER_PUBLIC_KEY,e)}getBrowserPublicKey(){return E.getItem(this.BROWSER_PUBLIC_KEY)}setBrowserPrivateKey(e){E.setItem(this.BROWSER_PRIVATE_KEY,e)}getBrowserPrivateKey(){return E.getItem(this.BROWSER_PRIVATE_KEY)}async setAppKey(e){E.setItem(this.APP_KEY,e),h&&h.IDB&&await h.setItem(this.APP_KEY,e)}getAppKey(){return E.getItem(this.APP_KEY)}async getAppKeySync(){if(h&&h.IDB)return await h.getItem(this.APP_KEY)}setVAPID(e){E.setItem(this.VAPID_PUBLIC,e)}getVAPID(){return E.getItem(this.VAPID_PUBLIC)}setEnabled(e){E.setItem(this.ENABLED,e)}getEnabled(){return E.getItem(this.ENABLED)}setServiceSyncTime(e){E.setItem(this.SERVICE_SYNC_TIME,e*this.BASE_TIME)}getServiceSyncTime(){return E.getItem(this.SERVICE_SYNC_TIME)||1*this.BASE_TIME}setLocationEnabled(e){E.setItem(this.LOCATION_ENABLED,e)}getLocationEnabled(){return E.getItem(this.LOCATION_ENABLED)}setLocationUpdateMinutes(e){E.setItem(this.LOCATION_UPDATE_MINUTES,e)}getLocationUpdateMinutes(){return E.getItem(this.LOCATION_UPDATE_MINUTES)||30}async setRequestLocation(e){E.setItem(this.REQUEST_LOCATION,e)}getRequestLocation(){return!!E&&E.getItem(this.REQUEST_LOCATION)}async setPlatform(e){E.setItem(this.PLATFORM,e)}getPlatform(){return E&&E.getItem(this.PLATFORM)||c.platform}getVersion(){return c.version}async setBrowserName(e){E.setItem(this.BROWSER_NAME,e)}getBrowserName(){return E.getItem(this.BROWSER_NAME)}setBrowserVersion(e){E.setItem(this.BROWSER_VERSION,e)}getBrowserVersion(){return E.getItem(this.BROWSER_VERSION)}async setOsName(e){E.setItem(this.OS_NAME,e)}getOsName(){return E.getItem(this.OS_NAME)}setOsVersion(e){E.setItem(this.OS_VERSION,e)}getOsVersion(){return E.getItem(this.OS_VERSION)}setDeviceType(e){E.setItem(this.DEVICE_TYPE,e)}getDeviceType(){return E.getItem(this.DEVICE_TYPE)}setSupported(e){E.setItem(this.SUPPORTED,e)}getSupported(){return E.getItem(this.SUPPORTED)}setServiceTimestamp(e){E.setItem(this.SERVICE_TIMESTAMP,e)}getServiceTimestamp(){return E.getItem(this.SERVICE_TIMESTAMP)}setLocationTimestamp(e){E.setItem(this.LOCATION_TIMESTAMP,e)}getLocationTimestamp(){return E.getItem(this.LOCATION_TIMESTAMP)}setPermissionLocation(e){E.setItem(this.PERMISSION_LOCATION,e)}getPermissionLocation(){return E.getItem(this.PERMISSION_LOCATION)}setDebugLog(e){E.setItem(this.SET_LOG_DEBUG,e)}getDebugLog(){return"false"!==E.getItem(this.SET_LOG_DEBUG)}setLogLevel(e){E.setItem(this.LOG_LEVEL,e)}getLogLevel(){return E.getItem(this.LOG_LEVEL)}setNewUserTimestamp(e){E.setItem(this.NEW_USER_TIMESTAMP,e)}getNewUserTimestamp(){return E.getItem(this.NEW_USER_TIMESTAMP)}async setExternalIdRequest(e){E&&E.isLocalStorageAvailable()&&E.setItem(this.EXTERNAL_ID,e),h&&h.IDB&&await h.setItem(this.EXTERNAL_ID,e)}async getExternalIdRequest(){let e;try{E&&E.isLocalStorageAvailable()?e=E.getItem(this.EXTERNAL_ID):h&&h.IDB&&(e=await h.getItem(this.EXTERNAL_ID))}catch(e){}return e}setExternalId(e){E.setItem(this.EXTERNAL_ID,e)}getExternalId(){return E.getItem(this.EXTERNAL_ID)}async getRegisteredByCookie(){return E.getItem(this.REGISTERED_BY_COOKIE)}async setRegisteredByCookie(e){E.setItem(this.REGISTERED_BY_COOKIE,e)}setLatitude(e){E.setItem(this.LATITUDE,e)}getLatitude(){return E.getItem(this.LATITUDE)}setLongitude(e){E.setItem(this.LONGITUDE,e)}getLongitude(){return E.getItem(this.LONGITUDE)}async setInAppTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.INAPP_TOPICS,e)}async getInAppTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.INAPP_TOPICS))}catch(e){}return e}async setTopicList(e){this.db&&this.db.IDB&&await this.db.setItem(this.TOPIC_LIST,e)}async getTopicList(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.TOPIC_LIST))}catch(e){}return e}getUrlInappApi(){return this.getStorage(this.URL_INAPP_API)}setUrlInappApi(e){this.setStorage(this.URL_INAPP_API,e)}setInAppEnabled(e){this.setStorage(this.INAPP_ENABLED,e)}isInAppEnabled(){return this.getStorage(this.INAPP_ENABLED)}},g=Object.freeze({DEBUG:1,INFO:2,WARNING:3,ERROR:4}),R=g;class _{constructor(e){this.tag="[IND]",e&&(this.tag=e),this.level=R.INFO,this.setLogLevel((new u).getLogLevel()),this.log=[]}setLogLevel(e){e&&e>=R.DEBUG&&e<=R.ERROR&&(this.level=e)}static addedAsString(e){return"string"==typeof e?e:JSON.stringify(e,null,2)}d(){if(this.level<=R.DEBUG)for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}i(){if(this.level<=R.INFO)for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}w(){if(this.level<=R.WARNING)for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}e(){if(this.level<=R.ERROR)if(1==arguments.length&&arguments.errorCode)this.log+=`${error.errorCode}: ${error.errorMessage}`;else for(let e=0;e<arguments.length;e++)this.log+=_.addedAsString(arguments[e]);return this}writeLog(){this.log.length>0&&this.tag&&this.log&&console.log(this.tag,this.log),this.log=[]}}const p=_,T=class{constructor(e,t,s){this.errorCode=e,this.errorMessage=t,null!=s&&(this.exceptionMessage=s)}},A=new class{constructor(){}showError(e,t,s){if(null!=e){const i=Object.values(e.ErrorCode).indexOf(t);return i>=0?new T(Object.keys(e.ErrorCode)[i],Object.keys(e.ErrorMessage)[i],s):new T(GENERAL_ERROR,"general error",s)}}},S={ErrorCode:{GENERAL_ERROR:600,API_SERVER_ERROR:500,API_PARAMETER_MISSING:400,API_APPKEY_NOT_VALID:401,API_FORBIDDEN_REQUEST:403,API_DEVICE_NOT_FOUND:404,API_TOPICS_ARE_INSERTED:409,BAD_REQUEST_SERVER_ERROR:410},ErrorMessage:{GENERAL_ERROR:"General Error",API_SERVER_ERROR:"Error server response",API_PARAMETER_MISSING:"Api parameter missing",API_APPKEY_NOT_VALID:"appKey is not valid",API_FORBIDDEN_REQUEST:"forbidden request",API_DEVICE_NOT_FOUND:"device not found",API_TOPICS_ARE_INSERTED:"topics are inserted",BAD_REQUEST_SERVER_ERROR:"bad request"}},O=class{constructor(){this.URL_BASE="",this.GET="GET",this.POST="POST",this.PUT="PUT",this.DELETE="DELETE"}async getURL(){return this.URL_BASE}async call(e,t,s,i){const r=new p("[IND]BaseClient: ");s.isServiceWorkerRequest()&&r.setLogLevel(R.DEBUG);let n=await this.getURL()+s.getPath(t)+s.getParams();s.isJourneyRequest()&&(n=n.replace("v1","v2"));const o={method:e,headers:s.addHeaders()};e!==this.GET&&(o.body=JSON.stringify(s.getBody())),i&&(o.credentials=i);try{const t=await fetch(n,o),i=await t.json();return t.ok?(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\nResponse Body:",JSON.stringify(i.data,null,"\t")).writeLog(),i):(r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\n").writeLog(),new T(i.statusCode,i.message))}catch(t){return r.d("Method: "+e+"\nURL: "+n+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Error: "+t).writeLog(),A.showError(S,S.ErrorCode.GENERAL_ERROR,t)}}async get(e,t){return await this.call(this.GET,e,t)}async post(e,t,s){return await this.call(this.POST,e,t,s)}async put(e,t,s){return await this.call(this.PUT,e,t,s)}async delete(e,t){return await this.call(this.DELETE,e,t)}},P=class{constructor(){this.PARAM_APP_KEY="appKey",this.PARAM_DEVICE_ID="deviceId",this.PARAM_PUSH_TOKEN="pushToken",this.PARAM_ENABLED="enabled",this.PARAM_PLATFORM="platform",this.PARAM_VERSION="version",this.PARAM_TOPICS="topics",this.PARAM_EVENT_TYPE="eventType",this.PARAM_PUSH_ID="pushId",this.PARAM_CLICKED_BUTTON="clickedButton",this.PARAM_PERMISSION_TYPE="permissionType",this.PARAM_LATITUDE="latitude",this.PARAM_LONGITUDE="longitude",this.PARAM_INAPP_ID="inAppId",this.PARAM_INAPP_EVENT_TYPE="eventType",this.PARAM_INAPP_CLICKED_BUTTON="clickedButton",this.PARAM_INAPP_LAST_VERSION_ID="lastVersionId",this.PARAM_INBOX_EXTERNALID="externalId",this.PARAM_INBOX_PAGE="page",this.PARAM_INBOX_PAGE_SIZE="pageSize",this.PARAM_INBOX_DATE_FROM="dateFrom",this.PARAM_INBOX_DATE_TO="dateTo",this.PARAM_INBOX_STATUS="status",this.PARAM_INBOX_SENDER_IDS="sendingIds",this.PARAM_CUSTOMER_ID="customerId",this.PARAM_CUSTOMER_FIELD_NAMES="fieldNames",this.PARAM_CUSTOMER_FIELDS="fields",this.PARAM_CUSTOMER_LINK="link",this.PARAM_CUSTOMER_CHANNEL="channel",this.appKey=(new u).getAppKey(),this.params=null,this.pathParams={},this.headers={}}getParams(){return"?"+this.PARAM_APP_KEY+"="+this.appKey+(this.params?"&"+this.params:"")}getBody(){return this.body?this.body:""}getPath(e){let t=e;return Object.keys(this.pathParams).forEach((e=>{t=t.replace(e,this.pathParams[e])})),t}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}isServiceWorkerRequest(){return this.serviceWorkerRequest}setServiceWorkerRequest(e){this.serviceWorkerRequest=e}isJourneyRequest(){return this.journeyRequest}setJourneyRequest(e){this.journeyRequest=e}},m=Object.freeze({PUSH:"push",INAPP:"inapp",CHAT:"chat"}),N=class{constructor(e=null,t){null==e?(this.browserPublicKey=(new u).getBrowserPublicKey(),this.browserPrivateKey=(new u).getBrowserPrivateKey(),this.platform=(new u).getPlatform(),this.version=(new u).getVersion(),this.browserName=(new u).getBrowserName(),this.browserVersion=(new u).getBrowserVersion(),this.osName=(new u).getOsName(),this.osVersion=(new u).getOsVersion(),this.deviceType=(new u).getDeviceType(),(new u).getEnabled()&&(this.enabled="true"===(new u).getEnabled()),(new u).getExternalId()&&(this.externalCode=(new u).getExternalId())):t?(e.enabled&&(this.enabled=e.enabled,(new u).setEnabled(this.enabled)),e.registeredByCookie&&(this.registeredByCookie=e.registeredByCookie,(new u).setRegisteredByCookie(this.registeredByCookie))):(e.browserPublicKey&&(this.browserPublicKey=e.browserPublicKey),e.browserPrivateKey&&(this.browserPrivateKey=e.browserPrivateKey),e.platform&&(this.platform=e.platform),e.version&&(this.version=e.version),e.osVersion&&(this.osVersion=e.osVersion),e.browserName&&(this.browserName=e.browserName),e.browserVersion&&(this.browserVersion=e.browserVersion),e.osName&&(this.osName=e.osName),e.deviceType&&(this.deviceType=e.deviceType),e.enabled&&(this.enabled=e.enabled),e.externalCode&&(this.externalCode=e.externalCode)),this.platform&&(this.productName=this.platform),this.version&&(this.productVersion=this.version),navigator&&"language"in navigator&&(this.locale=navigator.language),Intl&&"DateTimeFormat"in Intl&&(this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone),this.timeOffset=-(new Date).getTimezoneOffset()}getDeviceId(){return this.deviceId}setDeviceId(e){this.deviceId=e}setExternalCode(e){this.externalCode=e}toJSON(){const e={};return this.platform&&(e.platform=this.platform),this.version&&(e.version=this.version),this.productName&&(e.productName=this.productName),this.productVersion&&(e.productVersion=this.productVersion),this.browserName&&(e.browserName=this.browserName),this.browserVersion&&(e.browserVersion=this.browserVersion),this.osName&&(e.osName=this.osName),this.osVersion&&(e.osVersion=this.osVersion),this.deviceType&&(e.deviceType=this.deviceType),this.locale&&(e.locale=this.locale),this.timeZone&&(e.timeZome=this.timeZone),this.timeOffset&&(e.timeOffset=this.timeOffset),this.enabled&&(e.enabled=this.enabled),this.browserPublicKey&&(e.browserPublicKey=this.browserPublicKey),this.browserPrivateKey&&(e.browserPrivateKey=this.browserPrivateKey),this.externalCode&&(e.externalCode=this.externalCode),e}},y=Object.freeze({DEFAULT:-1,ENABLE:1,DISABLE:0}),w=Object.freeze({EVENT_TYPE_CLICK:"click",EVENT_TYPE_RECEIVE:"receive",EVENT_TYPE_UPDATE:"update",EVENT_TYPE_ACCEPT:"accept",EVENT_TYPE_REJECT:"reject",EVENT_TYPE_ASK:"ask"}),C=Object.freeze({SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe"}),D=class{static isServiceTimestampExceed(){return!(new u).getServiceTimestamp()||(new u).getServiceSyncTime()<=(Date.now()-(new u).getServiceTimestamp())/6e4}static isFunction(e){return!(!e||"function"!=typeof e)}},b=class{static async getPermissions(){const e=await this.getPermission("geolocation"),t={};return e&&(t.location=e.state),t}static async getPermission(e){try{if(navigator&&navigator.permissions&&navigator.permissions.query&&e)return await navigator.permissions.query({name:e,userVisibleOnly:!0})}catch(e){return null}return null}static async setPermissionsCallback(){await this.setCallback("geolocation",navigator.indigitallRequestLocationPermission)}static async setCallback(e,t){const s=await this.getPermission(e);if(s){let i=s.state;"onchange"in s&&(s.onchange=()=>{new p("[IND]CorePermissions: ").d(e+" permission state has changed from "+i+" to "+s.state).writeLog(),i=s.state,t&&t({name:e,state:s.state})})}}},f=new p("[IND]Crypto"),L=new TextEncoder("utf-8"),v="HMAC",B=class{static async createHmac(e,t){try{const s=window?.crypto?.subtle;if(!s)return;const i=await s.importKey("raw",L.encode(e),{name:v,hash:{name:"SHA-256"}},!1,["sign","verify"]),r=await s.sign(v,i,L.encode(t)),n=new Uint8Array(r),o=Array.prototype.map.call(n,(e=>("00"+e.toString(16)).slice(-2))).join("");return f.d("hmac: ",o).writeLog(),o}catch(e){return void f.e("error:",e).writeLog()}}},U=class{static compareJSON(e,t){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const i of s)if(e[i]!==t[i]){if("object"!=typeof e[i]||"object"!=typeof t[i])return!1;if(!isEqual(e[i],t[i]))return!1}return!0}},M=class{static isValidFormat(e){return null!=e&&""!=e&&"null"!=e&&e.length>8}},V=class{static setTopicChannel(e,t){const s=[];for(let i=0;i<e.length;i++){const r=e[i];r.channel=t,s.push(r)}return s}},x={Repository:u,Config:c,Api:i,Models:r,Utils:n}},391:e=>{"use strict";e.exports=JSON.parse('{"name":"indigitall-web-core","description":"indigitall web core","version":"4.3.1","main":"index.js","author":"Smart2me S.L.","homepage":"https://indigitall.com","devDependencies":{"@babel/preset-env":"^7.18.10","babel-loader":"^8.2.5","filemanager-webpack-plugin":"^7.0.0","idempotent-babel-polyfill":"^7.4.4","script-loader":"^0.7.2","webpack":"^5.74.0","webpack-bundle-analyzer":"^4.6.1","webpack-cli":"^4.10.0"},"scripts":{"test":"echo \'There are not tests\'","public":"ws --directory ./public --port 80 --log.format dev","build":"webpack --config webpack.config.js --mode=production","build-dev":"webpack --config webpack.config.js --watch --mode=development","delete-node-modules":"rm -rf node_modules/ && rm -f package-lock.json","install-core":"npm install && npm run build"}}')}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,s),n.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";s.r(r),s.d(r,{default:()=>L});const{Repository:e}=s(57).Core,t=new class extends e{constructor(){super(),this.AUTH_TOKEN=this.REPOSITORY+".AUTH_TOKEN",this.INBOX_AUTH_MODE=this.REPOSITORY+".INBOX_AUTH_MODE",this.URL_INBOX_API=this.REPOSITORY+".URL_INBOX_API"}async setDeviceId(e){this.setStorage(this.DEVICE_ID,e)}getDeviceId(){return this.getStorage(this.DEVICE_ID)}setAuthToken(e){this.setStorage(this.AUTH_TOKEN,e)}getAuthToken(){return this.getStorage(this.AUTH_TOKEN)}setInboxAuthMode(e){this.setStorage(this.INBOX_AUTH_MODE,e)}getInboxAuthMode(){return this.getStorage(this.INBOX_AUTH_MODE)}async getUrlInboxApi(){return this.getStorage(this.URL_INBOX_API)}async setUrlInboxApi(e){this.setStorage(this.URL_INBOX_API,e)}},{BaseClient:n}=s(57).Core.Api,{Config:o}=s(57).Core,{ErrorModel:a}=s(57).Core.Models,{CommonUtils:c}=s(57).Core.Utils,l=new class extends n{constructor(){super(),this.URL_BASE=o.client.INBOX_URL_BASE,this.ENDPOINT_INBOX_NOTIFICATIONS="/notification",this.ENDPOINT_INBOX_NOTIFICATIONS_WITH_SENDINGID=this.ENDPOINT_INBOX_NOTIFICATIONS+"/{sendingId}",this.ENDPOINT_INBOX_COUNTER="/counters",this.ENDPOINT_INBOX_AUTH="/auth/webhook"}async getURL(){return await t.getUrlInboxApi()||this.URL_BASE}async postInboxAuth(e,s,i){const r=await this.post(this.ENDPOINT_INBOX_AUTH,e.postInboxAuth());if(!r||r instanceof a||!r.data)r?c.isFunction(i)&&i(r):c.isFunction(i)&&i();else{const e=r.data.token;t.setAuthToken(e),c.isFunction(s)&&s(r)}return!0}async getInbox(e,t,s){const i=await this.get(this.ENDPOINT_INBOX_NOTIFICATIONS,e.getInboxPushRequest());return this.getInboxResponseStatus(i,t,s),!0}async putInboxPush(e,t,s){const i=await this.put(this.ENDPOINT_INBOX_NOTIFICATIONS,e.putInboxPushRequest());return this.getInboxResponseEdit(i,t,s),!0}async getInboxPushWithSendingId(e,t,s,i){const r=await this.get(this.ENDPOINT_INBOX_NOTIFICATIONS_WITH_SENDINGID,e.getInboxPushRequestWithSendingId());return this.getNotificationResponseStatus(r,t,s,i),!0}async putInboxPushWithSendingId(e,t,s,i){const r=await this.put(this.ENDPOINT_INBOX_NOTIFICATIONS_WITH_SENDINGID,e.putInboxWithSendingId());return this.getNotificationResponseStatus(r,t,s,i),!0}async getInboxCounter(e,t,s){const i=await this.get(this.ENDPOINT_INBOX_COUNTER,e.getCounter());this.getCounterStatus(i,t,s)}async getInboxResponseStatus(e,t,s){if(e&&!(e instanceof a)&&e.statusCode>=200&&e.statusCode<300){const s=new L(e.data);c.isFunction(t)&&t(s)}else e?c.isFunction(s)&&s(e):c.isFunction(s)&&s()}async getInboxResponseEdit(e,t,s){e&&!(e instanceof a)&&e.statusCode>=200&&e.statusCode<300?c.isFunction(t)&&t():e?c.isFunction(s)&&s(e):c.isFunction(s)&&s()}getNotifications(e,t){const s=[];for(let i=0;i<e.length;i++){null!=e[i].sentAt&&null!=t&&e[i].sentAt<t&&(read=!0);const r=new InboxNotification(e[i],t);s.push(r)}return s}async getNotificationResponseStatus(e,t,s,r){if(e&&!(e instanceof a)&&e.statusCode>=200&&e.statusCode<300){const e=new InboxNotification(notifications[i],t);c.isFunction(s)&&s(e)}else e?c.isFunction(r)&&r(e):c.isFunction(r)&&r()}async getCounterStatus(e,t,s){if(e&&!(e instanceof a)&&e.statusCode>=200&&e.statusCode<300){const s={click:e.data.click,sent:e.data.sent,deleted:e.data.deleted,unread:this.getUnreadCounters(e.data.unread)};c.isFunction(t)&&t(s)}else e?c.isFunction(s)&&s(e):c.isFunction(s)&&s()}getUnreadCounters(e){return{count:e.count,lastAccess:e.lastAccess}}},{BaseRequest:E}=s(57).Core.Api,h=class extends E{constructor(){super()}postInboxAuth(){return this.body=this.json,this}setJson(e){this.json=e}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}},I=Object.freeze({SENT:"sent",CLICK:"click",DELETED:"deleted"});window.inboxStatus=I;const d=I,u=Object.freeze({NONE:"none",DEFAULT:"default",WEBHOOK:"webhook"}),{BaseRequest:g}=s(57).Core.Api,R=class extends g{constructor(){super(),null!=t.getExternalId()&&(this.externalId=t.getExternalId()),null!=t.getAuthToken()&&t.getInboxAuthMode()==u.WEBHOOK&&(this.headers.Authorization="Bearer "+t.getAuthToken()),this.sendingId="",this.sendingIds=null,this.page=0,this.pageSize=0,this.dateFrom="",this.dateTo="",this.status=d.INBOXSTATUS_SENT,this.statusList=null}getInboxPushRequest(){return this.params=this.createQueryString(),this}putInboxPushRequest(){return this.params=this.createQueryStringExternalId(),this.body=this.createBodyJson(),this}getInboxPushRequestWithSendingId(){return this.pathParams["{sendingId}"]=this.sendingId,this.params=this.createQueryStringExternalId(),this}putInboxWithSendingId(){return this.pathParams["{sendingId}"]=this.sendingId,this.params=this.createQueryStringExternalId(),this.body=this.createBodyStatusJson(),this}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}createQueryString(){let e="";if(this.page&&(e+=this.PARAM_INBOX_PAGE+"="+this.page+"&"),this.pageSize&&(e+=this.PARAM_INBOX_PAGE_SIZE+"="+this.pageSize+"&"),this.dateFrom&&(e+=this.PARAM_INBOX_DATE_FROM+"="+this.dateFrom+"&"),this.dateTo&&(e+=this.PARAM_INBOX_DATE_TO+"="+this.dateTo+"&"),this.statusList){let t="";for(let e=0;e<this.statusList.length;e++)t+=this.statusList[e],e!=this.statusList.length-1&&(t+=",");e+=this.PARAM_INBOX_STATUS+"="+t+"&"}return e+this.createQueryStringExternalId()}createQueryStringExternalId(){return this.PARAM_INBOX_EXTERNALID+"="+this.externalId}createBodyJson(){let e={};const t=[];try{if(e=this.createBodyStatusJson(),this.sendingIds)for(let e=0;e<this.sendingIds.length;e++)t.push(this.sendingIds[e]);e.sendingIds=t}catch(e){console.log("Error Inbox request :"+e)}return e}createBodyStatusJson(){const e={};return this.status&&(e.status=this.status),e}setSendingId(e){this.sendingId=e}setSendingIds(e){this.sendingIds=e}setPage(e){this.page=e}setPageSize(e){this.pageSize=e}setDateFrom(e){this.dateFrom=e}setDateTo(e){this.dateTo=e}setStatus(e){this.status=e}setStatusList(e){this.statusList=e}},{BaseRequest:_}=s(57).Core.Api,p=class extends _{constructor(){super(),null!=t.getExternalId()&&(this.externalId=t.getExternalId()),null!=t.getAuthToken()&&t.getInboxAuthMode()==u.WEBHOOK&&(this.headers.Authorization="Bearer "+t.getAuthToken())}getCounter(){return this.params=this.createQueryStringExternalId(),this}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}createQueryStringExternalId(){return this.PARAM_INBOX_EXTERNALID+"="+this.externalId}};class T{constructor(e,t){e&&(e.id&&(this.id=e.id),e.externalId&&(this.externalId=e.externalId),e.sentAt&&(this.sentAt=e.sentAt),e.status&&(this.status=e.status),e.sendingId&&(this.sendingId=e.sendingId),e.message&&(this.message=e.message),e.campaignId&&(this.campaignId=e.campaignId),this.read=!1,this.sentAt&&t&&this.sentAt<t&&(this.read=!0))}}window.inboxNotification=T;const A=T,{ErrorDictionary:S}=s(57).Core.Models,O=S.ErrorCode;Object.assign(O,{INBOX_GET_ERROR:3001,INBOX_GET_PAGE_ERROR:3011,INBOX_EXTERNAL_ID_NO_REGISTERED:3012,INBOX_NO_MESSAGES:3013,INBOX_IS_REQUESTING_PAGE:3014,INBOX_EMPTY:3015,INBOX_GENERAL_ERROR:3600});const P=S.ErrorMessage;Object.assign(P,{INBOX_GET_ERROR:"inbox GET request error",INBOX_GET_PAGE_ERROR:"error inbox get page",INBOX_EXTERNAL_ID_NO_REGISTERED:"external Id is not registered",INBOX_NO_MESSAGES:"There are no more messages on Inbox",INBOX_IS_REQUESTING_PAGE:"Wait. Is Requesting new page",INBOX_EMPTY:"There are no messages on Inbox",INBOX_GENERAL_ERROR:"general error"});const m={ErrorCode:O,ErrorMessage:P},{Validations:N,Log:y}=s(57).Core.Utils,w=class extends N{static isAppKeyFormat(){const e=t.getAppKey();return null!=e&&""!=e&&"null"!=e&&e.length>3}static isValidFormatRequest(){const e=new y("[IND]InboxValidations: "),s=t.getDeviceId();let i=!0;return this.isAppKeyFormat()||(i=!1,e.w("appKey is null or empty").writeLog()),this.isValidFormat(s)||(i=!1,e.w("deviceId is null or empty").writeLog()),i}},{CommonUtils:C,ErrorUtils:D,Log:b}=s(57).Core.Utils;class f{constructor(e){if(e){if(e.lastAccess&&(this.lastAccess=e.lastAccess),e.numPage?this.page=e.numPage:this.page=0,e.pageSize&&(this.pageSize=e.pageSize),e.count&&(this.count=e.count),e.notifications){this.notifications=[];const t=e.notifications;for(let e=0;e<t.length;e++){const s=new A(t[e],this.lastAccess);this.notifications.push(s)}}this.totalPages=Math.trunc(this.count/this.pageSize)}this.dateFrom=null,this.dateTo=null,this.statusList=null,this.newNotifications=[A],this.isRequestingPage=!1}static generateAuthToken(e,t){let s={};navigator.indigitallGetAuthConfig&&C.isFunction(navigator.indigitallGetAuthConfig)&&(s=navigator.indigitallGetAuthConfig());const i=new h;i.setJson(s),l.postInboxAuth(i,e,t)}static getMessagesCountWithAuth(e,t,s){C.isFunction(e.getAuthConfig)&&(navigator.indigitallGetAuthConfig=getAuthConfig),f.getMessagesCount(t,s)}static setUrlInboxApi(e){t.setUrlInboxApi(e)}static setInboxAuthMode(e){t.setInboxAuthMode(e)}static getMessagesCount(e,s){if(w.isValidFormatRequest())if(w.isValidFormat(t.getExternalId())){const t=new p;l.getInboxCounter(t,e,(s=>{401===s.errorCode?this.generateAuthToken((()=>{l.getInboxCounter(t,e,s)}),s):C.isFunction(s)&&s(s)}))}else C.isFunction(s)&&s(D.showError(m,m.ErrorCode.INBOX_GET_ERROR));else C.isFunction(s)&&s(D.showError(m,m.ErrorCode.GENERAL_ERROR_BAD_REQUEST))}static getInboxWithAuth(e,t,s){C.isFunction(e.getAuthConfig)&&(navigator.indigitallGetAuthConfig=getAuthConfig),f.getInbox(t,s)}static getInbox(e,t){f.getInboxWithPage(null,null,null,null,null,e,t)}static getInboxWithPageAuth(e,t,s,i,r,n,o,a){C.isFunction(e.getAuthConfig)&&(navigator.indigitallGetAuthConfig=getAuthConfig),f.getInboxWithPage(t,s,i,r,n,o,a)}static getInboxWithPage(e,s,i,r,n,o,a){if(w.isValidFormatRequest())if(w.isValidFormat(t.getExternalId())){const t=new R;e&&t.setPage(e),s&&t.setPageSize(s),i&&(t.setDateFrom(i),this.dateFrom=i),r&&(t.setDateTo(r),this.dateTo=r),n&&(t.setStatusList(n),this.statusList=n),l.getInbox(t,(e=>{this.totalPages=e.totalPages,0!=e.count?C.isFunction(o)&&o(e):C.isFunction(a)&&a(D.showError(m,m.ErrorCode.INBOX_GET_PAGE_ERROR))}),(e=>{401==e.errorCode?this.generateAuthToken((()=>{l.getInbox(t,(e=>{this.totalPages=e.totalPages,C.isFunction(o)&&o(e)}),e)}),e):C.isFunction(e)&&e(e)}))}else C.isFunction(a)&&a(D.showError(m,m.ErrorCode.INBOX_EXTERNAL_ID_NO_REGISTERED));else C.isFunction(a)&&a(D.showError(m,m.ErrorCode.GENERAL_ERROR_BAD_REQUEST))}getNextPage(e,s){const i=new b("[IND]Inbox: ");if(this.isRequestingPage)i.w(m.ErrorMessage.INBOX_IS_REQUESTING_PAGE).writeLog();else if(this.isRequestingPage=!0,this.page+1<this.totalPages)if(w.isValidFormatRequest())if(w.isValidFormat(t.getExternalId())){const t=new R;(this.page||0==this.page)&&t.setPage(this.page+1),this.pageSize&&t.setPageSize(this.pageSize),this.dateFrom&&t.setDateFrom(this.dateFrom),this.dateTo&&t.setDateTo(this.dateTo),this.statusList&&t.setStatusList(this.statusList),l.getInbox(t,(t=>{this.notifications=this.notifications.concat(t.notifications),this.newNotifications=t.notifications,this.lastAccess=t.lastAccess,this.count=t.count,this.page=t.page,this.pageSize=t.pageSize,this.totalPages=t.totalPages,this.isRequestingPage=!1,C.isFunction(e)&&e(this,this.newNotifications)}),(s=>{401===s.errorCode?this.generateAuthToken((()=>{l.getInbox(t,(t=>{this.notifications=this.notifications.concat(t.notifications),this.newNotifications=t.notifications,this.lastAccess=t.lastAccess,this.count=t.count,this.page=t.page,this.pageSize=t.pageSize,this.totalPages=t.totalPages,this.isRequestingPage=!1,C.isFunction(e)&&e(this,this.newNotifications)}),s)}),s):(this.isRequestingPage=!1,C.isFunction(s)&&s())}))}else this.isRequestingPage=!1,C.isFunction(s)&&s(D.showError(m,m.ErrorCode.INBOX_EXTERNAL_ID_NO_REGISTERED));else C.isFunction(s)&&s(D.showError(m,m.ErrorCode.GENERAL_ERROR_BAD_REQUEST));else this.isRequestingPage=!1,C.isFunction(s)&&s(D.showError(m,m.ErrorCode.INBOX_NO_MESSAGES))}massiveEditNotifications(e,s,i,r){if(w.isValidFormatRequest())if(w.isValidFormat(t.getExternalId())){if(e&&s){const t=new R;t.setSendingIds(e),t.setStatus(s),l.putInboxPush(t,i,(e=>{401===e.errorCode?this.generateAuthToken((()=>{l.putInboxPush(t,i,e)}),e):C.isFunction(e)&&e(e)}))}}else C.isFunction(r)&&r(D.showError(m,m.ErrorCode.INBOX_EXTERNAL_ID_NO_REGISTERED));else C.isFunction(r)&&r(D.showError(m,m.ErrorCode.BAD_REQUEST_SERVER_ERROR))}getInfoFromNotification(e,s,i){if(w.isValidFormatRequest())if(w.isValidFormat(t.getExternalId())){if(e){const t=new R;t.setSendingId(e),l.getInboxPushWithSendingId(t,this.lastAccess,s,(e=>{401===e.errorCode?this.generateAuthToken((()=>{l.getInboxPushWithSendingId(t,this.lastAccess,s,e)}),e):C.isFunction(e)&&e(e)}))}}else C.isFunction(i)&&i(D.showError(m,m.ErrorCode.INBOX_EXTERNAL_ID_NO_REGISTERED));else C.isFunction(i)&&i(D.showError(m,m.ErrorCode.BAD_REQUEST_SERVER_ERROR))}modifyStatusFromNotification(e,s,i,r){if(w.isValidFormatRequest())if(w.isValidFormat(t.getExternalId())){if(e&&s){const t=new R;t.setSendingId(e),t.setStatus(s),l.putInboxPushWithSendingId(t,this.lastAccess,i,(e=>{401===e.errorCode?this.generateAuthToken((()=>{l.putInboxPushWithSendingId(t,this.lastAccess,i,e)}),e):C.isFunction(e)&&e(e)}))}}else C.isFunction(r)&&r(D.showError(m,m.ErrorCode.INBOX_EXTERNAL_ID_NO_REGISTERED));else C.isFunction(r)&&r(D.showError(m,m.ErrorCode.BAD_REQUEST_SERVER_ERROR))}}const L=f})(),r})(),e.exports=t()},391:e=>{"use strict";e.exports=JSON.parse('{"name":"indigitall-web-core","description":"indigitall web core","version":"4.3.1","main":"index.js","author":"Smart2me S.L.","homepage":"https://indigitall.com","devDependencies":{"@babel/preset-env":"^7.18.10","babel-loader":"^8.2.5","filemanager-webpack-plugin":"^7.0.0","idempotent-babel-polyfill":"^7.4.4","script-loader":"^0.7.2","webpack":"^5.74.0","webpack-bundle-analyzer":"^4.6.1","webpack-cli":"^4.10.0"},"scripts":{"test":"echo \'There are not tests\'","public":"ws --directory ./public --port 80 --log.format dev","build":"webpack --config webpack.config.js --mode=production","build-dev":"webpack --config webpack.config.js --watch --mode=development","delete-node-modules":"rm -rf node_modules/ && rm -f package-lock.json","install-core":"npm install && npm run build"}}')}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,s),n.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";s.r(r),s.d(r,{default:()=>Re});var e=s(557),t=s.n(e);const{Repository:i}=s(916).Core,n=new class extends i{constructor(){super(),this.SAFARI_WEBSITE_PUSH_ID=this.REPOSITORY+".SAFARI_WEBSITE_PUSH_ID",this.PUSH_TOKEN=this.REPOSITORY+".PUSH_TOKEN",this.PERMISSION_PUSH=this.REPOSITORY+".PERMISSION_PUSH",this.URL_DEVICE_API=this.REPOSITORY+".URL_DEVICE_API",this.DEVICE_JSON=this.REPOSITORY+".DEVICE_JSON",this.PUT_REQUEST_TIMESTAMP=this.REPOSITORY+".PUT_REQUEST_TIMESTAMP",this.WORKER_PATH=this.REPOSITORY+".WORKER_PATH",this.TEST=this.REPOSITORY+".TEST",this.SAFARI_GESTURE_REQUEST_PERMISSION=this.REPOSITORY+".SAFARI_GESTURE_REQUEST_PERMISSION",this.UPDATE_TOPIC_SUBSCRIBE=this.REPOSITORY+".UPDATE_TOPIC_SUBSCRIBE",this.TOPIC_SYNC_TIMESTAMP=this.REPOSITORY+".TOPIC_SYNC_TIMESTAMP",this.TOPIC_SEMAPHORE=this.REPOSITORY+".TOPIC_SEMAPHORE",this.TOPIC_SYNC_IS_PROCESSING=this.REPOSITORY+".TOPIC_SYNC_IS_PROCESSING"}async setDeviceId(e){this.storage&&this.storage.isLocalStorageAvailable()&&this.setStorage(this.DEVICE_ID,e),this.db&&this.db.IDB&&await this.db.setItem(this.DEVICE_ID,e)}getDeviceId(){return this.getStorage(this.DEVICE_ID)}async getDeviceIdSync(){if(this.db&&this.db.IDB)return await this.db.getItem(this.DEVICE_ID)}setPushToken(e){this.setStorage(this.PUSH_TOKEN,e)}getPushToken(){return this.getStorage(this.PUSH_TOKEN)}setSafariWebsitePushId(e){this.setStorage(this.SAFARI_WEBSITE_PUSH_ID,e)}getSafariWebsitePushId(){return this.getStorage(this.SAFARI_WEBSITE_PUSH_ID)}setPermissionPush(e){this.setStorage(this.PERMISSION_PUSH,e)}getPermissionPush(){return this.getStorage(this.PERMISSION_PUSH)}async getUrlDeviceApi(){let e;try{this.storage&&this.storage.isLocalStorageAvailable()?e=this.getStorage(this.URL_DEVICE_API):this.db&&this.db.IDB&&(e=await this.db.getItem(this.URL_DEVICE_API))}catch(e){}return e}async setUrlDeviceApi(e){this.storage&&this.storage.isLocalStorageAvailable()&&this.setStorage(this.URL_DEVICE_API,e),this.db&&this.db.IDB&&await this.db.setItem(this.URL_DEVICE_API,e)}async getDeviceJson(){return this.getStorage(this.DEVICE_JSON)}async setDeviceJson(e){this.setStorage(this.DEVICE_JSON,e)}async getPutRequestTimestamp(){return this.getStorage(this.PUT_REQUEST_TIMESTAMP)}async setPutRequestTimestamp(e){this.setStorage(this.PUT_REQUEST_TIMESTAMP,e)}setWorkerPath(e){this.setStorage(this.WORKER_PATH,e)}getWorkerPath(){return this.getStorage(this.WORKER_PATH)}setTestValue(e){this.setStorage(this.TEST,e)}getTestValue(){return this.getStorage(this.TEST)}setSafariGestureRequestPermission(e){this.setStorage(this.SAFARI_GESTURE_REQUEST_PERMISSION,e)}getSafariGestureRequestPermission(){return this.getStorage(this.SAFARI_GESTURE_REQUEST_PERMISSION)}async setUpdateTopicSubscribe(e){this.db&&this.db.IDB&&await this.db.setItem(this.UPDATE_TOPIC_SUBSCRIBE,e)}async getUpdateTopicSubscribe(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.UPDATE_TOPIC_SUBSCRIBE))}catch(e){}return e}async setTopicSyncTimestamp(e){this.db&&this.db.IDB&&await this.db.setItem(this.TOPIC_SYNC_TIMESTAMP,e)}async getTopicSyncTimestamp(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.TOPIC_SYNC_TIMESTAMP))}catch(e){}return e}async setTopicSemaphore(e){this.db&&this.db.IDB&&await this.db.setItem(this.TOPIC_SEMAPHORE,e)}async getTopicSemaphore(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.TOPIC_SEMAPHORE))}catch(e){}return e}async setTopicSyncIsProcessing(e){this.db&&this.db.IDB&&await this.db.setItem(this.TOPIC_SYNC_IS_PROCESSING,e)}async getTopicSyncIsProcessing(){let e;try{this.db&&this.db.IDB&&(e=await this.db.getItem(this.TOPIC_SYNC_IS_PROCESSING))}catch(e){}return e}},{ErrorDictionary:o}=s(916).Core.Models,a=o.ErrorCode;Object.assign(a,{GENERAL_ERROR_BAD_REQUEST:601,GENERAL_ERROR_APPKEY_BAD_REQUEST:602,PUSH_INITIALIZATION_ERROR:1e3,PUSH_RECEPTION_ERROR:1200,PUSH_TOPICS_ERROR:1400,PUSH_DEVICE_ERROR:1500,PUSH_EVENT_ERROR:1600,API_APPKEY_NOT_VALID:1601});const c=o.ErrorMessage;Object.assign(c,{GENERAL_ERROR_BAD_REQUEST:"AppKey or DeviceId are null or empty",GENERAL_ERROR_APPKEY_BAD_REQUEST:"AppKey is null or empty",PUSH_INITIALIZATION_ERROR:"initialization error",PUSH_RECEPTION_ERROR:"push reception error",PUSH_TOPICS_ERROR:"push topics error",PUSH_DEVICE_ERROR:"device error",PUSH_EVENT_ERROR:"event error",API_APPKEY_NOT_VALID:"appKey is missing'"});const l={ErrorCode:a,ErrorMessage:c},{BaseRequest:E}=s(916).Core.Api,{EventType:h}=s(916).Core.Models,I=class extends E{constructor(){super()}setEventType(e){this.eventType=e}setPushId(e){this.pushId=e}setClickedButton(e){this.clickedButton=e}setSendingId(e){this.sendingId=e}setPermissionType(e){this.permissionType=e}setLocation(e,t){this.latitude=e,this.longitude=t}setDeviceId(e){this.deviceId=e}setPlatform(e){this.platform=e}setAppKey(e){this.appKey=e}setCustomData(e){this.customData=e}async setExternalCodeRequest(){this.externalCode=await n.getExternalIdRequest()}setExternalCode(e){this.externalCode=e}setCampaingId(e){this.campaignId=e}setJourneyStateId(e){this.journeyStateId=e}setJourneyExecution(e){this.journeyExecution=e}setCjCurrentStateId(e){this.cjCurrentStateId=e}postEventPushRequest(){const e={};return e.deviceId=this.deviceId,e.platform=this.platform,this.eventType&&(e.eventType=this.eventType),this.pushId&&(e.pushId=this.pushId),e.clickedButton=this.clickedButton,null!=this.externalCode&&(e.externalCode=this.externalCode),this.sendingId&&"undefined"!=this.sendingId&&(e.sendingId=this.sendingId),this.journeyStateId&&(e.journeyStateId=this.journeyStateId),this.journeyExecution&&(e.journeyExecution=this.journeyExecution),this.cjCurrentStateId&&(e.cjCurrentStateId=this.cjCurrentStateId),this.campaignId&&(e.campaignId=this.campaignId),this.body=e,this}postEventVisitRequest(){const e={};return e.deviceId=n.getDeviceId(),e.eventType=h.EVENT_TYPE_UPDATE,this.body=e,this}postEventPermissionRequest(){const e={};return e.deviceId=n.getDeviceId(),this.eventType&&(e.eventType=this.eventType),this.permissionType&&(e.permissionType=this.permissionType),this.body=e,this}postEventLocationRequest(){const e={};return e.deviceId=n.getDeviceId(),e.eventType=h.EVENT_TYPE_UPDATE,this.latitude&&(e.latitude=this.latitude),this.longitude&&(e.longitude=this.longitude),this.body=e,this}postEventCustomRequest(){const e={};return this.deviceId&&(e.deviceId=this.deviceId),this.eventType&&(e.eventType=this.eventType),this.customData&&(e.customData=this.customData),this.externalCode&&(e.externalCode=this.externalCode),this.body=e,this}},d=class{static urlBase64ToUint8Array(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),s=window.atob(t),i=new Uint8Array(s.length);for(let e=0;e<s.length;++e)i[e]=s.charCodeAt(e);return i}static callEventPermission(e,t){const s=new I;s.setAppKey(n.getAppKey()),s.setDeviceId(n.getDeviceId()),s.setPermissionType(e),s.setEventType(t),w.postEventPermission(s)}static async getPutRequestTimestamp(){return await n.getPutRequestTimestamp()?n.getPutRequestTimestamp():Date.now()+6048e5}},{Validations:u,Log:g}=s(916).Core.Utils,R=class extends u{static isAppKeyFormat(){const e=n.getAppKey();return null!=e&&""!=e&&"null"!=e&&e.length>3}static isValidFormatRequest(){const e=new g("[IND]PushValidations: "),t=n.getDeviceId();let s=!0;return this.isAppKeyFormat()||(s=!1,e.w("appKey is null or empty").writeLog()),this.isValidFormat(t)||(s=!1,e.w("deviceId is null or empty").writeLog()),s}static async isPutRequestExceed(){return await d.getPutRequestTimestamp()<=Date.now()}static isSafariBrowserDevice(){const e=window.navigator.userAgent,t=!!e.match(/iPad/i)||!!e.match(/iPhone/i),s=!!e.match(/WebKit/i);return t&&s&&!e.match(/CriOS/i)&&!e.match(/OPiOS/i)}},{Device:_}=s(916).Core.Models,p=class extends _{constructor(e=null,t){super(e,t),null==e?(null!=n.getDeviceId()&&(this.deviceId=n.getDeviceId()),null!=n.getPushToken()&&(this.pushToken=n.getPushToken())):t?e.deviceId&&(this.deviceId=e.deviceId,n.setDeviceId(this.deviceId)):(e.deviceId&&(this.deviceId=e.deviceId),e.pushToken&&(this.pushToken=e.pushToken))}static setDeviceJson(e){n.setDeviceJson(JSON.stringify(e.toJSON()))}getDeviceId(){return this.deviceId}getPushToken(){return this.pushToken}toJSON(){const e=super.toJSON();return this.deviceId&&(e.deviceId=this.deviceId),this.pushToken&&(e.pushToken=this.pushToken),e}},{Config:T}=s(916).Core,{BaseClient:A}=s(916).Core.Api,{ErrorModel:S,Channel:O}=s(916).Core.Models,{TopicUtils:P,Log:m,CommonUtils:N,ErrorUtils:y}=s(916).Core.Utils,w=new class extends A{constructor(){super(),this.URL_BASE=T.client.URL_BASE,this.ENDPOINT_APPLICATION="/application",this.ENDPOINT_APPLICATION_ALL=this.ENDPOINT_APPLICATION+"/all",this.ENDPOINT_DEVICE="/device",this.ENDPOINT_DEVICE_TOPICS=this.ENDPOINT_DEVICE+"/topics",this.ENDPOINT_PUSH="/push",this.ENDPOINT_EVENT="/event",this.ENDPOINT_EVENT_PUSH=this.ENDPOINT_EVENT+"/push",this.ENDPOINT_EVENT_VISIT=this.ENDPOINT_EVENT+"/visit",this.ENDPOINT_EVENT_PERMISSION=this.ENDPOINT_EVENT+"/permission",this.ENDPOINT_EVENT_LOCATION=this.ENDPOINT_EVENT+"/location",this.ENDPOINT_EVENT_CUSTOM=this.ENDPOINT_EVENT+"/custom",this.ENDPOINT_EVENT_CUSTOM_BEACON=this.ENDPOINT_EVENT_CUSTOM+"/beacon",this.ENDPOINT_BROWSER="/browser",this.log=new m("[IND]Client: ")}async getURL(){return await n.getUrlDeviceApi()||this.URL_BASE}async getApplicationAll(e,t,s){if(R.isAppKeyFormat()){const i=await this.get(this.ENDPOINT_APPLICATION_ALL,e.getApplicationRequest());!i||i instanceof S?i?N.isFunction(s)&&s(i):N.isFunction(s)&&s():N.isFunction(t)&&t(i)}else N.isFunction(s)&&s(y.showError(l,l.ErrorCode.BAD_REQUEST_SERVER_ERROR));return!0}async postDevice(e,t,s){if(R.isAppKeyFormat()){const i=await this.post(this.ENDPOINT_DEVICE,e.postDeviceRequest(),"include");if(!i||i instanceof S)i?N.isFunction(s)&&s(i):N.isFunction(s)&&s();else{const e={enabled:i.data.enabled,deviceId:i.data.deviceId,registeredByCookie:i.data.registeredByCookie};await n.setDeviceId(e.deviceId),N.isFunction(t)&&t(new p(e,!0))}}else N.isFunction(s)&&s(y.showError(l,l.ErrorCode.GENERAL_ERROR_APPKEY_BAD_REQUEST));return!0}async putDevice(e,t,s){const i=new p,r=await R.isPutRequestExceed();if(e.deviceUpdate||null==await n.getPutRequestTimestamp()||r)if(R.isValidFormatRequest()){n.setPutRequestTimestamp(await d.getPutRequestTimestamp());const r=await this.put(this.ENDPOINT_DEVICE,e.putDeviceRequest(i),"include");if(!r||r instanceof S)r?N.isFunction(s)&&s(r):N.isFunction(s)&&s();else{const e={enabled:r.data.enabled,deviceId:r.data.deviceId,registeredByCookie:r.data.registeredByCookie};N.isFunction(t)&&t(new p(e,!0))}}else N.isFunction(s)&&s(y.showError(l,l.ErrorCode.GENERAL_ERROR_BAD_REQUEST));else N.isFunction(t)&&t(i)}async getDevice(e,t,s){if(R.isValidFormatRequest()){const i=await this.get(this.ENDPOINT_DEVICE,e.getDeviceRequest());if(!i||i instanceof S)i?N.isFunction(s)&&s(i):N.isFunction(s)&&s();else{const e={enabled:i.data.enabled,deviceId:i.data.deviceId};N.isFunction(t)&&t(new p(e,!0))}}else N.isFunction(s)&&s(y.showError(l,l.ErrorCode.GENERAL_ERROR_BAD_REQUEST));return!0}async getDeviceTopics(e,t,s){if(R.isValidFormatRequest()){const i=await this.get(this.ENDPOINT_DEVICE_TOPICS,e.getDeviceTopicsRequest());!i||i instanceof S?i?N.isFunction(s)&&s(i):N.isFunction(s)&&s():N.isFunction(t)&&t(P.setTopicChannel(i.data.topics,O.PUSH))}else N.isFunction(s)&&s(y.showError(l,l.ErrorCode.GENERAL_ERROR_BAD_REQUEST));return!0}async postDeviceTopics(e,t,s){return R.isValidFormatRequest()?await this.postDeviceTopicsRequest(e,t,s):N.isFunction(s)&&s(y.showError(l,l.ErrorCode.GENERAL_ERROR_BAD_REQUEST)),!0}async postDeviceTopicsRequest(e,t,s){const i=await this.post(this.ENDPOINT_DEVICE_TOPICS,e.postDeviceTopicsRequest());if(!i||i instanceof S)i?N.isFunction(s)&&s(i):N.isFunction(s)&&s();else{const e=i.data.topics;N.isFunction(t)&&t(e)}}async deleteDeviceTopics(e,t,s){return R.isValidFormatRequest()?this.deleteDeviceTopicsRequest(e,t,s):N.isFunction(s)&&s(y.showError(l,l.ErrorCode.GENERAL_ERROR_BAD_REQUEST)),!0}async deleteDeviceTopicsRequest(e,t,s){const i=await this.delete(this.ENDPOINT_DEVICE_TOPICS,e.deleteDeviceTopicsRequest());if(!i||i instanceof S)i?N.isFunction(s)&&s(i):N.isFunction(s)&&s();else{const e=i.data.topics;N.isFunction(t)&&t(e)}}async postEventPush(e){R.isValidFormatRequest()&&await this.post(this.ENDPOINT_EVENT_PUSH,e.postEventPushRequest())}postEventVisit(e){R.isValidFormatRequest()&&this.post(this.ENDPOINT_EVENT_VISIT,e.postEventVisitRequest())}postEventPermission(e){R.isValidFormatRequest()&&this.post(this.ENDPOINT_EVENT_PERMISSION,e.postEventPermissionRequest())}postEventLocation(e){R.isValidFormatRequest()&&this.post(this.ENDPOINT_EVENT_LOCATION,e.postEventLocationRequest())}async getBrowser(e,t,s){if(R.isAppKeyFormat()){const i=await this.get(this.ENDPOINT_BROWSER,e);if(!i||i instanceof S)i?N.isFunction(s)&&s(i):N.isFunction(s)&&s();else{const e={browserName:i.data.browserName,browserVersion:i.data.browserVersion,deviceType:i.data.deviceType,osName:i.data.osName,osVersion:i.data.osVersion,supported:i.data.supported,platform:i.data.platform};await n.setBrowserName(e.browserName),n.setBrowserVersion(e.browserVersion),await n.setOsName(e.osName),n.setOsVersion(e.osVersion),n.setDeviceType(e.deviceType),n.setSupported(e.supported),R.isSafariBrowserDevice()?await n.setPlatform("webpush"):await n.setPlatform(e.platform),N.isFunction(t)&&t(e)}}else N.isFunction(s)&&s(y.showError(l,l.ErrorCode.GENERAL_ERROR_BAD_REQUEST));return!0}async postEventCustom(e,t,s){if(R.isValidFormatRequest()){const i=await this.post(this.ENDPOINT_EVENT_CUSTOM,e.postEventCustomRequest());!i||i instanceof S?i?N.isFunction(s)&&s(i):N.isFunction(s)&&s():N.isFunction(t)&&t(i)}else N.isFunction(s)&&s(y.showError(l,l.ErrorCode.GENERAL_ERROR_BAD_REQUEST));return!0}async postEventCustomSync(e,t,s){if(R.isValidFormatRequest()){e=e.postEventCustomRequest();try{if(navigator&&"sendBeacon"in navigator){const s=await this.getURL()+this.ENDPOINT_EVENT_CUSTOM_BEACON+e.getParams();navigator.sendBeacon(s,JSON.stringify(e.getBody())),N.isFunction(t)&&t()}else{const i=await this.getURL()+this.ENDPOINT_EVENT_CUSTOM+e.getParams(),r=new XMLHttpRequest;r.open("POST",i,!1),r.setRequestHeader("Content-Type","application/json"),r.onreadystatechange=()=>{r.readyState===XMLHttpRequest.DONE&&(r.status>=200||r.status<300)?N.isFunction(t)&&t():N.isFunction(s)&&s()},r.send(JSON.stringify(e.getBody()))}}catch(e){N.isFunction(s)&&s(y.showError(l,l.ErrorCode.PUSH_EVENT_ERROR,e))}}else N.isFunction(s)&&s(y.showError(l,l.ErrorCode.GENERAL_ERROR_BAD_REQUEST));return!0}async postEventJourney(e,t,s){if(R.isValidFormatRequest()){const i=await this.post(this.ENDPOINT_PUSH+this.ENDPOINT_EVENT_CUSTOM,e.postEventCustomRequest());!i||i instanceof S?i?N.isFunction(s)&&s(i):N.isFunction(s)&&s():N.isFunction(t)&&t(i)}else N.isFunction(s)&&s(y.showError(l,l.ErrorCode.GENERAL_ERROR_BAD_REQUEST));return!0}async postEventJourneySync(e,t,s){if(R.isValidFormatRequest()){e=e.postEventCustomRequest();try{let i=await this.getURL();if(i=i.replace("v1","v2"),navigator&&"sendBeacon"in navigator){const s=i+this.ENDPOINT_PUSH+this.ENDPOINT_EVENT_CUSTOM+e.getParams();navigator.sendBeacon(s,JSON.stringify(e.getBody())),N.isFunction(t)&&t()}else{const i=await this.getURL().replace("v1","v2")+this.ENDPOINT_PUSH+this.ENDPOINT_EVENT_CUSTOM+e.getParams(),r=new XMLHttpRequest;r.open("POST",i,!1),r.setRequestHeader("Content-Type","application/json"),r.onreadystatechange=()=>{r.readyState===XMLHttpRequest.DONE&&(r.status>=200||r.status<300)?N.isFunction(t)&&t():N.isFunction(s)&&s()},r.send(JSON.stringify(e.getBody()))}}catch(e){N.isFunction(s)&&s(y.showError(l,l.ErrorCode.PUSH_EVENT_ERROR,e))}}else N.isFunction(s)&&s(y.showError(l,l.ErrorCode.GENERAL_ERROR_BAD_REQUEST));return!0}async postEventPushClick(e){let t="/event/push";e.journeyStateId&&(e.setJourneyRequest(!0),t=URL_PUSH+URL_EVENT_CLICK),e.setServiceWorkerRequest(!0),await this.post(t,e.postEventPushRequest())}},{Config:C}=s(916).Core,{BaseRequest:D}=s(916).Core.Api,b=class extends D{getApplicationRequest(){return this.params=this.PARAM_PLATFORM+"="+C.platform,this}},{DeviceStatus:f}=s(916).Core.Models,{BaseRequest:L}=s(916).Core.Api,v=class extends L{constructor(e=f.DEFAULT){super(),this.device=new p,this.status=e,this.notToUpdate=!1,this.deviceUpdate=!1}isDeviceUpdated(e){this.deviceUpdate=e}setDeviceId(e){this.device&&(this.device.deviceId=e)}setAppKey(e){this.appKey=e}getDeviceRequest(){return this.params=this.createQueryString(),this}postDeviceRequest(){return this.body=this.createDeviceJson(),this.status!==f.DEFAULT&&(this.body.enabled=1===this.status),this}putDeviceRequest(e){return this.params=this.createQueryString(),this.body=this.createPUTDeviceJson(e),this.status!==f.DEFAULT&&(this.body.enabled=1===this.status),this}getDeviceTopicsRequest(){return this.params=this.createQueryString(),this}postDeviceTopicsRequest(){return this.params=this.createQueryString(),this.body=this.createTopicsJson(),this}deleteDeviceTopicsRequest(){return this.params=this.createQueryString(),this.body=this.createTopicsJson(),this}createQueryString(){return this.PARAM_DEVICE_ID+"="+this.device.deviceId}createDeviceJson(){let e={};try{e=this.device.toJSON()}catch(e){}return e}createPUTDeviceJson(e){let t={};try{p.setDeviceJson(e),t=e.toJSON()}catch(e){}return t}createTopicsJson(){const e={};return this.topics&&(e.topics=this.topics),e}getDeviceId(){return this.device.getDeviceId()}setTopics(e){this.topics=e}setExternalCode(e){this.device.setExternalCode(e)}},B=Object.freeze({PERMISSION_TYPE_PUSH:"push",PERMISSION_TYPE_LOCATION:"location"}),{CorePermissions:U}=s(916).Core.Utils,M=class{static async getPermissions(){const e=await U.getPermissions(),t=await U.getPermission("push");return t&&(e.push=t.state),null===t&&window.Notification&&window.Notification.permission&&(e.push=window.Notification.permission),e}static async setPermissionsCallback(){U.setPermissionsCallback(),await U.setCallback("push",navigator.indigitallRequestPushPermission)}},{Log:V,CommonUtils:x,ErrorUtils:Y}=s(916).Core.Utils,{EventType:F}=s(916).Core.Models,K="[IND]IndigitallSafari: ",k=class{static isSafariPushNotificationSupported(){return!!R.isSafariBrowserDevice()||!!window?.safari?.pushNotification}static async launchNotificationPermissionForSafari(){const e=new V(K);if(n.getSafariGestureRequestPermission()===F.EVENT_TYPE_ASK)if(n.getSafariWebsitePushId()&&n.getDeviceId())if(R.isSafariBrowserDevice()&&n.getWorkerPath()){const e=await navigator.serviceWorker.register(n.getWorkerPath());"granted"===await window.Notification.requestPermission()&&(n.setPermissionPush(F.EVENT_TYPE_ACCEPT),Re.subscribeForPushNotification(e))}else{const e=window.safari.pushNotification.permission(n.getSafariWebsitePushId());this.checkRemotePermission(e)}else n.getSafariWebsitePushId()?e.w("error Device Id is not found").writeLog():e.w("error Safari Website Push Id is not found").writeLog();else e.w("there was not user gesture to request safari permissions").writeLog()}static async checkRemotePermission(e){const t=new V(K);try{if("default"===e.permission){const e={deviceCode:n.getDeviceId()};t.d("permission default: ",e).writeLog(),n.getPermissionPush()||d.callEventPermission(B.PERMISSION_TYPE_PUSH,F.EVENT_TYPE_ASK),window.safari.pushNotification.requestPermission(await w.getURL()+"/safari",n.getSafariWebsitePushId(),e,window.indigitall.Push.checkRemotePermission)}else"denied"===e.permission?(t.w("permission denied: ",e).writeLog(),n.getPermissionPush()&&n.getPermissionPush()!=F.EVENT_TYPE_REJECT&&(d.callEventPermission(B.PERMISSION_TYPE_PUSH,F.EVENT_TYPE_REJECT),n.setPermissionPush(F.EVENT_TYPE_REJECT))):"granted"===e.permission&&(t.d("permission granted: ",e).writeLog(),n.getPermissionPush()&&n.getPermissionPush()!=F.EVENT_TYPE_ACCEPT&&(d.callEventPermission(B.PERMISSION_TYPE_PUSH,F.EVENT_TYPE_ACCEPT),n.setPermissionPush(F.EVENT_TYPE_ACCEPT)),e.deviceToken&&e.deviceToken!==n.getPushToken()&&(n.setPushToken(e.deviceToken),w.putDevice(new v,(e=>{if(x.isFunction(navigator.indigitallOnInitialized)){const e={};e.push=n.getPermissionPush(),e.location=n.getPermissionLocation(),navigator.indigitallOnInitialized(e,new p)}x.isFunction(navigator.indigitallOnNewUserRegistered)&&!n.getNewUserTimestamp()&&(n.setNewUserTimestamp(Date.now()),navigator.indigitallOnNewUserRegistered(e)),Re.registerLocation()}),navigator.indigitallOnError),n.setServiceTimestamp(Date.now())))}catch(e){x.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(Y.showError(l,l.ErrorCode.PUSH_INITIALIZATION_ERROR,e))}}},G=new class{constructor(){this.TOPIC_SYNC_TIMESTAMP=3e4,this.TOPIC_SYNC_TAG="syncTopics",this.TOPIC_SYNC_SUBSCRIBE_CALLBACK="indigitallSyncTopicSubscribeOnSuccess",this.TOPIC_SYNC_SUBSCRIBE_ERROR_CALLBACK="indigitallSyncTopicSubscribeOnError",this.TOPIC_SYNC_UNSUBSCRIBE_CALLBACK="indigitallSyncTopicUnsubscribeOnSuccess",this.TOPIC_SYNC_UNSUBSCRIBE_ERROR_CALLBACK="indigitallSyncTopicUnsubscribeOnError"}},q=Object.freeze({GREEN:"green",RED:"red"}),{EventType:W}=s(916).Core.Models,{Config:j}=s(916).Core,X=class{static async requestBackgroundSync(){const e=await navigator.serviceWorker.getRegistration(n.getWorkerPath());return null!=e?e:null}static findIndigitallSW(e){for(let t=0;t<e.length;t++)if(void 0!==e[t]&&e[t].active&&e[t].active.scriptURL&&e[t].active.scriptURL.includes("worker.min.js"))return e[t];return null}static async sendEventRequest(e,t){const s=new I;s.setAppKey(e.appKey),s.setDeviceId(e.deviceId),s.setPlatform(j.platform),s.setPushId(""+e.id),s.setSendingId(""+e.sendingId),e.campaignId&&s.setCampaingId(""+e.campaignId),e.journeyStateId&&s.setJourneyStateId(e.journeyStateId),e.journeyExecution&&s.setJourneyExecution(e.journeyExecution),e.cjCurrentStateId&&s.setCjCurrentStateId(e.cjCurrentStateId),s.setEventType(W.EVENT_TYPE_CLICK),await s.setExternalCodeRequest(),"action-1"==t.action?s.setClickedButton(1):"action-2"==t.action?s.setClickedButton(2):s.setClickedButton(0),s.setServiceWorkerRequest(!0),await w.postEventPushClick(s)}},{CommonUtils:H}=s(916).Core.Utils,J=class{static async setTopicRequest(e){const t=new v;return t.setAppKey(await n.getAppKeySync()),t.setDeviceId(await n.getDeviceIdSync()),t.setServiceWorkerRequest(!0),t.setTopics(e),t}static async getTopicsList(e,t){try{const s=await n.getTopicList();s&&s.length>0?await oe.isTopicTimestampExceed()?this.getDeviceTopicClient(e,t):(await n.setTopicSemaphore(q.GREEN),H.isFunction(e)&&e(s)):this.getDeviceTopicClient(e,t)}catch(e){await n.setTopicSemaphore(q.GREEN)}}static async getDeviceTopicClient(e,t){try{w.getDeviceTopics(new v,(async t=>{await oe.setTopicTimestamp(),await n.setTopicList(t),await n.setTopicSemaphore(q.GREEN),H.isFunction(e)&&e(t)}),(async e=>{await oe.setTopicTimestamp(),await n.setTopicSemaphore(q.GREEN),H.isFunction(t)&&t(e)}))}catch(e){await n.setTopicSemaphore(q.GREEN),H.isFunction(t)&&t(e)}}},Q=class{constructor(e,t){this.code=e,this.type=t}static getAllCodes(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].code);return t}toJSON(){const e={};return this.code&&(e.code=this.code),this.type&&(e.type=this.type),e}},{Channel:z,TopicSubscribeType:$}=s(916).Core.Models,{ErrorUtils:Z,Log:ee}=s(916).Core.Utils;class te{static async syncTopics(){if(!await n.getTopicSyncIsProcessing()){await n.setTopicSyncIsProcessing(!0);const e=setTimeout((async function(){try{await te.sendTopicSync()}catch(e){}await n.setTopicSyncIsProcessing(!1),clearTimeout(e)}),G.TOPIC_SYNC_TIMESTAMP)}}static async sendTopicSync(){const e=await oe.filterTopicExistingOnIDB(),t=oe.topicFilter(e,$.SUBSCRIBE),s=oe.topicFilter(e,$.UNSUBSCRIBE);if(t&&t.length>0)w.postDeviceTopicsRequest(await J.setTopicRequest(t),(async e=>{await oe.setTopicTimestamp(),e.channel=z.PUSH,await n.setTopicList(e),oe.indigitallSyncTopicEvent(G.TOPIC_SYNC_SUBSCRIBE_CALLBACK,e)}),(async e=>{oe.indigitallSyncTopicEvent(G.TOPIC_SYNC_SUBSCRIBE_ERROR_CALLBACK,e)}));else if(s&&s.length>0)w.deleteDeviceTopicsRequest(await J.setTopicRequest(s),(async e=>{await oe.setTopicTimestamp(),await n.setTopicList(e),oe.indigitallSyncTopicEvent(G.TOPIC_SYNC_UNSUBSCRIBE_CALLBACK,e)}),(async e=>{oe.indigitallSyncTopicEvent(G.TOPIC_SYNC_UNSUBSCRIBE_ERROR_CALLBACK,e)}));else{const e=Z.showError(l,l.ErrorCode.PUSH_TOPICS_ERROR,"there is no topic with one of the codes in the push topic list");oe.indigitallSyncTopicEvent(G.TOPIC_SYNC_SUBSCRIBE_ERROR_CALLBACK,e),oe.indigitallSyncTopicEvent(G.TOPIC_SYNC_UNSUBSCRIBE_ERROR_CALLBACK,e)}await n.setUpdateTopicSubscribe([])}static async updateTopicAction(e,t){const s=await n.getUpdateTopicSubscribe();if(s&&s.length>0){const i=new ee("[IND]TopicSyncUtils: ");try{const i=[],r=s.filter((t=>e.includes(t.code))),o=e.filter((e=>!Q.getAllCodes(s).includes(e)));if(o&&o.length>0)for(let e=0;e<o.length;e++)null!==o[e]&&i.push(new Q(o[e],t).toJSON());if(r&&r.length>0)for(let e=0;e<r.length;e++){const i=s.findIndex((t=>t.code===r[e].code)),n=new Q(r[e].code,t);s[i]=n.toJSON()}i.length>0&&await n.setUpdateTopicSubscribe(i.concat(s))}catch(e){i.e("updateTopicAction: "+e).writeLog()}}else{const s=[];for(let i=0;i<e.length;i++){const r=e[i];s.push({code:r,type:t})}await n.setUpdateTopicSubscribe(s)}}}const se=te,{TopicSubscribeType:ie}=s(916).Core.Models,{CommonUtils:re}=s(916).Core.Utils;class ne{static async updateTopic(e,t,s,i){ne.checkTopicSemaphore().then((async()=>{await n.setTopicSemaphore(q.RED),await J.getTopicsList((async r=>{await this.setTopicCallbacks(e,s,i),await this.requestTopicBackground(G.TOPIC_SYNC_TAG),await se.updateTopicAction(t,e)}),i)}))}static async checkTopicSemaphore(){if(await n.getTopicSemaphore()!=q.RED)return!0;this.topicSemaphoreWaitTime((()=>!0))}static async topicSemaphoreWaitTime(e){const t=setInterval((async function(){await n.getTopicSemaphore()==q.GREEN&&(clearInterval(t),e())}),1e3)}static async setTopicCallbacks(e,t,s){let i=G.TOPIC_SYNC_SUBSCRIBE_CALLBACK,r=G.TOPIC_SYNC_SUBSCRIBE_ERROR_CALLBACK;e===ie.UNSUBSCRIBE&&(i=G.TOPIC_SYNC_UNSUBSCRIBE_CALLBACK,r=G.TOPIC_SYNC_UNSUBSCRIBE_ERROR_CALLBACK);const n=new BroadcastChannel(i);n.onmessage=e=>{re.isFunction(t)&&t(e.data),n.close()};const o=new BroadcastChannel(r);o.onmessage=e=>{re.isFunction(s)&&s(e.data),o.close()}}static async requestTopicBackground(e){const t=await X.requestBackgroundSync();null!=t&&await t.sync.register(e)}static async isTopicTimestampExceed(){const e=await n.getTopicSyncTimestamp();return!(e&&e>Date.now())&&void 0!==e}static async setTopicTimestamp(){const e=Date.now()+G.TOPIC_SYNC_TIMESTAMP;await n.setTopicSyncTimestamp(e)}static indigitallSyncTopicEvent(e,t){new BroadcastChannel(e).postMessage(t)}static topicFilter(e,t){const s=[];if(e)for(let i=0;i<e.length;i++)e[i].type===t&&s.push(e[i].code);return s}static async filterTopicExistingOnIDB(){const e=await n.getUpdateTopicSubscribe(),t=await n.getTopicList(),s=[];for(let i=0;i<e.length;i++)for(let r=0;r<t.length;r++)e[i]&&t[r]&&e[i].code==t[r].code&&(!0===t[r].subscribed&&e[i].type==ie.UNSUBSCRIBE||!1===t[r].subscribed&&e[i].type==ie.SUBSCRIBE)&&s.push(e[i]);return s}}const oe=ne,{EventType:ae,DeviceStatus:ce}=s(916).Core.Models,{LogLevel:le,Log:Ee,CommonUtils:he,ErrorUtils:Ie,CryptoUtils:de}=s(916).Core.Utils,ue="[IND]IndigitallPush: ";class ge{constructor(){this.config=null,this.interval=null}static async init(e){try{let s=new Ee(ue);if(!e)return void s.w("config is not defined").writeLog();e.onPushPermissionChanged&&(e.requestPushPermission=e.onPushPermissionChanged),e.onLocationPermissionChanged&&(e.requestLocationPermission=e.onLocationPermissionChanged),this.config=e,this.config.logLevel?(n.setLogLevel(this.config.logLevel),s=new Ee(ue)):this.config.setDebugLog&&(n.setLogLevel(le.WARNING),s=new Ee(ue));let i="https://device-api.indigitall.com/v1",r="https://inbox-api.indigitall.com/v1",o="https://device-api.indigitall.com/v2";this.config.urlDeviceApi&&(i=this.config.urlDeviceApi),this.config.urlInAppApi&&(o=this.config.urlInAppApi),this.config.urlInboxApi&&(r=this.config.urlInboxApi),await n.setUrlDeviceApi(i),t()&&t().setUrlInboxApi(r),he.isFunction(this.config.requestPushPermission)&&(navigator.indigitallRequestPushPermission=this.config.requestPushPermission),he.isFunction(this.config.requestLocationPermission)&&(navigator.indigitallRequestLocationPermission=this.config.requestLocationPermission),he.isFunction(this.config.onNewUserRegistered)&&(navigator.indigitallOnNewUserRegistered=this.config.onNewUserRegistered),he.isFunction(this.config.onInitialized)&&(navigator.indigitallOnInitialized=this.config.onInitialized),he.isFunction(this.config.onError)&&(navigator.indigitallOnError=this.config.onError),he.isFunction(this.config.onLocationUpdated)&&(navigator.indigitallOnLocationUpdated=this.config.onLocationUpdated);const a=await M.getPermissions();if(M.setPermissionsCallback(),a&&"denied"===a.push)return s.i("Push permission denied").writeLog(),he.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError("Push permission denied"),!1;if(!he.isServiceTimestampExceed())return this.device=new p,M.getPermissions().then((e=>{he.isFunction(navigator.indigitallOnInitialized)&&navigator.indigitallOnInitialized(e,new p)})),s.d("Device enabled").writeLog(),!0;{let e="",i=null;if(!this.config||!this.config.appKey)return s.w("config.appKey is not defined").writeLog(),!1;if(e=this.config.appKey,this.config.requestLocation&&await n.setRequestLocation(this.config.requestLocation),this.config.workerPath&&(i=this.config.workerPath),e){if(await n.setAppKey(e),ge.isServiceWorkerSupported()||k.isSafariPushNotificationSupported()){const e=new b;return w.getBrowser(e,(e=>{if(e.supported||this.isSafariBrowserDevice()){s.d("browser supported for webpush").writeLog();const e=new b;w.getApplicationAll(e,(async e=>{if(s.d("application ",e).writeLog(),e&&e.data&&e.data.configuration){const i=e.data.configuration;s.d("configuration ",i).writeLog(),i.vapidPublic&&n.setVAPID(i.vapidPublic),i.safariWebsitePushId&&n.setSafariWebsitePushId(i.safariWebsitePushId),i.enabled&&n.setEnabled(i.enabled),i.serviceSyncTime&&n.setServiceSyncTime(i.serviceSyncTime),i.locationEnabled&&n.setLocationEnabled(i.locationEnabled),i.locationUpdateMinutes&&n.setLocationUpdateMinutes(i.locationUpdateMinutes),i.inboxAuthMode&&t()&&t().setInboxAuthMode(i.inboxAuthMode),i.inAppEnabled&&(n.setInAppEnabled(i.inAppEnabled),await n.setUrlInappApi(o))}const r=new v;n.getDeviceId()&&n.getPushToken()?w.putDevice(r,(e=>{try{if(he.isServiceTimestampExceed()){const e=new I;e.setAppKey(n.getAppKey()),e.setDeviceId(n.getDeviceId()),w.postEventVisit(e)}e.registeredByCookie?(n.setServiceTimestamp(Date.now()),M.getPermissions().then((e=>{const t=new p;t.deviceId&&s.i("deviceId:",t.deviceId).writeLog(),t.pushToken&&s.i("pushToken:",t.pushToken).writeLog(),this.config&&he.isFunction(navigator.indigitallOnInitialized)&&navigator.indigitallOnInitialized(e,t)}))):ge.registerForPush(i)}catch(e){he.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(Ie.showError(l,l.ErrorCode.PUSH_INITIALIZATION_ERROR,e))}}),navigator.indigitallOnError):w.postDevice(r,(e=>{try{const t=new I;t.setAppKey(n.getAppKey()),t.setDeviceId(n.getDeviceId()),w.postEventVisit(t),e.registeredByCookie?n.setServiceTimestamp(Date.now()):ge.registerForPush(i)}catch(e){he.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(Ie.showError(l,l.ErrorCode.PUSH_INITIALIZATION_ERROR,e))}}),(e=>{404===e.errorCode&&n.clearStorage(),he.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(e)}))}),navigator.indigitallOnError)}else s.w("Browser not Supported").writeLog()}),navigator.indigitallOnError),!0}s.w("ServiceWorker and SafariPushNotification not supported").writeLog()}else s.w("appKey is not found").writeLog()}}catch(e){he.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(Ie.showError(l,l.ErrorCode.PUSH_INITIALIZATION_ERROR,e))}return!1}static deviceGet(e,t){return w.getDevice(new v,e,t),!0}static deviceEnable(e,t){const s=new v(ce.ENABLE);return s.isDeviceUpdated(!0),w.putDevice(s,e,t),!0}static deviceDisable(e,t){const s=new v(ce.DISABLE);return s.isDeviceUpdated(!0),w.putDevice(s,e,t),!0}static topicsList(e,t){return w.getDeviceTopics(new v,(async t=>{he.isFunction(e)&&e(t)}),(e=>{he.isFunction(t)&&t(e)})),!0}static topicsSubscribe(e,t,s){const i=new v;return i.setTopics(e),w.postDeviceTopics(i,(e=>{he.isFunction(t)&&t(e)}),(e=>{he.isFunction(s)&&s(e)})),!0}static topicsUnsubscribe(e,t,s){const i=new v;return i.setTopics(e),w.deleteDeviceTopics(i,(e=>{he.isFunction(t)&&t(e)}),(e=>{he.isFunction(s)&&s(e)})),!0}static async topicsSubscribeUpdate(e,t,s,i){oe.updateTopic(e,t,s,i)}static registerForPush(e){n.setWorkerPath(e),k.isSafariPushNotificationSupported()?k.launchNotificationPermissionForSafari():ge.isServiceWorkerSupported()&&ge.launchNotificationPermission(e)}static isSafariPushNotificationSupported(){return k.isSafariPushNotificationSupported()}static isSafariBrowserDevice(){return R.isSafariBrowserDevice()}static isServiceWorkerSupported(){return"serviceWorker"in navigator}static registerServiceWorker(e){const t=new Ee(ue);let s="/service-worker.js";return e&&(s=e),navigator.serviceWorker.register(s).then((e=>(t.d("ServiceWorker registration successful with scope: "+e.scope).writeLog(),e))).catch((e=>(t.e("ServiceWorker registration failed: ",e).writeLog(),e)))}static launchNotificationPermission(e){const t=new Ee(ue);this.registerServiceWorker(e).then((e=>{try{let s;e.installing?s=e.installing:e.waiting?s=e.waiting:e.active&&(s=e.active),s&&(t.d("sw current state "+s.state).writeLog(),"activated"==s.state?ge.subscribeForPushNotification(e):("installed"==s.state&&n.getPushToken()&&e.update(),s.addEventListener("statechange",(function(s){t.d("sw statechange : "+s.target.state).writeLog(),"activated"==s.target.state&&ge.subscribeForPushNotification(e)}))))}catch(e){he.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(Ie.showError(l,l.ErrorCode.PUSH_INITIALIZATION_ERROR,e))}}))}static async subscribeForPushNotification(e){const t=new Ee(ue);try{const s=await new Promise(((s,i)=>{const r={userVisibleOnly:!0,applicationServerKey:d.urlBase64ToUint8Array(n.getVAPID())};return t.d("Registration: ",e).writeLog(),n.getPermissionPush()||d.callEventPermission(B.PERMISSION_TYPE_PUSH,ae.EVENT_TYPE_ASK),s(e.pushManager.subscribe(r))}));t.d("Received PushSubscription: ",s).writeLog(),n.getPermissionPush()&&n.getPermissionPush()===ae.EVENT_TYPE_ACCEPT||(d.callEventPermission(B.PERMISSION_TYPE_PUSH,ae.EVENT_TYPE_ACCEPT),n.setPermissionPush(ae.EVENT_TYPE_ACCEPT));const i=s.toJSON();n.setBrowserPublicKey(i.keys.p256dh),n.setBrowserPrivateKey(i.keys.auth),n.setPushToken(i.endpoint),w.putDevice(new v,(e=>{M.getPermissions().then((e=>{he.isFunction(navigator.indigitallOnInitialized)&&navigator.indigitallOnInitialized(e,new p)})),he.isFunction(navigator.indigitallOnNewUserRegistered)&&!n.getNewUserTimestamp()&&(n.setNewUserTimestamp(Date.now()),navigator.indigitallOnNewUserRegistered(e)),ge.registerLocation()}),navigator.indigitallOnError),n.setServiceTimestamp(Date.now())}catch(e){t.e("No Registration: "+e).writeLog(),n.getPermissionPush()&&n.getPermissionPush()===ae.EVENT_TYPE_REJECT||(d.callEventPermission(B.PERMISSION_TYPE_PUSH,ae.EVENT_TYPE_REJECT),n.setPermissionPush(ae.EVENT_TYPE_REJECT)),he.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(e)}}static async launchNotificationPermissionForSafari(){n.setSafariGestureRequestPermission(ae.EVENT_TYPE_ASK),k.launchNotificationPermissionForSafari()}static async checkRemotePermission(e){k.checkRemotePermission(e)}static registerLocation(){const e=new Ee(ue);try{navigator.geolocation&&n.getRequestLocation()&&n.getLocationEnabled()&&(!n.getLocationTimestamp()||n.getLocationUpdateMinutes()<=(Date.now()-n.getLocationTimestamp())/6e4)&&(n.getPermissionLocation()||d.callEventPermission(B.PERMISSION_TYPE_LOCATION,ae.EVENT_TYPE_ASK),navigator.geolocation.getCurrentPosition((e=>{n.getPermissionLocation()||n.getPermissionLocation()==ae.EVENT_TYPE_ACCEPT||(d.callEventPermission(B.PERMISSION_TYPE_LOCATION,ae.EVENT_TYPE_ACCEPT),n.setPermissionLocation(ae.EVENT_TYPE_ACCEPT));const t=new I;t.setLocation(e.coords.latitude,e.coords.longitude),w.postEventLocation(t),he.isFunction(navigator.indigitallOnLocationUpdated)&&navigator.indigitallOnLocationUpdated(e),n.setLocationTimestamp(Date.now())}),(t=>{e.e("error "+t).writeLog(),n.getPermissionLocation()||n.getPermissionLocation()==ae.EVENT_TYPE_REJECT||(d.callEventPermission(B.PERMISSION_TYPE_LOCATION,ae.EVENT_TYPE_REJECT),n.setPermissionLocation(ae.EVENT_TYPE_REJECT))})))}catch(e){he.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(Ie.showError(l,l.ErrorCode.PUSH_EVENT_ERROR,e))}}static requestPushPermission(e){M.getPushPermission().then((t=>{he.isFunction(e)&&e(t)}))}static onPermissionChange(){M.setPermissionCallback()}static requestLocationPermission(e){M.getLocationPermission().then((t=>{he.isFunction(e)&&e(t)}))}static logIn(e,t,s){ge.setExternalId(e,t,s)}static logout(e,t){ge.setExternalId(null,e,t)}static setExternalCode(e,t,s){ge.setExternalId(e,t,s)}static async setExternalId(e,t,s){try{const i=n.getAppKey();if(!i)return void(he.isFunction(s)&&s(Ie.showError(l,l.ErrorCode.API_APPKEY_NOT_VALID)));if(null!=e){const r=await de.createHmac(i,e);r&&this.setExternalIdRequest(r,t,s)}else this.setExternalIdRequest(null,t,s)}catch(e){he.isFunction(s)&&s(Ie.showError(l,l.ErrorCode.PUSH_DEVICE_ERROR,e))}}static async setExternalIdRequest(e,t,s){const i=new v;n.setExternalId(e),await n.setExternalIdRequest(e),i.setExternalCode(e),i.isDeviceUpdated(!0),w.putDevice(i,(e=>{he.isFunction(t)&&t(new p(e))}),s)}static sendCustomEvent(e,t,s){try{let i="",r={},o=!0;"string"==typeof e?i=e:"object"==typeof e&&(i=e.eventType,e.customData&&(r=e.customData),!1===e.async&&(o=e.async));const a=new I;a.setDeviceId(n.getDeviceId()),a.setEventType(i),a.setCustomData(r),null!=n.getExternalId()&&"null"!=n.getExternalId()?(a.setExternalCode(n.getExternalId()),a.setJourneyRequest(!0),!1===o?w.postEventJourneySync(a,t,s):w.postEventJourney(a,t,s)):!1===o?w.postEventCustomSync(a,t,s):w.postEventCustom(a,t,s)}catch(e){he.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(Ie.showError(l,l.ErrorCode.PUSH_EVENT_ERROR,e))}}static sendJourneyEvent(e,t,s){try{let i="",r={},o=!0;"string"==typeof e?i=e:"object"==typeof e&&(i=e.eventType,e.customData&&(r=e.customData),!1===e.async&&(o=e.async));const a=new I;a.setDeviceId(n.getDeviceId()),a.setExternalCodeRequest(),a.setEventType(i),a.setCustomData(r),a.setJourneyRequest(!0),!1===o?w.postEventJourneySync(a,t,s):w.postEventJourney(a,t,s)}catch(e){he.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(Ie.showError(l,l.ErrorCode.PUSH_EVENT_ERROR,e))}}}const Re=ge;window.indigitall||(window.indigitall={}),window.indigitall.Push=ge,window.indigitall.LogLevel=le,window.indigitall.version=n.getVersion()})(),r})(),e.exports=t()},391:e=>{"use strict";e.exports=JSON.parse('{"name":"indigitall-web-core","description":"indigitall web core","version":"4.3.1","main":"index.js","author":"Smart2me S.L.","homepage":"https://indigitall.com","devDependencies":{"@babel/preset-env":"^7.18.10","babel-loader":"^8.2.5","filemanager-webpack-plugin":"^7.0.0","idempotent-babel-polyfill":"^7.4.4","script-loader":"^0.7.2","webpack":"^5.74.0","webpack-bundle-analyzer":"^4.6.1","webpack-cli":"^4.10.0"},"scripts":{"test":"echo \'There are not tests\'","public":"ws --directory ./public --port 80 --log.format dev","build":"webpack --config webpack.config.js --mode=production","build-dev":"webpack --config webpack.config.js --watch --mode=development","delete-node-modules":"rm -rf node_modules/ && rm -f package-lock.json","install-core":"npm install && npm run build"}}')},147:e=>{"use strict";e.exports=JSON.parse('{"name":"indigitall-web-sdk","description":"indigitall webpush SDK","version":"4.3.1","main":"index.js","author":"Smart2me S.L.","homepage":"https://indigitall.com","dependencies":{"indigitall-web-core":"file:../core","indigitall-web-inapp":"file:../inapp","indigitall-web-customer":"file:../customer","indigitall-web-inbox":"file:../inbox","indigitall-web-notification":"file:../push"},"devDependencies":{"@babel/preset-env":"^7.18.10","babel-loader":"^8.2.5","filemanager-webpack-plugin":"^7.0.0","idempotent-babel-polyfill":"^7.4.4","webpack":"^5.74.0","webpack-bundle-analyzer":"^4.6.1","webpack-cli":"^4.10.0"},"scripts":{"test":"echo \'There are not tests\'","public":"ws --directory ./public --port 80 --log.format dev","build":"webpack --config webpack.config.js --mode=production","build-dev":"webpack --config webpack.config.js --watch --mode=development","build-sdk":"npm run build-install-core && npm run build-install-inapp && npm run build","build-install-core":"npm uninstall indigitall-web-core && npm install ../core","build-install-inapp":"npm uninstall indigitall-web-inapp && npm install ../inapp","build-install-customer":"npm uninstall indigitall-web-customer && npm install ../customer","build-install-inbox":"npm uninstall indigitall-web-inbox && npm install ../inbox","build-install-push":"npm uninstall indigitall-web-notification && npm install ../push","install-sdk":"npm install && npm run build","release-install-core":"npm uninstall indigitall-web-core && npm install indigitall-web-core@$npm_package_version","release-install-inapp":"npm uninstall indigitall-web-inapp && npm install indigitall-web-inapp@$npm_package_version ","release-install-customer":"npm uninstall indigitall-web-customer && npm install indigitall-web-customer@$npm_package_version ","release-install-inbox":"npm uninstall indigitall-web-inbox && npm install indigitall-web-inbox@$npm_package_version ","release-install-push":"npm uninstall indigitall-web-notification && npm install indigitall-web-notification@$npm_package_version && npm run release-install-core && npm run release-install-inapp && npm run release-install-inbox && npm run release-install-customer && npm run install-sdk && npm run delete-node-modules","simulate-release-install-sdk":"npm run install-sdk && npm run delete-node-modules","delete-node-modules":"rm -rf node_modules/ && rm -f package-lock.json"}}')}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,s),n.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";s.r(r);var e=s(253),t=s.n(e),i=s(557),n=s.n(i),o=s(691),a=s.n(o),c=s(867),l=s.n(c);const{Log:E,LogLevel:h,CommonUtils:I,ErrorUtils:d}=s(109).Core.Utils,{Repository:u}=s(109).Core,g=s(147),{Channel:R}=s(109).Core.Models,_="[IND]Indigitall: ";class p{constructor(){this.config=null}static async init(e){return l().init(e)}static deviceGet(e,t){return l().devideGet(e,t)}static deviceEnable(e,t){return l().deviceEnable(e,t)}static deviceDisable(e,t){return l().deviceDisable(e,t)}static topicsList(e,t){return l().topicsList((t=>{this.inAppTopicList(t,e,(s=>{new E(_).w(s.message).writeLog(),I.isFunction(e)&&e(t)}))}),(s=>{new E(_).w(s).writeLog(),this.inAppTopicList(null,e,t)}))}static async inAppTopicList(e,s,i){(new u).isInAppEnabled()?t().topicsList((async t=>{null!=e?(await(new u).setTopicList(e),await(new u).setInAppTopicList(t),I.isFunction(s)&&s(t.concat(e))):(await(new u).setInAppTopicList(t),I.isFunction(s)&&s(t))}),(async t=>{null!=e?(await(new u).setTopicList(e),I.isFunction(s)&&s(e)):I.isFunction(i)&&i(t)})):null!=e?(await(new u).setTopicList(e),I.isFunction(s)&&s(e)):I.isFunction(i)&&i(d.showError(null,null,"Internal error bad topic list"))}static topicsSubscribe(e,s,i){(new u).isInAppEnabled()?t().topicsSubscribe(e,(t=>{this.pushTopicsSubscribe(e,t,s,i)}),(async t=>{new E(_).w(t).writeLog(),this.pushTopicsSubscribe(e,null,s,i)})):this.pushTopicsSubscribe(e,null,s,i)}static pushTopicsSubscribe(e,t,s,i){l().topicsSubscribe(e,(async e=>{this.topicActionOnSuccess(t,e,s)}),(async e=>{this.topicActionOnError(t,e,s,i)}))}static async topicsUnsubscribe(e,s,i){(new u).isInAppEnabled()?t().topicsUnsubscribe(e,(t=>{this.pushTopicsUnsubscribe(e,t,s,i)}),(async t=>{new E(_).w(t).writeLog(),this.pushTopicsUnsubscribe(e,null,s,i)})):this.pushTopicsUnsubscribe(e,null,s,i)}static pushTopicsUnsubscribe(e,t,s,i){l().topicsUnsubscribe(e,(async e=>{this.topicActionOnSuccess(t,e,s)}),(async e=>{this.topicActionOnError(t,e,s,i)}))}static async topicActionOnSuccess(e,t,s){let i=[];null!=e&&(i=e,await(new u).setInAppTopicList(e)),null!=t&&await(new u).setTopicList(t),I.isFunction(s)&&s(i.concat(t))}static async topicActionOnError(e,t,s,i){new E(_).w(`${t.errorCode}: ${t.exceptionMessage}`).writeLog(),null!=e?(await(new u).setInAppTopicList(e),I.isFunction(s)&&s(e)):I.isFunction(i)&&i(t)}static async setExternalId(e,t,s){l().setExternalId(e,t,s)}static logIn(e,t,s){p.setExternalId(e,t,s)}static logout(e,t){p.setExternalId(null,e,t)}static sendCustomEvent(e,t,s){l().sendCustomEvent(e,t,s)}static sendJourneyEvent(e,t,s){l().sendJourneyEvent(e,t,s)}static isServiceWorkerSupported(){return l().isServiceWorkerSupported()}static isSafariPushNotificationSupported(){return l().isSafariPushNotificationSupported()}static isSafariPermissionAsked(){return l().isSafariPermissionAsked()}static isSafariBrowserDevice(){return l().isSafariBrowserDevice()}static launchNotificationPermissionForSafari(){l().launchNotificationPermissionForSafari()}static async showInApp(e,s,i,r){t().showInApp(e,s,i,r)}static async showInAppWithConfig(e,s,i,r,n,o,a,c,l,E,h){t().showInAppWithConfig(e,s,i,r,n,o,a,c,l,E,h)}static showMultipleInApp(e,s,i,r){t().showMultipleInApp(e,s,i,r)}static async showMultipleInAppWithConfig(e,s,i,r,n,o,a,c,l,E,h){t().showMultipleInAppWithConfig(e,s,i,r,n,o,a,c,l,E,h)}static getInboxMessagesCount(e,t,s){n().getMessagesCountWithAuth(e,t,s)}static getInbox(e,t,s){n().getInboxWithAuth(e,t,s)}static getInboxWithPage(e,t,s,i,r,o,a,c){n().getInboxWithPage(e,t,s,i,r,o,a,c)}static getCustomer(e,t){a().getCustomer(e,t)}static getCustomerInformation(e,t){this.getCustomerInformationWithFields(null,e,t)}static getCustomerInformationWithFields(e,t,s){a().getCustomerInformation(e,t,s)}static assignOrUpdateValueToCustomerFields(e,t,s){a().assignOrUpdateValueToCustomerFields(e,t,s)}static deleteValuesFromCustomerFields(e,t,s){a().deleteValuesFromCustomerFields(e,t,s)}static link(e,t,s,i){p.logIn(e,(e=>{a().link(t,s,i)}),(e=>{I.isFunction(i)&&i(e)}))}static unlink(e,t,s){p.logout((i=>{a().unlink(e,t,s)}),(e=>{I.isFunction(s)&&s(e)}))}}window.indigitall=p,window.indigitall.InApp=t(),window.indigitall.Inbox=n(),window.indigitall.Customer=a(),window.indigitall.Push=l(),window.indigitall.InApp.Utils=t().Utils,window.indigitall.Channel=R,window.indigitall.LogLevel=h,window.indigitall.version=g.version})(),r})()));